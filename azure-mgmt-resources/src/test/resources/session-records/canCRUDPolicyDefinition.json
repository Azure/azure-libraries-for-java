{
  "networkCallRecords" : [ {
    "Method" : "PUT",
    "Uri" : "http://localhost:1234/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/policy1?api-version=2016-12-01",
    "Headers" : {
      "User-Agent" : "Azure-SDK-For-Java/null OS:Windows 10/10.0 MacAddressHash:6329c03b535ec33cd37fb229b82c5babb3cb7866e991f6299f1b3716d621b34d Java:1.8.0_221 (PolicyClient)",
      "Content-Type" : "application/json; charset=utf-8"
    },
    "Response" : {
      "date" : "Wed, 13 Nov 2019 06:04:34 GMT",
      "content-length" : "567",
      "expires" : "-1",
      "x-ms-ratelimit-remaining-subscription-writes" : "1196",
      "retry-after" : "0",
      "StatusCode" : "201",
      "pragma" : "no-cache",
      "strict-transport-security" : "max-age=31536000; includeSubDomains",
      "x-ms-correlation-request-id" : "3c163cbc-8df6-449d-ba60-5264f9c69b2a",
      "x-content-type-options" : "nosniff",
      "x-ms-routing-request-id" : "SOUTHEASTASIA:20191113T060435Z:3c163cbc-8df6-449d-ba60-5264f9c69b2a",
      "content-type" : "application/json; charset=utf-8",
      "cache-control" : "no-cache",
      "x-ms-request-id" : "southeastasia:0ce22d64-0493-41a4-ab77-ea5d5df4f8b9",
      "Body" : "{\"properties\":{\"displayName\":\"My Policy\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"This is my policy\",\"metadata\":{\"createdBy\":\"5b5e6b07-55b8-419b-a446-20fe0aa5b459\",\"createdOn\":\"2019-11-13T06:04:34.9335495Z\",\"updatedBy\":null,\"updatedOn\":null},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"northeurope\",\"westeurope\"]}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/policy1\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"policy1\"}"
    }
  }, {
    "Method" : "GET",
    "Uri" : "http://localhost:1234/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions?api-version=2016-12-01",
    "Headers" : {
      "User-Agent" : "Azure-SDK-For-Java/null OS:Windows 10/10.0 MacAddressHash:6329c03b535ec33cd37fb229b82c5babb3cb7866e991f6299f1b3716d621b34d Java:1.8.0_221 (PolicyClient)",
      "Content-Type" : "application/json; charset=utf-8"
    },
    "Response" : {
      "date" : "Wed, 13 Nov 2019 06:04:34 GMT",
      "content-length" : "1065971",
      "expires" : "-1",
      "transfer-encoding" : "chunked",
      "vary" : "Accept-Encoding,Accept-Encoding",
      "retry-after" : "0",
      "x-ms-ratelimit-remaining-subscription-reads" : "11999",
      "StatusCode" : "200",
      "pragma" : "no-cache",
      "strict-transport-security" : "max-age=31536000; includeSubDomains",
      "x-ms-correlation-request-id" : "f54bc20d-5df0-449d-ad18-15c79b75f94a",
      "x-content-type-options" : "nosniff",
      "x-ms-routing-request-id" : "SOUTHEASTASIA:20191113T060435Z:f54bc20d-5df0-449d-ad18-15c79b75f94a",
      "content-type" : "application/json; charset=utf-8",
      "cache-control" : "no-cache",
      "x-ms-request-id" : "southeastasia:963445fa-0ce9-4d4f-88aa-95c56aff4936",
      "Body" : "{\"value\":[{\"properties\":{\"displayName\":\"Audit virtual machines without disaster recovery configured\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Audit virtual machines which do not have disaster recovery configured. To learn more about disaster recovery, visit https://aka.ms/asr-doc.\",\"metadata\":{\"category\":\"Compute\"},\"parameters\":{},\"policyRule\":{\"if\":{\"field\":\"type\",\"in\":[\"Microsoft.Compute/virtualMachines\",\"Microsoft.ClassicCompute/virtualMachines\"]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.Resources/links\",\"existenceCondition\":{\"field\":\"name\",\"like\":\"ASR-Protect-*\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/0015ea4d-51ff-4ce3-8d8c-f3f8f0179a56\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"0015ea4d-51ff-4ce3-8d8c-f3f8f0179a56\"},{\"properties\":{\"displayName\":\"[Deprecated]: Audit Web Sockets state for a Function App\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"The Web Sockets protocol is vulnerable to different types of security threats. Use of Web Sockets within an Function app must be carefully reviewed.\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true,\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"microsoft.Web/sites\"},{\"anyOf\":[{\"field\":\"kind\",\"equals\":\"functionapp\"},{\"field\":\"kind\",\"equals\":\"functionapp,linux\"},{\"field\":\"kind\",\"equals\":\"functionapp,linux,container\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"DisableWebSockets\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/001802d1-4969-4c82-a700-c29c6c6f9bbd\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"001802d1-4969-4c82-a700-c29c6c6f9bbd\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs on which the remote host connection status does not match the specified one\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines on which the remote host connection status does not match the specified one. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WindowsRemoteConnection\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/02a84be7-c304-421f-9bb7-5d2c26af54ad\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"02a84be7-c304-421f-9bb7-5d2c26af54ad\"},{\"properties\":{\"displayName\":\"SQL managed instance TDE protector should be encrypted with your own key\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Transparent Data Encryption (TDE) with your own key support provides increased transparency and control over the TDE Protector, increased security with an HSM-backed external service, and promotion of separation of duties.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Sql/managedInstances\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Sql/managedInstances/encryptionProtector\",\"name\":\"current\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Sql/managedInstances/encryptionProtector/serverKeyType\",\"equals\":\"AzureKeyVault\"},{\"field\":\"Microsoft.Sql/managedInstances/encryptionProtector/uri\",\"notEquals\":\"\"},{\"field\":\"Microsoft.Sql/managedInstances/encryptionProtector/uri\",\"exists\":\"true\"}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/048248b0-55cd-46da-b1ff-39efd52db260\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"048248b0-55cd-46da-b1ff-39efd52db260\"},{\"properties\":{\"displayName\":\"Deploy Diagnostic Settings for Service Bus to Log Analytics workspace\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploys the diagnostic settings for Service Bus to stream to a regional Log Analytics workspace when any Service Bus which is missing this diagnostic settings is created or updated.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"DeployIfNotExists\",\"Disabled\"]},\"profileName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Profile name\",\"description\":\"The diagnostic settings profile name\"}},\"logAnalytics\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Log Analytics workspace\",\"description\":\"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\"strongType\":\"omsWorkspace\",\"assignPermissions\":true}},\"metricsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable metrics\",\"description\":\"Whether to enable metrics stream to the Event Hub - True or False\"},\"allowedValues\":[\"True\",\"False\"]},\"logsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable logs\",\"description\":\"Whether to enable logs stream to the Event Hub  - True or False\"},\"allowedValues\":[\"True\",\"False\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.ServiceBus/namespaces\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"name\":\"[parameters('profileName')]\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"[parameters('logsEnabled')]\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\"equals\":\"[parameters('metricsEnabled')]\"}]},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa\",\"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"resourceName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"logAnalytics\":{\"type\":\"string\"},\"metricsEnabled\":{\"type\":\"string\"},\"logsEnabled\":{\"type\":\"string\"},\"profileName\":{\"type\":\"string\"}},\"variables\":{},\"resources\":[{\"type\":\"Microsoft.ServiceBus/namespaces/providers/diagnosticSettings\",\"apiVersion\":\"2017-05-01-preview\",\"name\":\"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\"location\":\"[parameters('location')]\",\"dependsOn\":[],\"properties\":{\"workspaceId\":\"[parameters('logAnalytics')]\",\"metrics\":[{\"category\":\"AllMetrics\",\"enabled\":\"[parameters('metricsEnabled')]\",\"retentionPolicy\":{\"enabled\":false,\"days\":0}}],\"logs\":[{\"category\":\"OperationalLogs\",\"enabled\":\"[parameters('logsEnabled')]\"}]}}],\"outputs\":{}},\"parameters\":{\"location\":{\"value\":\"[field('location')]\"},\"resourceName\":{\"value\":\"[field('name')]\"},\"logAnalytics\":{\"value\":\"[parameters('logAnalytics')]\"},\"metricsEnabled\":{\"value\":\"[parameters('metricsEnabled')]\"},\"logsEnabled\":{\"value\":\"[parameters('logsEnabled')]\"},\"profileName\":{\"value\":\"[parameters('profileName')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/04d53d87-841c-4f23-8a5b-21564380b55e\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"04d53d87-841c-4f23-8a5b-21564380b55e\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy Log Analytics Agent for Linux VMs\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploy Log Analytics Agent for Linux VMs if the VM Image (OS) is in the list defined and the agent is not installed.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"logAnalytics\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Log Analytics workspace\",\"description\":\"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\"strongType\":\"omsWorkspace\",\"assignPermissions\":true}},\"listOfImageIdToInclude\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"Optional: List of VM images that have supported Linux OS to add to scope\",\"description\":\"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageId\",\"in\":\"[parameters('listOfImageIdToInclude')]\"},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"RHEL\",\"RHEL-SAP-HANA\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"6.*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"SUSE\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"SLES\",\"SLES-HPC\",\"SLES-HPC-Priority\",\"SLES-SAP\",\"SLES-SAP-BYOS\",\"SLES-Priority\",\"SLES-BYOS\",\"SLES-SAPCAL\",\"SLES-Standard\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"12*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Canonical\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"UbuntuServer\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"14.04*LTS\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"16.04*LTS\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"18.04*LTS\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Oracle\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Oracle-Linux\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"6.*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7.*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"OpenLogic\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"CentOS\",\"Centos-LVM\",\"CentOS-SRIOV\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"6.*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-centos-os\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"],\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Compute/virtualMachines/extensions/type\",\"equals\":\"OmsAgentForLinux\"},{\"field\":\"Microsoft.Compute/virtualMachines/extensions/publisher\",\"equals\":\"Microsoft.EnterpriseCloud.Monitoring\"},{\"field\":\"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\"equals\":\"Succeeded\"}]},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"logAnalytics\":{\"type\":\"string\"}},\"variables\":{\"vmExtensionName\":\"MMAExtension\",\"vmExtensionPublisher\":\"Microsoft.EnterpriseCloud.Monitoring\",\"vmExtensionType\":\"OmsAgentForLinux\",\"vmExtensionTypeHandlerVersion\":\"1.7\"},\"resources\":[{\"name\":\"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"apiVersion\":\"2018-06-01\",\"properties\":{\"publisher\":\"[variables('vmExtensionPublisher')]\",\"type\":\"[variables('vmExtensionType')]\",\"typeHandlerVersion\":\"[variables('vmExtensionTypeHandlerVersion')]\",\"autoUpgradeMinorVersion\":true,\"settings\":{\"workspaceId\":\"[reference(parameters('logAnalytics'), '2015-03-20').customerId]\",\"stopOnMultipleConnections\":\"true\"},\"protectedSettings\":{\"workspaceKey\":\"[listKeys(parameters('logAnalytics'), '2015-03-20').primarySharedKey]\"}}}],\"outputs\":{\"policy\":{\"type\":\"string\",\"value\":\"[concat('Enabled extension for VM', ': ', parameters('vmName'))]\"}}},\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"logAnalytics\":{\"value\":\"[parameters('logAnalytics')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/053d3325-282c-4e5c-b944-24faffd30d77\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"053d3325-282c-4e5c-b944-24faffd30d77\"},{\"properties\":{\"displayName\":\"Vulnerability Assessment settings for SQL server should contain an email address to receive scan reports\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Ensure that an email address is provided for the 'Send scan reports to' field in the Vulnerability Assessment settings. This email address receives scan result summary after a periodic scan runs on SQL servers.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Sql/servers\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Sql/servers/vulnerabilityAssessments\",\"name\":\"default\",\"existenceCondition\":{\"field\":\"Microsoft.Sql/servers/vulnerabilityAssessments/default.recurringScans.emails[*]\",\"notEquals\":\"\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/057d6cfe-9c4f-4a6d-bc60-14420ea1f1a9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"057d6cfe-9c4f-4a6d-bc60-14420ea1f1a9\"},{\"properties\":{\"displayName\":\"Diagnostic logs in Azure Data Lake Store should be enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit enabling of diagnostic logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised\",\"metadata\":{\"category\":\"Data Lake\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]},\"requiredRetentionDays\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Required retention (days)\",\"description\":\"The required diagnostic logs retention in days\"}}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.DataLakeStore/accounts\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"existenceCondition\":{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\"equals\":\"true\"},{\"anyOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\"equals\":\"0\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\"equals\":\"[parameters('requiredRetentionDays')]\"}]},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"true\"}]},{\"allOf\":[{\"not\":{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\"equals\":\"true\"}},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"true\"}]}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/057ef27e-665e-4328-8ea3-04b3122bd9fb\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"057ef27e-665e-4328-8ea3-04b3122bd9fb\"},{\"properties\":{\"displayName\":\"[Deprecated]: Audit SQL DB Level Audit Setting\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Audit DB level audit setting for SQL databases\",\"metadata\":{\"category\":\"SQL\",\"deprecated\":true},\"parameters\":{\"setting\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Audit Setting\"},\"allowedValues\":[\"enabled\",\"disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Sql/servers/databases\"},{\"field\":\"name\",\"notEquals\":\"master\"}]},\"then\":{\"effect\":\"AuditIfNotExists\",\"details\":{\"type\":\"Microsoft.Sql/servers/databases/auditingSettings\",\"name\":\"default\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Sql/auditingSettings.state\",\"equals\":\"[parameters('setting')]\"}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/06a78e20-9358-41c9-923c-fb736d382a12\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"06a78e20-9358-41c9-923c-fb736d382a12\"},{\"properties\":{\"displayName\":\"Audit VMs that do not use managed disks\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy audits VMs that do not use managed disks\",\"metadata\":{\"category\":\"Compute\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"field\":\"Microsoft.Compute/virtualMachines/osDisk.uri\",\"exists\":\"True\"}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/VirtualMachineScaleSets\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/VirtualMachineScaleSets/osDisk.vhdContainers\",\"exists\":\"True\"},{\"field\":\"Microsoft.Compute/VirtualMachineScaleSets/osdisk.imageUrl\",\"exists\":\"True\"}]}]}]},\"then\":{\"effect\":\"audit\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/06a78e20-9358-41c9-923c-fb736d382a4d\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"06a78e20-9358-41c9-923c-fb736d382a4d\"},{\"properties\":{\"displayName\":\"CORS should not allow every resource to access your Function Apps\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Cross-Origin Resource Sharing (CORS) should not allow all domains to access your Function app. Allow only required domains to interact with your Function app.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"functionapp*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/web.cors.allowedOrigins[*]\",\"notEquals\":\"*\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/0820b7b9-23aa-4725-a1ce-ae4558f718e5\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"0820b7b9-23aa-4725-a1ce-ae4558f718e5\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy Log Analytics Agent for Windows VMs\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploy Log Analytics Agent for Windows VMs if the VM Image (OS) is in the list defined and the agent is not installed. The list of OS images will be updated over time as support is updated.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"logAnalytics\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Log Analytics workspace\",\"description\":\"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\"strongType\":\"omsWorkspace\",\"assignPermissions\":true}},\"listOfImageIdToInclude\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"Optional: List of VM images that have supported Windows OS to add to scope\",\"description\":\"Example values: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageId\",\"in\":\"[parameters('listOfImageIdToInclude')]\"},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"2008-R2-SP1\",\"2008-R2-SP1-smalldisk\",\"2012-Datacenter\",\"2012-Datacenter-smalldisk\",\"2012-R2-Datacenter\",\"2012-R2-Datacenter-smalldisk\",\"2016-Datacenter\",\"2016-Datacenter-Server-Core\",\"2016-Datacenter-Server-Core-smalldisk\",\"2016-Datacenter-smalldisk\",\"2016-Datacenter-with-Containers\",\"2016-Datacenter-with-RDSH\",\"2019-Datacenter\",\"2019-Datacenter-Core\",\"2019-Datacenter-Core-smalldisk\",\"2019-Datacenter-Core-with-Containers\",\"2019-Datacenter-Core-with-Containers-smalldisk\",\"2019-Datacenter-smalldisk\",\"2019-Datacenter-with-Containers\",\"2019-Datacenter-with-Containers-smalldisk\",\"2019-Datacenter-zhcn\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServerSemiAnnual\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"Datacenter-Core-1709-smalldisk\",\"Datacenter-Core-1709-with-Containers-smalldisk\",\"Datacenter-Core-1803-with-Containers-smalldisk\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServerHPCPack\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServerHPCPack\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2016\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2016-BYOL\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2012R2\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2012R2-BYOL\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftRServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"MLServer-WS2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftVisualStudio\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"VisualStudio\",\"Windows\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftDynamicsAX\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Dynamics\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"equals\":\"Pre-Req-AX7-Onebox-U8\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"windows-data-science-vm\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsDesktop\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Windows-10\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"],\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Compute/virtualMachines/extensions/type\",\"equals\":\"MicrosoftMonitoringAgent\"},{\"field\":\"Microsoft.Compute/virtualMachines/extensions/publisher\",\"equals\":\"Microsoft.EnterpriseCloud.Monitoring\"},{\"field\":\"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\"equals\":\"Succeeded\"}]},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"logAnalytics\":{\"type\":\"string\"}},\"variables\":{\"vmExtensionName\":\"MMAExtension\",\"vmExtensionPublisher\":\"Microsoft.EnterpriseCloud.Monitoring\",\"vmExtensionType\":\"MicrosoftMonitoringAgent\",\"vmExtensionTypeHandlerVersion\":\"1.0\"},\"resources\":[{\"name\":\"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"apiVersion\":\"2018-06-01\",\"properties\":{\"publisher\":\"[variables('vmExtensionPublisher')]\",\"type\":\"[variables('vmExtensionType')]\",\"typeHandlerVersion\":\"[variables('vmExtensionTypeHandlerVersion')]\",\"autoUpgradeMinorVersion\":true,\"settings\":{\"workspaceId\":\"[reference(parameters('logAnalytics'), '2015-03-20').customerId]\",\"stopOnMultipleConnections\":\"true\"},\"protectedSettings\":{\"workspaceKey\":\"[listKeys(parameters('logAnalytics'), '2015-03-20').primarySharedKey]\"}}}],\"outputs\":{\"policy\":{\"type\":\"string\",\"value\":\"[concat('Enabled extension for VM', ': ', parameters('vmName'))]\"}}},\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"logAnalytics\":{\"value\":\"[parameters('logAnalytics')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/0868462e-646c-4fe3-9ced-a733534b6a2c\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"0868462e-646c-4fe3-9ced-a733534b6a2c\"},{\"properties\":{\"displayName\":\"[Deprecated]: Audit Web Applications that are not using latest supported PHP Framework\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Use the latest supported PHP version for the latest security classes. Using older classes and types can make your application vulnerable.\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true,\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"microsoft.Web/sites\"},{\"anyOf\":[{\"field\":\"kind\",\"equals\":\"app\"},{\"field\":\"kind\",\"equals\":\"WebApp\"},{\"field\":\"kind\",\"equals\":\"app,linux\"},{\"field\":\"kind\",\"equals\":\"app,linux,container\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"UseLatestPHP\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/08b17839-76c6-4015-90e0-33d9d54d219c\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"08b17839-76c6-4015-90e0-33d9d54d219c\"},{\"properties\":{\"displayName\":\"Deploy Diagnostic Settings for Search Services to Log Analytics workspace\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploys the diagnostic settings for Search Services to stream to a regional Log Analytics workspace when any Search Services which is missing this diagnostic settings is created or updated.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"DeployIfNotExists\",\"Disabled\"]},\"profileName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Profile name\",\"description\":\"The diagnostic settings profile name\"}},\"logAnalytics\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Log Analytics workspace\",\"description\":\"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\"strongType\":\"omsWorkspace\",\"assignPermissions\":true}},\"metricsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable metrics\",\"description\":\"Whether to enable metrics stream to the Event Hub - True or False\"},\"allowedValues\":[\"True\",\"False\"]},\"logsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable logs\",\"description\":\"Whether to enable logs stream to the Event Hub  - True or False\"},\"allowedValues\":[\"True\",\"False\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Search/searchServices\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"name\":\"[parameters('profileName')]\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"[parameters('logsEnabled')]\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\"equals\":\"[parameters('metricsEnabled')]\"}]},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa\",\"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"resourceName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"logAnalytics\":{\"type\":\"string\"},\"metricsEnabled\":{\"type\":\"string\"},\"logsEnabled\":{\"type\":\"string\"},\"profileName\":{\"type\":\"string\"}},\"variables\":{},\"resources\":[{\"type\":\"Microsoft.Search/searchServices/providers/diagnosticSettings\",\"apiVersion\":\"2017-05-01-preview\",\"name\":\"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\"location\":\"[parameters('location')]\",\"dependsOn\":[],\"properties\":{\"workspaceId\":\"[parameters('logAnalytics')]\",\"metrics\":[{\"category\":\"AllMetrics\",\"enabled\":\"[parameters('metricsEnabled')]\",\"retentionPolicy\":{\"enabled\":false,\"days\":0}}],\"logs\":[{\"category\":\"OperationLogs\",\"enabled\":\"[parameters('logsEnabled')]\"}]}}],\"outputs\":{}},\"parameters\":{\"location\":{\"value\":\"[field('location')]\"},\"resourceName\":{\"value\":\"[field('name')]\"},\"logAnalytics\":{\"value\":\"[parameters('logAnalytics')]\"},\"metricsEnabled\":{\"value\":\"[parameters('metricsEnabled')]\"},\"logsEnabled\":{\"value\":\"[parameters('logsEnabled')]\"},\"profileName\":{\"value\":\"[parameters('profileName')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/08ba64b8-738f-4918-9686-730d2ed79c7d\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"08ba64b8-738f-4918-9686-730d2ed79c7d\"},{\"properties\":{\"displayName\":\"Network Security Group Rules for Internet facing virtual machines should be hardened\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Azure Security Center analyzes the traffic patterns of Internet facing virtual machines and provides Network Security Group rule recommendations that reduce the potential attack surface\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"adaptiveNetworkHardenings\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/08e6af2d-db70-460a-bfe9-d5bd474ba9d6\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"08e6af2d-db70-460a-bfe9-d5bd474ba9d6\"},{\"properties\":{\"displayName\":\"There should be more than one owner assigned to your subscription\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"It is recommended to designate more than one subscription owner in order to have administrator access redundancy.\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"DesignateMoreThanOneOwner\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/09024ccc-0c5f-475e-9457-b7c0d9ed487b\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"09024ccc-0c5f-475e-9457-b7c0d9ed487b\"},{\"properties\":{\"displayName\":\"Disk encryption should be applied on virtual machines\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"VMs without an enabled disk encryption will be monitored by Azure Security Center as recommendations\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"encryption\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/0961003e-5a0a-4549-abde-af6a37f2724d\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"0961003e-5a0a-4549-abde-af6a37f2724d\"},{\"properties\":{\"displayName\":\"Deploy prerequisites to backup VMs of a location to an existing central Vault in the same location \",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy configures Azure Backup protection on VMs in a given location to an existing central vault in the same location. It applies to only those VMs that are not already configured for backup. It is recommended that this policy is assigned to not more than 200 VMs. If the policy is assigned for more than 200 VMs, it can result in the backup getting triggered a few hours beyond the defined schedule. This policy will be enhanced to support more VM images.\",\"metadata\":{\"category\":\"Backup\"},\"parameters\":{\"vaultLocation\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Location (Specify the location of the VMs that you want to protect)\",\"description\":\"Specify the location of the VMs that you want to protect. VMs should be backed up to a vault in the same location.\\nFor example - southeastasia\",\"strongType\":\"location\"}},\"backupPolicyId\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Backup Policy (of type Azure VM from a vault in the location chosen above)\",\"description\":\"Specify the id of the Azure backup policy to configure backup of the virtual machines. The selected Azure backup policy should be of type Azure virtual machine. This policy needs to be in a vault that is present in the location chosen above.\\nFor example - /subscriptions/<SubscriptionId>/resourceGroups/<resourceGroupName>/providers/Microsoft.RecoveryServices/vaults/<VaultName>/backupPolicies/<BackupPolicyName>\",\"strongType\":\"Microsoft.RecoveryServices/vaults/backupPolicies\"}},\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"deployIfNotExists\",\"auditIfNotExists\",\"disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"field\":\"location\",\"equals\":\"[parameters('vaultLocation')]\"},{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"2008-R2-SP1\",\"2008-R2-SP1-smalldisk\",\"2012-Datacenter\",\"2012-Datacenter-smalldisk\",\"2012-R2-Datacenter\",\"2012-R2-Datacenter-smalldisk\",\"2016-Datacenter\",\"2016-Datacenter-Server-Core\",\"2016-Datacenter-Server-Core-smalldisk\",\"2016-Datacenter-smalldisk\",\"2016-Datacenter-with-Containers\",\"2016-Datacenter-with-RDSH\",\"2019-Datacenter\",\"2019-Datacenter-Core\",\"2019-Datacenter-Core-smalldisk\",\"2019-Datacenter-Core-with-Containers\",\"2019-Datacenter-Core-with-Containers-smalldisk\",\"2019-Datacenter-smalldisk\",\"2019-Datacenter-with-Containers\",\"2019-Datacenter-with-Containers-smalldisk\",\"2019-Datacenter-zhcn\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServerSemiAnnual\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"Datacenter-Core-1709-smalldisk\",\"Datacenter-Core-1709-with-Containers-smalldisk\",\"Datacenter-Core-1803-with-Containers-smalldisk\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServerHPCPack\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServerHPCPack\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2016\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2016-BYOL\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2012R2\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2012R2-BYOL\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftRServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"MLServer-WS2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftVisualStudio\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"VisualStudio\",\"Windows\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftDynamicsAX\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Dynamics\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"equals\":\"Pre-Req-AX7-Onebox-U8\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"windows-data-science-vm\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsDesktop\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Windows-10\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"RHEL\",\"RHEL-SAP-HANA\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"6.*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"SUSE\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"SLES\",\"SLES-HPC\",\"SLES-HPC-Priority\",\"SLES-SAP\",\"SLES-SAP-BYOS\",\"SLES-Priority\",\"SLES-BYOS\",\"SLES-SAPCAL\",\"SLES-Standard\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"12*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Canonical\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"UbuntuServer\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"14.04*LTS\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"16.04*LTS\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"18.04*LTS\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Oracle\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Oracle-Linux\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"6.*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7.*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"OpenLogic\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"CentOS\",\"Centos-LVM\",\"CentOS-SRIOV\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"6.*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-centos-os\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\",\"/providers/microsoft.authorization/roleDefinitions/5e467623-bb1f-42f4-a55d-6e525e11384b\"],\"type\":\"Microsoft.RecoveryServices/backupprotecteditems\",\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"backupPolicyId\":{\"type\":\"String\"},\"fabricName\":{\"type\":\"String\"},\"protectionContainers\":{\"type\":\"String\"},\"protectedItems\":{\"type\":\"String\"},\"sourceResourceId\":{\"type\":\"String\"}},\"resources\":[{\"apiVersion\":\"2017-05-10\",\"name\":\"[concat('DeployProtection-',uniqueString(parameters('protectedItems')))]\",\"type\":\"Microsoft.Resources/deployments\",\"resourceGroup\":\"[first(skip(split(parameters('backupPolicyId'), '/'), 4))]\",\"subscriptionId\":\"[first(skip(split(parameters('backupPolicyId'), '/'), 2))]\",\"properties\":{\"mode\":\"Incremental\",\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"backupPolicyId\":{\"type\":\"String\"},\"fabricName\":{\"type\":\"String\"},\"protectionContainers\":{\"type\":\"String\"},\"protectedItems\":{\"type\":\"String\"},\"sourceResourceId\":{\"type\":\"String\"}},\"resources\":[{\"type\":\"Microsoft.RecoveryServices/vaults/backupFabrics/protectionContainers/protectedItems\",\"name\":\"[concat(first(skip(split(parameters('backupPolicyId'), '/'), 8)), '/', parameters('fabricName'), '/',parameters('protectionContainers'), '/', parameters('protectedItems'))]\",\"apiVersion\":\"2016-06-01\",\"properties\":{\"protectedItemType\":\"Microsoft.Compute/virtualMachines\",\"policyId\":\"[parameters('backupPolicyId')]\",\"sourceResourceId\":\"[parameters('sourceResourceId')]\"}}]},\"parameters\":{\"backupPolicyId\":{\"value\":\"[parameters('backupPolicyId')]\"},\"fabricName\":{\"value\":\"[parameters('fabricName')]\"},\"protectionContainers\":{\"value\":\"[parameters('protectionContainers')]\"},\"protectedItems\":{\"value\":\"[parameters('protectedItems')]\"},\"sourceResourceId\":{\"value\":\"[parameters('sourceResourceId')]\"}}}}]},\"parameters\":{\"backupPolicyId\":{\"value\":\"[parameters('backupPolicyId')]\"},\"fabricName\":{\"value\":\"Azure\"},\"protectionContainers\":{\"value\":\"[concat('iaasvmcontainer;iaasvmcontainerv2;', resourceGroup().name, ';' ,field('name'))]\"},\"protectedItems\":{\"value\":\"[concat('vm;iaasvmcontainerv2;', resourceGroup().name, ';' ,field('name'))]\"},\"sourceResourceId\":{\"value\":\"[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Compute/virtualMachines/',field('name'))]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/09ce66bc-1220-4153-8104-e3f51c936913\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"09ce66bc-1220-4153-8104-e3f51c936913\"},{\"properties\":{\"displayName\":\"Audit resource location matches resource group location\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit that the resource location matches its resource group location\",\"metadata\":{\"category\":\"General\"},\"parameters\":{},\"policyRule\":{\"if\":{\"field\":\"location\",\"notIn\":[\"[resourcegroup().location]\",\"global\"]},\"then\":{\"effect\":\"audit\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/0a914e76-4921-4c19-b460-a2d36003525a\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"0a914e76-4921-4c19-b460-a2d36003525a\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'System Audit Policies - Account Management'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'System Audit Policies - Account Management'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SystemAuditPoliciesAccountManagement\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_SystemAuditPoliciesAccountManagement\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/0a9991e6-21be-49f9-8916-a06d934bcf29\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"0a9991e6-21be-49f9-8916-a06d934bcf29\"},{\"properties\":{\"displayName\":\"Email notification to subscription owner for high severity alerts should be enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Enable emailing security alerts to the subscription owner, in order to have them receive security alert emails from Microsoft. This ensures that they are aware of any potential security issues and can mitigate the risk in a timely fashion\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/securityContacts\",\"existenceCondition\":{\"field\":\"Microsoft.Security/securityContacts/alertsToAdmins\",\"notEquals\":\"Off\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/0b15565f-aa9e-48ba-8619-45960f2c314d\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"0b15565f-aa9e-48ba-8619-45960f2c314d\"},{\"properties\":{\"displayName\":\"Key Vault objects should be recoverable\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy audits if key vault objects are not recoverable. Soft Delete feature helps to effectively hold the resources for a given retention period (90 days) even after a DELETE operation, while giving the appearance that the object is deleted. When 'Purge protection' is on, a vault or an object in deleted state cannot be purged until the retention period of 90 days has passed. These vaults and objects can still be recovered, assuring customers that the retention policy will be followed.\",\"metadata\":{\"category\":\"Key Vault\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.KeyVault/vaults\"},{\"anyOf\":[{\"field\":\"Microsoft.KeyVault/vaults/enableSoftDelete\",\"exists\":\"false\"},{\"field\":\"Microsoft.KeyVault/vaults/enablePurgeProtection\",\"exists\":\"false\"},{\"field\":\"Microsoft.KeyVault/vaults/enableSoftDelete\",\"equals\":\"false\"},{\"field\":\"Microsoft.KeyVault/vaults/enablePurgeProtection\",\"equals\":\"false\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/0b60c0b2-2dc2-4e1c-b5c9-abbed971de53\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"0b60c0b2-2dc2-4e1c-b5c9-abbed971de53\"},{\"properties\":{\"displayName\":\"Ensure API app has 'Client Certificates (Incoming client certificates)' set to 'On'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Client certificates allow for the app to request a certificate for incoming requests. Only clients that have a valid certificate will be able to reach the app.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"*api\"},{\"field\":\"Microsoft.Web/sites/clientCertEnabled\",\"equals\":\"false\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/0c192fe8-9cbb-4516-85b3-0ade8bd03886\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"0c192fe8-9cbb-4516-85b3-0ade8bd03886\"},{\"properties\":{\"displayName\":\"SQL server TDE protector should be encrypted with your own key\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Transparent Data Encryption (TDE) with your own key support provides increased transparency and control over the TDE Protector, increased security with an HSM-backed external service, and promotion of separation of duties.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Sql/servers\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Sql/servers/encryptionProtector\",\"name\":\"current\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Sql/servers/encryptionProtector/serverKeyType\",\"equals\":\"AzureKeyVault\"},{\"field\":\"Microsoft.Sql/servers/encryptionProtector/uri\",\"notEquals\":\"\"},{\"field\":\"Microsoft.Sql/servers/encryptionProtector/uri\",\"exists\":\"true\"}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/0d134df8-db83-46fb-ad72-fe0c9428c8dd\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"0d134df8-db83-46fb-ad72-fe0c9428c8dd\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs on which Windows Defender Exploit Guard is not enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines on which Windows Defender Exploit Guard is not enabled. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WindowsDefenderExploitGuard\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/0d9b45ff-9ddd-43fc-bf59-fbd1c8423053\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"0d9b45ff-9ddd-43fc-bf59-fbd1c8423053\"},{\"properties\":{\"displayName\":\"Managed identity should be used in your Function App\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Use a managed identity for enhanced authentication security\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"functionapp*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/managedServiceIdentityId\",\"exists\":\"true\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/0da106f2-4ca3-48e8-bc85-c638fe6aea8f\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"0da106f2-4ca3-48e8-bc85-c638fe6aea8f\"},{\"properties\":{\"displayName\":\"[Preview]: Authorized IP ranges should be defined on Kubernetes Services\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Restrict access to the Kubernetes Service Management API by granting API access only to IP addresses in specific ranges. It is recommended to limit access to authorized IP ranges to ensure that only applications from allowed networks can access the cluster.\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.ContainerService/managedClusters\"},{\"field\":\"Microsoft.ContainerService/managedClusters/apiServerAuthorizedIPRanges\",\"exists\":\"false\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/0e246bcf-5f6f-4f87-bc6f-775d4712c7ea\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"0e246bcf-5f6f-4f87-bc6f-775d4712c7ea\"},{\"properties\":{\"displayName\":\"Remote debugging should be turned off for Function Apps\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Remote debugging requires inbound ports to be opened on an function app. Remote debugging should be turned off.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"functionapp*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/web.remoteDebuggingEnabled\",\"equals\":\"false\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/0e60b895-3786-45da-8377-9c6b4b6ac5f9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"0e60b895-3786-45da-8377-9c6b4b6ac5f9\"},{\"properties\":{\"displayName\":\"Geo-redundant backup should be enabled for Azure Database for MariaDB\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy audits any Azure Database for MariaDB with geo-redundant backup not enabled.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.DBforMariaDB/servers\"},{\"field\":\"Microsoft.DBforMariaDB/servers/storageProfile.geoRedundantBackup\",\"notEquals\":\"Enabled\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/0ec47710-77ff-4a3d-9181-6aa50af424d0\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"0ec47710-77ff-4a3d-9181-6aa50af424d0\"},{\"properties\":{\"displayName\":\"Deploy prerequisites to enable Guest Configuration Policy on Windows VMs.\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a system-assigned managed identity and deploys the VM extension for Guest Configuration on Windows VMs. This is a prerequisites for Guest Configuration Policy and must be assigned to the scope before using any Guest Configuration policy. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol.\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"name\":\"AzurePolicyforWindows\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Compute/virtualMachines/extensions/publisher\",\"equals\":\"Microsoft.GuestConfiguration\"},{\"field\":\"Microsoft.Compute/virtualMachines/extensions/type\",\"equals\":\"ConfigurationforWindows\"}]},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}}}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/0ecd903d-91e7-4726-83d3-a229d7f2e293\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"0ecd903d-91e7-4726-83d3-a229d7f2e293\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy prerequisites to audit Windows VMs that do not contain the specified certificates in Trusted Root\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows VMs that do not contain the specified certificates in the Trusted Root Certification Authorities certificate store (Cert:\\\\LocalMachine\\\\Root). It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"CertificateThumbprints\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Certificate thumbprints\",\"description\":\"A semicolon-separated list of certificate thumbprints that should exist under the Trusted Root certificate store (Cert:\\\\LocalMachine\\\\Root). e.g. THUMBPRINT1;THUMBPRINT2;THUMBPRINT3\"}}},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WindowsCertificateInTrustedRoot\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('[CertificateStore]CertificateStore1;CertificateThumbprintsToInclude', '=', parameters('CertificateThumbprints')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"WindowsCertificateInTrustedRoot\"},\"CertificateThumbprints\":{\"value\":\"[parameters('CertificateThumbprints')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"CertificateThumbprints\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[CertificateStore]CertificateStore1;CertificateThumbprintsToInclude\",\"value\":\"[parameters('CertificateThumbprints')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[CertificateStore]CertificateStore1;CertificateThumbprintsToInclude\",\"value\":\"[parameters('CertificateThumbprints')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/106ccbe4-a791-4f33-a44a-06796944b8d5\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"106ccbe4-a791-4f33-a44a-06796944b8d5\"},{\"properties\":{\"displayName\":\"Ensure that '.Net Framework' version is the latest, if used as a part of the Function App\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Periodically, newer versions are released for .Net Framework software either due to security flaws or to include additional functionality. Using the latest .Net framework version for web apps is recommended in order to to take advantage of security fixes, if any, and/or new functionalities of the latest version.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"functionapp*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/web.netFrameworkVersion\",\"in\":[\"v3.0\",\"v4.0\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/10c1859c-e1a7-4df3-ab97-a487fa8059f6\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"10c1859c-e1a7-4df3-ab97-a487fa8059f6\"},{\"properties\":{\"displayName\":\"Custom subscription owner roles should not exist\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy ensures that no custom subscription owner roles exist.\",\"metadata\":{\"category\":\"General\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Authorization/roleDefinitions\"},{\"field\":\"Microsoft.Authorization/roleDefinitions/type\",\"equals\":\"CustomRole\"},{\"anyOf\":[{\"not\":{\"field\":\"Microsoft.Authorization/roleDefinitions/permissions[*].actions[*]\",\"notEquals\":\"*\"}},{\"not\":{\"field\":\"Microsoft.Authorization/roleDefinitions/permissions.actions[*]\",\"notEquals\":\"*\"}}]},{\"not\":{\"field\":\"Microsoft.Authorization/roleDefinitions/assignableScopes[*]\",\"notIn\":[\"[concat(subscription().id,'/')]\",\"[subscription().id]\",\"/\"]}},{\"not\":{\"field\":\"Microsoft.Authorization/roleDefinitions/assignableScopes[*]\",\"notLike\":\"/providers/Microsoft.Management/*\"}}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/10ee2ea2-fb4d-45b8-a7e9-a2e770044cd9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"10ee2ea2-fb4d-45b8-a7e9-a2e770044cd9\"},{\"properties\":{\"displayName\":\"[Preview]: Audit Dependency Agent Deployment - VM Image (OS) unlisted\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Reports VMs as non-compliant if the VM Image (OS) is not in the list defined and the agent is not installed. The list of OS images will be updated over time as support is updated.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"listOfImageIdToInclude_windows\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"Optional: List of VM images that have supported Windows OS to add to scope\",\"description\":\"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"}},\"listOfImageIdToInclude_linux\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"Optional: List of VM images that have supported Linux OS to add to scope\",\"description\":\"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"not\":{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageId\",\"in\":\"[parameters('listOfImageIdToInclude_windows')]\"},{\"field\":\"Microsoft.Compute/imageId\",\"in\":\"[parameters('listOfImageIdToInclude_linux')]\"},{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"2008-R2-SP1\",\"2008-R2-SP1-smalldisk\",\"2012-Datacenter\",\"2012-Datacenter-smalldisk\",\"2012-R2-Datacenter\",\"2012-R2-Datacenter-smalldisk\",\"2016-Datacenter\",\"2016-Datacenter-Server-Core\",\"2016-Datacenter-Server-Core-smalldisk\",\"2016-Datacenter-smalldisk\",\"2016-Datacenter-with-Containers\",\"2016-Datacenter-with-RDSH\",\"2019-Datacenter\",\"2019-Datacenter-Core\",\"2019-Datacenter-Core-smalldisk\",\"2019-Datacenter-Core-with-Containers\",\"2019-Datacenter-Core-with-Containers-smalldisk\",\"2019-Datacenter-smalldisk\",\"2019-Datacenter-with-Containers\",\"2019-Datacenter-with-Containers-smalldisk\",\"2019-Datacenter-zhcn\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServerSemiAnnual\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"Datacenter-Core-1709-smalldisk\",\"Datacenter-Core-1709-with-Containers-smalldisk\",\"Datacenter-Core-1803-with-Containers-smalldisk\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServerHPCPack\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServerHPCPack\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2016\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2016-BYOL\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2012R2\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2012R2-BYOL\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftRServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"MLServer-WS2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftVisualStudio\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"VisualStudio\",\"Windows\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftDynamicsAX\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Dynamics\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"equals\":\"Pre-Req-AX7-Onebox-U8\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"windows-data-science-vm\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsDesktop\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Windows-10\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"RHEL\",\"RHEL-SAP-HANA\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"6.*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"SUSE\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"SLES\",\"SLES-HPC\",\"SLES-HPC-Priority\",\"SLES-SAP\",\"SLES-SAP-BYOS\",\"SLES-Priority\",\"SLES-BYOS\",\"SLES-SAPCAL\",\"SLES-Standard\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"12-SP2\",\"12-SP3\",\"12-SP4\"]}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Canonical\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"UbuntuServer\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"14.04.0-LTS\",\"14.04.1-LTS\",\"14.04.5-LTS\"]},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"16.04-LTS\",\"16.04.0-LTS\"]},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"18.04-LTS\"]}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"OpenLogic\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"Centos\",\"Centos-LVM\",\"CentOS-SRIOV\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"6.*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-centos-os\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]}}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"existenceCondition\":{\"field\":\"Microsoft.Compute/virtualMachines/extensions/publisher\",\"equals\":\"Microsoft.Azure.Monitoring.DependencyAgent\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/11ac78e3-31bc-4f0c-8434-37ab963cea07\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"11ac78e3-31bc-4f0c-8434-37ab963cea07\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'Security Options - System objects'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - System objects'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsSystemobjects\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_SecurityOptionsSystemobjects\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/12ae2d24-3805-4b37-9fa9-465968bfbcfa\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"12ae2d24-3805-4b37-9fa9-465968bfbcfa\"},{\"properties\":{\"displayName\":\"Deploy prerequisites to audit Windows VMs that do not have the specified applications installed\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines that do not have the specified applications installed. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"installedApplication\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Application names (supports wildcards)\",\"description\":\"A semicolon-separated list of the names of the applications that should be installed. e.g. 'Microsoft SQL Server 2014 (64-bit); Microsoft Visual Studio Code' or 'Microsoft SQL Server 2014*' (to match any application starting with 'Microsoft SQL Server 2014')\"}}},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WhitelistedApplication\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('[InstalledApplication]bwhitelistedapp;Name', '=', parameters('installedApplication')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"WhitelistedApplication\"},\"installedApplication\":{\"value\":\"[parameters('installedApplication')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"installedApplication\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[InstalledApplication]bwhitelistedapp;Name\",\"value\":\"[parameters('installedApplication')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[InstalledApplication]bwhitelistedapp;Name\",\"value\":\"[parameters('installedApplication')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/12f7e5d0-42a7-4630-80d8-54fb7cff9bd6\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"12f7e5d0-42a7-4630-80d8-54fb7cff9bd6\"},{\"properties\":{\"displayName\":\"Deploy prerequisites to audit Windows VMs in which the Administrators group contains any of the specified members\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines in which the Administrators group contains any of the specified members. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"MembersToExclude\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Members to exclude\",\"description\":\"A semicolon-separated list of members that should be excluded in the Administrators local group. Ex: Administrator; myUser1; myUser2\"}}},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AdministratorsGroupMembersToExclude\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('[LocalGroup]AdministratorsGroup;MembersToExclude', '=', parameters('MembersToExclude')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"AdministratorsGroupMembersToExclude\"},\"MembersToExclude\":{\"value\":\"[parameters('MembersToExclude')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"MembersToExclude\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[LocalGroup]AdministratorsGroup;MembersToExclude\",\"value\":\"[parameters('MembersToExclude')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[LocalGroup]AdministratorsGroup;MembersToExclude\",\"value\":\"[parameters('MembersToExclude')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/144f1397-32f9-4598-8c88-118decc3ccba\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"144f1397-32f9-4598-8c88-118decc3ccba\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy prerequisites to audit Windows VMs that do not have a minimum password age of 1 day\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines that do not have a minimum password age of 1 day. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"MinimumPasswordAge\",\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"MinimumPasswordAge\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/16390df4-2f73-4b42-af13-c801066763df\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"16390df4-2f73-4b42-af13-c801066763df\"},{\"properties\":{\"displayName\":\"Show audit results from Windows VMs that do not have the specified Windows PowerShell modules installed\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines that do not have the specified Windows PowerShell modules installed. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WindowsPowerShellModules\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/16f9b37c-4408-4c30-bc17-254958f2e2d6\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"16f9b37c-4408-4c30-bc17-254958f2e2d6\"},{\"properties\":{\"displayName\":\"Deploy associations for a managed application\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploys an association resource that associates selected resource types to the specified managed application.  This policy deployment does not support nested resource types.\",\"metadata\":{\"category\":\"Managed Application\"},\"parameters\":{\"targetManagedApplicationId\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Managed application Id\",\"description\":\"Resource ID of the managed application to which resources need to be associated.\"}},\"resourceTypesToAssociate\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"Resource types to associate\",\"description\":\"The list of resource types to be associated to the managed application.\",\"strongType\":\"resourceTypes\"}},\"associationNamePrefix\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Association name prefix\",\"description\":\"Prefix to be added to the name of the association resource being created.\"}}},\"policyRule\":{\"if\":{\"field\":\"type\",\"in\":\"[parameters('resourceTypesToAssociate')]\"},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.CustomProviders/Associations\",\"name\":\"[concat(parameters('associationNamePrefix'), '-', uniqueString(parameters('targetManagedApplicationId')))]\",\"roleDefinitionIds\":[\"/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"associatedResourceName\":{\"type\":\"string\"},\"resourceTypesToAssociate\":{\"type\":\"string\"},\"targetManagedApplicationId\":{\"type\":\"string\"},\"associationNamePrefix\":{\"type\":\"string\"}},\"variables\":{\"resourceType\":\"[concat(parameters('resourceTypesToAssociate'), '/providers/associations')]\",\"resourceName\":\"[concat(parameters('associatedResourceName'), '/microsoft.customproviders/', parameters('associationNamePrefix'), '-', uniqueString(parameters('targetManagedApplicationId')))]\"},\"resources\":[{\"type\":\"Microsoft.Resources/deployments\",\"apiVersion\":\"2017-05-10\",\"name\":\"[concat(deployment().Name, '-2')]\",\"properties\":{\"mode\":\"Incremental\",\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"resources\":[{\"type\":\"[variables('resourceType')]\",\"name\":\"[variables('resourceName')]\",\"apiVersion\":\"2018-09-01-preview\",\"properties\":{\"targetResourceId\":\"[parameters('targetManagedApplicationId')]\"}}]}}}]},\"parameters\":{\"resourceTypesToAssociate\":{\"value\":\"[field('type')]\"},\"associatedResourceName\":{\"value\":\"[field('name')]\"},\"targetManagedApplicationId\":{\"value\":\"[parameters('targetManagedApplicationId')]\"},\"associationNamePrefix\":{\"value\":\"[parameters('associationNamePrefix')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/17763ad9-70c0-4794-9397-53d765932634\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"17763ad9-70c0-4794-9397-53d765932634\"},{\"properties\":{\"displayName\":\"Transparent Data Encryption on SQL databases should be enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit transparent data encryption status for SQL databases\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Sql/servers/databases\"},{\"field\":\"name\",\"notEquals\":\"master\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Sql/servers/databases/transparentDataEncryption\",\"name\":\"current\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Sql/transparentDataEncryption.status\",\"equals\":\"enabled\"}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/17k78e20-9358-41c9-923c-fb736d382a12\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"17k78e20-9358-41c9-923c-fb736d382a12\"},{\"properties\":{\"displayName\":\"Azure Monitor log profile should collect logs for categories 'write,' 'delete,' and 'action'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy ensures that a log profile collects logs for categories 'write,' 'delete,' and 'action'\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/logprofiles\",\"existenceCondition\":{\"allOf\":[{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/categories[*]\",\"notEquals\":\"Write\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/categories[*]\",\"notEquals\":\"Delete\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/categories[*]\",\"notEquals\":\"Action\"}}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/1a4e592a-6a6e-44a5-9814-e36264ca96e7\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"1a4e592a-6a6e-44a5-9814-e36264ca96e7\"},{\"properties\":{\"displayName\":\"[Preview]: Access to App Services should be restricted\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Azure security center has discovered that the networking configuration of some of your app services are overly permissive and allow inbound traffic from ranges that are too broad\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"restrictAccessToAppServices\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/1a833ff1-d297-4a0f-9944-888428f8e0ff\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"1a833ff1-d297-4a0f-9944-888428f8e0ff\"},{\"properties\":{\"displayName\":\"Vulnerability assessment should be enabled on your SQL managed instances\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit SQL managed instances which do not have recurring vulnerability assessment scans enabled. Vulnerability assessment can discover, track, and help you remediate potential database vulnerabilities.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Sql/managedInstances\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Sql/managedInstances/vulnerabilityAssessments\",\"name\":\"default\",\"existenceCondition\":{\"field\":\"Microsoft.Sql/managedInstances/vulnerabilityAssessments/recurringScans.isEnabled\",\"equals\":\"True\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/1b7aa243-30e4-4c9e-bca8-d0d3022b634a\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"1b7aa243-30e4-4c9e-bca8-d0d3022b634a\"},{\"properties\":{\"displayName\":\"Ensure that 'PHP version' is the latest, if used as a part of the Api app\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Periodically, newer versions are released for PHP software either due to security flaws or to include additional functionality. Using the latest PHP version for API apps is recommended in order to to take advantage of security fixes, if any, and/or new functionalities of the latest version.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]},\"PHPLatestVersion\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Latest PHP version\",\"description\":\"Latest supported PHP version for App Services\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"*api\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"notContains\":\"PHP\"},{\"field\":\"Microsoft.Web/sites/config/web.phpVersion\",\"equals\":\"\"}]},{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"equals\":\"[concat('PHP|', parameters('PHPLatestVersion'))]\"},{\"field\":\"Microsoft.Web/sites/config/web.phpVersion\",\"equals\":\"\"}]},{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"equals\":\"\"},{\"field\":\"Microsoft.Web/sites/config/web.phpVersion\",\"equals\":\"[parameters('PHPLatestVersion')]\"}]}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/1bc1795e-d44a-4d48-9b3b-6fff0fd5f9ba\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"1bc1795e-d44a-4d48-9b3b-6fff0fd5f9ba\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy Dependency Agent for Windows VMs\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploy Dependency Agent for Windows VMs if the VM Image (OS) is in the list defined and the agent is not installed. The list of OS images will be updated over time as support is updated.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"listOfImageIdToInclude\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"Optional: List of VM images that have supported Windows OS to add to scope\",\"description\":\"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageId\",\"in\":\"[parameters('listOfImageIdToInclude')]\"},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"2008-R2-SP1\",\"2008-R2-SP1-smalldisk\",\"2012-Datacenter\",\"2012-Datacenter-smalldisk\",\"2012-R2-Datacenter\",\"2012-R2-Datacenter-smalldisk\",\"2016-Datacenter\",\"2016-Datacenter-Server-Core\",\"2016-Datacenter-Server-Core-smalldisk\",\"2016-Datacenter-smalldisk\",\"2016-Datacenter-with-Containers\",\"2016-Datacenter-with-RDSH\",\"2019-Datacenter\",\"2019-Datacenter-Core\",\"2019-Datacenter-Core-smalldisk\",\"2019-Datacenter-Core-with-Containers\",\"2019-Datacenter-Core-with-Containers-smalldisk\",\"2019-Datacenter-smalldisk\",\"2019-Datacenter-with-Containers\",\"2019-Datacenter-with-Containers-smalldisk\",\"2019-Datacenter-zhcn\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServerSemiAnnual\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"Datacenter-Core-1709-smalldisk\",\"Datacenter-Core-1709-with-Containers-smalldisk\",\"Datacenter-Core-1803-with-Containers-smalldisk\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServerHPCPack\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServerHPCPack\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2016\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2016-BYOL\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2012R2\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2012R2-BYOL\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftRServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"MLServer-WS2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftVisualStudio\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"VisualStudio\",\"Windows\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftDynamicsAX\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Dynamics\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"equals\":\"Pre-Req-AX7-Onebox-U8\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"windows-data-science-vm\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsDesktop\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Windows-10\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"],\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Compute/virtualMachines/extensions/type\",\"equals\":\"DependencyAgentWindows\"},{\"field\":\"Microsoft.Compute/virtualMachines/extensions/publisher\",\"equals\":\"Microsoft.Azure.Monitoring.DependencyAgent\"},{\"field\":\"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\"equals\":\"Succeeded\"}]},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"}},\"variables\":{\"vmExtensionName\":\"DependencyAgent\",\"vmExtensionPublisher\":\"Microsoft.Azure.Monitoring.DependencyAgent\",\"vmExtensionType\":\"DependencyAgentWindows\",\"vmExtensionTypeHandlerVersion\":\"9.6\"},\"resources\":[{\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"name\":\"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\"apiVersion\":\"2018-06-01\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"[variables('vmExtensionPublisher')]\",\"type\":\"[variables('vmExtensionType')]\",\"typeHandlerVersion\":\"[variables('vmExtensionTypeHandlerVersion')]\",\"autoUpgradeMinorVersion\":true}}],\"outputs\":{\"policy\":{\"type\":\"string\",\"value\":\"[concat('Enabled extension for VM', ': ', parameters('vmName'))]\"}}},\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/1c210e94-a481-4beb-95fa-1571b434fb04\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"1c210e94-a481-4beb-95fa-1571b434fb04\"},{\"properties\":{\"displayName\":\"Virtual machines should be migrated to new Azure Resource Manager resources\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Use new Azure Resource Manager for your virtual machines to provide security enhancements such as: stronger access control (RBAC), better auditing, ARM-based deployment and governance, access to managed identities, access to key vault for secrets, Azure AD-based authentication and support for tags and resource groups for easier security management\",\"metadata\":{\"category\":\"Compute\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"The effect determines what happens when the policy rule is evaluated to match\"},\"allowedValues\":[\"Audit\",\"Deny\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"in\":[\"Microsoft.ClassicCompute/virtualMachines\",\"Microsoft.Compute/virtualMachines\"]},{\"value\":\"[field('type')]\",\"equals\":\"Microsoft.ClassicCompute/virtualMachines\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/1d84d5fb-01f6-4d12-ba4f-4a26081d403d\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"1d84d5fb-01f6-4d12-ba4f-4a26081d403d\"},{\"properties\":{\"displayName\":\"[Deprecated]: Audit API Applications that are not using latest supported .NET Framework\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Use the latest supported .NET Framework version for the latest security classes. Using older classes and types can make your application vulnerable.\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true,\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"microsoft.Web/sites\"},{\"anyOf\":[{\"field\":\"kind\",\"equals\":\"api\"},{\"field\":\"kind\",\"equals\":\"apiApp\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"UseLatestDotNet\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/1de7b11d-1870-41a5-8181-507e7c663cfb\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"1de7b11d-1870-41a5-8181-507e7c663cfb\"},{\"properties\":{\"displayName\":\"Require tag and its value\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Enforces a required tag and its value. Does not apply to resource groups.\",\"metadata\":{\"category\":\"Tags\"},\"parameters\":{\"tagName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Tag Name\",\"description\":\"Name of the tag, such as 'environment'\"}},\"tagValue\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Tag Value\",\"description\":\"Value of the tag, such as 'production'\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"[concat('tags[', parameters('tagName'), ']')]\",\"equals\":\"[parameters('tagValue')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/1e30110a-5ceb-460c-a204-c1c3969c6d62\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"1e30110a-5ceb-460c-a204-c1c3969c6d62\"},{\"properties\":{\"displayName\":\"An Azure Active Directory administrator should be provisioned for SQL servers\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit provisioning of an Azure Active Directory administrator for your SQL server to enable Azure AD authentication. Azure AD authentication enables simplified permission management and centralized identity management of database users and other Microsoft services\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Sql/servers\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Sql/servers/administrators\"}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/1f314764-cb73-4fc9-b863-8eca98ac36e9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"1f314764-cb73-4fc9-b863-8eca98ac36e9\"},{\"properties\":{\"displayName\":\"Deploy Diagnostic Settings for Event Hub to Log Analytics workspace\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploys the diagnostic settings for Event Hub to stream to a regional Log Analytics workspace when any Event Hub which is missing this diagnostic settings is created or updated.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"DeployIfNotExists\",\"Disabled\"]},\"profileName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Profile name\",\"description\":\"The diagnostic settings profile name\"}},\"logAnalytics\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Log Analytics workspace\",\"description\":\"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\"strongType\":\"omsWorkspace\",\"assignPermissions\":true}},\"metricsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable metrics\",\"description\":\"Whether to enable metrics stream to the Event Hub - True or False\"},\"allowedValues\":[\"True\",\"False\"]},\"logsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable logs\",\"description\":\"Whether to enable logs stream to the Event Hub  - True or False\"},\"allowedValues\":[\"True\",\"False\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.EventHub/namespaces\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"name\":\"[parameters('profileName')]\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"[parameters('logsEnabled')]\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\"equals\":\"[parameters('metricsEnabled')]\"}]},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa\",\"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"resourceName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"logAnalytics\":{\"type\":\"string\"},\"metricsEnabled\":{\"type\":\"string\"},\"logsEnabled\":{\"type\":\"string\"},\"profileName\":{\"type\":\"string\"}},\"variables\":{},\"resources\":[{\"type\":\"Microsoft.EventHub/namespaces/providers/diagnosticSettings\",\"apiVersion\":\"2017-05-01-preview\",\"name\":\"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\"location\":\"[parameters('location')]\",\"dependsOn\":[],\"properties\":{\"workspaceId\":\"[parameters('logAnalytics')]\",\"metrics\":[{\"category\":\"AllMetrics\",\"enabled\":\"[parameters('metricsEnabled')]\",\"retentionPolicy\":{\"enabled\":false,\"days\":0}}],\"logs\":[{\"category\":\"ArchiveLogs\",\"enabled\":true,\"retentionPolicy\":{\"enabled\":false,\"days\":0}},{\"category\":\"OperationalLogs\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"AutoScaleLogs\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"KafkaCoordinatorLogs\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"EventHubVNetConnectionEvent\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"CustomerManagedKeyUserLogs\",\"enabled\":\"[parameters('logsEnabled')]\"}]}}],\"outputs\":{}},\"parameters\":{\"location\":{\"value\":\"[field('location')]\"},\"resourceName\":{\"value\":\"[field('name')]\"},\"logAnalytics\":{\"value\":\"[parameters('logAnalytics')]\"},\"metricsEnabled\":{\"value\":\"[parameters('metricsEnabled')]\"},\"logsEnabled\":{\"value\":\"[parameters('logsEnabled')]\"},\"profileName\":{\"value\":\"[parameters('profileName')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/1f6e93e8-6b31-41b1-83f6-36e449a42579\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"1f6e93e8-6b31-41b1-83f6-36e449a42579\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'Security Options - Shutdown'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Shutdown'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"ShutdownAllowSystemToBeShutDownWithoutHavingToLogOn\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Shutdown: Allow system to be shut down without having to log on\",\"description\":\"Specifies whether a computer can be shut down when a user is not logged on. If this policy setting is enabled, the shutdown command is available on the Windows logon screen.\"}},\"ShutdownClearVirtualMemoryPagefile\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Shutdown: Clear virtual memory pagefile\",\"description\":\"Specifies whether the virtual memory pagefile is cleared when the system is shut down. When this policy setting is enabled, the system pagefile is cleared each time that the system shuts down properly. For systems with large amounts of RAM, this could result in substantial time needed to complete the shutdown.\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsShutdown\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('Shutdown: Allow system to be shut down without having to log on;ExpectedValue', '=', parameters('ShutdownAllowSystemToBeShutDownWithoutHavingToLogOn'), ',', 'Shutdown: Clear virtual memory pagefile;ExpectedValue', '=', parameters('ShutdownClearVirtualMemoryPagefile')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_SecurityOptionsShutdown\"},\"ShutdownAllowSystemToBeShutDownWithoutHavingToLogOn\":{\"value\":\"[parameters('ShutdownAllowSystemToBeShutDownWithoutHavingToLogOn')]\"},\"ShutdownClearVirtualMemoryPagefile\":{\"value\":\"[parameters('ShutdownClearVirtualMemoryPagefile')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"ShutdownAllowSystemToBeShutDownWithoutHavingToLogOn\":{\"type\":\"string\"},\"ShutdownClearVirtualMemoryPagefile\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"Shutdown: Allow system to be shut down without having to log on;ExpectedValue\",\"value\":\"[parameters('ShutdownAllowSystemToBeShutDownWithoutHavingToLogOn')]\"},{\"name\":\"Shutdown: Clear virtual memory pagefile;ExpectedValue\",\"value\":\"[parameters('ShutdownClearVirtualMemoryPagefile')]\"}]}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/1f8c20ce-3414-4496-8b26-0e902a1541da\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"1f8c20ce-3414-4496-8b26-0e902a1541da\"},{\"properties\":{\"displayName\":\"The NSGs rules for web applications on IaaS should be hardened\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Azure security center has discovered that some of your virtual machines are running web applications, and the NSGs associated to these virtual machines are overly permissive with regards to the web application ports\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"in\":[\"Microsoft.Compute/virtualMachines\",\"Microsoft.ClassicCompute/virtualMachines\"]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"unprotectedWebApplication\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/201ea587-7c90-41c3-910f-c280ae01cfd6\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"201ea587-7c90-41c3-910f-c280ae01cfd6\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'Security Options - Audit'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Audit'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsAudit\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/21e2995e-683e-497a-9e81-2f42ad07050a\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"21e2995e-683e-497a-9e81-2f42ad07050a\"},{\"properties\":{\"displayName\":\"[Deprecated]: Audit API Apps that are not using custom domains\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Use of custom domains protects a API app from common attacks such as phishing and other DNS-related attacks.\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true,\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"microsoft.Web/sites\"},{\"anyOf\":[{\"field\":\"kind\",\"equals\":\"api\"},{\"field\":\"kind\",\"equals\":\"apiApp\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"UsedCustomDomains\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/224da9fe-0d38-4e79-adb3-0a6e2af942ac\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"224da9fe-0d38-4e79-adb3-0a6e2af942ac\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'System Audit Policies - Account Management'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'System Audit Policies - Account Management'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SystemAuditPoliciesAccountManagement\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/225e937e-d32e-4713-ab74-13ce95b3519a\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"225e937e-d32e-4713-ab74-13ce95b3519a\"},{\"properties\":{\"displayName\":\"Management ports should be closed on your virtual machines\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Open remote management ports are exposing your VM to a high level of risk from Internet-based attacks. These attacks attempt to brute force credentials to gain admin access to the machine.\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"in\":[\"Microsoft.Compute/virtualMachines\",\"Microsoft.ClassicCompute/virtualMachines\"]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"restrictAccessToManagementPorts\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/22730e10-96f6-4aac-ad84-9383d35b5917\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"22730e10-96f6-4aac-ad84-9383d35b5917\"},{\"properties\":{\"displayName\":\"Only secure connections to your Redis Cache should be enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Audit enabling of only connections via SSL to Redis Cache. Use of secure connections ensures authentication between the server and the service and protects data in transit from network layer attacks such as man-in-the-middle, eavesdropping, and session-hijacking\",\"metadata\":{\"category\":\"Cache\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"The effect determines what happens when the policy rule is evaluated to match\"},\"allowedValues\":[\"Audit\",\"Deny\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Cache/redis\"},{\"field\":\"Microsoft.Cache/Redis/enableNonSslPort\",\"equals\":\"true\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/22bee202-a82f-4305-9a2a-6d7f44d4dedb\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"22bee202-a82f-4305-9a2a-6d7f44d4dedb\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy prerequisites to audit Windows VMs that do not restrict the minimum password length to 14 characters\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines that do not restrict the minimum password length to 14 characters. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"MinimumPasswordLength\",\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"MinimumPasswordLength\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/23020aa6-1135-4be2-bae2-149982b06eca\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"23020aa6-1135-4be2-bae2-149982b06eca\"},{\"properties\":{\"displayName\":\"Service Bus should use a virtual network service endpoint\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy audits any Service Bus not configured to use a virtual network service endpoint.\",\"metadata\":{\"category\":\"Network\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.ServiceBus/namespaces\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.ServiceBus/namespaces/virtualNetworkRules\",\"existenceCondition\":{\"field\":\"Microsoft.ServiceBus/namespaces/virtualNetworkRules/virtualNetworkSubnetId\",\"exists\":\"true\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/235359c5-7c52-4b82-9055-01c75cf9f60e\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"235359c5-7c52-4b82-9055-01c75cf9f60e\"},{\"properties\":{\"displayName\":\"Deploy Diagnostic Settings for Stream Analytics to Log Analytics workspace\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploys the diagnostic settings for Stream Analytics to stream to a regional Log Analytics workspace when any Stream Analytics which is missing this diagnostic settings is created or updated.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"DeployIfNotExists\",\"Disabled\"]},\"profileName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Profile name\",\"description\":\"The diagnostic settings profile name\"}},\"logAnalytics\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Log Analytics workspace\",\"description\":\"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\"strongType\":\"omsWorkspace\",\"assignPermissions\":true}},\"metricsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable metrics\",\"description\":\"Whether to enable metrics stream to the Event Hub - True or False\"},\"allowedValues\":[\"True\",\"False\"]},\"logsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable logs\",\"description\":\"Whether to enable logs stream to the Event Hub  - True or False\"},\"allowedValues\":[\"True\",\"False\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.StreamAnalytics/streamingjobs\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"name\":\"[parameters('profileName')]\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"[parameters('logsEnabled')]\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\"equals\":\"[parameters('metricsEnabled')]\"}]},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa\",\"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"resourceName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"logAnalytics\":{\"type\":\"string\"},\"metricsEnabled\":{\"type\":\"string\"},\"logsEnabled\":{\"type\":\"string\"},\"profileName\":{\"type\":\"string\"}},\"variables\":{},\"resources\":[{\"type\":\"Microsoft.StreamAnalytics/streamingjobs/providers/diagnosticSettings\",\"apiVersion\":\"2017-05-01-preview\",\"name\":\"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\"location\":\"[parameters('location')]\",\"dependsOn\":[],\"properties\":{\"workspaceId\":\"[parameters('logAnalytics')]\",\"metrics\":[{\"category\":\"AllMetrics\",\"enabled\":\"[parameters('metricsEnabled')]\",\"retentionPolicy\":{\"enabled\":false,\"days\":0}}],\"logs\":[{\"category\":\"Execution\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"Authoring\",\"enabled\":\"[parameters('logsEnabled')]\"}]}}],\"outputs\":{}},\"parameters\":{\"location\":{\"value\":\"[field('location')]\"},\"resourceName\":{\"value\":\"[field('name')]\"},\"logAnalytics\":{\"value\":\"[parameters('logAnalytics')]\"},\"metricsEnabled\":{\"value\":\"[parameters('metricsEnabled')]\"},\"logsEnabled\":{\"value\":\"[parameters('logsEnabled')]\"},\"profileName\":{\"value\":\"[parameters('profileName')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/237e0f7e-b0e8-4ec4-ad46-8c12cb66d673\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"237e0f7e-b0e8-4ec4-ad46-8c12cb66d673\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs that do not have a maximum password age of 70 days\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines that do not have a maximum password age of 70 days. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"MaximumPasswordAge\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/24dde96d-f0b1-425e-884f-4a1421e2dcdc\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"24dde96d-f0b1-425e-884f-4a1421e2dcdc\"},{\"properties\":{\"displayName\":\"Deploy Diagnostic Settings for Data Lake Storage Gen1 to Log Analytics workspace\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploys the diagnostic settings for Data Lake Storage Gen1 to stream to a regional Log Analytics workspace when any Data Lake Storage Gen1 which is missing this diagnostic settings is created or updated.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"DeployIfNotExists\",\"Disabled\"]},\"profileName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Profile name\",\"description\":\"The diagnostic settings profile name\"}},\"logAnalytics\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Log Analytics workspace\",\"description\":\"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\"strongType\":\"omsWorkspace\",\"assignPermissions\":true}},\"metricsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable metrics\",\"description\":\"Whether to enable metrics stream to the Event Hub - True or False\"},\"allowedValues\":[\"True\",\"False\"]},\"logsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable logs\",\"description\":\"Whether to enable logs stream to the Event Hub  - True or False\"},\"allowedValues\":[\"True\",\"False\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.DataLakeStore/accounts\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"name\":\"[parameters('profileName')]\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"[parameters('logsEnabled')]\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\"equals\":\"[parameters('metricsEnabled')]\"}]},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa\",\"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"resourceName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"logAnalytics\":{\"type\":\"string\"},\"metricsEnabled\":{\"type\":\"string\"},\"logsEnabled\":{\"type\":\"string\"},\"profileName\":{\"type\":\"string\"}},\"variables\":{},\"resources\":[{\"type\":\"Microsoft.DataLakeStore/accounts/providers/diagnosticSettings\",\"apiVersion\":\"2017-05-01-preview\",\"name\":\"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\"location\":\"[parameters('location')]\",\"dependsOn\":[],\"properties\":{\"workspaceId\":\"[parameters('logAnalytics')]\",\"metrics\":[{\"category\":\"AllMetrics\",\"enabled\":\"[parameters('metricsEnabled')]\",\"retentionPolicy\":{\"enabled\":false,\"days\":0}}],\"logs\":[{\"category\":\"Audit\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"Requests\",\"enabled\":\"[parameters('logsEnabled')]\"}]}}],\"outputs\":{}},\"parameters\":{\"location\":{\"value\":\"[field('location')]\"},\"resourceName\":{\"value\":\"[field('name')]\"},\"logAnalytics\":{\"value\":\"[parameters('logAnalytics')]\"},\"metricsEnabled\":{\"value\":\"[parameters('metricsEnabled')]\"},\"logsEnabled\":{\"value\":\"[parameters('logsEnabled')]\"},\"profileName\":{\"value\":\"[parameters('profileName')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/25763a0a-5783-4f14-969e-79d4933eb74b\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"25763a0a-5783-4f14-969e-79d4933eb74b\"},{\"properties\":{\"displayName\":\"Endpoint protection solution should be installed on virtual machine scale sets\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit the existence and health of an endpoint protection solution on your virtual machines scale sets, to protect them from threats and vulnerabilities.\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachineScaleSets\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"EndpointProtection\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/26a828e1-e88f-464e-bbb3-c134a282b9de\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"26a828e1-e88f-464e-bbb3-c134a282b9de\"},{\"properties\":{\"displayName\":\"Metric alert rules should be configured on Batch accounts\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit configuration of metric alert rules on Batch account to enable the required metric\",\"metadata\":{\"category\":\"Batch\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]},\"metricName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Metric name\",\"description\":\"The metric name that an alert rule must be enabled on\"}}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Batch/batchAccounts\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/alertRules\",\"existenceScope\":\"Subscription\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Insights/alertRules/isEnabled\",\"equals\":\"true\"},{\"field\":\"Microsoft.Insights/alertRules/condition.dataSource.metricName\",\"equals\":\"[parameters('metricName')]\"},{\"field\":\"Microsoft.Insights/alertRules/condition.dataSource.resourceUri\",\"equals\":\"[concat('/subscriptions/', subscription().subscriptionId, '/resourcegroups/', resourceGroup().name, '/providers/Microsoft.Batch/batchAccounts/', field('name'))]\"}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/26ee67a2-f81a-4ba8-b9ce-8550bd5ee1a7\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"26ee67a2-f81a-4ba8-b9ce-8550bd5ee1a7\"},{\"properties\":{\"displayName\":\"Deploy default Microsoft IaaSAntimalware extension for Windows Server\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy deploys a Microsoft IaaSAntimalware extension with a default configuration when a VM is not configured with the antimalware extension.\",\"metadata\":{\"category\":\"Compute\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"2008-R2-SP1\",\"2008-R2-SP1-smalldisk\",\"2012-Datacenter\",\"2012-Datacenter-smalldisk\",\"2012-R2-Datacenter\",\"2012-R2-Datacenter-smalldisk\",\"2016-Datacenter\",\"2016-Datacenter-Server-Core\",\"2016-Datacenter-Server-Core-smalldisk\",\"2016-Datacenter-smalldisk\",\"2016-Datacenter-with-Containers\",\"2016-Datacenter-with-RDSH\",\"2019-Datacenter\",\"2019-Datacenter-Core\",\"2019-Datacenter-Core-smalldisk\",\"2019-Datacenter-Core-with-Containers\",\"2019-Datacenter-Core-with-Containers-smalldisk\",\"2019-Datacenter-smalldisk\",\"2019-Datacenter-with-Containers\",\"2019-Datacenter-with-Containers-smalldisk\"]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Compute/virtualMachines/extensions/type\",\"equals\":\"IaaSAntimalware\"},{\"field\":\"Microsoft.Compute/virtualMachines/extensions/publisher\",\"equals\":\"Microsoft.Azure.Security\"}]},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"ExclusionsPaths\":{\"type\":\"string\",\"defaultValue\":\"\",\"metadata\":{\"description\":\"Semicolon delimited list of file paths or locations to exclude from scanning\"}},\"ExclusionsExtensions\":{\"type\":\"string\",\"defaultValue\":\"\",\"metadata\":{\"description\":\"Semicolon delimited list of file extensions to exclude from scanning\"}},\"ExclusionsProcesses\":{\"type\":\"string\",\"defaultValue\":\"\",\"metadata\":{\"description\":\"Semicolon delimited list of process names to exclude from scanning\"}},\"RealtimeProtectionEnabled\":{\"type\":\"string\",\"defaultValue\":\"true\",\"metadata\":{\"description\":\"Indicates whether or not real time protection is enabled (default is true)\"}},\"ScheduledScanSettingsIsEnabled\":{\"type\":\"string\",\"defaultValue\":\"false\",\"metadata\":{\"description\":\"Indicates whether or not custom scheduled scan settings are enabled (default is false)\"}},\"ScheduledScanSettingsScanType\":{\"type\":\"string\",\"defaultValue\":\"Quick\",\"metadata\":{\"description\":\"Indicates whether scheduled scan setting type is set to Quick or Full (default is Quick)\"}},\"ScheduledScanSettingsDay\":{\"type\":\"string\",\"defaultValue\":\"7\",\"metadata\":{\"description\":\"Day of the week for scheduled scan (1-Sunday, 2-Monday, ..., 7-Saturday)\"}},\"ScheduledScanSettingsTime\":{\"type\":\"string\",\"defaultValue\":\"120\",\"metadata\":{\"description\":\"When to perform the scheduled scan, measured in minutes from midnight (0-1440). For example: 0 = 12AM, 60 = 1AM, 120 = 2AM.\"}}},\"resources\":[{\"name\":\"[concat(parameters('vmName'),'/IaaSAntimalware')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"apiVersion\":\"2017-12-01\",\"properties\":{\"publisher\":\"Microsoft.Azure.Security\",\"type\":\"IaaSAntimalware\",\"typeHandlerVersion\":\"1.3\",\"autoUpgradeMinorVersion\":true,\"settings\":{\"AntimalwareEnabled\":true,\"RealtimeProtectionEnabled\":\"[parameters('RealtimeProtectionEnabled')]\",\"ScheduledScanSettings\":{\"isEnabled\":\"[parameters('ScheduledScanSettingsIsEnabled')]\",\"day\":\"[parameters('ScheduledScanSettingsDay')]\",\"time\":\"[parameters('ScheduledScanSettingsTime')]\",\"scanType\":\"[parameters('ScheduledScanSettingsScanType')]\"},\"Exclusions\":{\"Extensions\":\"[parameters('ExclusionsExtensions')]\",\"Paths\":\"[parameters('ExclusionsPaths')]\",\"Processes\":\"[parameters('ExclusionsProcesses')]\"}}}}]},\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"RealtimeProtectionEnabled\":{\"value\":\"true\"},\"ScheduledScanSettingsIsEnabled\":{\"value\":\"true\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/2835b622-407b-4114-9198-6f7064cbe0dc\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"2835b622-407b-4114-9198-6f7064cbe0dc\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'Security Options - User Account Control'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - User Account Control'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsUserAccountControl\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/29829ec2-489d-4925-81b7-bda06b1718e0\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"29829ec2-489d-4925-81b7-bda06b1718e0\"},{\"properties\":{\"displayName\":\"Append tag and its default value\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Appends the specified tag and value when any resource which is missing this tag is created or updated. Does not modify the tags of resources created before this policy was applied until those resources are changed. Does not apply to resource groups. New 'modify' effect policies are available that support remediation of tags on existing resources (see https://aka.ms/modifydoc).\",\"metadata\":{\"category\":\"Tags\"},\"parameters\":{\"tagName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Tag Name\",\"description\":\"Name of the tag, such as 'environment'\"}},\"tagValue\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Tag Value\",\"description\":\"Value of the tag, such as 'production'\"}}},\"policyRule\":{\"if\":{\"field\":\"[concat('tags[', parameters('tagName'), ']')]\",\"exists\":\"false\"},\"then\":{\"effect\":\"append\",\"details\":[{\"field\":\"[concat('tags[', parameters('tagName'), ']')]\",\"value\":\"[parameters('tagValue')]\"}]}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/2a0e14a6-b0a6-4fab-991a-187a4f81c498\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"2a0e14a6-b0a6-4fab-991a-187a4f81c498\"},{\"properties\":{\"displayName\":\"Managed identity should be used in your Web App\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Use a managed identity for enhanced authentication security\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"app*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/managedServiceIdentityId\",\"exists\":\"true\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/2b9ad585-36bc-4615-b300-fd4435808332\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"2b9ad585-36bc-4615-b300-fd4435808332\"},{\"properties\":{\"displayName\":\"Unattached disks should be encrypted\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy audits any unattached disk without encryption enabled.\",\"metadata\":{\"category\":\"Compute\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/disks\"},{\"field\":\"Microsoft.Compute/disks/diskState\",\"equals\":\"Unattached\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/disks/encryptionSettingsCollection.enabled\",\"exists\":\"false\"},{\"field\":\"Microsoft.Compute/disks/encryptionSettingsCollection.enabled\",\"equals\":\"false\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/2c89a2e5-7285-40fe-afe0-ae8654b92fb2\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"2c89a2e5-7285-40fe-afe0-ae8654b92fb2\"},{\"properties\":{\"displayName\":\"App Service should use a virtual network service endpoint\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy audits any App Service not configured to use a virtual network service endpoint.\",\"metadata\":{\"category\":\"Network\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"app*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/virtualNetworkConnections\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/virtualnetworkconnections/vnetResourceId\",\"exists\":\"true\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/2d21331d-a4c2-4def-a9ad-ee4e1e023beb\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"2d21331d-a4c2-4def-a9ad-ee4e1e023beb\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs that do not store passwords using reversible encryption\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines that do not store passwords using reversible encryption. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"StorePasswordsUsingReversibleEncryption\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/2d60d3b7-aa10-454c-88a8-de39d99d17c6\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"2d60d3b7-aa10-454c-88a8-de39d99d17c6\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Linux VMs that allow remote connections from accounts without passwords\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Linux virtual machines that allow remote connections from accounts without passwords. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"microsoft-aks\",\"AzureDatabricks\",\"qubole-inc\",\"datastax\",\"couchbase\",\"scalegrid\",\"checkpoint\",\"paloaltonetworks\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"OpenLogic\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"CentOS*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"RHEL\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"osa\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"credativ\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Debian\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"7*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Suse\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"SLES*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"11*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Canonical\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"UbuntuServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"12*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"linux-data-science-vm-ubuntu\",\"azureml\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-centos-os\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-altus-centos-os\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"linux*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"linux*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"PasswordPolicy_msid110\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/2d67222d-05fd-4526-a171-2ee132ad9e83\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"2d67222d-05fd-4526-a171-2ee132ad9e83\"},{\"properties\":{\"displayName\":\"[Deprecated]: Web Application should only be accessible over HTTPS\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Use of HTTPS ensures server/service authentication and protects data in transit from network layer eavesdropping attacks.\",\"metadata\":{\"category\":\"Security Center\",\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"microsoft.Web/sites\"},{\"anyOf\":[{\"field\":\"kind\",\"equals\":\"app\"},{\"field\":\"kind\",\"equals\":\"WebApp\"},{\"field\":\"kind\",\"equals\":\"app,linux\"},{\"field\":\"kind\",\"equals\":\"app,linux,container\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"OnlyHttpsForWebApplication\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/2fde8a98-6892-426a-83ba-050e640c0ce0\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"2fde8a98-6892-426a-83ba-050e640c0ce0\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'Security Options - Network Access'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Network Access'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsNetworkAccess\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/30040dab-4e75-4456-8273-14b8f75d91d9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"30040dab-4e75-4456-8273-14b8f75d91d9\"},{\"properties\":{\"displayName\":\"Deploy prerequisites to audit Windows VMs that are not joined to the specified domain\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines that are not joined to the specified domain. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"DomainName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Domain Name (FQDN)\",\"description\":\"The fully qualified domain name (FQDN) that the Windows VMs should be joined to\"}}},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WindowsDomainMembership\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('[DomainMembership]WindowsDomainMembership;DomainName', '=', parameters('DomainName')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"WindowsDomainMembership\"},\"DomainName\":{\"value\":\"[parameters('DomainName')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"DomainName\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[DomainMembership]WindowsDomainMembership;DomainName\",\"value\":\"[parameters('DomainName')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[DomainMembership]WindowsDomainMembership;DomainName\",\"value\":\"[parameters('DomainName')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/315c850a-272d-4502-8935-b79010405970\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"315c850a-272d-4502-8935-b79010405970\"},{\"properties\":{\"displayName\":\"[Preview]: Audit Log Analytics Agent Deployment - VM Image (OS) unlisted\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Reports VMs as non-compliant if the VM Image (OS) is not in the list defined and the agent is not installed. The list of OS images will be updated over time as support is updated.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"listOfImageIdToInclude_windows\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"Optional: List of VM images that have supported Windows OS to add to scope\",\"description\":\"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"}},\"listOfImageIdToInclude_linux\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"Optional: List of VM images that have supported Linux OS to add to scope\",\"description\":\"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"not\":{\"anyOf\":[{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageId\",\"in\":\"[parameters('listOfImageIdToInclude_windows')]\"},{\"field\":\"Microsoft.Compute/imageId\",\"in\":\"[parameters('listOfImageIdToInclude_linux')]\"},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"2008-R2-SP1\",\"2008-R2-SP1-smalldisk\",\"2012-Datacenter\",\"2012-Datacenter-smalldisk\",\"2012-R2-Datacenter\",\"2012-R2-Datacenter-smalldisk\",\"2016-Datacenter\",\"2016-Datacenter-Server-Core\",\"2016-Datacenter-Server-Core-smalldisk\",\"2016-Datacenter-smalldisk\",\"2016-Datacenter-with-Containers\",\"2016-Datacenter-with-RDSH\",\"2019-Datacenter\",\"2019-Datacenter-Core\",\"2019-Datacenter-Core-smalldisk\",\"2019-Datacenter-Core-with-Containers\",\"2019-Datacenter-Core-with-Containers-smalldisk\",\"2019-Datacenter-smalldisk\",\"2019-Datacenter-with-Containers\",\"2019-Datacenter-with-Containers-smalldisk\",\"2019-Datacenter-zhcn\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServerSemiAnnual\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"Datacenter-Core-1709-smalldisk\",\"Datacenter-Core-1709-with-Containers-smalldisk\",\"Datacenter-Core-1803-with-Containers-smalldisk\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServerHPCPack\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServerHPCPack\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2016\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2016-BYOL\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2012R2\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2012R2-BYOL\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftRServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"MLServer-WS2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftVisualStudio\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"VisualStudio\",\"Windows\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftDynamicsAX\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Dynamics\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"equals\":\"Pre-Req-AX7-Onebox-U8\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"windows-data-science-vm\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsDesktop\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Windows-10\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"RHEL\",\"RHEL-SAP-HANA\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"6.*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"SUSE\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"SLES\",\"SLES-HPC\",\"SLES-HPC-Priority\",\"SLES-SAP\",\"SLES-SAP-BYOS\",\"SLES-Priority\",\"SLES-BYOS\",\"SLES-SAPCAL\",\"SLES-Standard\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"12*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Canonical\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"UbuntuServer\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"14.04*LTS\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"16.04*LTS\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"18.04*LTS\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Oracle\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Oracle-Linux\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"6.*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7.*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"OpenLogic\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"CentOS\",\"Centos-LVM\",\"CentOS-SRIOV\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"6.*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-centos-os\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]}}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"existenceCondition\":{\"field\":\"Microsoft.Compute/virtualMachines/extensions/publisher\",\"equals\":\"Microsoft.EnterpriseCloud.Monitoring\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/32133ab0-ee4b-4b44-98d6-042180979d50\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"32133ab0-ee4b-4b44-98d6-042180979d50\"},{\"properties\":{\"displayName\":\"Deploy prerequisites to audit Windows VMs on which the specified services are not installed and 'Running'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines on which the specified services are not installed and 'Running'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"ServiceName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Service names (supports wildcards)\",\"description\":\"A semicolon-separated list of the names of the services that should be installed and 'Running'. e.g. 'WinRm;Wi*'\"}}},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WindowsServiceStatus\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('[WindowsServiceStatus]WindowsServiceStatus1;ServiceName', '=', parameters('ServiceName')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"WindowsServiceStatus\"},\"ServiceName\":{\"value\":\"[parameters('ServiceName')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"ServiceName\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[WindowsServiceStatus]WindowsServiceStatus1;ServiceName\",\"value\":\"[parameters('ServiceName')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[WindowsServiceStatus]WindowsServiceStatus1;ServiceName\",\"value\":\"[parameters('ServiceName')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/32b1e4d4-6cd5-47b4-a935-169da8a5c262\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"32b1e4d4-6cd5-47b4-a935-169da8a5c262\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy prerequisites to audit Linux VMs that have accounts without passwords\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Linux virtual machines that have accounts without passwords. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"microsoft-aks\",\"AzureDatabricks\",\"qubole-inc\",\"datastax\",\"couchbase\",\"scalegrid\",\"checkpoint\",\"paloaltonetworks\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"OpenLogic\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"CentOS*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"RHEL\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"osa\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"credativ\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Debian\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"7*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Suse\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"SLES*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"11*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Canonical\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"UbuntuServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"12*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"linux-data-science-vm-ubuntu\",\"azureml\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-centos-os\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-altus-centos-os\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"linux*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"linux*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"PasswordPolicy_msid232\",\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"PasswordPolicy_msid232\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforLinux')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforLinux\",\"typeHandlerVersion\":\"1.0\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/3470477a-b35a-49db-aca5-1073d04524fe\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"3470477a-b35a-49db-aca5-1073d04524fe\"},{\"properties\":{\"displayName\":\"Audit unrestricted network access to storage accounts\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit unrestricted network access in your storage account firewall settings. Instead, configure network rules so only applications from allowed networks can access the storage account. To allow connections from specific internet or on-premise clients, access can be granted to traffic from specific Azure virtual networks or to public internet IP address ranges\",\"metadata\":{\"category\":\"Storage\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Storage/storageAccounts\"},{\"field\":\"Microsoft.Storage/storageAccounts/networkAcls.defaultAction\",\"equals\":\"Allow\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/34c877ad-507e-4c82-993e-3452a6e0ad3c\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"34c877ad-507e-4c82-993e-3452a6e0ad3c\"},{\"properties\":{\"displayName\":\"Diagnostic logs in Logic Apps should be enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit enabling of diagnostic logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised\",\"metadata\":{\"category\":\"Logic Apps\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]},\"requiredRetentionDays\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Required retention (days)\",\"description\":\"The required diagnostic logs retention in days\"}}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Logic/workflows\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"existenceCondition\":{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\"equals\":\"true\"},{\"anyOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\"equals\":\"0\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\"equals\":\"[parameters('requiredRetentionDays')]\"}]},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"true\"}]},{\"allOf\":[{\"not\":{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\"equals\":\"true\"}},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"true\"}]}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/34f95f76-5386-4de7-b824-0d8478470c9d\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"34f95f76-5386-4de7-b824-0d8478470c9d\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy prerequisites to audit Windows VMs that do not have a maximum password age of 70 days\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines that do not have a maximum password age of 70 days. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"MaximumPasswordAge\",\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"MaximumPasswordAge\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/356a906e-05e5-4625-8729-90771e0ee934\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"356a906e-05e5-4625-8729-90771e0ee934\"},{\"properties\":{\"displayName\":\"CORS should not allow every resource to access your API App\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Cross-Origin Resource Sharing (CORS) should not allow all domains to access your API app. Allow only required domains to interact with your API app.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"*api\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/web.cors.allowedOrigins[*]\",\"notEquals\":\"*\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/358c20a6-3f9e-4f0e-97ff-c6ce485e2aac\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"358c20a6-3f9e-4f0e-97ff-c6ce485e2aac\"},{\"properties\":{\"displayName\":\"Gateway subnets should not be configured with a network security group\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy denies if a gateway subnet is configured with a network security group. Assigning a network security group to a gateway subnet will cause the gateway to stop functioning.\",\"metadata\":{\"category\":\"Network\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Network/virtualNetworks/subnets\"},{\"field\":\"name\",\"equals\":\"GatewaySubnet\"},{\"field\":\"Microsoft.Network/virtualNetworks/subnets/networkSecurityGroup.id\",\"exists\":\"true\"}]},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/35f9c03a-cc27-418e-9c0c-539ff999d010\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"35f9c03a-cc27-418e-9c0c-539ff999d010\"},{\"properties\":{\"displayName\":\"Deploy Advanced Threat Protection on Storage Accounts\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy enables Advanced Threat Protection on Storage Accounts.\",\"metadata\":{\"category\":\"Storage\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"DeployIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Storage/storageAccounts\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/advancedThreatProtectionSettings\",\"name\":\"current\",\"existenceCondition\":{\"field\":\"Microsoft.Security/advancedThreatProtectionSettings/isEnabled\",\"equals\":\"true\"},\"roleDefinitionIds\":[\"/providers/Microsoft.Authorization/roleDefinitions/fb1c8493-542b-48eb-b624-b4c8fea62acd\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"storageAccountName\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2017-08-01-preview\",\"type\":\"Microsoft.Storage/storageAccounts/providers/advancedThreatProtectionSettings\",\"name\":\"[concat(parameters('storageAccountName'), '/Microsoft.Security/current')]\",\"properties\":{\"isEnabled\":true}}]},\"parameters\":{\"storageAccountName\":{\"value\":\"[field('name')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/361c2074-3595-4e5d-8cab-4f21dffc835c\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"361c2074-3595-4e5d-8cab-4f21dffc835c\"},{\"properties\":{\"displayName\":\"Automation account variables should be encrypted\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"It is important to enable encryption of Automation account variable assets when storing sensitive data\",\"metadata\":{\"category\":\"Automation\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Automation/automationAccounts/variables\"},{\"field\":\"Microsoft.Automation/automationAccounts/variables/isEncrypted\",\"notEquals\":\"true\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/3657f5a0-770e-44a3-b44e-9431ba1e9735\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"3657f5a0-770e-44a3-b44e-9431ba1e9735\"},{\"properties\":{\"displayName\":\"Deploy Threat Detection on SQL servers\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy ensures that Threat Detection is enabled on SQL Servers.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Sql/servers\"},\"then\":{\"effect\":\"DeployIfNotExists\",\"details\":{\"type\":\"Microsoft.Sql/servers/securityAlertPolicies\",\"name\":\"Default\",\"existenceCondition\":{\"field\":\"Microsoft.Sql/securityAlertPolicies.state\",\"equals\":\"Enabled\"},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/056cd41c-7e88-42e1-933e-88ba6a50c9c3\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"serverName\":{\"type\":\"string\"}},\"variables\":{},\"resources\":[{\"name\":\"[concat(parameters('serverName'), '/Default')]\",\"type\":\"Microsoft.Sql/servers/securityAlertPolicies\",\"apiVersion\":\"2017-03-01-preview\",\"properties\":{\"state\":\"Enabled\",\"emailAccountAdmins\":true}}]},\"parameters\":{\"serverName\":{\"value\":\"[field('name')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/36d49e87-48c4-4f2e-beed-ba4ed02b71f5\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"36d49e87-48c4-4f2e-beed-ba4ed02b71f5\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'Security Options - Network Security'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Network Security'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"NetworkSecurityConfigureEncryptionTypesAllowedForKerberos\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Network Security: Configure encryption types allowed for Kerberos\",\"description\":\"Specifies the encryption types that Kerberos is allowed to use.\"}},\"NetworkSecurityLANManagerAuthenticationLevel\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Network security: LAN Manager authentication level\",\"description\":\"Specify which challenge-response authentication protocol is used for network logons. This choice affects the level of authentication protocol used by clients, the level of session security negotiated, and the level of authentication accepted by servers.\"}},\"NetworkSecurityLDAPClientSigningRequirements\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Network security: LDAP client signing requirements\",\"description\":\"Specify the level of data signing that is requested on behalf of clients that issue LDAP BIND requests.\"}},\"NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCClients\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Network security: Minimum session security for NTLM SSP based (including secure RPC) clients\",\"description\":\"Specifies which behaviors are allowed by clients for applications using the NTLM Security Support Provider (SSP). The SSP Interface (SSPI) is used by applications that need authentication services. See https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-security-minimum-session-security-for-ntlm-ssp-based-including-secure-rpc-servers for more information.\"}},\"NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCServers\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Network security: Minimum session security for NTLM SSP based (including secure RPC) servers\",\"description\":\"Specifies which behaviors are allowed by servers for applications using the NTLM Security Support Provider (SSP). The SSP Interface (SSPI) is used by applications that need authentication services.\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsNetworkSecurity\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('Network Security: Configure encryption types allowed for Kerberos;ExpectedValue', '=', parameters('NetworkSecurityConfigureEncryptionTypesAllowedForKerberos'), ',', 'Network security: LAN Manager authentication level;ExpectedValue', '=', parameters('NetworkSecurityLANManagerAuthenticationLevel'), ',', 'Network security: LDAP client signing requirements;ExpectedValue', '=', parameters('NetworkSecurityLDAPClientSigningRequirements'), ',', 'Network security: Minimum session security for NTLM SSP based (including secure RPC) clients;ExpectedValue', '=', parameters('NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCClients'), ',', 'Network security: Minimum session security for NTLM SSP based (including secure RPC) servers;ExpectedValue', '=', parameters('NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCServers')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_SecurityOptionsNetworkSecurity\"},\"NetworkSecurityConfigureEncryptionTypesAllowedForKerberos\":{\"value\":\"[parameters('NetworkSecurityConfigureEncryptionTypesAllowedForKerberos')]\"},\"NetworkSecurityLANManagerAuthenticationLevel\":{\"value\":\"[parameters('NetworkSecurityLANManagerAuthenticationLevel')]\"},\"NetworkSecurityLDAPClientSigningRequirements\":{\"value\":\"[parameters('NetworkSecurityLDAPClientSigningRequirements')]\"},\"NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCClients\":{\"value\":\"[parameters('NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCClients')]\"},\"NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCServers\":{\"value\":\"[parameters('NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCServers')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"NetworkSecurityConfigureEncryptionTypesAllowedForKerberos\":{\"type\":\"string\"},\"NetworkSecurityLANManagerAuthenticationLevel\":{\"type\":\"string\"},\"NetworkSecurityLDAPClientSigningRequirements\":{\"type\":\"string\"},\"NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCClients\":{\"type\":\"string\"},\"NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCServers\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"Network Security: Configure encryption types allowed for Kerberos;ExpectedValue\",\"value\":\"[parameters('NetworkSecurityConfigureEncryptionTypesAllowedForKerberos')]\"},{\"name\":\"Network security: LAN Manager authentication level;ExpectedValue\",\"value\":\"[parameters('NetworkSecurityLANManagerAuthenticationLevel')]\"},{\"name\":\"Network security: LDAP client signing requirements;ExpectedValue\",\"value\":\"[parameters('NetworkSecurityLDAPClientSigningRequirements')]\"},{\"name\":\"Network security: Minimum session security for NTLM SSP based (including secure RPC) clients;ExpectedValue\",\"value\":\"[parameters('NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCClients')]\"},{\"name\":\"Network security: Minimum session security for NTLM SSP based (including secure RPC) servers;ExpectedValue\",\"value\":\"[parameters('NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCServers')]\"}]}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/36e17963-7202-494a-80c3-f508211c826b\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"36e17963-7202-494a-80c3-f508211c826b\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'Security Options - Interactive Logon'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Interactive Logon'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsInteractiveLogon\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_SecurityOptionsInteractiveLogon\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/3750712b-43d0-478e-9966-d2c26f6141b9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"3750712b-43d0-478e-9966-d2c26f6141b9\"},{\"properties\":{\"displayName\":\"Storage accounts should be migrated to new Azure Resource Manager resources\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Use new Azure Resource Manager for your storage accounts to provide security enhancements such as: stronger access control (RBAC), better auditing, Azure Resource Manager based deployment and governance, access to managed identities, access to key vault for secrets, Azure AD-based authentication and support for tags and resource groups for easier security management\",\"metadata\":{\"category\":\"Storage\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"The effect determines what happens when the policy rule is evaluated to match\"},\"allowedValues\":[\"Audit\",\"Deny\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"in\":[\"Microsoft.ClassicStorage/storageAccounts\",\"Microsoft.Storage/StorageAccounts\"]},{\"value\":\"[field('type')]\",\"equals\":\"Microsoft.ClassicStorage/storageAccounts\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/37e0d2fe-28a5-43d6-a273-67d37d1f5606\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"37e0d2fe-28a5-43d6-a273-67d37d1f5606\"},{\"properties\":{\"displayName\":\"Diagnostic logs in IoT Hub should be enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit enabling of diagnostic logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised\",\"metadata\":{\"category\":\"Internet of Things\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]},\"requiredRetentionDays\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Required retention (days)\",\"description\":\"The required diagnostic logs retention in days\"}}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Devices/IotHubs\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"existenceCondition\":{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\"equals\":\"true\"},{\"anyOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\"equals\":\"0\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\"equals\":\"[parameters('requiredRetentionDays')]\"}]},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"true\"}]},{\"allOf\":[{\"not\":{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\"equals\":\"true\"}},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"true\"}]}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/383856f8-de7f-44a2-81fc-e5135b5c2aa4\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"383856f8-de7f-44a2-81fc-e5135b5c2aa4\"},{\"properties\":{\"displayName\":\"Advanced data security settings for SQL managed instance should contain an email address to receive security alerts\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Ensure that an email address is provided for the 'Send alerts to' field in the Advanced Data Security server settings. This email address receives alert notifications when anomalous activities are detected on SQL managed instances.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Sql/managedInstances\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Sql/managedInstances/securityAlertPolicies\",\"name\":\"default\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Sql/managedInstances/securityAlertPolicies/emailAddresses[*]\",\"notEquals\":\"\"},{\"field\":\"Microsoft.Sql/managedInstances/securityAlertPolicies/emailAddresses[*]\",\"exists\":\"true\"}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/3965c43d-b5f4-482e-b74a-d89ee0e0b3a8\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"3965c43d-b5f4-482e-b74a-d89ee0e0b3a8\"},{\"properties\":{\"displayName\":\"FTPS only should be required in your Function App\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Enable FTPS enforcement for enhanced security\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"functionapp*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/ftpsState\",\"equals\":\"FtpsOnly\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/399b2637-a50f-4f95-96f8-3a145476eb15\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"399b2637-a50f-4f95-96f8-3a145476eb15\"},{\"properties\":{\"displayName\":\"[Preview]: Pod Security Policies should be defined on Kubernetes Services\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Define Pod Security Policies to reduce the attack vector by removing unnecessary application privileges. It is recommended to configure Pod Security Policies to only allow pods to access the resources which they have permissions to access.\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.ContainerService/managedClusters\"},{\"anyOf\":[{\"field\":\"Microsoft.ContainerService/managedClusters/enablePodSecurityPolicy\",\"exists\":\"false\"},{\"field\":\"Microsoft.ContainerService/managedClusters/enablePodSecurityPolicy\",\"equals\":\"false\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/3abeb944-26af-43ee-b83d-32aaf060fb94\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"3abeb944-26af-43ee-b83d-32aaf060fb94\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy Dependency Agent for Windows VM Scale Sets (VMSS)\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploy Dependency Agent for Windows VM Scale Sets if the VM Image (OS) is in the list defined and the agent is not installed. The list of OS images will be updated over time as support is updated. Note: if your scale set upgradePolicy is set to Manual, you need to apply the extension to the all VMs in the set by calling upgrade on them. In CLI this would be az vmss update-instances.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"listOfImageIdToInclude\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"Optional: List of VM images that have supported Windows OS to add to scope\",\"description\":\"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachineScaleSets\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageId\",\"in\":\"[parameters('listOfImageIdToInclude')]\"},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"2008-R2-SP1\",\"2008-R2-SP1-smalldisk\",\"2012-Datacenter\",\"2012-Datacenter-smalldisk\",\"2012-R2-Datacenter\",\"2012-R2-Datacenter-smalldisk\",\"2016-Datacenter\",\"2016-Datacenter-Server-Core\",\"2016-Datacenter-Server-Core-smalldisk\",\"2016-Datacenter-smalldisk\",\"2016-Datacenter-with-Containers\",\"2016-Datacenter-with-RDSH\",\"2019-Datacenter\",\"2019-Datacenter-Core\",\"2019-Datacenter-Core-smalldisk\",\"2019-Datacenter-Core-with-Containers\",\"2019-Datacenter-Core-with-Containers-smalldisk\",\"2019-Datacenter-smalldisk\",\"2019-Datacenter-with-Containers\",\"2019-Datacenter-with-Containers-smalldisk\",\"2019-Datacenter-zhcn\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServerSemiAnnual\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"Datacenter-Core-1709-smalldisk\",\"Datacenter-Core-1709-with-Containers-smalldisk\",\"Datacenter-Core-1803-with-Containers-smalldisk\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServerHPCPack\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServerHPCPack\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2016\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2016-BYOL\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2012R2\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2012R2-BYOL\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftRServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"MLServer-WS2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftVisualStudio\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"VisualStudio\",\"Windows\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftDynamicsAX\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Dynamics\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"equals\":\"Pre-Req-AX7-Onebox-U8\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"windows-data-science-vm\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsDesktop\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Windows-10\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.Compute/virtualMachineScaleSets/extensions\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\"],\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Compute/virtualMachineScaleSets/extensions/type\",\"equals\":\"DependencyAgentWindows\"},{\"field\":\"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\"equals\":\"Microsoft.Azure.Monitoring.DependencyAgent\"}]},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"}},\"variables\":{\"vmExtensionName\":\"DependencyAgent\",\"vmExtensionPublisher\":\"Microsoft.Azure.Monitoring.DependencyAgent\",\"vmExtensionType\":\"DependencyAgentWindows\",\"vmExtensionTypeHandlerVersion\":\"9.7\"},\"resources\":[{\"type\":\"Microsoft.Compute/virtualMachineScaleSets/extensions\",\"name\":\"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\"apiVersion\":\"2018-06-01\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"[variables('vmExtensionPublisher')]\",\"type\":\"[variables('vmExtensionType')]\",\"typeHandlerVersion\":\"[variables('vmExtensionTypeHandlerVersion')]\",\"autoUpgradeMinorVersion\":true}}],\"outputs\":{\"policy\":{\"type\":\"string\",\"value\":\"[concat('Enabled extension for: ', parameters('vmName'))]\"}}},\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/3be22e3b-d919-47aa-805e-8985dbeb0ad9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"3be22e3b-d919-47aa-805e-8985dbeb0ad9\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy Log Analytics Agent for Windows VM Scale Sets (VMSS)\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploy Log Analytics Agent for Windows VM Scale Sets if the VM Image (OS) is in the list defined and the agent is not installed. The list of OS images will be updated over time as support is updated. Note: if your scale set upgradePolicy is set to Manual, you need to apply the extension to the all VMs in the set by calling upgrade on them. In CLI this would be az vmss update-instances.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"logAnalytics\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Log Analytics workspace\",\"description\":\"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\"strongType\":\"omsWorkspace\",\"assignPermissions\":true}},\"listOfImageIdToInclude\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"Optional: List of VM images that have supported Windows OS to add to scope\",\"description\":\"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachineScaleSets\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageId\",\"in\":\"[parameters('listOfImageIdToInclude')]\"},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"2008-R2-SP1\",\"2008-R2-SP1-smalldisk\",\"2012-Datacenter\",\"2012-Datacenter-smalldisk\",\"2012-R2-Datacenter\",\"2012-R2-Datacenter-smalldisk\",\"2016-Datacenter\",\"2016-Datacenter-Server-Core\",\"2016-Datacenter-Server-Core-smalldisk\",\"2016-Datacenter-smalldisk\",\"2016-Datacenter-with-Containers\",\"2016-Datacenter-with-RDSH\",\"2019-Datacenter\",\"2019-Datacenter-Core\",\"2019-Datacenter-Core-smalldisk\",\"2019-Datacenter-Core-with-Containers\",\"2019-Datacenter-Core-with-Containers-smalldisk\",\"2019-Datacenter-smalldisk\",\"2019-Datacenter-with-Containers\",\"2019-Datacenter-with-Containers-smalldisk\",\"2019-Datacenter-zhcn\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServerSemiAnnual\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"Datacenter-Core-1709-smalldisk\",\"Datacenter-Core-1709-with-Containers-smalldisk\",\"Datacenter-Core-1803-with-Containers-smalldisk\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServerHPCPack\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServerHPCPack\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2016\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2016-BYOL\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2012R2\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2012R2-BYOL\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftRServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"MLServer-WS2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftVisualStudio\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"VisualStudio\",\"Windows\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftDynamicsAX\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Dynamics\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"equals\":\"Pre-Req-AX7-Onebox-U8\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"windows-data-science-vm\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsDesktop\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Windows-10\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.Compute/virtualMachineScaleSets/extensions\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\",\"/providers/microsoft.authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\"],\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Compute/virtualMachineScaleSets/extensions/type\",\"equals\":\"MicrosoftMonitoringAgent\"},{\"field\":\"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\"equals\":\"Microsoft.EnterpriseCloud.Monitoring\"}]},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"logAnalytics\":{\"type\":\"string\"}},\"variables\":{\"vmExtensionName\":\"MMAExtension\",\"vmExtensionPublisher\":\"Microsoft.EnterpriseCloud.Monitoring\",\"vmExtensionType\":\"MicrosoftMonitoringAgent\",\"vmExtensionTypeHandlerVersion\":\"1.0\"},\"resources\":[{\"name\":\"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\"type\":\"Microsoft.Compute/virtualMachineScaleSets/extensions\",\"location\":\"[parameters('location')]\",\"apiVersion\":\"2018-06-01\",\"properties\":{\"publisher\":\"[variables('vmExtensionPublisher')]\",\"type\":\"[variables('vmExtensionType')]\",\"typeHandlerVersion\":\"[variables('vmExtensionTypeHandlerVersion')]\",\"autoUpgradeMinorVersion\":true,\"settings\":{\"workspaceId\":\"[reference(parameters('logAnalytics'), '2015-03-20').customerId]\",\"stopOnMultipleConnections\":\"true\"},\"protectedSettings\":{\"workspaceKey\":\"[listKeys(parameters('logAnalytics'), '2015-03-20').primarySharedKey]\"}}}],\"outputs\":{\"policy\":{\"type\":\"string\",\"value\":\"[concat('Enabled extension for: ', parameters('vmName'))]\"}}},\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"logAnalytics\":{\"value\":\"[parameters('logAnalytics')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/3c1b3629-c8f8-4bf6-862c-037cb9094038\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"3c1b3629-c8f8-4bf6-862c-037cb9094038\"},{\"properties\":{\"displayName\":\"Vulnerabilities in security configuration on your virtual machine scale sets should be remediated\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit the OS vulnerabilities on your virtual machine scale sets to protect them from attacks.\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachineScaleSets\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"OsVulnerabilities\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/3c735d8a-a4ba-4a3a-b7cf-db7754cf57f4\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"3c735d8a-a4ba-4a3a-b7cf-db7754cf57f4\"},{\"properties\":{\"displayName\":\"Deploy Diagnostic Settings for Search Services to Event Hub\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploys the diagnostic settings for Search Services to stream to a regional Event Hub when any Search Services which is missing this diagnostic settings is created or updated.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"DeployIfNotExists\",\"Disabled\"]},\"profileName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Profile name\",\"description\":\"The diagnostic settings profile name\"}},\"eventHubRuleId\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Event Hub Authorization Rule Id\",\"description\":\"The Event Hub authorization rule Id for Azure Diagnostics. The authorization rule needs to be at Event Hub namespace level. e.g. /subscriptions/{subscription Id}/resourceGroups/{resource group}/providers/Microsoft.EventHub/namespaces/{Event Hub namespace}/authorizationrules/{authorization rule}\",\"strongType\":\"Microsoft.EventHub/Namespaces/AuthorizationRules\",\"assignPermissions\":true}},\"metricsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable metrics\",\"description\":\"Whether to enable metrics stream to the Event Hub - True or False\"},\"allowedValues\":[\"True\",\"False\"]},\"logsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable logs\",\"description\":\"Whether to enable logs stream to the Event Hub  - True or False\"},\"allowedValues\":[\"True\",\"False\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Search/searchServices\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"name\":\"[parameters('profileName')]\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"[parameters('logsEnabled')]\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\"equals\":\"[parameters('metricsEnabled')]\"}]},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"resourceName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"eventHubRuleId\":{\"type\":\"string\"},\"metricsEnabled\":{\"type\":\"string\"},\"logsEnabled\":{\"type\":\"string\"},\"profileName\":{\"type\":\"string\"}},\"variables\":{},\"resources\":[{\"type\":\"Microsoft.Search/searchServices/providers/diagnosticSettings\",\"apiVersion\":\"2017-05-01-preview\",\"name\":\"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\"location\":\"[parameters('location')]\",\"dependsOn\":[],\"properties\":{\"eventHubAuthorizationRuleId\":\"[parameters('eventHubRuleId')]\",\"metrics\":[{\"category\":\"AllMetrics\",\"enabled\":\"[parameters('metricsEnabled')]\",\"retentionPolicy\":{\"enabled\":false,\"days\":0}}],\"logs\":[{\"category\":\"OperationLogs\",\"enabled\":\"[parameters('logsEnabled')]\"}]}}],\"outputs\":{}},\"parameters\":{\"location\":{\"value\":\"[field('location')]\"},\"resourceName\":{\"value\":\"[field('name')]\"},\"eventHubRuleId\":{\"value\":\"[parameters('eventHubRuleId')]\"},\"metricsEnabled\":{\"value\":\"[parameters('metricsEnabled')]\"},\"logsEnabled\":{\"value\":\"[parameters('logsEnabled')]\"},\"profileName\":{\"value\":\"[parameters('profileName')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/3d5da587-71bd-41f5-ac95-dd3330c2d58d\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"3d5da587-71bd-41f5-ac95-dd3330c2d58d\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'Security Options - Devices'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Devices'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsDevices\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/3d7b154e-2700-4c8c-9e46-cb65ac1578c2\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"3d7b154e-2700-4c8c-9e46-cb65ac1578c2\"},{\"properties\":{\"displayName\":\"[Deprecated]: Deploy default Log Analytics Agent for Ubuntu VMs\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy deploys the Log Analytics Agent on Ubuntu VMs, and connects to the selected Log Analytics workspace\",\"metadata\":{\"category\":\"Compute\",\"deprecated\":true},\"parameters\":{\"logAnalytics\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Log Analytics workspace\",\"description\":\"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\"strongType\":\"omsWorkspace\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Canonical\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"UbuntuServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"18.04-LTS\",\"16.04-LTS\",\"16.04.0-LTS\",\"14.04.2-LTS\",\"12.04.5-LTS\"]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Compute/virtualMachines/extensions/type\",\"equals\":\"OmsAgentForLinux\"},{\"field\":\"Microsoft.Compute/virtualMachines/extensions/publisher\",\"equals\":\"Microsoft.EnterpriseCloud.Monitoring\"}]},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"logAnalytics\":{\"type\":\"string\"}},\"resources\":[{\"name\":\"[concat(parameters('vmName'),'/omsPolicy')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"apiVersion\":\"2017-12-01\",\"properties\":{\"publisher\":\"Microsoft.EnterpriseCloud.Monitoring\",\"type\":\"OmsAgentForLinux\",\"typeHandlerVersion\":\"1.4\",\"autoUpgradeMinorVersion\":true,\"settings\":{\"workspaceId\":\"[reference(parameters('logAnalytics'), '2015-03-20').customerId]\"},\"protectedSettings\":{\"workspaceKey\":\"[listKeys(parameters('logAnalytics'), '2015-03-20').primarySharedKey]\"}}}],\"outputs\":{\"policy\":{\"type\":\"string\",\"value\":\"[concat('Enabled monitoring for Linux VM', ': ', parameters('vmName'))]\"}}},\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"logAnalytics\":{\"value\":\"[parameters('logAnalytics')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/3d8640fc-63f6-4734-8dcb-cfd3d8c78f38\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"3d8640fc-63f6-4734-8dcb-cfd3d8c78f38\"},{\"properties\":{\"displayName\":\"Azure Monitor solution 'Security and Audit' must be deployed\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy ensures that Security and Audit is deployed.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.OperationsManagement/solutions\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.OperationsManagement/solutions/provisioningState\",\"equals\":\"Succeeded\"},{\"field\":\"name\",\"like\":\"Security(*)\"}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/3e596b57-105f-48a6-be97-03e9243bad6e\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"3e596b57-105f-48a6-be97-03e9243bad6e\"},{\"properties\":{\"displayName\":\"[Deprecated]: Audit API Applications that are not using latest supported PHP Framework\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Use the latest supported PHP version for the latest security classes. Using older classes and types can make your application vulnerable.\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true,\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"microsoft.Web/sites\"},{\"anyOf\":[{\"field\":\"kind\",\"equals\":\"api\"},{\"field\":\"kind\",\"equals\":\"apiApp\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"UseLatestPHP\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/3fe37002-5d00-4b37-a301-da09e3a0ca66\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"3fe37002-5d00-4b37-a301-da09e3a0ca66\"},{\"properties\":{\"displayName\":\"Secure transfer to storage accounts should be enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit requirment of Secure transfer in your storage account. Secure transfer is an option that forces your storage account to accept requests only from secure connections (HTTPS). Use of HTTPS ensures authentication between the server and the service and protects data in transit from network layer attacks such as man-in-the-middle, eavesdropping, and session-hijacking\",\"metadata\":{\"category\":\"Storage\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"The effect determines what happens when the policy rule is evaluated to match\"},\"allowedValues\":[\"Audit\",\"Deny\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Storage/storageAccounts\"},{\"not\":{\"field\":\"Microsoft.Storage/storageAccounts/supportsHttpsTrafficOnly\",\"equals\":\"True\"}}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/404c3081-a854-4457-ae30-26a93ef643f9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"404c3081-a854-4457-ae30-26a93ef643f9\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'Administrative Templates - System'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Administrative Templates - System'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"AlwaysUseClassicLogon\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Always use classic logon\",\"description\":\"Specifies whether to force the user to log on to the computer using the classic logon screen. This setting only works when the computer is not on a domain.\"}},\"BootStartDriverInitializationPolicy\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Boot-Start Driver Initialization Policy\",\"description\":\"Specifies which boot-start drivers are initialized based on a classification determined by an Early Launch Antimalware boot-start driver.\"}},\"EnableWindowsNTPClient\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable Windows NTP Client\",\"description\":\"Specifies whether the Windows NTP Client is enabled. Enabling the Windows NTP Client allows your computer to synchronize its computer clock with other NTP servers.\"}},\"TurnOnConveniencePINSignin\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Turn on convenience PIN sign-in\",\"description\":\"Specifies whether a domain user can sign in using a convenience PIN.\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_AdministrativeTemplatesSystem\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('Always use classic logon;ExpectedValue', '=', parameters('AlwaysUseClassicLogon'), ',', 'Boot-Start Driver Initialization Policy;ExpectedValue', '=', parameters('BootStartDriverInitializationPolicy'), ',', 'Enable Windows NTP Client;ExpectedValue', '=', parameters('EnableWindowsNTPClient'), ',', 'Turn on convenience PIN sign-in;ExpectedValue', '=', parameters('TurnOnConveniencePINSignin')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_AdministrativeTemplatesSystem\"},\"AlwaysUseClassicLogon\":{\"value\":\"[parameters('AlwaysUseClassicLogon')]\"},\"BootStartDriverInitializationPolicy\":{\"value\":\"[parameters('BootStartDriverInitializationPolicy')]\"},\"EnableWindowsNTPClient\":{\"value\":\"[parameters('EnableWindowsNTPClient')]\"},\"TurnOnConveniencePINSignin\":{\"value\":\"[parameters('TurnOnConveniencePINSignin')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"AlwaysUseClassicLogon\":{\"type\":\"string\"},\"BootStartDriverInitializationPolicy\":{\"type\":\"string\"},\"EnableWindowsNTPClient\":{\"type\":\"string\"},\"TurnOnConveniencePINSignin\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"Always use classic logon;ExpectedValue\",\"value\":\"[parameters('AlwaysUseClassicLogon')]\"},{\"name\":\"Boot-Start Driver Initialization Policy;ExpectedValue\",\"value\":\"[parameters('BootStartDriverInitializationPolicy')]\"},{\"name\":\"Enable Windows NTP Client;ExpectedValue\",\"value\":\"[parameters('EnableWindowsNTPClient')]\"},{\"name\":\"Turn on convenience PIN sign-in;ExpectedValue\",\"value\":\"[parameters('TurnOnConveniencePINSignin')]\"}]}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/40917425-69db-4018-8dae-2a0556cef899\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"40917425-69db-4018-8dae-2a0556cef899\"},{\"properties\":{\"displayName\":\"Azure Monitor should collect activity logs from all regions\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy audits the Azure Monitor log profile which does not export activities from all Azure supported regions including global.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/logProfiles\",\"existenceCondition\":{\"allOf\":[{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"australiacentral\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"australiacentral2\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"australiaeast\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"australiasoutheast\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"brazilsouth\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"canadacentral\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"canadaeast\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"centralindia\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"centralus\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"eastasia\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"eastus\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"eastus2\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"francecentral\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"francesouth\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"japaneast\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"japanwest\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"koreacentral\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"koreasouth\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"northcentralus\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"northeurope\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"southafricanorth\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"southafricawest\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"southcentralus\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"southindia\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"southeastasia\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"uaecentral\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"uaenorth\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"uksouth\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"ukwest\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"westcentralus\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"westeurope\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"westindia\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"westus\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"westus2\"}},{\"not\":{\"field\":\"Microsoft.Insights/logProfiles/locations[*]\",\"notEquals\":\"global\"}}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/41388f1c-2db0-4c25-95b2-35d7f5ccbfa9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"41388f1c-2db0-4c25-95b2-35d7f5ccbfa9\"},{\"properties\":{\"displayName\":\"Diagnostic logs in Batch accounts should be enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit enabling of diagnostic logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised\",\"metadata\":{\"category\":\"Batch\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]},\"requiredRetentionDays\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Required retention (days)\",\"description\":\"The required diagnostic logs retention in days\"}}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Batch/batchAccounts\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"existenceCondition\":{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\"equals\":\"true\"},{\"anyOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\"equals\":\"0\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\"equals\":\"[parameters('requiredRetentionDays')]\"}]},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"true\"}]},{\"allOf\":[{\"not\":{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\"equals\":\"true\"}},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"true\"}]}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/428256e6-1fac-4f48-a757-df34c2b3336d\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"428256e6-1fac-4f48-a757-df34c2b3336d\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'System Audit Policies - Detailed Tracking'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'System Audit Policies - Detailed Tracking'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"AuditProcessTermination\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Audit Process Termination\",\"description\":\"Specifies whether audit events are generated when a process has exited. Recommended for monitoring termination of critical processes.\"},\"allowedValues\":[\"No Auditing\",\"Success\",\"Failure\",\"Success and Failure\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SystemAuditPoliciesDetailedTracking\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('Audit Process Termination;ExpectedValue', '=', parameters('AuditProcessTermination')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_SystemAuditPoliciesDetailedTracking\"},\"AuditProcessTermination\":{\"value\":\"[parameters('AuditProcessTermination')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"AuditProcessTermination\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"Audit Process Termination;ExpectedValue\",\"value\":\"[parameters('AuditProcessTermination')]\"}]}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/42a07bbf-ffcf-459a-b4b1-30ecd118a505\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"42a07bbf-ffcf-459a-b4b1-30ecd118a505\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'Security Options - System settings'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - System settings'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"SystemSettingsUseCertificateRulesOnWindowsExecutablesForSoftwareRestrictionPolicies\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"System settings: Use Certificate Rules on Windows Executables for Software Restriction Policies\",\"description\":\"Specifies whether digital certificates are processed when software restriction policies are enabled and a user or process attempts to run software with an .exe file name extension. It enables or disables certificate rules (a type of software restriction policies rule). For certificate rules to take effect in software restriction policies, you must enable this policy setting.\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsSystemsettings\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('System settings: Use Certificate Rules on Windows Executables for Software Restriction Policies;ExpectedValue', '=', parameters('SystemSettingsUseCertificateRulesOnWindowsExecutablesForSoftwareRestrictionPolicies')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_SecurityOptionsSystemsettings\"},\"SystemSettingsUseCertificateRulesOnWindowsExecutablesForSoftwareRestrictionPolicies\":{\"value\":\"[parameters('SystemSettingsUseCertificateRulesOnWindowsExecutablesForSoftwareRestrictionPolicies')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"SystemSettingsUseCertificateRulesOnWindowsExecutablesForSoftwareRestrictionPolicies\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"System settings: Use Certificate Rules on Windows Executables for Software Restriction Policies;ExpectedValue\",\"value\":\"[parameters('SystemSettingsUseCertificateRulesOnWindowsExecutablesForSoftwareRestrictionPolicies')]\"}]}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/437a1f8f-8552-47a8-8b12-a2fee3269dd5\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"437a1f8f-8552-47a8-8b12-a2fee3269dd5\"},{\"properties\":{\"displayName\":\"[Deprecated]: Monitor permissive network access in Azure Security Center\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Network Security Groups with too permissive rules will be monitored by Azure Security Center as recommendations\",\"metadata\":{\"category\":\"Security Center\",\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"in\":[\"Microsoft.Compute/virtualMachines\",\"Microsoft.ClassicCompute/virtualMachines\"]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"permissiveNetworkAccess\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/44452482-524f-4bf4-b852-0bff7cc4a3ed\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"44452482-524f-4bf4-b852-0bff7cc4a3ed\"},{\"properties\":{\"displayName\":\"[Deprecated]: Require SQL Server version 12.0\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy ensures all SQL servers use version 12.0. This policy is deprecated because it is no longer possible to create an Azure SQL server with any version other than 12.0.\",\"metadata\":{\"category\":\"SQL\",\"deprecated\":\"true\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Sql/servers\"},{\"not\":{\"field\":\"Microsoft.Sql/servers/version\",\"equals\":\"12.0\"}}]},\"then\":{\"effect\":\"Deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/464dbb85-3d5f-4a1d-bb09-95a9b5dd19cf\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"464dbb85-3d5f-4a1d-bb09-95a9b5dd19cf\"},{\"properties\":{\"displayName\":\"[Deprecated]: Audit Web Applications that are not using latest supported Python Framework\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Use the latest supported Python version for the latest security classes. Using older classes and types can make your application vulnerable.\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true,\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"microsoft.Web/sites\"},{\"anyOf\":[{\"field\":\"kind\",\"equals\":\"app\"},{\"field\":\"kind\",\"equals\":\"WebApp\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"UseLatestPython\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/46544d7b-1f0d-46f5-81da-5c1351de1b06\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"46544d7b-1f0d-46f5-81da-5c1351de1b06\"},{\"properties\":{\"displayName\":\"Require automatic OS image patching on Virtual Machine Scale Sets\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy enforces enabling automatic OS image patching on Virtual Machine Scale Sets to always keep Virtual Machines secure by safely applying latest security patches every month.\",\"metadata\":{\"category\":\"Compute\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachineScaleSets\"},{\"field\":\"Microsoft.Compute/VirtualMachineScaleSets/upgradePolicy.automaticOSUpgradePolicy.enableAutomaticOSUpgrade\",\"notEquals\":\"True\"},{\"field\":\"Microsoft.Compute/VirtualMachineScaleSets/upgradePolicy.automaticOSUpgrade\",\"notEquals\":\"True\"}]},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/465f0161-0087-490a-9ad9-ad6217f4f43a\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"465f0161-0087-490a-9ad9-ad6217f4f43a\"},{\"properties\":{\"displayName\":\"Automatic provisioning of the Log Analytics monitoring agent should be enabled on your subscription\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Enable automatic provisioning of the Log Analytics monitoring agent in order to collect security data\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/autoProvisioningSettings\",\"existenceCondition\":{\"field\":\"Microsoft.Security/autoProvisioningSettings/autoProvision\",\"equals\":\"On\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/475aae12-b88a-4572-8b36-9b712b2b3a17\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"475aae12-b88a-4572-8b36-9b712b2b3a17\"},{\"properties\":{\"displayName\":\"Adaptive Application Controls should be enabled on virtual machines\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Possible Application Whitelist configuration will be monitored by Azure Security Center\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"in\":[\"Microsoft.Compute/virtualMachines\",\"Microsoft.ClassicCompute/virtualMachines\"]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"applicationWhitelisting\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/47a6b606-51aa-4496-8bb7-64b11cf66adc\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"47a6b606-51aa-4496-8bb7-64b11cf66adc\"},{\"properties\":{\"displayName\":\"[Deprecated]: Audit IP restrictions configuration for an API App\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"IP Restrictions allow you to define a list of IP addresses that are allowed to access your app. Use of IP Restrictions protects an API app from common attacks.\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true,\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"microsoft.Web/sites\"},{\"anyOf\":[{\"field\":\"kind\",\"equals\":\"api\"},{\"field\":\"kind\",\"equals\":\"apiApp\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"ConfigureIPRestrictions\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/48893b84-a2c8-4d9a-badf-835d5d1b7d53\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"48893b84-a2c8-4d9a-badf-835d5d1b7d53\"},{\"properties\":{\"displayName\":\"Geo-redundant backup should be enabled for Azure Database for PostgreSQL\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy audits any Azure Database for PostgreSQL with geo-redundant backup not enabled.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.DBforPostgreSQL/servers\"},{\"field\":\"Microsoft.DBforPostgreSQL/servers/storageProfile.geoRedundantBackup\",\"notEquals\":\"Enabled\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/48af4db5-9b8b-401c-8e74-076be876a430\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"48af4db5-9b8b-401c-8e74-076be876a430\"},{\"properties\":{\"displayName\":\"Ensure that 'Java version' is the latest, if used as a part of the Web app\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Periodically, newer versions are released for Java software either due to security flaws or to include additional functionality. Using the latest Java version for web apps is recommended in order to take advantage of security fixes, if any, and/or new functionalities of the latest version.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]},\"JavaLatestVersion\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Latest Java version\",\"description\":\"Latest supported Java version for App Services\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"app*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"notContains\":\"JAVA\"},{\"field\":\"Microsoft.Web/sites/config/web.javaVersion\",\"equals\":\"\"}]},{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"like\":\"[concat('*', parameters('JavaLatestVersion'))]\"},{\"field\":\"Microsoft.Web/sites/config/web.javaVersion\",\"equals\":\"\"}]},{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"equals\":\"\"},{\"field\":\"Microsoft.Web/sites/config/web.javaVersion\",\"like\":\"[concat(parameters('JavaLatestVersion'), '*')]\"}]}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/496223c3-ad65-4ecd-878a-bae78737e9ed\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"496223c3-ad65-4ecd-878a-bae78737e9ed\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'Security Options - Audit'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Audit'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"AuditShutDownSystemImmediatelyIfUnableToLogSecurityAudits\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Audit: Shut down system immediately if unable to log security audits\",\"description\":\"Audits if the system will shut down when unable to log Security events.\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsAudit\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('Audit: Shut down system immediately if unable to log security audits;ExpectedValue', '=', parameters('AuditShutDownSystemImmediatelyIfUnableToLogSecurityAudits')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_SecurityOptionsAudit\"},\"AuditShutDownSystemImmediatelyIfUnableToLogSecurityAudits\":{\"value\":\"[parameters('AuditShutDownSystemImmediatelyIfUnableToLogSecurityAudits')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"AuditShutDownSystemImmediatelyIfUnableToLogSecurityAudits\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"Audit: Shut down system immediately if unable to log security audits;ExpectedValue\",\"value\":\"[parameters('AuditShutDownSystemImmediatelyIfUnableToLogSecurityAudits')]\"}]}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/498b810c-59cd-4222-9338-352ba146ccf3\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"498b810c-59cd-4222-9338-352ba146ccf3\"},{\"properties\":{\"displayName\":\"Append tag and its default value to resource groups\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Appends the specified tag and value when any resource group which is missing this tag is created or updated. Does not modify the tags of resource groups created before this policy was applied until those resource groups are changed. New 'modify' effect policies are available that support remediation of tags on existing resources (see https://aka.ms/modifydoc).\",\"metadata\":{\"category\":\"Tags\"},\"parameters\":{\"tagName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Tag Name\",\"description\":\"Name of the tag, such as 'environment'\"}},\"tagValue\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Tag Value\",\"description\":\"Value of the tag, such as 'production'\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions/resourceGroups\"},{\"field\":\"[concat('tags[', parameters('tagName'), ']')]\",\"exists\":\"false\"}]},\"then\":{\"effect\":\"append\",\"details\":[{\"field\":\"[concat('tags[', parameters('tagName'), ']')]\",\"value\":\"[parameters('tagValue')]\"}]}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/49c88fc8-6fd1-46fd-a676-f12d1d3a4c71\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"49c88fc8-6fd1-46fd-a676-f12d1d3a4c71\"},{\"properties\":{\"displayName\":\"Deploy prerequisites to audit Linux VMs that do not have the specified applications installed\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Linux virtual machines that do not have the specified applications installed. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"ApplicationName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Application names\",\"description\":\"A semicolon-separated list of the names of the applications that should be installed. e.g. 'python; powershell'\"}}},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"microsoft-aks\",\"AzureDatabricks\",\"qubole-inc\",\"datastax\",\"couchbase\",\"scalegrid\",\"checkpoint\",\"paloaltonetworks\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"OpenLogic\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"CentOS*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"RHEL\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"osa\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"credativ\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Debian\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"7*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Suse\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"SLES*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"11*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Canonical\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"UbuntuServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"12*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"linux-data-science-vm-ubuntu\",\"azureml\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-centos-os\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-altus-centos-os\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"linux*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"linux*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"installed_application_linux\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('[ChefInSpec]InstalledApplicationLinuxResource1;AttributesYmlContent', '=', concat('packages: [', replace(parameters('ApplicationName'), ';', ','), ']')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"installed_application_linux\"},\"ApplicationName\":{\"value\":\"[parameters('ApplicationName')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"ApplicationName\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[ChefInSpec]InstalledApplicationLinuxResource1;AttributesYmlContent\",\"value\":\"[concat('packages: [', replace(parameters('ApplicationName'), ';', ','), ']')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[ChefInSpec]InstalledApplicationLinuxResource1;AttributesYmlContent\",\"value\":\"[concat('packages: [', replace(parameters('ApplicationName'), ';', ','), ']')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforLinux')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforLinux\",\"typeHandlerVersion\":\"1.0\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/4d1c04de-2172-403f-901b-90608c35c721\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"4d1c04de-2172-403f-901b-90608c35c721\"},{\"properties\":{\"displayName\":\"FTPS should be required in your Web App\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Enable FTPS enforcement for enhanced security\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"app*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/ftpsState\",\"equals\":\"FtpsOnly\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/4d24b6d4-5e53-4a4f-a7f4-618fa573ee4b\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"4d24b6d4-5e53-4a4f-a7f4-618fa573ee4b\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy Dependency Agent for Linux VMs\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploy Dependency Agent for Linux VMs if the VM Image (OS) is in the list defined and the agent is not installed.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"listOfImageIdToInclude\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"Optional: List of VM images that have supported Linux OS to add to scope\",\"description\":\"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageId\",\"in\":\"[parameters('listOfImageIdToInclude')]\"},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Canonical\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"UbuntuServer\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"14.04.0-LTS\",\"14.04.1-LTS\",\"14.04.5-LTS\"]},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"16.04-LTS\",\"16.04.0-LTS\"]},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"18.04-LTS\"]}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"RHEL\",\"RHEL-SAP-HANA\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"6.*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"SUSE\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"SLES\",\"SLES-HPC\",\"SLES-HPC-Priority\",\"SLES-SAP\",\"SLES-SAP-BYOS\",\"SLES-Priority\",\"SLES-BYOS\",\"SLES-SAPCAL\",\"SLES-Standard\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"12-SP2\",\"12-SP3\",\"12-SP4\"]}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"OpenLogic\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"CentOS\",\"Centos-LVM\",\"CentOS-SRIOV\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"6.*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-centos-os\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"],\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Compute/virtualMachines/extensions/type\",\"equals\":\"DependencyAgentLinux\"},{\"field\":\"Microsoft.Compute/virtualMachines/extensions/publisher\",\"equals\":\"Microsoft.Azure.Monitoring.DependencyAgent\"},{\"field\":\"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\"equals\":\"Succeeded\"}]},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"}},\"variables\":{\"vmExtensionName\":\"DependencyAgent\",\"vmExtensionPublisher\":\"Microsoft.Azure.Monitoring.DependencyAgent\",\"vmExtensionType\":\"DependencyAgentLinux\",\"vmExtensionTypeHandlerVersion\":\"9.6\"},\"resources\":[{\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"name\":\"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\"apiVersion\":\"2018-06-01\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"[variables('vmExtensionPublisher')]\",\"type\":\"[variables('vmExtensionType')]\",\"typeHandlerVersion\":\"[variables('vmExtensionTypeHandlerVersion')]\",\"autoUpgradeMinorVersion\":true}}],\"outputs\":{\"policy\":{\"type\":\"string\",\"value\":\"[concat('Enabled extension for VM', ': ', parameters('vmName'))]\"}}},\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/4da21710-ce6f-4e06-8cdb-5cc4c93ffbee\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"4da21710-ce6f-4e06-8cdb-5cc4c93ffbee\"},{\"properties\":{\"displayName\":\"Deploy Diagnostic Settings for Data Lake Analytics to Event Hub\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploys the diagnostic settings for Data Lake Analytics to stream to a regional Event Hub when any Data Lake Analytics which is missing this diagnostic settings is created or updated.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"DeployIfNotExists\",\"Disabled\"]},\"profileName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Profile name\",\"description\":\"The diagnostic settings profile name\"}},\"eventHubRuleId\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Event Hub Authorization Rule Id\",\"description\":\"The Event Hub authorization rule Id for Azure Diagnostics. The authorization rule needs to be at Event Hub namespace level. e.g. /subscriptions/{subscription Id}/resourceGroups/{resource group}/providers/Microsoft.EventHub/namespaces/{Event Hub namespace}/authorizationrules/{authorization rule}\",\"strongType\":\"Microsoft.EventHub/Namespaces/AuthorizationRules\",\"assignPermissions\":true}},\"metricsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable metrics\",\"description\":\"Whether to enable metrics stream to the Event Hub - True or False\"},\"allowedValues\":[\"True\",\"False\"]},\"logsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable logs\",\"description\":\"Whether to enable logs stream to the Event Hub  - True or False\"},\"allowedValues\":[\"True\",\"False\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.DataLakeAnalytics/accounts\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"name\":\"[parameters('profileName')]\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"[parameters('logsEnabled')]\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\"equals\":\"[parameters('metricsEnabled')]\"}]},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"resourceName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"eventHubRuleId\":{\"type\":\"string\"},\"metricsEnabled\":{\"type\":\"string\"},\"logsEnabled\":{\"type\":\"string\"},\"profileName\":{\"type\":\"string\"}},\"variables\":{},\"resources\":[{\"type\":\"Microsoft.DataLakeAnalytics/accounts/providers/diagnosticSettings\",\"apiVersion\":\"2017-05-01-preview\",\"name\":\"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\"location\":\"[parameters('location')]\",\"dependsOn\":[],\"properties\":{\"eventHubAuthorizationRuleId\":\"[parameters('eventHubRuleId')]\",\"metrics\":[{\"category\":\"AllMetrics\",\"enabled\":\"[parameters('metricsEnabled')]\",\"retentionPolicy\":{\"enabled\":false,\"days\":0}}],\"logs\":[{\"category\":\"Audit\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"Requests\",\"enabled\":\"[parameters('logsEnabled')]\"}]}}],\"outputs\":{}},\"parameters\":{\"location\":{\"value\":\"[field('location')]\"},\"resourceName\":{\"value\":\"[field('name')]\"},\"eventHubRuleId\":{\"value\":\"[parameters('eventHubRuleId')]\"},\"metricsEnabled\":{\"value\":\"[parameters('metricsEnabled')]\"},\"logsEnabled\":{\"value\":\"[parameters('logsEnabled')]\"},\"profileName\":{\"value\":\"[parameters('profileName')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/4daddf25-4823-43d4-88eb-2419eb6dcc08\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"4daddf25-4823-43d4-88eb-2419eb6dcc08\"},{\"properties\":{\"displayName\":\"A maximum of 3 owners should be designated for your subscription\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"It is recommended to designate up to 3 subscription owners in order to reduce the potential for breach by a compromised owner.\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"DesignateLessThanXOwners\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/4f11b553-d42e-4e3a-89be-32ca364cad4c\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"4f11b553-d42e-4e3a-89be-32ca364cad4c\"},{\"properties\":{\"displayName\":\"A security contact email address should be provided for your subscription\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Enter an email address to receive notifications when Azure Security Center detects compromised resources\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/securityContacts\",\"existenceCondition\":{\"field\":\"Microsoft.Security/securityContacts/email\",\"notEquals\":\"\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/4f4f78b8-e367-4b10-a341-d9a4ad5cf1c7\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"4f4f78b8-e367-4b10-a341-d9a4ad5cf1c7\"},{\"properties\":{\"displayName\":\"Add a tag to resources\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Adds the specified tag and value when any resource missing this tag is created or updated. Existing resources can be remediated by triggering a remediation task. If the tag exists with a different value it will not be changed. Does not modify tags on resource groups.\",\"metadata\":{\"category\":\"Tags\"},\"parameters\":{\"tagName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Tag Name\",\"description\":\"Name of the tag, such as 'environment'\"}},\"tagValue\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Tag Value\",\"description\":\"Value of the tag, such as 'production'\"}}},\"policyRule\":{\"if\":{\"field\":\"[concat('tags[', parameters('tagName'), ']')]\",\"exists\":\"false\"},\"then\":{\"effect\":\"modify\",\"details\":{\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"operations\":[{\"operation\":\"add\",\"field\":\"[concat('tags[', parameters('tagName'), ']')]\",\"value\":\"[parameters('tagValue')]\"}]}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/4f9dc7db-30c1-420c-b61a-e1d640128d26\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"4f9dc7db-30c1-420c-b61a-e1d640128d26\"},{\"properties\":{\"displayName\":\"[Preview] Vulnerability Assessment should be enabled on Virtual Machines\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Monitors vulnerabilities detected by Azure Security Center Vulnerability Assessment on Virtual Machines\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"in\":[\"Microsoft.Compute/virtualMachines\",\"Microsoft.ClassicCompute/virtualMachines\"]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"serverVulnerabilityAssessment\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"NotApplicable\",\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/501541f7-f7e7-4cd6-868c-4190fdad3ac9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"501541f7-f7e7-4cd6-868c-4190fdad3ac9\"},{\"properties\":{\"displayName\":\"A custom IPsec/IKE policy must be applied to all Azure virtual network gateway connections\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy ensures that all Azure virtual network gateway connections use a custom Internet Protocol Security(Ipsec)/Internet Key Exchange(IKE) policy. Supported algorithms and key strengths - https://aka.ms/AA62kb0\",\"metadata\":{\"category\":\"Network\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]},\"IPsecEncryption\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"IPsec Encryption\",\"description\":\"IPsec Encryption\"}},\"IPsecIntegrity\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"IPsec Integrity\",\"description\":\"IPsec Integrity\"}},\"IKEEncryption\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"IKE Encryption\",\"description\":\"IKE Encryption\"}},\"IKEIntegrity\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"IKE Integrity\",\"description\":\"IKE Integrity\"}},\"DHGroup\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"DH Group\",\"description\":\"DH Group\"}},\"PFSGroup\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"PFS Group\",\"description\":\"PFS Group\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Network/connections\"},{\"anyOf\":[{\"field\":\"Microsoft.Network/connections/ipsecPolicies[*].ipsecEncryption\",\"notIn\":\"[parameters('IPsecEncryption')]\"},{\"field\":\"Microsoft.Network/connections/ipsecPolicies[*].ipsecIntegrity\",\"notIn\":\"[parameters('IPsecIntegrity')]\"},{\"field\":\"Microsoft.Network/connections/ipsecPolicies[*].ikeEncryption\",\"notIn\":\"[parameters('IKEEncryption')]\"},{\"field\":\"Microsoft.Network/connections/ipsecPolicies[*].ikeIntegrity\",\"notIn\":\"[parameters('IKEIntegrity')]\"},{\"field\":\"Microsoft.Network/connections/ipsecPolicies[*].dhGroup\",\"notIn\":\"[parameters('DHGroup')]\"},{\"field\":\"Microsoft.Network/connections/ipsecPolicies[*].pfsGroup\",\"notIn\":\"[parameters('PFSGroup')]\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/50b83b09-03da-41c1-b656-c293c914862b\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"50b83b09-03da-41c1-b656-c293c914862b\"},{\"properties\":{\"displayName\":\"Connection throttling should be enabled for PostgreSQL database servers\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy helps audit any PostgreSQL databases in your environment without Connection throttling enabled. This setting enables temporary connection throttling per IP for too many invalid password login failures.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.DBforPostgreSQL/servers\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.DBforPostgreSQL/servers/configurations\",\"name\":\"connection_throttling\",\"existenceCondition\":{\"field\":\"Microsoft.DBforPostgreSQL/servers/configurations/value\",\"equals\":\"ON\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/5345bb39-67dc-4960-a1bf-427e16b9a0bd\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"5345bb39-67dc-4960-a1bf-427e16b9a0bd\"},{\"properties\":{\"displayName\":\"CORS should not allow every resource to access your Web Applications\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Cross-Origin Resource Sharing (CORS) should not allow all domains to access your web application. Allow only required domains to interact with your web app.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"app*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/web.cors.allowedOrigins[*]\",\"notEquals\":\"*\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/5744710e-cc2f-4ee8-8809-3b11e89f4bc9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"5744710e-cc2f-4ee8-8809-3b11e89f4bc9\"},{\"properties\":{\"displayName\":\"[Deprecated]: Ensure Function app is using the latest version of TLS encryption\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"The TLS(Transport Layer Security) protocol secures transmission of data over the internet using standard encryption technology. Encryption should be set with the latest version of TLS. App service allows TLS 1.2 by default, which is the recommended TLS level by industry standards, such as PCI DSS\",\"metadata\":{\"category\":\"App Service\",\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"functionapp*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/web.minTlsVersion\",\"equals\":\"1.2\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/58d94fc1-a072-47c2-bd37-9cdb38e77453\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"58d94fc1-a072-47c2-bd37-9cdb38e77453\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs that do not have a minimum password age of 1 day\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines that do not have a minimum password age of 1 day. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"MinimumPasswordAge\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/5aa11bbc-5c76-4302-80e5-aba46a4282e7\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"5aa11bbc-5c76-4302-80e5-aba46a4282e7\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs that do not restrict the minimum password length to 14 characters\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines that do not restrict the minimum password length to 14 characters. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"MinimumPasswordLength\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/5aebc8d1-020d-4037-89a0-02043a7524ec\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"5aebc8d1-020d-4037-89a0-02043a7524ec\"},{\"properties\":{\"displayName\":\"Show audit results from Linux VMs that have the specified applications installed\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Linux virtual machines that have the specified applications installed. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"microsoft-aks\",\"AzureDatabricks\",\"qubole-inc\",\"datastax\",\"couchbase\",\"scalegrid\",\"checkpoint\",\"paloaltonetworks\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"OpenLogic\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"CentOS*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"RHEL\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"osa\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"credativ\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Debian\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"7*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Suse\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"SLES*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"11*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Canonical\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"UbuntuServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"12*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"linux-data-science-vm-ubuntu\",\"azureml\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-centos-os\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-altus-centos-os\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"linux*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"linux*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"not_installed_application_linux\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/5b842acb-0fe7-41b0-9f40-880ec4ad84d8\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"5b842acb-0fe7-41b0-9f40-880ec4ad84d8\"},{\"properties\":{\"displayName\":\"Ensure WEB app has 'Client Certificates (Incoming client certificates)' set to 'On'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Client certificates allow for the app to request a certificate for incoming requests. Only clients that have a valid certificate will be able to reach the app.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"app*\"},{\"field\":\"Microsoft.Web/sites/clientCertEnabled\",\"equals\":\"false\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/5bb220d9-2698-4ee4-8404-b9c30c9df609\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"5bb220d9-2698-4ee4-8404-b9c30c9df609\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy prerequisites to audit Windows VMs on which the remote host connection status does not match the specified one\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines on which the remote host connection status does not match the specified one. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"host\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Remote Host Name\",\"description\":\"Specifies the Domain Name System (DNS) name or IP address of the remote host machine.\"}},\"port\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Port\",\"description\":\"The TCP port number on the remote host name.\"}},\"shouldConnect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Should connect to remote host\",\"description\":\"Must be 'True' or 'False'. 'True' indicates that the virtual machine should be able to establish a connection with the remote host specified, so the machine will be non-compliant if it cannot establish a connection. 'False' indicates that the virtual machine should not be able to establish a connection with the remote host specified, so the machine will be non-compliant if it can establish a connection.\"},\"allowedValues\":[\"True\",\"False\"]}},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WindowsRemoteConnection\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('[WindowsRemoteConnection]WindowsRemoteConnection1;host', '=', parameters('host'), ',', '[WindowsRemoteConnection]WindowsRemoteConnection1;port', '=', parameters('port'), ',', '[WindowsRemoteConnection]WindowsRemoteConnection1;shouldConnect', '=', parameters('shouldConnect')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"WindowsRemoteConnection\"},\"host\":{\"value\":\"[parameters('host')]\"},\"port\":{\"value\":\"[parameters('port')]\"},\"shouldConnect\":{\"value\":\"[parameters('shouldConnect')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"host\":{\"type\":\"string\"},\"port\":{\"type\":\"string\"},\"shouldConnect\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[WindowsRemoteConnection]WindowsRemoteConnection1;host\",\"value\":\"[parameters('host')]\"},{\"name\":\"[WindowsRemoteConnection]WindowsRemoteConnection1;port\",\"value\":\"[parameters('port')]\"},{\"name\":\"[WindowsRemoteConnection]WindowsRemoteConnection1;shouldConnect\",\"value\":\"[parameters('shouldConnect')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[WindowsRemoteConnection]WindowsRemoteConnection1;host\",\"value\":\"[parameters('host')]\"},{\"name\":\"[WindowsRemoteConnection]WindowsRemoteConnection1;port\",\"value\":\"[parameters('port')]\"},{\"name\":\"[WindowsRemoteConnection]WindowsRemoteConnection1;shouldConnect\",\"value\":\"[parameters('shouldConnect')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/5bb36dda-8a78-4df9-affd-4f05a8612a8a\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"5bb36dda-8a78-4df9-affd-4f05a8612a8a\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'Security Options - Network Security'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Network Security'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsNetworkSecurity\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/5c028d2a-1889-45f6-b821-31f42711ced8\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"5c028d2a-1889-45f6-b821-31f42711ced8\"},{\"properties\":{\"displayName\":\"[Preview]: Audit Log Analytics Agent Deployment in VMSS - VM Image (OS) unlisted\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Reports VMSS as non-compliant if the VM Image (OS) is not in the list defined and the agent is not installed. The list of OS images will be updated over time as support is updated.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"listOfImageIdToInclude_windows\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"Optional: List of VM images that have supported Windows OS to add to scope\",\"description\":\"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"}},\"listOfImageIdToInclude_linux\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"Optional: List of VM images that have supported Linux OS to add to scope\",\"description\":\"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachineScaleSets\"},{\"not\":{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageId\",\"in\":\"[parameters('listOfImageIdToInclude_windows')]\"},{\"field\":\"Microsoft.Compute/imageId\",\"in\":\"[parameters('listOfImageIdToInclude_linux')]\"},{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"2008-R2-SP1\",\"2008-R2-SP1-smalldisk\",\"2012-Datacenter\",\"2012-Datacenter-smalldisk\",\"2012-R2-Datacenter\",\"2012-R2-Datacenter-smalldisk\",\"2016-Datacenter\",\"2016-Datacenter-Server-Core\",\"2016-Datacenter-Server-Core-smalldisk\",\"2016-Datacenter-smalldisk\",\"2016-Datacenter-with-Containers\",\"2016-Datacenter-with-RDSH\",\"2019-Datacenter\",\"2019-Datacenter-Core\",\"2019-Datacenter-Core-smalldisk\",\"2019-Datacenter-Core-with-Containers\",\"2019-Datacenter-Core-with-Containers-smalldisk\",\"2019-Datacenter-smalldisk\",\"2019-Datacenter-with-Containers\",\"2019-Datacenter-with-Containers-smalldisk\",\"2019-Datacenter-zhcn\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServerSemiAnnual\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"Datacenter-Core-1709-smalldisk\",\"Datacenter-Core-1709-with-Containers-smalldisk\",\"Datacenter-Core-1803-with-Containers-smalldisk\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServerHPCPack\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServerHPCPack\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2016\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2016-BYOL\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2012R2\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2012R2-BYOL\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftRServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"MLServer-WS2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftVisualStudio\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"VisualStudio\",\"Windows\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftDynamicsAX\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Dynamics\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"equals\":\"Pre-Req-AX7-Onebox-U8\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"windows-data-science-vm\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsDesktop\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Windows-10\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"RHEL\",\"RHEL-SAP-HANA\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"6.*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"SUSE\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"SLES\",\"SLES-HPC\",\"SLES-HPC-Priority\",\"SLES-SAP\",\"SLES-SAP-BYOS\",\"SLES-Priority\",\"SLES-BYOS\",\"SLES-SAPCAL\",\"SLES-Standard\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"12*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Canonical\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"UbuntuServer\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"14.04*LTS\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"16.04*LTS\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"18.04*LTS\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Oracle\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Oracle-Linux\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"6.*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7.*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"OpenLogic\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"CentOS\",\"Centos-LVM\",\"CentOS-SRIOV\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"6.*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-centos-os\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]}}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.Compute/virtualMachineScaleSets/extensions\",\"existenceCondition\":{\"field\":\"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\"equals\":\"Microsoft.EnterpriseCloud.Monitoring\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/5c3bc7b8-a64c-4e08-a9cd-7ff0f31e1138\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"5c3bc7b8-a64c-4e08-a9cd-7ff0f31e1138\"},{\"properties\":{\"displayName\":\"External accounts with write permissions should be removed from your subscription\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"External accounts with write privileges should be removed from your subscription in order to prevent unmonitored access.\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"RemoveExternalAccountsWithWritePermissions\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/5c607a2e-c700-4744-8254-d77e7c9eb5e4\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"5c607a2e-c700-4744-8254-d77e7c9eb5e4\"},{\"properties\":{\"displayName\":\"[Deprecated]: Function App should only be accessible over HTTPS\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Use of HTTPS ensures server/service authentication and protects data in transit from network layer eavesdropping attacks.\",\"metadata\":{\"category\":\"Security Center\",\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"microsoft.Web/sites\"},{\"anyOf\":[{\"field\":\"kind\",\"equals\":\"functionapp\"},{\"field\":\"kind\",\"equals\":\"functionapp,linux\"},{\"field\":\"kind\",\"equals\":\"functionapp,linux,container\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"OnlyHttpsForFunctionApp\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/5df82f4f-773a-4a2d-97a2-422a806f1a55\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"5df82f4f-773a-4a2d-97a2-422a806f1a55\"},{\"properties\":{\"displayName\":\"[Deprecated]: Audit Web Applications that are not using latest supported .NET Framework\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Use the latest supported .NET Framework version for the latest security classes. Using older classes and types can make your application vulnerable.\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true,\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"microsoft.Web/sites\"},{\"anyOf\":[{\"field\":\"kind\",\"equals\":\"app\"},{\"field\":\"kind\",\"equals\":\"WebApp\"},{\"field\":\"kind\",\"equals\":\"app,linux\"},{\"field\":\"kind\",\"equals\":\"app,linux,container\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"UseLatestDotNet\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/5e3315e0-a414-4efb-a4d2-c7bd2b0443d2\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"5e3315e0-a414-4efb-a4d2-c7bd2b0443d2\"},{\"properties\":{\"displayName\":\"Show audit results from Windows VMs that do not have the specified applications installed\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines that do not have the specified applications installed. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WhitelistedApplication\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/5e393799-e3ca-4e43-a9a5-0ec4648a57d9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"5e393799-e3ca-4e43-a9a5-0ec4648a57d9\"},{\"properties\":{\"displayName\":\"[Deprecated]: Allow resource creation only in India data centers\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Allows resource creation in the following locations only: West India, South India, Central India\",\"metadata\":{\"category\":\"General\",\"deprecated\":true},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"westindia\",\"southindia\",\"centralindia\"]}},\"then\":{\"effect\":\"Deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/5ee85ce5-e7eb-44d6-b4a2-32a24be1ca54\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"5ee85ce5-e7eb-44d6-b4a2-32a24be1ca54\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy Log Analytics Agent for Linux VM Scale Sets (VMSS)\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploy Log Analytics Agent for Linux VM Scale Sets if the VM Image (OS) is in the list defined and the agent is not installed. Note: if your scale set upgradePolicy is set to Manual, you need to apply the extension to the all VMs in the set by calling upgrade on them. In CLI this would be az vmss update-instances.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"logAnalytics\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Log Analytics workspace\",\"description\":\"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\"strongType\":\"omsWorkspace\",\"assignPermissions\":true}},\"listOfImageIdToInclude\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"Optional: List of VM images that have supported Linux OS to add to scope\",\"description\":\"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachineScaleSets\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageId\",\"in\":\"[parameters('listOfImageIdToInclude')]\"},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"RHEL\",\"RHEL-SAP-HANA\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"6.*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"SUSE\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"SLES\",\"SLES-HPC\",\"SLES-HPC-Priority\",\"SLES-SAP\",\"SLES-SAP-BYOS\",\"SLES-Priority\",\"SLES-BYOS\",\"SLES-SAPCAL\",\"SLES-Standard\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"12*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Canonical\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"UbuntuServer\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"14.04*LTS\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"16.04*LTS\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"18.04*LTS\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Oracle\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Oracle-Linux\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"6.*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7.*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"OpenLogic\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"CentOS\",\"Centos-LVM\",\"CentOS-SRIOV\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"6.*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-centos-os\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.Compute/virtualMachineScaleSets/extensions\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\",\"/providers/microsoft.authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\"],\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Compute/virtualMachineScaleSets/extensions/type\",\"equals\":\"OmsAgentForLinux\"},{\"field\":\"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\"equals\":\"Microsoft.EnterpriseCloud.Monitoring\"}]},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"logAnalytics\":{\"type\":\"string\"}},\"variables\":{\"vmExtensionName\":\"MMAExtension\",\"vmExtensionPublisher\":\"Microsoft.EnterpriseCloud.Monitoring\",\"vmExtensionType\":\"OmsAgentForLinux\",\"vmExtensionTypeHandlerVersion\":\"1.7\"},\"resources\":[{\"name\":\"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\"type\":\"Microsoft.Compute/virtualMachineScaleSets/extensions\",\"location\":\"[parameters('location')]\",\"apiVersion\":\"2018-06-01\",\"properties\":{\"publisher\":\"[variables('vmExtensionPublisher')]\",\"type\":\"[variables('vmExtensionType')]\",\"typeHandlerVersion\":\"[variables('vmExtensionTypeHandlerVersion')]\",\"autoUpgradeMinorVersion\":true,\"settings\":{\"workspaceId\":\"[reference(parameters('logAnalytics'), '2015-03-20').customerId]\",\"stopOnMultipleConnections\":\"true\"},\"protectedSettings\":{\"workspaceKey\":\"[listKeys(parameters('logAnalytics'), '2015-03-20').primarySharedKey]\"}}}],\"outputs\":{\"policy\":{\"type\":\"string\",\"value\":\"[concat('Enabled extension for: ', parameters('vmName'))]\"}}},\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"logAnalytics\":{\"value\":\"[parameters('logAnalytics')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/5ee9e9ed-0b42-41b7-8c9c-3cfb2fbe2069\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"5ee9e9ed-0b42-41b7-8c9c-3cfb2fbe2069\"},{\"properties\":{\"displayName\":\"External accounts with read permissions should be removed from your subscription\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"External accounts with read privileges should be removed from your subscription in order to prevent unmonitored access.\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"RemoveExternalAccountsWithReadPermissions\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/5f76cf89-fbf2-47fd-a3f4-b891fa780b60\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"5f76cf89-fbf2-47fd-a3f4-b891fa780b60\"},{\"properties\":{\"displayName\":\"Add or replace a tag on resources\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Adds or replaces the specified tag and value when any resource is created or updated. Existing resources can be remediated by triggering a remediation task. Does not modify tags on resource groups.\",\"metadata\":{\"category\":\"Tags\"},\"parameters\":{\"tagName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Tag Name\",\"description\":\"Name of the tag, such as 'environment'\"}},\"tagValue\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Tag Value\",\"description\":\"Value of the tag, such as 'production'\"}}},\"policyRule\":{\"if\":{\"field\":\"[concat('tags[', parameters('tagName'), ']')]\",\"notEquals\":\"[parameters('tagValue')]\"},\"then\":{\"effect\":\"modify\",\"details\":{\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"operations\":[{\"operation\":\"addOrReplace\",\"field\":\"[concat('tags[', parameters('tagName'), ']')]\",\"value\":\"[parameters('tagValue')]\"}]}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/5ffd78d9-436d-4b41-a421-5baa819e3008\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"5ffd78d9-436d-4b41-a421-5baa819e3008\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'System Audit Policies - Object Access'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'System Audit Policies - Object Access'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SystemAuditPoliciesObjectAccess\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/60aeaf73-a074-417a-905f-7ce9df0ff77b\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"60aeaf73-a074-417a-905f-7ce9df0ff77b\"},{\"properties\":{\"displayName\":\"Storage Accounts should use a virtual network service endpoint\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy audits any Storage Account not configured to use a virtual network service endpoint.\",\"metadata\":{\"category\":\"Network\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Storage/storageAccounts\"},{\"anyOf\":[{\"field\":\"Microsoft.Storage/storageAccounts/networkAcls.defaultAction\",\"notEquals\":\"Deny\"},{\"field\":\"Microsoft.Storage/storageAccounts/networkAcls.virtualNetworkRules[*].id\",\"exists\":\"false\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/60d21c4f-21a3-4d94-85f4-b924e6aeeda4\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"60d21c4f-21a3-4d94-85f4-b924e6aeeda4\"},{\"properties\":{\"displayName\":\"Show audit results from Windows web servers that are not using secure communication protocols\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows web servers that are not using secure communication protocols (TLS 1.1 or TLS 1.2). For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AuditSecureProtocol\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/60ffe3e2-4604-4460-8f22-0f1da058266c\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"60ffe3e2-4604-4460-8f22-0f1da058266c\"},{\"properties\":{\"displayName\":\"Deploy Advanced Data Security on SQL servers\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy enables Advanced Data Security on SQL Servers. This includes turning on Threat Detection and Vulnerability Assessment. It will automatically create a storage account in the same region and resource group as the SQL server to store scan results, with a 'sqlva' prefix.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Sql/servers\"},\"then\":{\"effect\":\"DeployIfNotExists\",\"details\":{\"type\":\"Microsoft.Sql/servers/securityAlertPolicies\",\"name\":\"Default\",\"existenceCondition\":{\"field\":\"Microsoft.Sql/securityAlertPolicies.state\",\"equals\":\"Enabled\"},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/056cd41c-7e88-42e1-933e-88ba6a50c9c3\",\"/providers/microsoft.authorization/roleDefinitions/17d1049b-9a84-46fb-8f53-869881c3d3ab\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"serverName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"}},\"variables\":{\"serverResourceGroupName\":\"[resourceGroup().name]\",\"subscriptionId\":\"[subscription().subscriptionId]\",\"uniqueStorage\":\"[uniqueString(variables('subscriptionId'), variables('serverResourceGroupName'), parameters('location'))]\",\"storageName\":\"[tolower(concat('sqlva', variables('uniqueStorage')))]\"},\"resources\":[{\"type\":\"Microsoft.Storage/storageAccounts\",\"name\":\"[variables('storageName')]\",\"apiVersion\":\"2016-01-01\",\"location\":\"[parameters('location')]\",\"sku\":{\"name\":\"Standard_LRS\"},\"kind\":\"Storage\",\"properties\":{}},{\"name\":\"[concat(parameters('serverName'), '/Default')]\",\"type\":\"Microsoft.Sql/servers/securityAlertPolicies\",\"apiVersion\":\"2017-03-01-preview\",\"properties\":{\"state\":\"Enabled\",\"emailAccountAdmins\":true}},{\"name\":\"[concat(parameters('serverName'), '/Default')]\",\"type\":\"Microsoft.Sql/servers/vulnerabilityAssessments\",\"apiVersion\":\"2018-06-01-preview\",\"properties\":{\"storageContainerPath\":\"[concat(reference(resourceId('Microsoft.Storage/storageAccounts', variables('storageName'))).primaryEndpoints.blob, 'vulnerability-assessment')]\",\"storageAccountAccessKey\":\"[listKeys(resourceId('Microsoft.Storage/storageAccounts', variables('storageName')), '2018-02-01').keys[0].value]\",\"recurringScans\":{\"isEnabled\":true,\"emailSubscriptionAdmins\":true,\"emails\":[]}},\"dependsOn\":[\"[concat('Microsoft.Storage/storageAccounts/', variables('storageName'))]\",\"[concat('Microsoft.Sql/servers/', parameters('serverName'), '/securityAlertPolicies/Default')]\"]}]},\"parameters\":{\"serverName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/6134c3db-786f-471e-87bc-8f479dc890f6\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"6134c3db-786f-471e-87bc-8f479dc890f6\"},{\"properties\":{\"displayName\":\"Configure time zone on Windows machines.\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to set specified time zone on Windows virtual machines.\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"TimeZone\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Time zone\",\"description\":\"The expected time zone\"},\"allowedValues\":[\"(UTC-12:00) International Date Line West\",\"(UTC-11:00) Coordinated Universal Time-11\",\"(UTC-10:00) Aleutian Islands\",\"(UTC-10:00) Hawaii\",\"(UTC-09:30) Marquesas Islands\",\"(UTC-09:00) Alaska\",\"(UTC-09:00) Coordinated Universal Time-09\",\"(UTC-08:00) Baja California\",\"(UTC-08:00) Coordinated Universal Time-08\",\"(UTC-08:00) Pacific Time (US & Canada)\",\"(UTC-07:00) Arizona\",\"(UTC-07:00) Chihuahua, La Paz, Mazatlan\",\"(UTC-07:00) Mountain Time (US & Canada)\",\"(UTC-06:00) Central America\",\"(UTC-06:00) Central Time (US & Canada)\",\"(UTC-06:00) Easter Island\",\"(UTC-06:00) Guadalajara, Mexico City, Monterrey\",\"(UTC-06:00) Saskatchewan\",\"(UTC-05:00) Bogota, Lima, Quito, Rio Branco\",\"(UTC-05:00) Chetumal\",\"(UTC-05:00) Eastern Time (US & Canada)\",\"(UTC-05:00) Haiti\",\"(UTC-05:00) Havana\",\"(UTC-05:00) Indiana (East)\",\"(UTC-05:00) Turks and Caicos\",\"(UTC-04:00) Asuncion\",\"(UTC-04:00) Atlantic Time (Canada)\",\"(UTC-04:00) Caracas\",\"(UTC-04:00) Cuiaba\",\"(UTC-04:00) Georgetown, La Paz, Manaus, San Juan\",\"(UTC-04:00) Santiago\",\"(UTC-03:30) Newfoundland\",\"(UTC-03:00) Araguaina\",\"(UTC-03:00) Brasilia\",\"(UTC-03:00) Cayenne, Fortaleza\",\"(UTC-03:00) City of Buenos Aires\",\"(UTC-03:00) Greenland\",\"(UTC-03:00) Montevideo\",\"(UTC-03:00) Punta Arenas\",\"(UTC-03:00) Saint Pierre and Miquelon\",\"(UTC-03:00) Salvador\",\"(UTC-02:00) Coordinated Universal Time-02\",\"(UTC-02:00) Mid-Atlantic - Old\",\"(UTC-01:00) Azores\",\"(UTC-01:00) Cabo Verde Is.\",\"(UTC) Coordinated Universal Time\",\"(UTC+00:00) Dublin, Edinburgh, Lisbon, London\",\"(UTC+00:00) Monrovia, Reykjavik\",\"(UTC+00:00) Sao Tome\",\"(UTC+01:00) Casablanca\",\"(UTC+01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna\",\"(UTC+01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague\",\"(UTC+01:00) Brussels, Copenhagen, Madrid, Paris\",\"(UTC+01:00) Sarajevo, Skopje, Warsaw, Zagreb\",\"(UTC+01:00) West Central Africa\",\"(UTC+02:00) Amman\",\"(UTC+02:00) Athens, Bucharest\",\"(UTC+02:00) Beirut\",\"(UTC+02:00) Cairo\",\"(UTC+02:00) Chisinau\",\"(UTC+02:00) Damascus\",\"(UTC+02:00) Gaza, Hebron\",\"(UTC+02:00) Harare, Pretoria\",\"(UTC+02:00) Helsinki, Kyiv, Riga, Sofia, Tallinn, Vilnius\",\"(UTC+02:00) Jerusalem\",\"(UTC+02:00) Kaliningrad\",\"(UTC+02:00) Khartoum\",\"(UTC+02:00) Tripoli\",\"(UTC+02:00) Windhoek\",\"(UTC+03:00) Baghdad\",\"(UTC+03:00) Istanbul\",\"(UTC+03:00) Kuwait, Riyadh\",\"(UTC+03:00) Minsk\",\"(UTC+03:00) Moscow, St. Petersburg\",\"(UTC+03:00) Nairobi\",\"(UTC+03:30) Tehran\",\"(UTC+04:00) Abu Dhabi, Muscat\",\"(UTC+04:00) Astrakhan, Ulyanovsk\",\"(UTC+04:00) Baku\",\"(UTC+04:00) Izhevsk, Samara\",\"(UTC+04:00) Port Louis\",\"(UTC+04:00) Saratov\",\"(UTC+04:00) Tbilisi\",\"(UTC+04:00) Volgograd\",\"(UTC+04:00) Yerevan\",\"(UTC+04:30) Kabul\",\"(UTC+05:00) Ashgabat, Tashkent\",\"(UTC+05:00) Ekaterinburg\",\"(UTC+05:00) Islamabad, Karachi\",\"(UTC+05:00) Qyzylorda\",\"(UTC+05:30) Chennai, Kolkata, Mumbai, New Delhi\",\"(UTC+05:30) Sri Jayawardenepura\",\"(UTC+05:45) Kathmandu\",\"(UTC+06:00) Astana\",\"(UTC+06:00) Dhaka\",\"(UTC+06:00) Omsk\",\"(UTC+06:30) Yangon (Rangoon)\",\"(UTC+07:00) Bangkok, Hanoi, Jakarta\",\"(UTC+07:00) Barnaul, Gorno-Altaysk\",\"(UTC+07:00) Hovd\",\"(UTC+07:00) Krasnoyarsk\",\"(UTC+07:00) Novosibirsk\",\"(UTC+07:00) Tomsk\",\"(UTC+08:00) Beijing, Chongqing, Hong Kong, Urumqi\",\"(UTC+08:00) Irkutsk\",\"(UTC+08:00) Kuala Lumpur, Singapore\",\"(UTC+08:00) Perth\",\"(UTC+08:00) Taipei\",\"(UTC+08:00) Ulaanbaatar\",\"(UTC+08:45) Eucla\",\"(UTC+09:00) Chita\",\"(UTC+09:00) Osaka, Sapporo, Tokyo\",\"(UTC+09:00) Pyongyang\",\"(UTC+09:00) Seoul\",\"(UTC+09:00) Yakutsk\",\"(UTC+09:30) Adelaide\",\"(UTC+09:30) Darwin\",\"(UTC+10:00) Brisbane\",\"(UTC+10:00) Canberra, Melbourne, Sydney\",\"(UTC+10:00) Guam, Port Moresby\",\"(UTC+10:00) Hobart\",\"(UTC+10:00) Vladivostok\",\"(UTC+10:30) Lord Howe Island\",\"(UTC+11:00) Bougainville Island\",\"(UTC+11:00) Chokurdakh\",\"(UTC+11:00) Magadan\",\"(UTC+11:00) Norfolk Island\",\"(UTC+11:00) Sakhalin\",\"(UTC+11:00) Solomon Is., New Caledonia\",\"(UTC+12:00) Anadyr, Petropavlovsk-Kamchatsky\",\"(UTC+12:00) Auckland, Wellington\",\"(UTC+12:00) Coordinated Universal Time+12\",\"(UTC+12:00) Fiji\",\"(UTC+12:00) Petropavlovsk-Kamchatsky - Old\",\"(UTC+12:45) Chatham Islands\",\"(UTC+13:00) Coordinated Universal Time+13\",\"(UTC+13:00) Nuku'alofa\",\"(UTC+13:00) Samoa\",\"(UTC+14:00) Kiritimati Island\"]}},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"SetWindowsTimeZone\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('[WindowsTimeZone]WindowsTimeZone1;TimeZone', '=', parameters('TimeZone')))]\"},{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}]},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"SetWindowsTimeZone\"},\"TimeZone\":{\"value\":\"[parameters('TimeZone')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"TimeZone\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"assignmentType\":\"DeployAndAutoCorrect\",\"configurationParameter\":[{\"name\":\"[WindowsTimeZone]WindowsTimeZone1;TimeZone\",\"value\":\"[parameters('TimeZone')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"assignmentType\":\"DeployAndAutoCorrect\",\"configurationParameter\":[{\"name\":\"[WindowsTimeZone]WindowsTimeZone1;TimeZone\",\"value\":\"[parameters('TimeZone')]\"}]}}}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/6141c932-9384-44c6-a395-59e4c057d7c9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"6141c932-9384-44c6-a395-59e4c057d7c9\"},{\"properties\":{\"displayName\":\"Service Fabric clusters should have the ClusterProtectionLevel property set to EncryptAndSign\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Service Fabric provides three levels of protection (None, Sign and EncryptAndSign) for node-to-node communication using a primary cluster certificate. Set the protection level to ensure that all node-to-node messages are encrypted and digitally signed\",\"metadata\":{\"category\":\"Service Fabric\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.ServiceFabric/clusters\"},{\"anyOf\":[{\"field\":\"Microsoft.ServiceFabric/clusters/fabricSettings[*].name\",\"notEquals\":\"Security\"},{\"field\":\"Microsoft.ServiceFabric/clusters/fabricSettings[*].parameters[*].name\",\"notEquals\":\"ClusterProtectionLevel\"},{\"field\":\"Microsoft.ServiceFabric/clusters/fabricSettings[*].parameters[*].value\",\"notEquals\":\"EncryptAndSign\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/617c02be-7f02-4efd-8836-3180d47b6c68\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"617c02be-7f02-4efd-8836-3180d47b6c68\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'Security Options - System objects'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - System objects'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsSystemobjects\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/620e58b5-ac75-49b4-993f-a9d4f0459636\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"620e58b5-ac75-49b4-993f-a9d4f0459636\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'Security Options - Devices'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Devices'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"DevicesAllowedToFormatAndEjectRemovableMedia\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Devices: Allowed to format and eject removable media\",\"description\":\"Specifies who is allowed to format and eject removable NTFS media. You can use this policy setting to prevent unauthorized users from removing data on one computer to access it on another computer on which they have local administrator privileges.\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsDevices\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('Devices: Allowed to format and eject removable media;ExpectedValue', '=', parameters('DevicesAllowedToFormatAndEjectRemovableMedia')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_SecurityOptionsDevices\"},\"DevicesAllowedToFormatAndEjectRemovableMedia\":{\"value\":\"[parameters('DevicesAllowedToFormatAndEjectRemovableMedia')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"DevicesAllowedToFormatAndEjectRemovableMedia\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"Devices: Allowed to format and eject removable media;ExpectedValue\",\"value\":\"[parameters('DevicesAllowedToFormatAndEjectRemovableMedia')]\"}]}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/6481cc21-ed6e-4480-99dd-ea7c5222e897\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"6481cc21-ed6e-4480-99dd-ea7c5222e897\"},{\"properties\":{\"displayName\":\"[Deprecated]: Audit missing blob encryption for storage accounts\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy is no longer necessary because storage blob encryption is enabled by default and cannot be turned off.\",\"metadata\":{\"category\":\"Security Center\",\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Storage/storageAccounts\"},{\"not\":{\"field\":\"Microsoft.Storage/storageAccounts/enableBlobEncryption\",\"equals\":\"True\"}}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/655cb504-bcee-4362-bd4c-402e6aa38759\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"655cb504-bcee-4362-bd4c-402e6aa38759\"},{\"properties\":{\"displayName\":\"[Deprecated]: Audit IP restrictions configuration for a Function App\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"IP Restrictions allow you to define a list of IP addresses that are allowed to access your app. Use of IP Restrictions protects a Function app from common attacks.\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true,\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"microsoft.Web/sites\"},{\"anyOf\":[{\"field\":\"kind\",\"equals\":\"functionapp\"},{\"field\":\"kind\",\"equals\":\"functionapp,linux\"},{\"field\":\"kind\",\"equals\":\"functionapp,linux,container\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"ConfigureIPRestrictions\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/664346d9-be92-43fb-a219-d595eeb76a90\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"664346d9-be92-43fb-a219-d595eeb76a90\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy prerequisites to audit Windows VMs on which the Log Analytics agent is not connected as expected\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines on which the Log Analytics agent is not connected to the specified workspaces. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"WorkspaceId\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Connected workspace IDs\",\"description\":\"A semicolon-separated list of the workspace IDs that the Log Analytics agent should be connected to\"}}},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WindowsLogAnalyticsAgentConnection\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('[LogAnalyticsAgent]LogAnalyticsAgent1;WorkspaceId', '=', parameters('WorkspaceId')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"WindowsLogAnalyticsAgentConnection\"},\"WorkspaceId\":{\"value\":\"[parameters('WorkspaceId')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"WorkspaceId\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[LogAnalyticsAgent]LogAnalyticsAgent1;WorkspaceId\",\"value\":\"[parameters('WorkspaceId')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[LogAnalyticsAgent]LogAnalyticsAgent1;WorkspaceId\",\"value\":\"[parameters('WorkspaceId')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/68511db2-bd02-41c4-ae6b-1900a012968a\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"68511db2-bd02-41c4-ae6b-1900a012968a\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy prerequisites to audit Windows VMs on which Windows Defender Exploit Guard is not enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines on which Windows Defender Exploit Guard is not enabled. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"NotAvailableMachineState\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"State in which to show VMs on which Windows Defender Exploit Guard is not available\",\"description\":\"Windows Defender Exploit Guard is only available starting with Windows 10/Windows Server with update 1709. Setting this value to 'Non-Compliant' will make machines with older versions on which Windows Defender Exploit Guard is not available (such as Windows Server 2012 R2) non-compliant. Setting this value to 'Compliant' will make these machines compliant.\"},\"allowedValues\":[\"Compliant\",\"Non-Compliant\"]}},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WindowsDefenderExploitGuard\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('[WindowsDefenderExploitGuard]WindowsDefenderExploitGuard1;NotAvailableMachineState', '=', parameters('NotAvailableMachineState')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"WindowsDefenderExploitGuard\"},\"NotAvailableMachineState\":{\"value\":\"[parameters('NotAvailableMachineState')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"NotAvailableMachineState\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[WindowsDefenderExploitGuard]WindowsDefenderExploitGuard1;NotAvailableMachineState\",\"value\":\"[parameters('NotAvailableMachineState')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[WindowsDefenderExploitGuard]WindowsDefenderExploitGuard1;NotAvailableMachineState\",\"value\":\"[parameters('NotAvailableMachineState')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/6a7a2bcf-f9be-4e35-9734-4f9657a70f1d\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"6a7a2bcf-f9be-4e35-9734-4f9657a70f1d\"},{\"properties\":{\"displayName\":\"[Deprecated]: Audit IP restrictions configuration for a Web Application\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"IP Restrictions allow you to define a list of IP addresses that are allowed to access your app. Use of IP Restrictions protects a web application from common attacks.\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true,\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"microsoft.Web/sites\"},{\"anyOf\":[{\"field\":\"kind\",\"equals\":\"app\"},{\"field\":\"kind\",\"equals\":\"WebApp\"},{\"field\":\"kind\",\"equals\":\"app,linux\"},{\"field\":\"kind\",\"equals\":\"app,linux,container\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"ConfigureIPRestrictions\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/6a8450e2-6c61-43b4-be65-62e3a197bffe\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"6a8450e2-6c61-43b4-be65-62e3a197bffe\"},{\"properties\":{\"displayName\":\"[Deprecated]: Ensure WEB app is using the latest version of TLS encryption \",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"The TLS(Transport Layer Security) protocol secures transmission of data over the internet using standard encryption technology. Encryption should be set with the latest version of TLS. App service allows TLS 1.2 by default, which is the recommended TLS level by industry standards, such as PCI DSS.\",\"metadata\":{\"category\":\"App Service\",\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"app*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/web.minTlsVersion\",\"equals\":\"1.2\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/6ad61431-88ce-4357-a0e1-6da43f292bd7\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"6ad61431-88ce-4357-a0e1-6da43f292bd7\"},{\"properties\":{\"displayName\":\"Deprecated accounts should be removed from your subscription\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Deprecated accounts should be removed from your subscriptions.  Deprecated accounts are accounts that have been blocked from signing in.\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"RemoveDeprecatedAccounts\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/6b1cbf55-e8b6-442f-ba4c-7246b6381474\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"6b1cbf55-e8b6-442f-ba4c-7246b6381474\"},{\"properties\":{\"displayName\":\"Deploy Diagnostic Settings for Service Bus to Event Hub\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploys the diagnostic settings for Service Bus to stream to a regional Event Hub when any Service Bus which is missing this diagnostic settings is created or updated.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"DeployIfNotExists\",\"Disabled\"]},\"profileName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Profile name\",\"description\":\"The diagnostic settings profile name\"}},\"eventHubRuleId\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Event Hub Authorization Rule Id\",\"description\":\"The Event Hub authorization rule Id for Azure Diagnostics. The authorization rule needs to be at Event Hub namespace level. e.g. /subscriptions/{subscription Id}/resourceGroups/{resource group}/providers/Microsoft.EventHub/namespaces/{Event Hub namespace}/authorizationrules/{authorization rule}\",\"strongType\":\"Microsoft.EventHub/Namespaces/AuthorizationRules\",\"assignPermissions\":true}},\"metricsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable metrics\",\"description\":\"Whether to enable metrics stream to the Event Hub - True or False\"},\"allowedValues\":[\"True\",\"False\"]},\"logsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable logs\",\"description\":\"Whether to enable logs stream to the Event Hub  - True or False\"},\"allowedValues\":[\"True\",\"False\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.ServiceBus/namespaces\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"name\":\"[parameters('profileName')]\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"[parameters('logsEnabled')]\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\"equals\":\"[parameters('metricsEnabled')]\"}]},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"resourceName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"eventHubRuleId\":{\"type\":\"string\"},\"metricsEnabled\":{\"type\":\"string\"},\"logsEnabled\":{\"type\":\"string\"},\"profileName\":{\"type\":\"string\"}},\"variables\":{},\"resources\":[{\"type\":\"Microsoft.ServiceBus/namespaces/providers/diagnosticSettings\",\"apiVersion\":\"2017-05-01-preview\",\"name\":\"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\"location\":\"[parameters('location')]\",\"dependsOn\":[],\"properties\":{\"eventHubAuthorizationRuleId\":\"[parameters('eventHubRuleId')]\",\"metrics\":[{\"category\":\"AllMetrics\",\"enabled\":\"[parameters('metricsEnabled')]\",\"retentionPolicy\":{\"enabled\":false,\"days\":0}}],\"logs\":[{\"category\":\"OperationalLogs\",\"enabled\":\"[parameters('logsEnabled')]\"}]}}],\"outputs\":{}},\"parameters\":{\"location\":{\"value\":\"[field('location')]\"},\"resourceName\":{\"value\":\"[field('name')]\"},\"eventHubRuleId\":{\"value\":\"[parameters('eventHubRuleId')]\"},\"metricsEnabled\":{\"value\":\"[parameters('metricsEnabled')]\"},\"logsEnabled\":{\"value\":\"[parameters('logsEnabled')]\"},\"profileName\":{\"value\":\"[parameters('profileName')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/6b51af03-9277-49a9-a3f8-1c69c9ff7403\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"6b51af03-9277-49a9-a3f8-1c69c9ff7403\"},{\"properties\":{\"displayName\":\"Not allowed resource types\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy enables you to specify the resource types that your organization cannot deploy.\",\"metadata\":{\"category\":\"General\"},\"parameters\":{\"listOfResourceTypesNotAllowed\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of resource types that cannot be deployed.\",\"displayName\":\"Not allowed resource types\",\"strongType\":\"resourceTypes\"}}},\"policyRule\":{\"if\":{\"field\":\"type\",\"in\":\"[parameters('listOfResourceTypesNotAllowed')]\"},\"then\":{\"effect\":\"Deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/6c112d4e-5bc7-47ae-a041-ea2d9dccd749\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"6c112d4e-5bc7-47ae-a041-ea2d9dccd749\"},{\"properties\":{\"displayName\":\"Function App should only be accessible over HTTPS\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Use of HTTPS ensures server/service authentication and protects data in transit from network layer eavesdropping attacks.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"functionapp*\"},{\"field\":\"Microsoft.Web/sites/httpsOnly\",\"equals\":\"false\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/6d555dd1-86f2-4f1c-8ed7-5abae7c6cbab\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"6d555dd1-86f2-4f1c-8ed7-5abae7c6cbab\"},{\"properties\":{\"displayName\":\"Email notification for high severity alerts should be enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Enable emailing security alerts to the security contact, in order to have them receive security alert emails from Microsoft. This ensures that the right people are aware of any potential security issues and are able to mitigate the risks\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/securityContacts\",\"existenceCondition\":{\"field\":\"Microsoft.Security/securityContacts/alertNotifications\",\"notEquals\":\"Off\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/6e2593d9-add6-4083-9c9b-4b7d2188c899\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"6e2593d9-add6-4083-9c9b-4b7d2188c899\"},{\"properties\":{\"displayName\":\"[Deprecated]: Allow resource creation only in Japan data centers\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Allows resource creation in the following locations only: Japan East, Japan West\",\"metadata\":{\"category\":\"General\",\"deprecated\":true},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"japaneast\",\"japanwest\"]}},\"then\":{\"effect\":\"Deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/6fdb9205-3462-4cfc-87d8-16c7860b53f4\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"6fdb9205-3462-4cfc-87d8-16c7860b53f4\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'Security Options - Microsoft Network Server'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Microsoft Network Server'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsMicrosoftNetworkServer\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/6fe4ef56-7576-4dc4-8e9c-26bad4b087ce\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"6fe4ef56-7576-4dc4-8e9c-26bad4b087ce\"},{\"properties\":{\"displayName\":\"Ensure that 'Python version' is the latest, if used as a part of the Web app\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Periodically, newer versions are released for Python software either due to security flaws or to include additional functionality. Using the latest Python version for web apps is recommended in order to to take advantage of security fixes, if any, and/or new functionalities of the latest version.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]},\"WindowsPythonLatestVersion\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Windows Latest Python version\",\"description\":\"Latest supported Python version for App Services\"}},\"LinuxPythonLatestVersion\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Linux Latest Python version\",\"description\":\"Latest supported Python version for App Services\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"app*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"notContains\":\"PYTHON\"},{\"field\":\"Microsoft.Web/sites/config/web.pythonVersion\",\"equals\":\"\"}]},{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"equals\":\"[concat('PYTHON|', parameters('LinuxPythonLatestVersion'))]\"},{\"field\":\"Microsoft.Web/sites/config/web.pythonVersion\",\"equals\":\"\"}]},{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"equals\":\"\"},{\"field\":\"Microsoft.Web/sites/config/web.pythonVersion\",\"equals\":\"[parameters('WindowsPythonLatestVersion')]\"}]}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/7008174a-fd10-4ef0-817e-fc820a951d73\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"7008174a-fd10-4ef0-817e-fc820a951d73\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'Windows Components'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Windows Components'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"SendFileSamplesWhenFurtherAnalysisIsRequired\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Send file samples when further analysis is required\",\"description\":\"Specifies whether and how Windows Defender will submit samples of suspected malware  to Microsoft for further analysis when opt-in for MAPS telemetry is set.\"}},\"AllowIndexingOfEncryptedFiles\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Allow indexing of encrypted files\",\"description\":\"Specifies whether encrypted items are allowed to be indexed.\"}},\"AllowTelemetry\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Allow Telemetry\",\"description\":\"Specifies configuration of the amount of diagnostic and usage data reported to Microsoft. The data is transmitted securely and sensitive data is not sent.\"}},\"AllowUnencryptedTraffic\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Allow unencrypted traffic\",\"description\":\"Specifies whether the Windows Remote Management (WinRM) service sends and receives unencrypted messages over the network.\"}},\"AlwaysInstallWithElevatedPrivileges\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Always install with elevated privileges\",\"description\":\"Specifies whether Windows Installer should use system permissions when it installs any program on the system.\"}},\"AlwaysPromptForPasswordUponConnection\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Always prompt for password upon connection\",\"description\":\"Specifies whether Terminal Services/Remote Desktop Connection always prompts the client computer for a password upon connection.\"}},\"ApplicationSpecifyTheMaximumLogFileSizeKB\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Application: Specify the maximum log file size (KB)\",\"description\":\"Specifies the maximum size for the Application event log in kilobytes.\"}},\"AutomaticallySendMemoryDumpsForOSgeneratedErrorReports\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Automatically send memory dumps for OS-generated error reports\",\"description\":\"Specifies if memory dumps in support of OS-generated error reports can be sent to Microsoft automatically.\"}},\"ConfigureDefaultConsent\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Configure Default consent\",\"description\":\"Specifies setting of the default consent handling for error reports sent to Microsoft.\"}},\"ConfigureWindowsSmartScreen\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Configure Windows SmartScreen\",\"description\":\"Specifies how to manage the behavior of Windows SmartScreen. Windows SmartScreen helps keep PCs safer by warning users before running unrecognized programs downloaded from the Internet. Some information is sent to Microsoft about files and programs run on PCs with this feature enabled.\"}},\"DisallowDigestAuthentication\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Disallow Digest authentication\",\"description\":\"Specifies whether the Windows Remote Management (WinRM) client will not use Digest authentication.\"}},\"DisallowWinRMFromStoringRunAsCredentials\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Disallow WinRM from storing RunAs credentials\",\"description\":\"Specifies whether the Windows Remote Management (WinRM) service will not allow RunAs credentials to be stored for any plug-ins.\"}},\"DoNotAllowPasswordsToBeSaved\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Do not allow passwords to be saved\",\"description\":\"Specifies whether to prevent Remote Desktop Services - Terminal Services clients from saving passwords on a computer.\"}},\"SecuritySpecifyTheMaximumLogFileSizeKB\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Security: Specify the maximum log file size (KB)\",\"description\":\"Specifies the maximum size for the Security event log in kilobytes.\"}},\"SetClientConnectionEncryptionLevel\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Set client connection encryption level\",\"description\":\"Specifies whether to require the use of a specific encryption level to secure communications between client computers and RD Session Host servers during Remote Desktop Protocol (RDP) connections. This policy only applies when you are using native RDP encryption.\"}},\"SetTheDefaultBehaviorForAutoRun\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Set the default behavior for AutoRun\",\"description\":\"Specifies the default behavior for Autorun commands. Autorun commands are generally stored in autorun.inf files. They often launch the installation program or other routines.\"}},\"SetupSpecifyTheMaximumLogFileSizeKB\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Setup: Specify the maximum log file size (KB)\",\"description\":\"Specifies the maximum size for the Setup event log in kilobytes.\"}},\"SystemSpecifyTheMaximumLogFileSizeKB\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"System: Specify the maximum log file size (KB)\",\"description\":\"Specifies the maximum size for the System event log in kilobytes.\"}},\"TurnOffDataExecutionPreventionForExplorer\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Turn off Data Execution Prevention for Explorer\",\"description\":\"Specifies whether to turn off Data Execution Prevention for Windows File Explorer. Disabling data execution prevention can allow certain legacy plug-in applications to function without terminating Explorer.\"}},\"SpecifyTheIntervalToCheckForDefinitionUpdates\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Specify the interval to check for definition updates\",\"description\":\"Specifies an interval at which to check for Windows Defender definition updates. The time value is represented as the number of hours between update checks.\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_WindowsComponents\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('Send file samples when further analysis is required;ExpectedValue', '=', parameters('SendFileSamplesWhenFurtherAnalysisIsRequired'), ',', 'Allow indexing of encrypted files;ExpectedValue', '=', parameters('AllowIndexingOfEncryptedFiles'), ',', 'Allow Telemetry;ExpectedValue', '=', parameters('AllowTelemetry'), ',', 'Allow unencrypted traffic;ExpectedValue', '=', parameters('AllowUnencryptedTraffic'), ',', 'Always install with elevated privileges;ExpectedValue', '=', parameters('AlwaysInstallWithElevatedPrivileges'), ',', 'Always prompt for password upon connection;ExpectedValue', '=', parameters('AlwaysPromptForPasswordUponConnection'), ',', 'Application: Specify the maximum log file size (KB);ExpectedValue', '=', parameters('ApplicationSpecifyTheMaximumLogFileSizeKB'), ',', 'Automatically send memory dumps for OS-generated error reports;ExpectedValue', '=', parameters('AutomaticallySendMemoryDumpsForOSgeneratedErrorReports'), ',', 'Configure Default consent;ExpectedValue', '=', parameters('ConfigureDefaultConsent'), ',', 'Configure Windows SmartScreen;ExpectedValue', '=', parameters('ConfigureWindowsSmartScreen'), ',', 'Disallow Digest authentication;ExpectedValue', '=', parameters('DisallowDigestAuthentication'), ',', 'Disallow WinRM from storing RunAs credentials;ExpectedValue', '=', parameters('DisallowWinRMFromStoringRunAsCredentials'), ',', 'Do not allow passwords to be saved;ExpectedValue', '=', parameters('DoNotAllowPasswordsToBeSaved'), ',', 'Security: Specify the maximum log file size (KB);ExpectedValue', '=', parameters('SecuritySpecifyTheMaximumLogFileSizeKB'), ',', 'Set client connection encryption level;ExpectedValue', '=', parameters('SetClientConnectionEncryptionLevel'), ',', 'Set the default behavior for AutoRun;ExpectedValue', '=', parameters('SetTheDefaultBehaviorForAutoRun'), ',', 'Setup: Specify the maximum log file size (KB);ExpectedValue', '=', parameters('SetupSpecifyTheMaximumLogFileSizeKB'), ',', 'System: Specify the maximum log file size (KB);ExpectedValue', '=', parameters('SystemSpecifyTheMaximumLogFileSizeKB'), ',', 'Turn off Data Execution Prevention for Explorer;ExpectedValue', '=', parameters('TurnOffDataExecutionPreventionForExplorer'), ',', 'Specify the interval to check for definition updates;ExpectedValue', '=', parameters('SpecifyTheIntervalToCheckForDefinitionUpdates')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_WindowsComponents\"},\"SendFileSamplesWhenFurtherAnalysisIsRequired\":{\"value\":\"[parameters('SendFileSamplesWhenFurtherAnalysisIsRequired')]\"},\"AllowIndexingOfEncryptedFiles\":{\"value\":\"[parameters('AllowIndexingOfEncryptedFiles')]\"},\"AllowTelemetry\":{\"value\":\"[parameters('AllowTelemetry')]\"},\"AllowUnencryptedTraffic\":{\"value\":\"[parameters('AllowUnencryptedTraffic')]\"},\"AlwaysInstallWithElevatedPrivileges\":{\"value\":\"[parameters('AlwaysInstallWithElevatedPrivileges')]\"},\"AlwaysPromptForPasswordUponConnection\":{\"value\":\"[parameters('AlwaysPromptForPasswordUponConnection')]\"},\"ApplicationSpecifyTheMaximumLogFileSizeKB\":{\"value\":\"[parameters('ApplicationSpecifyTheMaximumLogFileSizeKB')]\"},\"AutomaticallySendMemoryDumpsForOSgeneratedErrorReports\":{\"value\":\"[parameters('AutomaticallySendMemoryDumpsForOSgeneratedErrorReports')]\"},\"ConfigureDefaultConsent\":{\"value\":\"[parameters('ConfigureDefaultConsent')]\"},\"ConfigureWindowsSmartScreen\":{\"value\":\"[parameters('ConfigureWindowsSmartScreen')]\"},\"DisallowDigestAuthentication\":{\"value\":\"[parameters('DisallowDigestAuthentication')]\"},\"DisallowWinRMFromStoringRunAsCredentials\":{\"value\":\"[parameters('DisallowWinRMFromStoringRunAsCredentials')]\"},\"DoNotAllowPasswordsToBeSaved\":{\"value\":\"[parameters('DoNotAllowPasswordsToBeSaved')]\"},\"SecuritySpecifyTheMaximumLogFileSizeKB\":{\"value\":\"[parameters('SecuritySpecifyTheMaximumLogFileSizeKB')]\"},\"SetClientConnectionEncryptionLevel\":{\"value\":\"[parameters('SetClientConnectionEncryptionLevel')]\"},\"SetTheDefaultBehaviorForAutoRun\":{\"value\":\"[parameters('SetTheDefaultBehaviorForAutoRun')]\"},\"SetupSpecifyTheMaximumLogFileSizeKB\":{\"value\":\"[parameters('SetupSpecifyTheMaximumLogFileSizeKB')]\"},\"SystemSpecifyTheMaximumLogFileSizeKB\":{\"value\":\"[parameters('SystemSpecifyTheMaximumLogFileSizeKB')]\"},\"TurnOffDataExecutionPreventionForExplorer\":{\"value\":\"[parameters('TurnOffDataExecutionPreventionForExplorer')]\"},\"SpecifyTheIntervalToCheckForDefinitionUpdates\":{\"value\":\"[parameters('SpecifyTheIntervalToCheckForDefinitionUpdates')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"SendFileSamplesWhenFurtherAnalysisIsRequired\":{\"type\":\"string\"},\"AllowIndexingOfEncryptedFiles\":{\"type\":\"string\"},\"AllowTelemetry\":{\"type\":\"string\"},\"AllowUnencryptedTraffic\":{\"type\":\"string\"},\"AlwaysInstallWithElevatedPrivileges\":{\"type\":\"string\"},\"AlwaysPromptForPasswordUponConnection\":{\"type\":\"string\"},\"ApplicationSpecifyTheMaximumLogFileSizeKB\":{\"type\":\"string\"},\"AutomaticallySendMemoryDumpsForOSgeneratedErrorReports\":{\"type\":\"string\"},\"ConfigureDefaultConsent\":{\"type\":\"string\"},\"ConfigureWindowsSmartScreen\":{\"type\":\"string\"},\"DisallowDigestAuthentication\":{\"type\":\"string\"},\"DisallowWinRMFromStoringRunAsCredentials\":{\"type\":\"string\"},\"DoNotAllowPasswordsToBeSaved\":{\"type\":\"string\"},\"SecuritySpecifyTheMaximumLogFileSizeKB\":{\"type\":\"string\"},\"SetClientConnectionEncryptionLevel\":{\"type\":\"string\"},\"SetTheDefaultBehaviorForAutoRun\":{\"type\":\"string\"},\"SetupSpecifyTheMaximumLogFileSizeKB\":{\"type\":\"string\"},\"SystemSpecifyTheMaximumLogFileSizeKB\":{\"type\":\"string\"},\"TurnOffDataExecutionPreventionForExplorer\":{\"type\":\"string\"},\"SpecifyTheIntervalToCheckForDefinitionUpdates\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"Send file samples when further analysis is required;ExpectedValue\",\"value\":\"[parameters('SendFileSamplesWhenFurtherAnalysisIsRequired')]\"},{\"name\":\"Allow indexing of encrypted files;ExpectedValue\",\"value\":\"[parameters('AllowIndexingOfEncryptedFiles')]\"},{\"name\":\"Allow Telemetry;ExpectedValue\",\"value\":\"[parameters('AllowTelemetry')]\"},{\"name\":\"Allow unencrypted traffic;ExpectedValue\",\"value\":\"[parameters('AllowUnencryptedTraffic')]\"},{\"name\":\"Always install with elevated privileges;ExpectedValue\",\"value\":\"[parameters('AlwaysInstallWithElevatedPrivileges')]\"},{\"name\":\"Always prompt for password upon connection;ExpectedValue\",\"value\":\"[parameters('AlwaysPromptForPasswordUponConnection')]\"},{\"name\":\"Application: Specify the maximum log file size (KB);ExpectedValue\",\"value\":\"[parameters('ApplicationSpecifyTheMaximumLogFileSizeKB')]\"},{\"name\":\"Automatically send memory dumps for OS-generated error reports;ExpectedValue\",\"value\":\"[parameters('AutomaticallySendMemoryDumpsForOSgeneratedErrorReports')]\"},{\"name\":\"Configure Default consent;ExpectedValue\",\"value\":\"[parameters('ConfigureDefaultConsent')]\"},{\"name\":\"Configure Windows SmartScreen;ExpectedValue\",\"value\":\"[parameters('ConfigureWindowsSmartScreen')]\"},{\"name\":\"Disallow Digest authentication;ExpectedValue\",\"value\":\"[parameters('DisallowDigestAuthentication')]\"},{\"name\":\"Disallow WinRM from storing RunAs credentials;ExpectedValue\",\"value\":\"[parameters('DisallowWinRMFromStoringRunAsCredentials')]\"},{\"name\":\"Do not allow passwords to be saved;ExpectedValue\",\"value\":\"[parameters('DoNotAllowPasswordsToBeSaved')]\"},{\"name\":\"Security: Specify the maximum log file size (KB);ExpectedValue\",\"value\":\"[parameters('SecuritySpecifyTheMaximumLogFileSizeKB')]\"},{\"name\":\"Set client connection encryption level;ExpectedValue\",\"value\":\"[parameters('SetClientConnectionEncryptionLevel')]\"},{\"name\":\"Set the default behavior for AutoRun;ExpectedValue\",\"value\":\"[parameters('SetTheDefaultBehaviorForAutoRun')]\"},{\"name\":\"Setup: Specify the maximum log file size (KB);ExpectedValue\",\"value\":\"[parameters('SetupSpecifyTheMaximumLogFileSizeKB')]\"},{\"name\":\"System: Specify the maximum log file size (KB);ExpectedValue\",\"value\":\"[parameters('SystemSpecifyTheMaximumLogFileSizeKB')]\"},{\"name\":\"Turn off Data Execution Prevention for Explorer;ExpectedValue\",\"value\":\"[parameters('TurnOffDataExecutionPreventionForExplorer')]\"},{\"name\":\"Specify the interval to check for definition updates;ExpectedValue\",\"value\":\"[parameters('SpecifyTheIntervalToCheckForDefinitionUpdates')]\"}]}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/7040a231-fb65-4412-8c0a-b365f4866c24\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"7040a231-fb65-4412-8c0a-b365f4866c24\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'System Audit Policies - System'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'System Audit Policies - System'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SystemAuditPoliciesSystem\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/7066131b-61a6-4917-a7e4-72e8983f0aa6\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"7066131b-61a6-4917-a7e4-72e8983f0aa6\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs on which the DSC configuration is not compliant\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows VMs on which the Desired State Configuration (DSC) configuration is not compliant. This policy is only applicable to machines with WMF 4 and above. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WindowsDscConfiguration\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/7227ebe5-9ff7-47ab-b823-171cd02fb90f\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"7227ebe5-9ff7-47ab-b823-171cd02fb90f\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'Administrative Templates - Network'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Administrative Templates - Network'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_AdministrativeTemplatesNetwork\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/7229bd6a-693d-478a-87f0-1dc1af06f3b8\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"7229bd6a-693d-478a-87f0-1dc1af06f3b8\"},{\"properties\":{\"displayName\":\"Ensure that 'Python version' is the latest, if used as a part of the Function app\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Periodically, newer versions are released for Python software either due to security flaws or to include additional functionality. Using the latest Python version for Function apps is recommended in order to to take advantage of security fixes, if any, and/or new functionalities of the latest version.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]},\"WindowsPythonLatestVersion\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Windows Latest Python version\",\"description\":\"Latest supported Python version for App Services\"}},\"LinuxPythonLatestVersion\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Linux Latest Python version\",\"description\":\"Latest supported Python version for App Services\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"functionapp*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"notContains\":\"PYTHON\"},{\"field\":\"Microsoft.Web/sites/config/web.pythonVersion\",\"equals\":\"\"}]},{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"equals\":\"[concat('PYTHON|', parameters('LinuxPythonLatestVersion'))]\"},{\"field\":\"Microsoft.Web/sites/config/web.pythonVersion\",\"equals\":\"\"}]},{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"equals\":\"\"},{\"field\":\"Microsoft.Web/sites/config/web.pythonVersion\",\"equals\":\"[parameters('WindowsPythonLatestVersion')]\"}]}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/7238174a-fd10-4ef0-817e-fc820a951d73\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"7238174a-fd10-4ef0-817e-fc820a951d73\"},{\"properties\":{\"displayName\":\"Ensure that 'PHP version' is the latest, if used as a part of the WEB app\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Periodically, newer versions are released for PHP software either due to security flaws or to include additional functionality. Using the latest PHP version for web apps is recommended in order to to take advantage of security fixes, if any, and/or new functionalities of the latest version.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]},\"PHPLatestVersion\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Latest PHP version\",\"description\":\"Latest supported PHP version for App Services\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"app*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"notContains\":\"PHP\"},{\"field\":\"Microsoft.Web/sites/config/web.phpVersion\",\"equals\":\"\"}]},{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"equals\":\"[concat('PHP|', parameters('PHPLatestVersion'))]\"},{\"field\":\"Microsoft.Web/sites/config/web.phpVersion\",\"equals\":\"\"}]},{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"equals\":\"\"},{\"field\":\"Microsoft.Web/sites/config/web.phpVersion\",\"equals\":\"[parameters('PHPLatestVersion')]\"}]}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/7261b898-8a84-4db8-9e04-18527132abb3\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"7261b898-8a84-4db8-9e04-18527132abb3\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy prerequisites to audit Windows VMs that allow re-use of the previous 24 passwords\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines that allow re-use of the previous 24 passwords. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"EnforcePasswordHistory\",\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"EnforcePasswordHistory\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/726671ac-c4de-4908-8c7d-6043ae62e3b6\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"726671ac-c4de-4908-8c7d-6043ae62e3b6\"},{\"properties\":{\"displayName\":\"Add a tag to resource groups\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Adds the specified tag and value when any resource group missing this tag is created or updated. Existing resource groups can be remediated by triggering a remediation task. If the tag exists with a different value it will not be changed.\",\"metadata\":{\"category\":\"Tags\"},\"parameters\":{\"tagName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Tag Name\",\"description\":\"Name of the tag, such as 'environment'\"}},\"tagValue\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Tag Value\",\"description\":\"Value of the tag, such as 'production'\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions/resourceGroups\"},{\"field\":\"[concat('tags[', parameters('tagName'), ']')]\",\"exists\":\"false\"}]},\"then\":{\"effect\":\"modify\",\"details\":{\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"operations\":[{\"operation\":\"add\",\"field\":\"[concat('tags[', parameters('tagName'), ']')]\",\"value\":\"[parameters('tagValue')]\"}]}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/726aca4c-86e9-4b04-b0c5-073027359532\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"726aca4c-86e9-4b04-b0c5-073027359532\"},{\"properties\":{\"displayName\":\"Allowed storage account SKUs\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy enables you to specify a set of storage account SKUs that your organization can deploy.\",\"metadata\":{\"category\":\"Storage\"},\"parameters\":{\"listOfAllowedSKUs\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of SKUs that can be specified for storage accounts.\",\"displayName\":\"Allowed SKUs\",\"strongType\":\"StorageSKUs\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Storage/storageAccounts\"},{\"not\":{\"field\":\"Microsoft.Storage/storageAccounts/sku.name\",\"in\":\"[parameters('listOfAllowedSKUs')]\"}}]},\"then\":{\"effect\":\"Deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/7433c107-6db4-4ad1-b57a-a76dce0154a1\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"7433c107-6db4-4ad1-b57a-a76dce0154a1\"},{\"properties\":{\"displayName\":\"Ensure that 'Python version' is the latest, if used as a part of the Api app\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Periodically, newer versions are released for Python software either due to security flaws or to include additional functionality. Using the latest Python version for Api apps is recommended in order to to take advantage of security fixes, if any, and/or new functionalities of the latest version.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]},\"WindowsPythonLatestVersion\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Windows Latest Python version\",\"description\":\"Latest supported Python version for App Services\"}},\"LinuxPythonLatestVersion\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Linux Latest Python version\",\"description\":\"Latest supported Python version for App Services\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"*api\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"notContains\":\"PYTHON\"},{\"field\":\"Microsoft.Web/sites/config/web.pythonVersion\",\"equals\":\"\"}]},{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"equals\":\"[concat('PYTHON|', parameters('LinuxPythonLatestVersion'))]\"},{\"field\":\"Microsoft.Web/sites/config/web.pythonVersion\",\"equals\":\"\"}]},{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"equals\":\"\"},{\"field\":\"Microsoft.Web/sites/config/web.pythonVersion\",\"equals\":\"[parameters('WindowsPythonLatestVersion')]\"}]}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/74c3584d-afae-46f7-a20a-6f8adba71a16\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"74c3584d-afae-46f7-a20a-6f8adba71a16\"},{\"properties\":{\"displayName\":\"[Deprecated]: Audit enabling of diagnostic logs in App Services\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Audit enabling of diagnostic logs on the app. This enables you to recreate activity trails for investigation purposes if a security incident occurs or your network is compromised\",\"metadata\":{\"category\":\"App Service\",\"preview\":true,\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites/config\"},{\"field\":\"name\",\"equals\":\"web\"},{\"anyOf\":[{\"field\":\"Microsoft.Web/sites/config/detailedErrorLoggingEnabled\",\"notEquals\":\"true\"},{\"field\":\"Microsoft.Web/sites/config/httpLoggingEnabled\",\"notEquals\":\"true\"},{\"field\":\"Microsoft.Web/sites/config/requestTracingEnabled\",\"notEquals\":\"true\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/752c6934-9bcc-4749-b004-655e676ae2ac\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"752c6934-9bcc-4749-b004-655e676ae2ac\"},{\"properties\":{\"displayName\":\"Vulnerabilities should be remediated by a Vulnerability Assessment solution\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Monitors vulnerabilities detected by Vulnerability Assessment solution and VMs without a Vulnerability Assessment solution in Azure Security Center as recommendations.\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"in\":[\"Microsoft.Compute/virtualMachines\",\"Microsoft.ClassicCompute/virtualMachines\"]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"vulnerabilityAssessment\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/760a85ff-6162-42b3-8d70-698e268f648c\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"760a85ff-6162-42b3-8d70-698e268f648c\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy Dependency Agent for Linux VM Scale Sets (VMSS)\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploy Dependency Agent for Linux VM Scale Sets if the VM Image (OS) is in the list defined and the agent is not installed. Note: if your scale set upgradePolicy is set to Manual, you need to apply the extension to the all VMs in the set by calling upgrade on them. In CLI this would be az vmss update-instances.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"listOfImageIdToInclude\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"Optional: List of VM images that have supported Linux OS to add to scope\",\"description\":\"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachineScaleSets\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageId\",\"in\":\"[parameters('listOfImageIdToInclude')]\"},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Canonical\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"UbuntuServer\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"14.04.0-LTS\",\"14.04.1-LTS\",\"14.04.5-LTS\"]},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"16.04-LTS\",\"16.04.0-LTS\"]},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"18.04-LTS\"]}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"RHEL\",\"RHEL-SAP-HANA\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"6.*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"SUSE\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"SLES\",\"SLES-HPC\",\"SLES-HPC-Priority\",\"SLES-SAP\",\"SLES-SAP-BYOS\",\"SLES-Priority\",\"SLES-BYOS\",\"SLES-SAPCAL\",\"SLES-Standard\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"12-SP2\",\"12-SP3\",\"12-SP4\"]}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"OpenLogic\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"CentOS\",\"Centos-LVM\",\"CentOS-SRIOV\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"6.*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-centos-os\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.Compute/virtualMachineScaleSets/extensions\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\"],\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Compute/virtualMachineScaleSets/extensions/type\",\"equals\":\"DependencyAgentLinux\"},{\"field\":\"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\"equals\":\"Microsoft.Azure.Monitoring.DependencyAgent\"}]},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"}},\"variables\":{\"vmExtensionName\":\"DependencyAgent\",\"vmExtensionPublisher\":\"Microsoft.Azure.Monitoring.DependencyAgent\",\"vmExtensionType\":\"DependencyAgentLinux\",\"vmExtensionTypeHandlerVersion\":\"9.7\"},\"resources\":[{\"type\":\"Microsoft.Compute/virtualMachineScaleSets/extensions\",\"name\":\"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\"apiVersion\":\"2018-06-01\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"[variables('vmExtensionPublisher')]\",\"type\":\"[variables('vmExtensionType')]\",\"typeHandlerVersion\":\"[variables('vmExtensionTypeHandlerVersion')]\",\"autoUpgradeMinorVersion\":true}}],\"outputs\":{\"policy\":{\"type\":\"string\",\"value\":\"[concat('Enabled extension for: ', parameters('vmName'))]\"}}},\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/765266ab-e40e-4c61-bcb2-5a5275d0b7c0\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"765266ab-e40e-4c61-bcb2-5a5275d0b7c0\"},{\"properties\":{\"displayName\":\"Audit delegation of scopes to a managing tenant\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Audit delegation of scopes to a managing tenant via Azure Lighthouse.\",\"metadata\":{\"category\":\"Lighthouse\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.ManagedServices/registrationAssignments\"},{\"value\":\"true\",\"equals\":\"true\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/76bed37b-484f-430f-a009-fd7592dff818\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"76bed37b-484f-430f-a009-fd7592dff818\"},{\"properties\":{\"displayName\":\"Azure subscriptions should have a log profile for Activity Log\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy ensures if a log profile is enabled for exporting activity logs. It audits if there is no log profile created to export the logs either to a storage account or to an event hub.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/logProfiles\",\"existenceCondition\":{\"field\":\"Microsoft.Insights/logProfiles/categories\",\"exists\":\"true\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/7796937f-307b-4598-941c-67d3a05ebfe7\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"7796937f-307b-4598-941c-67d3a05ebfe7\"},{\"properties\":{\"displayName\":\"Deploy prerequisites to audit Windows Server VMs on which Windows Serial Console is not enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows Server virtual machines on which Windows Serial Console is not enabled. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"EMSPortNumber\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"EMS Port Number\",\"description\":\"An integer indicating the COM port to be used for the Emergency Management Services (EMS) console redirection. For more information on EMS settings, please visit https://aka.ms/gcpolwsc\"},\"allowedValues\":[\"1\",\"2\",\"3\",\"4\"]},\"EMSBaudRate\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"EMS Baud Rate\",\"description\":\"An integer indicating the baud rate to be used for the Emergency Management Services (EMS) console redirection. For more information on EMS settings, please visit https://aka.ms/gcpolwsc\"},\"allowedValues\":[\"9600\",\"19200\",\"38400\",\"57600\",\"115200\"]}},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WindowsSerialConsole\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('[WindowsSerialConsole]WindowsSerialConsole;EMSPortNumber', '=', parameters('EMSPortNumber'), ',', '[WindowsSerialConsole]WindowsSerialConsole;EMSBaudRate', '=', parameters('EMSBaudRate')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"WindowsSerialConsole\"},\"EMSPortNumber\":{\"value\":\"[parameters('EMSPortNumber')]\"},\"EMSBaudRate\":{\"value\":\"[parameters('EMSBaudRate')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"EMSPortNumber\":{\"type\":\"string\"},\"EMSBaudRate\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[WindowsSerialConsole]WindowsSerialConsole;EMSPortNumber\",\"value\":\"[parameters('EMSPortNumber')]\"},{\"name\":\"[WindowsSerialConsole]WindowsSerialConsole;EMSBaudRate\",\"value\":\"[parameters('EMSBaudRate')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[WindowsSerialConsole]WindowsSerialConsole;EMSPortNumber\",\"value\":\"[parameters('EMSPortNumber')]\"},{\"name\":\"[WindowsSerialConsole]WindowsSerialConsole;EMSBaudRate\",\"value\":\"[parameters('EMSBaudRate')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/7a031c68-d6ab-406e-a506-697a19c634b0\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"7a031c68-d6ab-406e-a506-697a19c634b0\"},{\"properties\":{\"displayName\":\"Diagnostic logs in Virtual Machine Scale Sets should be enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"It is recommended to enable Logs so that activity trail can be recreated when investigations are required in the event of an incident or a compromise.\",\"metadata\":{\"category\":\"Compute\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachineScaleSets\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Compute/virtualMachineScaleSets/extensions\",\"existenceCondition\":{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Compute/virtualMachineScaleSets/extensions/type\",\"equals\":\"IaaSDiagnostics\"},{\"field\":\"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\"equals\":\"Microsoft.Azure.Diagnostics\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/virtualMachineScaleSets/extensions/type\",\"equals\":\"LinuxDiagnostic\"},{\"field\":\"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\"equals\":\"Microsoft.OSTCExtensions\"}]}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/7c1b1214-f927-48bf-8882-84f0af6588b1\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"7c1b1214-f927-48bf-8882-84f0af6588b1\"},{\"properties\":{\"displayName\":\"[Deprecated]: Require blob encryption for storage accounts\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy ensures blob encryption for storage accounts is turned on. It only applies to Microsoft.Storage resource types, not other storage providers. This policy is deprecated because storage blob encryption is now enabled by default, and can no longer be disabled.\",\"metadata\":{\"category\":\"Storage\",\"deprecated\":true},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Storage/storageAccounts\"},{\"field\":\"Microsoft.Storage/storageAccounts/enableBlobEncryption\",\"equals\":\"false\"}]},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/7c5a74bf-ae94-4a74-8fcf-644d1e0e6e6f\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"7c5a74bf-ae94-4a74-8fcf-644d1e0e6e6f\"},{\"properties\":{\"displayName\":\"Show audit results from Windows VMs that have the specified applications installed\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines that have the specified applications installed. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"NotInstalledApplication\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/7e56b49b-5990-4159-a734-511ea19b731c\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"7e56b49b-5990-4159-a734-511ea19b731c\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs that have not restarted within the specified number of days\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines that have not restarted within the specified number of days. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"MachineLastBootUpTime\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/7e84ba44-6d03-46fd-950e-5efa5a1112fa\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"7e84ba44-6d03-46fd-950e-5efa5a1112fa\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy prerequisites to audit Windows VMs that do not have the password complexity setting enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines that do not have the password complexity setting enabled. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"PasswordMustMeetComplexityRequirements\",\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"PasswordMustMeetComplexityRequirements\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/7ed40801-8a0f-4ceb-85c0-9fd25c1d61a8\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"7ed40801-8a0f-4ceb-85c0-9fd25c1d61a8\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'System Audit Policies - Privilege Use'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'System Audit Policies - Privilege Use'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SystemAuditPoliciesPrivilegeUse\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/7f4e96d1-e4f3-4dbb-b767-33ca4df8df7c\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"7f4e96d1-e4f3-4dbb-b767-33ca4df8df7c\"},{\"properties\":{\"displayName\":\"Audit diagnostic setting\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Audit diagnostic setting for selected resource types\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"listOfResourceTypes\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"Resource Types\",\"strongType\":\"resourceTypes\"}}},\"policyRule\":{\"if\":{\"field\":\"type\",\"in\":\"[parameters('listOfResourceTypes')]\"},\"then\":{\"effect\":\"AuditIfNotExists\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"true\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\"equals\":\"true\"}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/7f89b1eb-583c-429a-8828-af049802c1d9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"7f89b1eb-583c-429a-8828-af049802c1d9\"},{\"properties\":{\"displayName\":\"SQL Auditing settings should have Action-Groups configured to capture critical activities\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"The AuditActionsAndGroups property should contain at least SUCCESSFUL_DATABASE_AUTHENTICATION_GROUP, FAILED_DATABASE_AUTHENTICATION_GROUP, BATCH_COMPLETED_GROUP to ensure a thorough audit logging\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Sql/servers\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Sql/servers/auditingSettings\",\"name\":\"default\",\"existenceCondition\":{\"allOf\":[{\"not\":{\"field\":\"Microsoft.Sql/servers/auditingSettings/auditActionsAndGroups[*]\",\"notEquals\":\"SUCCESSFUL_DATABASE_AUTHENTICATION_GROUP\"}},{\"not\":{\"field\":\"Microsoft.Sql/servers/auditingSettings/auditActionsAndGroups[*]\",\"notEquals\":\"FAILED_DATABASE_AUTHENTICATION_GROUP\"}},{\"not\":{\"field\":\"Microsoft.Sql/servers/auditingSettings/auditActionsAndGroups[*]\",\"notEquals\":\"BATCH_COMPLETED_GROUP\"}}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/7ff426e2-515f-405a-91c8-4f2333442eb5\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"7ff426e2-515f-405a-91c8-4f2333442eb5\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'User Rights Assignment'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'User Rights Assignment'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"UsersOrGroupsThatMayAccessThisComputerFromTheNetwork\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Users or groups that may access this computer from the network\",\"description\":\"Specifies which remote users on the network are permitted to connect to the computer. This does not include Remote Desktop Connection.\"}},\"UsersOrGroupsThatMayLogOnLocally\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Users or groups that may log on locally\",\"description\":\"Specifies which users or groups can interactively log on to the computer. Users who attempt to log on via Remote Desktop Connection or IIS also require this user right.\"}},\"UsersOrGroupsThatMayLogOnThroughRemoteDesktopServices\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Users or groups that may log on through Remote Desktop Services\",\"description\":\"Specifies which users or groups are permitted to log on as a Terminal Services client, Remote Desktop, or for Remote Assistance.\"}},\"UsersAndGroupsThatAreDeniedAccessToThisComputerFromTheNetwork\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Users and groups that are denied access to this computer from the network\",\"description\":\"Specifies which users or groups are explicitly prohibited from connecting to the computer across the network.\"}},\"UsersOrGroupsThatMayManageAuditingAndSecurityLog\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Users or groups that may manage auditing and security log\",\"description\":\"Specifies users and groups permitted to change the auditing options for files and directories and clear the Security log.\"}},\"UsersOrGroupsThatMayBackUpFilesAndDirectories\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Users or groups that may back up files and directories\",\"description\":\"Specifies users and groups allowed to circumvent file and directory permissions to back up the system.\"}},\"UsersOrGroupsThatMayChangeTheSystemTime\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Users or groups that may change the system time\",\"description\":\"Specifies which users and groups are permitted to change the time and date on the internal clock of the computer.\"}},\"UsersOrGroupsThatMayChangeTheTimeZone\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Users or groups that may change the time zone\",\"description\":\"Specifies which users and groups are permitted to change the time zone of the computer.\"}},\"UsersOrGroupsThatMayCreateATokenObject\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Users or groups that may create a token object\",\"description\":\"Specifies which users and groups are permitted to create an access token, which may provide elevated rights to access sensitive data.\"}},\"UsersAndGroupsThatAreDeniedLoggingOnAsABatchJob\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Users and groups that are denied logging on as a batch job\",\"description\":\"Specifies which users and groups are explicitly not permitted to log on to the computer as a batch job (i.e. scheduled task).\"}},\"UsersAndGroupsThatAreDeniedLoggingOnAsAService\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Users and groups that are denied logging on as a service\",\"description\":\"Specifies which service accounts are explicitly not permitted to register a process as a service.\"}},\"UsersAndGroupsThatAreDeniedLocalLogon\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Users and groups that are denied local logon\",\"description\":\"Specifies which users and groups are explicitly not permitted to log on to the computer.\"}},\"UsersAndGroupsThatAreDeniedLogOnThroughRemoteDesktopServices\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Users and groups that are denied log on through Remote Desktop Services\",\"description\":\"Specifies which users and groups are explicitly not permitted to log on to the computer via Terminal Services/Remote Desktop Client.\"}},\"UserAndGroupsThatMayForceShutdownFromARemoteSystem\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"User and groups that may force shutdown from a remote system\",\"description\":\"Specifies which users and groups are permitted to shut down the computer from a remote location on the network.\"}},\"UsersAndGroupsThatMayRestoreFilesAndDirectories\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Users and groups that may restore files and directories\",\"description\":\"Specifies which users and groups are permitted to bypass file, directory, registry, and other persistent object permissions when restoring backed up files and directories.\"}},\"UsersAndGroupsThatMayShutDownTheSystem\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Users and groups that may shut down the system\",\"description\":\"Specifies which users and groups who are logged on locally to the computers in your environment are permitted to shut down the operating system with the Shut Down command.\"}},\"UsersOrGroupsThatMayTakeOwnershipOfFilesOrOtherObjects\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Users or groups that may take ownership of files or other objects\",\"description\":\"Specifies which users and groups are permitted to take ownership of files, folders, registry keys, processes, or threads. This user right bypasses any permissions that are in place to protect objects to give ownership to the specified user.\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_UserRightsAssignment\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('Access this computer from the network;ExpectedValue', '=', parameters('UsersOrGroupsThatMayAccessThisComputerFromTheNetwork'), ',', 'Allow log on locally;ExpectedValue', '=', parameters('UsersOrGroupsThatMayLogOnLocally'), ',', 'Allow log on through Remote Desktop Services;ExpectedValue', '=', parameters('UsersOrGroupsThatMayLogOnThroughRemoteDesktopServices'), ',', 'Deny access to this computer from the network;ExpectedValue', '=', parameters('UsersAndGroupsThatAreDeniedAccessToThisComputerFromTheNetwork'), ',', 'Manage auditing and security log;ExpectedValue', '=', parameters('UsersOrGroupsThatMayManageAuditingAndSecurityLog'), ',', 'Back up files and directories;ExpectedValue', '=', parameters('UsersOrGroupsThatMayBackUpFilesAndDirectories'), ',', 'Change the system time;ExpectedValue', '=', parameters('UsersOrGroupsThatMayChangeTheSystemTime'), ',', 'Change the time zone;ExpectedValue', '=', parameters('UsersOrGroupsThatMayChangeTheTimeZone'), ',', 'Create a token object;ExpectedValue', '=', parameters('UsersOrGroupsThatMayCreateATokenObject'), ',', 'Deny log on as a batch job;ExpectedValue', '=', parameters('UsersAndGroupsThatAreDeniedLoggingOnAsABatchJob'), ',', 'Deny log on as a service;ExpectedValue', '=', parameters('UsersAndGroupsThatAreDeniedLoggingOnAsAService'), ',', 'Deny log on locally;ExpectedValue', '=', parameters('UsersAndGroupsThatAreDeniedLocalLogon'), ',', 'Deny log on through Remote Desktop Services;ExpectedValue', '=', parameters('UsersAndGroupsThatAreDeniedLogOnThroughRemoteDesktopServices'), ',', 'Force shutdown from a remote system;ExpectedValue', '=', parameters('UserAndGroupsThatMayForceShutdownFromARemoteSystem'), ',', 'Restore files and directories;ExpectedValue', '=', parameters('UsersAndGroupsThatMayRestoreFilesAndDirectories'), ',', 'Shut down the system;ExpectedValue', '=', parameters('UsersAndGroupsThatMayShutDownTheSystem'), ',', 'Take ownership of files or other objects;ExpectedValue', '=', parameters('UsersOrGroupsThatMayTakeOwnershipOfFilesOrOtherObjects')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_UserRightsAssignment\"},\"UsersOrGroupsThatMayAccessThisComputerFromTheNetwork\":{\"value\":\"[parameters('UsersOrGroupsThatMayAccessThisComputerFromTheNetwork')]\"},\"UsersOrGroupsThatMayLogOnLocally\":{\"value\":\"[parameters('UsersOrGroupsThatMayLogOnLocally')]\"},\"UsersOrGroupsThatMayLogOnThroughRemoteDesktopServices\":{\"value\":\"[parameters('UsersOrGroupsThatMayLogOnThroughRemoteDesktopServices')]\"},\"UsersAndGroupsThatAreDeniedAccessToThisComputerFromTheNetwork\":{\"value\":\"[parameters('UsersAndGroupsThatAreDeniedAccessToThisComputerFromTheNetwork')]\"},\"UsersOrGroupsThatMayManageAuditingAndSecurityLog\":{\"value\":\"[parameters('UsersOrGroupsThatMayManageAuditingAndSecurityLog')]\"},\"UsersOrGroupsThatMayBackUpFilesAndDirectories\":{\"value\":\"[parameters('UsersOrGroupsThatMayBackUpFilesAndDirectories')]\"},\"UsersOrGroupsThatMayChangeTheSystemTime\":{\"value\":\"[parameters('UsersOrGroupsThatMayChangeTheSystemTime')]\"},\"UsersOrGroupsThatMayChangeTheTimeZone\":{\"value\":\"[parameters('UsersOrGroupsThatMayChangeTheTimeZone')]\"},\"UsersOrGroupsThatMayCreateATokenObject\":{\"value\":\"[parameters('UsersOrGroupsThatMayCreateATokenObject')]\"},\"UsersAndGroupsThatAreDeniedLoggingOnAsABatchJob\":{\"value\":\"[parameters('UsersAndGroupsThatAreDeniedLoggingOnAsABatchJob')]\"},\"UsersAndGroupsThatAreDeniedLoggingOnAsAService\":{\"value\":\"[parameters('UsersAndGroupsThatAreDeniedLoggingOnAsAService')]\"},\"UsersAndGroupsThatAreDeniedLocalLogon\":{\"value\":\"[parameters('UsersAndGroupsThatAreDeniedLocalLogon')]\"},\"UsersAndGroupsThatAreDeniedLogOnThroughRemoteDesktopServices\":{\"value\":\"[parameters('UsersAndGroupsThatAreDeniedLogOnThroughRemoteDesktopServices')]\"},\"UserAndGroupsThatMayForceShutdownFromARemoteSystem\":{\"value\":\"[parameters('UserAndGroupsThatMayForceShutdownFromARemoteSystem')]\"},\"UsersAndGroupsThatMayRestoreFilesAndDirectories\":{\"value\":\"[parameters('UsersAndGroupsThatMayRestoreFilesAndDirectories')]\"},\"UsersAndGroupsThatMayShutDownTheSystem\":{\"value\":\"[parameters('UsersAndGroupsThatMayShutDownTheSystem')]\"},\"UsersOrGroupsThatMayTakeOwnershipOfFilesOrOtherObjects\":{\"value\":\"[parameters('UsersOrGroupsThatMayTakeOwnershipOfFilesOrOtherObjects')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"UsersOrGroupsThatMayAccessThisComputerFromTheNetwork\":{\"type\":\"string\"},\"UsersOrGroupsThatMayLogOnLocally\":{\"type\":\"string\"},\"UsersOrGroupsThatMayLogOnThroughRemoteDesktopServices\":{\"type\":\"string\"},\"UsersAndGroupsThatAreDeniedAccessToThisComputerFromTheNetwork\":{\"type\":\"string\"},\"UsersOrGroupsThatMayManageAuditingAndSecurityLog\":{\"type\":\"string\"},\"UsersOrGroupsThatMayBackUpFilesAndDirectories\":{\"type\":\"string\"},\"UsersOrGroupsThatMayChangeTheSystemTime\":{\"type\":\"string\"},\"UsersOrGroupsThatMayChangeTheTimeZone\":{\"type\":\"string\"},\"UsersOrGroupsThatMayCreateATokenObject\":{\"type\":\"string\"},\"UsersAndGroupsThatAreDeniedLoggingOnAsABatchJob\":{\"type\":\"string\"},\"UsersAndGroupsThatAreDeniedLoggingOnAsAService\":{\"type\":\"string\"},\"UsersAndGroupsThatAreDeniedLocalLogon\":{\"type\":\"string\"},\"UsersAndGroupsThatAreDeniedLogOnThroughRemoteDesktopServices\":{\"type\":\"string\"},\"UserAndGroupsThatMayForceShutdownFromARemoteSystem\":{\"type\":\"string\"},\"UsersAndGroupsThatMayRestoreFilesAndDirectories\":{\"type\":\"string\"},\"UsersAndGroupsThatMayShutDownTheSystem\":{\"type\":\"string\"},\"UsersOrGroupsThatMayTakeOwnershipOfFilesOrOtherObjects\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"Access this computer from the network;ExpectedValue\",\"value\":\"[parameters('UsersOrGroupsThatMayAccessThisComputerFromTheNetwork')]\"},{\"name\":\"Allow log on locally;ExpectedValue\",\"value\":\"[parameters('UsersOrGroupsThatMayLogOnLocally')]\"},{\"name\":\"Allow log on through Remote Desktop Services;ExpectedValue\",\"value\":\"[parameters('UsersOrGroupsThatMayLogOnThroughRemoteDesktopServices')]\"},{\"name\":\"Deny access to this computer from the network;ExpectedValue\",\"value\":\"[parameters('UsersAndGroupsThatAreDeniedAccessToThisComputerFromTheNetwork')]\"},{\"name\":\"Manage auditing and security log;ExpectedValue\",\"value\":\"[parameters('UsersOrGroupsThatMayManageAuditingAndSecurityLog')]\"},{\"name\":\"Back up files and directories;ExpectedValue\",\"value\":\"[parameters('UsersOrGroupsThatMayBackUpFilesAndDirectories')]\"},{\"name\":\"Change the system time;ExpectedValue\",\"value\":\"[parameters('UsersOrGroupsThatMayChangeTheSystemTime')]\"},{\"name\":\"Change the time zone;ExpectedValue\",\"value\":\"[parameters('UsersOrGroupsThatMayChangeTheTimeZone')]\"},{\"name\":\"Create a token object;ExpectedValue\",\"value\":\"[parameters('UsersOrGroupsThatMayCreateATokenObject')]\"},{\"name\":\"Deny log on as a batch job;ExpectedValue\",\"value\":\"[parameters('UsersAndGroupsThatAreDeniedLoggingOnAsABatchJob')]\"},{\"name\":\"Deny log on as a service;ExpectedValue\",\"value\":\"[parameters('UsersAndGroupsThatAreDeniedLoggingOnAsAService')]\"},{\"name\":\"Deny log on locally;ExpectedValue\",\"value\":\"[parameters('UsersAndGroupsThatAreDeniedLocalLogon')]\"},{\"name\":\"Deny log on through Remote Desktop Services;ExpectedValue\",\"value\":\"[parameters('UsersAndGroupsThatAreDeniedLogOnThroughRemoteDesktopServices')]\"},{\"name\":\"Force shutdown from a remote system;ExpectedValue\",\"value\":\"[parameters('UserAndGroupsThatMayForceShutdownFromARemoteSystem')]\"},{\"name\":\"Restore files and directories;ExpectedValue\",\"value\":\"[parameters('UsersAndGroupsThatMayRestoreFilesAndDirectories')]\"},{\"name\":\"Shut down the system;ExpectedValue\",\"value\":\"[parameters('UsersAndGroupsThatMayShutDownTheSystem')]\"},{\"name\":\"Take ownership of files or other objects;ExpectedValue\",\"value\":\"[parameters('UsersOrGroupsThatMayTakeOwnershipOfFilesOrOtherObjects')]\"}]}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/815dcc9f-6662-43f2-9a03-1b83e9876f24\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"815dcc9f-6662-43f2-9a03-1b83e9876f24\"},{\"properties\":{\"displayName\":\"Geo-redundant backup should be enabled for Azure Database for MySQL\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy audits any Azure Database for MySQL with geo-redundant backup not enabled.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.DBforMySQL/servers\"},{\"field\":\"Microsoft.DBforMySQL/servers/storageProfile.geoRedundantBackup\",\"notEquals\":\"Enabled\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/82339799-d096-41ae-8538-b108becf0970\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"82339799-d096-41ae-8538-b108becf0970\"},{\"properties\":{\"displayName\":\"Diagnostic logs in Event Hub should be enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit enabling of diagnostic logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised\",\"metadata\":{\"category\":\"Event Hub\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]},\"requiredRetentionDays\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Required retention (days)\",\"description\":\"The required diagnostic logs retention in days\"}}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.EventHub/namespaces\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"existenceCondition\":{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\"equals\":\"true\"},{\"anyOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\"equals\":\"0\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\"equals\":\"[parameters('requiredRetentionDays')]\"}]},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"true\"}]},{\"allOf\":[{\"not\":{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\"equals\":\"true\"}},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"true\"}]}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/83a214f7-d01a-484b-91a9-ed54470c9a6a\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"83a214f7-d01a-484b-91a9-ed54470c9a6a\"},{\"properties\":{\"displayName\":\"Network interfaces should not have public IPs\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy denies the network interfaces which are configured with any public IP. Public IP addresses allow internet resources to communicate inbound to Azure resources, and Azure resources to communicate outbound to the internet. This should be reviewed by the network security team.\",\"metadata\":{\"category\":\"Network\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Network/networkInterfaces\"},{\"not\":{\"field\":\"Microsoft.Network/networkInterfaces/ipconfigurations[*].publicIpAddress.id\",\"notLike\":\"*\"}}]},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/83a86a26-fd1f-447c-b59d-e51f44264114\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"83a86a26-fd1f-447c-b59d-e51f44264114\"},{\"properties\":{\"displayName\":\"Ensure that '.Net Framework' version is the latest, if used as a part of the Web app\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Periodically, newer versions are released for .Net Framework software either due to security flaws or to include additional functionality. Using the latest .Net framework version for web apps is recommended in order to to take advantage of security fixes, if any, and/or new functionalities of the latest version.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"app*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/web.netFrameworkVersion\",\"in\":[\"v3.0\",\"v4.0\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/843664e0-7563-41ee-a9cb-7522c382d2c4\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"843664e0-7563-41ee-a9cb-7522c382d2c4\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'Security Options - Microsoft Network Server'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Microsoft Network Server'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsMicrosoftNetworkServer\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_SecurityOptionsMicrosoftNetworkServer\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/86880e5c-df35-43c5-95ad-7e120635775e\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"86880e5c-df35-43c5-95ad-7e120635775e\"},{\"properties\":{\"displayName\":\"Deploy SQL DB transparent data encryption\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Enables transparent data encryption on SQL databases\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Sql/servers/databases\"},{\"field\":\"name\",\"notEquals\":\"master\"}]},\"then\":{\"effect\":\"DeployIfNotExists\",\"details\":{\"type\":\"Microsoft.Sql/servers/databases/transparentDataEncryption\",\"name\":\"current\",\"existenceCondition\":{\"field\":\"Microsoft.Sql/transparentDataEncryption.status\",\"equals\":\"Enabled\"},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/9b7fa17d-e63e-47b0-bb0a-15c516ac86ec\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"fullDbName\":{\"type\":\"string\"}},\"resources\":[{\"name\":\"[concat(parameters('fullDbName'), '/current')]\",\"type\":\"Microsoft.Sql/servers/databases/transparentDataEncryption\",\"apiVersion\":\"2014-04-01\",\"properties\":{\"status\":\"Enabled\"}}]},\"parameters\":{\"fullDbName\":{\"value\":\"[field('fullName')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/86a912f6-9a06-4e26-b447-11b16ba8659f\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"86a912f6-9a06-4e26-b447-11b16ba8659f\"},{\"properties\":{\"displayName\":\"System updates should be installed on your machines\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Missing security system updates on your servers will be monitored by Azure Security Center as recommendations\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"in\":[\"Microsoft.Compute/virtualMachines\",\"Microsoft.ClassicCompute/virtualMachines\"]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"systemUpdates\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/86b3d65f-7626-441e-b690-81a8b71cff60\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"86b3d65f-7626-441e-b690-81a8b71cff60\"},{\"properties\":{\"displayName\":\"Ensure that Register with Azure Active Directory is enabled on API app\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Managed service identity in App Service makes the app more secure by eliminating secrets from the app, such as credentials in the connection strings. When registering with Azure Active Directory in the app service, the app will connect to other Azure services securely without the need of username and passwords\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"*api\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/web.managedServiceIdentityId\",\"exists\":\"true\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/86d97760-d216-4d81-a3ad-163087b2b6c3\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"86d97760-d216-4d81-a3ad-163087b2b6c3\"},{\"properties\":{\"displayName\":\"Require specified tag\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Enforces existence of a tag. Does not apply to resource groups.\",\"metadata\":{\"category\":\"Tags\"},\"parameters\":{\"tagName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Tag Name\",\"description\":\"Name of the tag, such as 'environment'\"}}},\"policyRule\":{\"if\":{\"field\":\"[concat('tags[', parameters('tagName'), ']')]\",\"exists\":\"false\"},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/871b6d14-10aa-478d-b590-94f262ecfa99\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"871b6d14-10aa-478d-b590-94f262ecfa99\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'Administrative Templates - Control Panel'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Administrative Templates - Control Panel'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_AdministrativeTemplatesControlPanel\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/87b590fe-4a1d-4697-ae74-d4fe72ab786c\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"87b590fe-4a1d-4697-ae74-d4fe72ab786c\"},{\"properties\":{\"displayName\":\"Deploy prerequisites to audit Linux VMs that have the specified applications installed\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Linux virtual machines that have the specified applications installed. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"ApplicationName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Application names\",\"description\":\"A semicolon-separated list of the names of the applications that should not be installed. e.g. 'python; powershell'\"}}},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"microsoft-aks\",\"AzureDatabricks\",\"qubole-inc\",\"datastax\",\"couchbase\",\"scalegrid\",\"checkpoint\",\"paloaltonetworks\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"OpenLogic\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"CentOS*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"RHEL\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"osa\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"credativ\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Debian\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"7*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Suse\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"SLES*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"11*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Canonical\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"UbuntuServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"12*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"linux-data-science-vm-ubuntu\",\"azureml\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-centos-os\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-altus-centos-os\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"linux*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"linux*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"not_installed_application_linux\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('[ChefInSpec]NotInstalledApplicationLinuxResource1;AttributesYmlContent', '=', concat('packages: [', replace(parameters('ApplicationName'), ';', ','), ']')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"not_installed_application_linux\"},\"ApplicationName\":{\"value\":\"[parameters('ApplicationName')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"ApplicationName\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[ChefInSpec]NotInstalledApplicationLinuxResource1;AttributesYmlContent\",\"value\":\"[concat('packages: [', replace(parameters('ApplicationName'), ';', ','), ']')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[ChefInSpec]NotInstalledApplicationLinuxResource1;AttributesYmlContent\",\"value\":\"[concat('packages: [', replace(parameters('ApplicationName'), ';', ','), ']')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforLinux')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforLinux\",\"typeHandlerVersion\":\"1.0\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/884b209a-963b-4520-8006-d20cb3c213e0\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"884b209a-963b-4520-8006-d20cb3c213e0\"},{\"properties\":{\"displayName\":\"Ensure that 'Java version' is the latest, if used as a part of the Api app\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Periodically, newer versions are released for Java either due to security flaws or to include additional functionality. Using the latest Python version for Api apps is recommended in order to to take advantage of security fixes, if any, and/or new functionalities of the latest version.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]},\"JavaLatestVersion\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Latest Java version\",\"description\":\"Latest supported Java version for App Services\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"*api\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"notContains\":\"JAVA\"},{\"field\":\"Microsoft.Web/sites/config/web.javaVersion\",\"equals\":\"\"}]},{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"like\":\"[concat('*', parameters('JavaLatestVersion'))]\"},{\"field\":\"Microsoft.Web/sites/config/web.javaVersion\",\"equals\":\"\"}]},{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"equals\":\"\"},{\"field\":\"Microsoft.Web/sites/config/web.javaVersion\",\"like\":\"[concat(parameters('JavaLatestVersion'), '*')]\"}]}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/88999f4c-376a-45c8-bcb3-4058f713cf39\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"88999f4c-376a-45c8-bcb3-4058f713cf39\"},{\"properties\":{\"displayName\":\"Network interfaces should disable IP forwarding\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy denies the network interfaces which enabled IP forwarding. The setting of IP forwarding disables Azure's check of the source and destination for a network interface. This should be reviewed by the network security team.\",\"metadata\":{\"category\":\"Network\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Network/networkInterfaces\"},{\"field\":\"Microsoft.Network/networkInterfaces/enableIpForwarding\",\"equals\":\"true\"}]},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/88c0b9da-ce96-4b03-9635-f29a937e2900\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"88c0b9da-ce96-4b03-9635-f29a937e2900\"},{\"properties\":{\"displayName\":\"SQL servers should be configured with auditing retention days greater than 90 days.\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit SQL servers configured with an auditing retention period of less than 90 days.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Sql/servers\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Sql/servers/auditingSettings\",\"name\":\"default\",\"existenceCondition\":{\"field\":\"Microsoft.Sql/servers/auditingSettings/retentionDays\",\"greater\":90}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/89099bee-89e0-4b26-a5f4-165451757743\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"89099bee-89e0-4b26-a5f4-165451757743\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'Security Options - System settings'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - System settings'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsSystemsettings\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/8a39d1f1-5513-4628-b261-f469a5a3341b\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"8a39d1f1-5513-4628-b261-f469a5a3341b\"},{\"properties\":{\"displayName\":\"Show audit results from Windows VMs with a pending reboot\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with a pending reboot. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WindowsPendingReboot\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/8b0de57a-f511-4d45-a277-17cb79cb163b\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"8b0de57a-f511-4d45-a277-17cb79cb163b\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'Windows Firewall Properties'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Windows Firewall Properties'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_WindowsFirewallProperties\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/8bbd627e-4d25-4906-9a6e-3789780af3ec\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"8bbd627e-4d25-4906-9a6e-3789780af3ec\"},{\"properties\":{\"displayName\":\"Ensure that 'HTTP Version' is the latest, if used to run the Web app\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Managed service identity in App Service makes the app more secure by eliminating secrets from the app, such as credentials in the connection strings. When registering with Azure Active Directory in the app service, the app will connect to other Azure services securely without the need of username and passwords\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"app*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/web.http20Enabled\",\"Equals\":\"true\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/8c122334-9d20-4eb8-89ea-ac9a705b74ae\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"8c122334-9d20-4eb8-89ea-ac9a705b74ae\"},{\"properties\":{\"displayName\":\"Latest TLS version should be used in your API App\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Upgrade to the latest TLS version\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"*api\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/minTlsVersion\",\"equals\":\"1.2\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/8cb6aa8b-9e41-4f4e-aa25-089a7ac2581e\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"8cb6aa8b-9e41-4f4e-aa25-089a7ac2581e\"},{\"properties\":{\"displayName\":\"Require tag and its value on resource groups\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Enforces a required tag and its value on resource groups.\",\"metadata\":{\"category\":\"Tags\"},\"parameters\":{\"tagName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Tag Name\",\"description\":\"Name of the tag, such as 'environment'\"}},\"tagValue\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Tag Value\",\"description\":\"Value of the tag, such as 'production'\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions/resourceGroups\"},{\"field\":\"[concat('tags[', parameters('tagName'), ']')]\",\"notEquals\":\"[parameters('tagValue')]\"}]},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/8ce3da23-7156-49e4-b145-24f95f9dcb46\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"8ce3da23-7156-49e4-b145-24f95f9dcb46\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'System Audit Policies - Object Access'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'System Audit Policies - Object Access'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"AuditDetailedFileShare\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Audit Detailed File Share\",\"description\":\"If this policy setting is enabled, access to all shared files and folders on the system is audited. Auditing for Success can lead to very high volumes of events.\"},\"allowedValues\":[\"No Auditing\",\"Success\",\"Failure\",\"Success and Failure\"]},\"AuditFileShare\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Audit File Share\",\"description\":\"Specifies whether to audit events related to file shares: creation, deletion, modification, and access attempts. Also, it shows failed SMB SPN checks. Event volumes can be high on DCs and File Servers.\"},\"allowedValues\":[\"No Auditing\",\"Success\",\"Failure\",\"Success and Failure\"]},\"AuditFileSystem\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Audit File System\",\"description\":\"Specifies whether audit events are generated when users attempt to access file system objects. Audit events are generated only for objects that have configured system access control lists (SACLs).\"},\"allowedValues\":[\"No Auditing\",\"Success\",\"Failure\",\"Success and Failure\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SystemAuditPoliciesObjectAccess\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('Audit Detailed File Share;ExpectedValue', '=', parameters('AuditDetailedFileShare'), ',', 'Audit File Share;ExpectedValue', '=', parameters('AuditFileShare'), ',', 'Audit File System;ExpectedValue', '=', parameters('AuditFileSystem')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_SystemAuditPoliciesObjectAccess\"},\"AuditDetailedFileShare\":{\"value\":\"[parameters('AuditDetailedFileShare')]\"},\"AuditFileShare\":{\"value\":\"[parameters('AuditFileShare')]\"},\"AuditFileSystem\":{\"value\":\"[parameters('AuditFileSystem')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"AuditDetailedFileShare\":{\"type\":\"string\"},\"AuditFileShare\":{\"type\":\"string\"},\"AuditFileSystem\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"Audit Detailed File Share;ExpectedValue\",\"value\":\"[parameters('AuditDetailedFileShare')]\"},{\"name\":\"Audit File Share;ExpectedValue\",\"value\":\"[parameters('AuditFileShare')]\"},{\"name\":\"Audit File System;ExpectedValue\",\"value\":\"[parameters('AuditFileSystem')]\"}]}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/8e170edb-e0f5-497a-bb36-48b3280cec6a\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"8e170edb-e0f5-497a-bb36-48b3280cec6a\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy prerequisites to audit Windows VMs that do not store passwords using reversible encryption\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines that do not store passwords using reversible encryption. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"StorePasswordsUsingReversibleEncryption\",\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"StorePasswordsUsingReversibleEncryption\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/8ff0b18b-262e-4512-857a-48ad0aeb9a78\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"8ff0b18b-262e-4512-857a-48ad0aeb9a78\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'Windows Firewall Properties'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Windows Firewall Properties'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"WindowsFirewallDomainUseProfileSettings\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Windows Firewall (Domain): Use profile settings\",\"description\":\"Specifies whether Windows Firewall with Advanced Security uses the settings for the Domain profile to filter network traffic. If you select Off, Windows Firewall with Advanced Security will not use any of the firewall rules or connection security rules for this profile.\"}},\"WindowsFirewallDomainBehaviorForOutboundConnections\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Windows Firewall (Domain): Behavior for outbound connections\",\"description\":\"Specifies the behavior for outbound connections for the Domain profile that do not match an outbound firewall rule. The default value of 0 means to allow connections, and a value of 1 means to block connections.\"}},\"WindowsFirewallDomainApplyLocalConnectionSecurityRules\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Windows Firewall (Domain): Apply local connection security rules\",\"description\":\"Specifies whether local administrators are allowed to create connection security rules that apply together with connection security rules configured by Group Policy for the Domain profile.\"}},\"WindowsFirewallDomainApplyLocalFirewallRules\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Windows Firewall (Domain): Apply local firewall rules\",\"description\":\"Specifies whether local administrators are allowed to create local firewall rules that apply together with firewall rules configured by Group Policy for the Domain profile.\"}},\"WindowsFirewallDomainDisplayNotifications\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Windows Firewall (Domain): Display notifications\",\"description\":\"Specifies whether Windows Firewall with Advanced Security displays notifications to the user when a program is blocked from receiving inbound connections, for the Domain profile.\"}},\"WindowsFirewallPrivateUseProfileSettings\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Windows Firewall (Private): Use profile settings\",\"description\":\"Specifies whether Windows Firewall with Advanced Security uses the settings for the Private profile to filter network traffic. If you select Off, Windows Firewall with Advanced Security will not use any of the firewall rules or connection security rules for this profile.\"}},\"WindowsFirewallPrivateBehaviorForOutboundConnections\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Windows Firewall (Private): Behavior for outbound connections\",\"description\":\"Specifies the behavior for outbound connections for the Private profile that do not match an outbound firewall rule. The default value of 0 means to allow connections, and a value of 1 means to block connections.\"}},\"WindowsFirewallPrivateApplyLocalConnectionSecurityRules\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Windows Firewall (Private): Apply local connection security rules\",\"description\":\"Specifies whether local administrators are allowed to create connection security rules that apply together with connection security rules configured by Group Policy for the Private profile.\"}},\"WindowsFirewallPrivateApplyLocalFirewallRules\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Windows Firewall (Private): Apply local firewall rules\",\"description\":\"Specifies whether local administrators are allowed to create local firewall rules that apply together with firewall rules configured by Group Policy for the Private profile.\"}},\"WindowsFirewallPrivateDisplayNotifications\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Windows Firewall (Private): Display notifications\",\"description\":\"Specifies whether Windows Firewall with Advanced Security displays notifications to the user when a program is blocked from receiving inbound connections, for the Private profile.\"}},\"WindowsFirewallPublicUseProfileSettings\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Windows Firewall (Public): Use profile settings\",\"description\":\"Specifies whether Windows Firewall with Advanced Security uses the settings for the Public profile to filter network traffic. If you select Off, Windows Firewall with Advanced Security will not use any of the firewall rules or connection security rules for this profile.\"}},\"WindowsFirewallPublicBehaviorForOutboundConnections\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Windows Firewall (Public): Behavior for outbound connections\",\"description\":\"Specifies the behavior for outbound connections for the Public profile that do not match an outbound firewall rule. The default value of 0 means to allow connections, and a value of 1 means to block connections.\"}},\"WindowsFirewallPublicApplyLocalConnectionSecurityRules\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Windows Firewall (Public): Apply local connection security rules\",\"description\":\"Specifies whether local administrators are allowed to create connection security rules that apply together with connection security rules configured by Group Policy for the Public profile.\"}},\"WindowsFirewallPublicApplyLocalFirewallRules\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Windows Firewall (Public): Apply local firewall rules\",\"description\":\"Specifies whether local administrators are allowed to create local firewall rules that apply together with firewall rules configured by Group Policy for the Public profile.\"}},\"WindowsFirewallPublicDisplayNotifications\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Windows Firewall (Public): Display notifications\",\"description\":\"Specifies whether Windows Firewall with Advanced Security displays notifications to the user when a program is blocked from receiving inbound connections, for the Public profile.\"}},\"WindowsFirewallDomainAllowUnicastResponse\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Windows Firewall: Domain: Allow unicast response\",\"description\":\"Specifies whether Windows Firewall with Advanced Security permits the local computer to receive unicast responses to its outgoing multicast or broadcast messages; for the Domain profile.\"}},\"WindowsFirewallPrivateAllowUnicastResponse\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Windows Firewall: Private: Allow unicast response\",\"description\":\"Specifies whether Windows Firewall with Advanced Security permits the local computer to receive unicast responses to its outgoing multicast or broadcast messages; for the Private profile.\"}},\"WindowsFirewallPublicAllowUnicastResponse\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Windows Firewall: Public: Allow unicast response\",\"description\":\"Specifies whether Windows Firewall with Advanced Security permits the local computer to receive unicast responses to its outgoing multicast or broadcast messages; for the Public profile.\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_WindowsFirewallProperties\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('Windows Firewall: Domain: Firewall state;ExpectedValue', '=', parameters('WindowsFirewallDomainUseProfileSettings'), ',', 'Windows Firewall: Domain: Outbound connections;ExpectedValue', '=', parameters('WindowsFirewallDomainBehaviorForOutboundConnections'), ',', 'Windows Firewall: Domain: Settings: Apply local connection security rules;ExpectedValue', '=', parameters('WindowsFirewallDomainApplyLocalConnectionSecurityRules'), ',', 'Windows Firewall: Domain: Settings: Apply local firewall rules;ExpectedValue', '=', parameters('WindowsFirewallDomainApplyLocalFirewallRules'), ',', 'Windows Firewall: Domain: Settings: Display a notification;ExpectedValue', '=', parameters('WindowsFirewallDomainDisplayNotifications'), ',', 'Windows Firewall: Private: Firewall state;ExpectedValue', '=', parameters('WindowsFirewallPrivateUseProfileSettings'), ',', 'Windows Firewall: Private: Outbound connections;ExpectedValue', '=', parameters('WindowsFirewallPrivateBehaviorForOutboundConnections'), ',', 'Windows Firewall: Private: Settings: Apply local connection security rules;ExpectedValue', '=', parameters('WindowsFirewallPrivateApplyLocalConnectionSecurityRules'), ',', 'Windows Firewall: Private: Settings: Apply local firewall rules;ExpectedValue', '=', parameters('WindowsFirewallPrivateApplyLocalFirewallRules'), ',', 'Windows Firewall: Private: Settings: Display a notification;ExpectedValue', '=', parameters('WindowsFirewallPrivateDisplayNotifications'), ',', 'Windows Firewall: Public: Firewall state;ExpectedValue', '=', parameters('WindowsFirewallPublicUseProfileSettings'), ',', 'Windows Firewall: Public: Outbound connections;ExpectedValue', '=', parameters('WindowsFirewallPublicBehaviorForOutboundConnections'), ',', 'Windows Firewall: Public: Settings: Apply local connection security rules;ExpectedValue', '=', parameters('WindowsFirewallPublicApplyLocalConnectionSecurityRules'), ',', 'Windows Firewall: Public: Settings: Apply local firewall rules;ExpectedValue', '=', parameters('WindowsFirewallPublicApplyLocalFirewallRules'), ',', 'Windows Firewall: Public: Settings: Display a notification;ExpectedValue', '=', parameters('WindowsFirewallPublicDisplayNotifications'), ',', 'Windows Firewall: Domain: Allow unicast response;ExpectedValue', '=', parameters('WindowsFirewallDomainAllowUnicastResponse'), ',', 'Windows Firewall: Private: Allow unicast response;ExpectedValue', '=', parameters('WindowsFirewallPrivateAllowUnicastResponse'), ',', 'Windows Firewall: Public: Allow unicast response;ExpectedValue', '=', parameters('WindowsFirewallPublicAllowUnicastResponse')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_WindowsFirewallProperties\"},\"WindowsFirewallDomainUseProfileSettings\":{\"value\":\"[parameters('WindowsFirewallDomainUseProfileSettings')]\"},\"WindowsFirewallDomainBehaviorForOutboundConnections\":{\"value\":\"[parameters('WindowsFirewallDomainBehaviorForOutboundConnections')]\"},\"WindowsFirewallDomainApplyLocalConnectionSecurityRules\":{\"value\":\"[parameters('WindowsFirewallDomainApplyLocalConnectionSecurityRules')]\"},\"WindowsFirewallDomainApplyLocalFirewallRules\":{\"value\":\"[parameters('WindowsFirewallDomainApplyLocalFirewallRules')]\"},\"WindowsFirewallDomainDisplayNotifications\":{\"value\":\"[parameters('WindowsFirewallDomainDisplayNotifications')]\"},\"WindowsFirewallPrivateUseProfileSettings\":{\"value\":\"[parameters('WindowsFirewallPrivateUseProfileSettings')]\"},\"WindowsFirewallPrivateBehaviorForOutboundConnections\":{\"value\":\"[parameters('WindowsFirewallPrivateBehaviorForOutboundConnections')]\"},\"WindowsFirewallPrivateApplyLocalConnectionSecurityRules\":{\"value\":\"[parameters('WindowsFirewallPrivateApplyLocalConnectionSecurityRules')]\"},\"WindowsFirewallPrivateApplyLocalFirewallRules\":{\"value\":\"[parameters('WindowsFirewallPrivateApplyLocalFirewallRules')]\"},\"WindowsFirewallPrivateDisplayNotifications\":{\"value\":\"[parameters('WindowsFirewallPrivateDisplayNotifications')]\"},\"WindowsFirewallPublicUseProfileSettings\":{\"value\":\"[parameters('WindowsFirewallPublicUseProfileSettings')]\"},\"WindowsFirewallPublicBehaviorForOutboundConnections\":{\"value\":\"[parameters('WindowsFirewallPublicBehaviorForOutboundConnections')]\"},\"WindowsFirewallPublicApplyLocalConnectionSecurityRules\":{\"value\":\"[parameters('WindowsFirewallPublicApplyLocalConnectionSecurityRules')]\"},\"WindowsFirewallPublicApplyLocalFirewallRules\":{\"value\":\"[parameters('WindowsFirewallPublicApplyLocalFirewallRules')]\"},\"WindowsFirewallPublicDisplayNotifications\":{\"value\":\"[parameters('WindowsFirewallPublicDisplayNotifications')]\"},\"WindowsFirewallDomainAllowUnicastResponse\":{\"value\":\"[parameters('WindowsFirewallDomainAllowUnicastResponse')]\"},\"WindowsFirewallPrivateAllowUnicastResponse\":{\"value\":\"[parameters('WindowsFirewallPrivateAllowUnicastResponse')]\"},\"WindowsFirewallPublicAllowUnicastResponse\":{\"value\":\"[parameters('WindowsFirewallPublicAllowUnicastResponse')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"WindowsFirewallDomainUseProfileSettings\":{\"type\":\"string\"},\"WindowsFirewallDomainBehaviorForOutboundConnections\":{\"type\":\"string\"},\"WindowsFirewallDomainApplyLocalConnectionSecurityRules\":{\"type\":\"string\"},\"WindowsFirewallDomainApplyLocalFirewallRules\":{\"type\":\"string\"},\"WindowsFirewallDomainDisplayNotifications\":{\"type\":\"string\"},\"WindowsFirewallPrivateUseProfileSettings\":{\"type\":\"string\"},\"WindowsFirewallPrivateBehaviorForOutboundConnections\":{\"type\":\"string\"},\"WindowsFirewallPrivateApplyLocalConnectionSecurityRules\":{\"type\":\"string\"},\"WindowsFirewallPrivateApplyLocalFirewallRules\":{\"type\":\"string\"},\"WindowsFirewallPrivateDisplayNotifications\":{\"type\":\"string\"},\"WindowsFirewallPublicUseProfileSettings\":{\"type\":\"string\"},\"WindowsFirewallPublicBehaviorForOutboundConnections\":{\"type\":\"string\"},\"WindowsFirewallPublicApplyLocalConnectionSecurityRules\":{\"type\":\"string\"},\"WindowsFirewallPublicApplyLocalFirewallRules\":{\"type\":\"string\"},\"WindowsFirewallPublicDisplayNotifications\":{\"type\":\"string\"},\"WindowsFirewallDomainAllowUnicastResponse\":{\"type\":\"string\"},\"WindowsFirewallPrivateAllowUnicastResponse\":{\"type\":\"string\"},\"WindowsFirewallPublicAllowUnicastResponse\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"Windows Firewall: Domain: Firewall state;ExpectedValue\",\"value\":\"[parameters('WindowsFirewallDomainUseProfileSettings')]\"},{\"name\":\"Windows Firewall: Domain: Outbound connections;ExpectedValue\",\"value\":\"[parameters('WindowsFirewallDomainBehaviorForOutboundConnections')]\"},{\"name\":\"Windows Firewall: Domain: Settings: Apply local connection security rules;ExpectedValue\",\"value\":\"[parameters('WindowsFirewallDomainApplyLocalConnectionSecurityRules')]\"},{\"name\":\"Windows Firewall: Domain: Settings: Apply local firewall rules;ExpectedValue\",\"value\":\"[parameters('WindowsFirewallDomainApplyLocalFirewallRules')]\"},{\"name\":\"Windows Firewall: Domain: Settings: Display a notification;ExpectedValue\",\"value\":\"[parameters('WindowsFirewallDomainDisplayNotifications')]\"},{\"name\":\"Windows Firewall: Private: Firewall state;ExpectedValue\",\"value\":\"[parameters('WindowsFirewallPrivateUseProfileSettings')]\"},{\"name\":\"Windows Firewall: Private: Outbound connections;ExpectedValue\",\"value\":\"[parameters('WindowsFirewallPrivateBehaviorForOutboundConnections')]\"},{\"name\":\"Windows Firewall: Private: Settings: Apply local connection security rules;ExpectedValue\",\"value\":\"[parameters('WindowsFirewallPrivateApplyLocalConnectionSecurityRules')]\"},{\"name\":\"Windows Firewall: Private: Settings: Apply local firewall rules;ExpectedValue\",\"value\":\"[parameters('WindowsFirewallPrivateApplyLocalFirewallRules')]\"},{\"name\":\"Windows Firewall: Private: Settings: Display a notification;ExpectedValue\",\"value\":\"[parameters('WindowsFirewallPrivateDisplayNotifications')]\"},{\"name\":\"Windows Firewall: Public: Firewall state;ExpectedValue\",\"value\":\"[parameters('WindowsFirewallPublicUseProfileSettings')]\"},{\"name\":\"Windows Firewall: Public: Outbound connections;ExpectedValue\",\"value\":\"[parameters('WindowsFirewallPublicBehaviorForOutboundConnections')]\"},{\"name\":\"Windows Firewall: Public: Settings: Apply local connection security rules;ExpectedValue\",\"value\":\"[parameters('WindowsFirewallPublicApplyLocalConnectionSecurityRules')]\"},{\"name\":\"Windows Firewall: Public: Settings: Apply local firewall rules;ExpectedValue\",\"value\":\"[parameters('WindowsFirewallPublicApplyLocalFirewallRules')]\"},{\"name\":\"Windows Firewall: Public: Settings: Display a notification;ExpectedValue\",\"value\":\"[parameters('WindowsFirewallPublicDisplayNotifications')]\"},{\"name\":\"Windows Firewall: Domain: Allow unicast response;ExpectedValue\",\"value\":\"[parameters('WindowsFirewallDomainAllowUnicastResponse')]\"},{\"name\":\"Windows Firewall: Private: Allow unicast response;ExpectedValue\",\"value\":\"[parameters('WindowsFirewallPrivateAllowUnicastResponse')]\"},{\"name\":\"Windows Firewall: Public: Allow unicast response;ExpectedValue\",\"value\":\"[parameters('WindowsFirewallPublicAllowUnicastResponse')]\"}]}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/909c958d-1b99-4c74-b88f-46a5c5bc34f9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"909c958d-1b99-4c74-b88f-46a5c5bc34f9\"},{\"properties\":{\"displayName\":\"Deploy prerequisites to audit Windows VMs that do not have the specified Windows PowerShell modules installed\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines that do not have the specified Windows PowerShell modules installed. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"Modules\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"PowerShell Modules\",\"description\":\"A semicolon-separated list of the names of the PowerShell modules that should be installed. You may also specify a specific version of a module that should be installed by including a comma after the module name, followed by the desired version. e.g. PSDscResources; SqlServerDsc, 12.0.0.0; ComputerManagementDsc, 6.1.0.0\"}}},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WindowsPowerShellModules\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('[PowerShellModules]PowerShellModules1;Modules', '=', parameters('Modules')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"WindowsPowerShellModules\"},\"Modules\":{\"value\":\"[parameters('Modules')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"Modules\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[PowerShellModules]PowerShellModules1;Modules\",\"value\":\"[parameters('Modules')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[PowerShellModules]PowerShellModules1;Modules\",\"value\":\"[parameters('Modules')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/90ba2ee7-4ca8-4673-84d1-c851c50d3baf\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"90ba2ee7-4ca8-4673-84d1-c851c50d3baf\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'Windows Components'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Windows Components'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_WindowsComponents\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/9178b430-2295-406e-bb28-f6a7a2a2f897\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"9178b430-2295-406e-bb28-f6a7a2a2f897\"},{\"properties\":{\"displayName\":\"MFA should be enabled accounts with write permissions on your subscription\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Multi-Factor Authentication (MFA) should be enabled for all subscription accounts with write privileges to prevent a breach of accounts or resources.\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"EnableMFAForWritePermissions\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/9297c21d-2ed6-4474-b48f-163f75654ce3\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"9297c21d-2ed6-4474-b48f-163f75654ce3\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs that contain certificates expiring within the specified number of days\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines that contain certificates expiring within the specified number of days. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"CertificateExpiration\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/9328f27e-611e-44a7-a244-39109d7d35ab\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"9328f27e-611e-44a7-a244-39109d7d35ab\"},{\"properties\":{\"displayName\":\"Deploy prerequisites to audit Windows VMs in which the Administrators group does not contain all of the specified members\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines in which the Administrators group does not contain all of the specified members. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"MembersToInclude\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Members to include\",\"description\":\"A semicolon-separated list of members that should be included in the Administrators local group. Ex: Administrator; myUser1; myUser2\"}}},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AdministratorsGroupMembersToInclude\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('[LocalGroup]AdministratorsGroup;MembersToInclude', '=', parameters('MembersToInclude')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"AdministratorsGroupMembersToInclude\"},\"MembersToInclude\":{\"value\":\"[parameters('MembersToInclude')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"MembersToInclude\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[LocalGroup]AdministratorsGroup;MembersToInclude\",\"value\":\"[parameters('MembersToInclude')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[LocalGroup]AdministratorsGroup;MembersToInclude\",\"value\":\"[parameters('MembersToInclude')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/93507a81-10a4-4af0-9ee2-34cf25a96e98\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"93507a81-10a4-4af0-9ee2-34cf25a96e98\"},{\"properties\":{\"displayName\":\"[Deprecated]: Allow resource creation only in European data centers\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Allows resource creation in the following locations only: North Europe, West Europe\",\"metadata\":{\"category\":\"General\",\"deprecated\":true},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"northeurope\",\"westeurope\"]}},\"then\":{\"effect\":\"Deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/94c19f19-8192-48cd-a11b-e37099d3e36b\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"94c19f19-8192-48cd-a11b-e37099d3e36b\"},{\"properties\":{\"displayName\":\"Require specified tag on resource groups\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Enforces existence of a tag on resource groups.\",\"metadata\":{\"category\":\"Tags\"},\"parameters\":{\"tagName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Tag Name\",\"description\":\"Name of the tag, such as 'environment'\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions/resourceGroups\"},{\"field\":\"[concat('tags[', parameters('tagName'), ']')]\",\"exists\":\"false\"}]},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/96670d01-0a4d-4649-9c89-2d3abc0a5025\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"96670d01-0a4d-4649-9c89-2d3abc0a5025\"},{\"properties\":{\"displayName\":\"Advanced data security settings for SQL server should contain an email address to receive security alerts\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Ensure that an email address is provided for the 'Send alerts to' field in the Advanced Data Security server settings. This email address receives alert notifications when anomalous activities are detected on SQL servers.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Sql/servers\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Sql/servers/securityAlertPolicies\",\"name\":\"default\",\"existenceCondition\":{\"field\":\"Microsoft.Sql/servers/securityAlertPolicies/emailAddresses[*]\",\"notEquals\":\"\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/9677b740-f641-4f3c-b9c5-466005c85278\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"9677b740-f641-4f3c-b9c5-466005c85278\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'Adminstrative Templates - MSS (Legacy)'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Adminstrative Templates - MSS (Legacy)'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_AdminstrativeTemplatesMSSLegacy\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/97646672-5efa-4622-9b54-740270ad60bf\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"97646672-5efa-4622-9b54-740270ad60bf\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'System Audit Policies - Policy Change'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'System Audit Policies - Policy Change'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"AuditAuthenticationPolicyChange\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Audit Authentication Policy Change\",\"description\":\"Specifies whether audit events are generated when changes are made to authentication policy. This setting is useful for tracking changes in domain-level and forest-level trust and privileges that are granted to user accounts or groups.\"},\"allowedValues\":[\"No Auditing\",\"Success\",\"Failure\",\"Success and Failure\"]},\"AuditAuthorizationPolicyChange\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Audit Authorization Policy Change\",\"description\":\"Specifies whether audit events are generated for assignment and removal of user rights in user right policies, changes in security token object permission, resource attributes changes and Central Access Policy changes for file system objects.\"},\"allowedValues\":[\"No Auditing\",\"Success\",\"Failure\",\"Success and Failure\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SystemAuditPoliciesPolicyChange\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('Audit Authentication Policy Change;ExpectedValue', '=', parameters('AuditAuthenticationPolicyChange'), ',', 'Audit Authorization Policy Change;ExpectedValue', '=', parameters('AuditAuthorizationPolicyChange')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_SystemAuditPoliciesPolicyChange\"},\"AuditAuthenticationPolicyChange\":{\"value\":\"[parameters('AuditAuthenticationPolicyChange')]\"},\"AuditAuthorizationPolicyChange\":{\"value\":\"[parameters('AuditAuthorizationPolicyChange')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"AuditAuthenticationPolicyChange\":{\"type\":\"string\"},\"AuditAuthorizationPolicyChange\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"Audit Authentication Policy Change;ExpectedValue\",\"value\":\"[parameters('AuditAuthenticationPolicyChange')]\"},{\"name\":\"Audit Authorization Policy Change;ExpectedValue\",\"value\":\"[parameters('AuditAuthorizationPolicyChange')]\"}]}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/97b595c8-fd10-400e-8543-28e2b9138b13\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"97b595c8-fd10-400e-8543-28e2b9138b13\"},{\"properties\":{\"displayName\":\"[Deprecated]: Allow resource creation only in United States data centers\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Allows resource creation in the following locations only: Central US, East US, East US2, North Central US, South Central US, West US\",\"metadata\":{\"category\":\"General\",\"deprecated\":true},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"centralus\",\"eastus\",\"eastus2\",\"northcentralus\",\"southcentralus\",\"westus\"]}},\"then\":{\"effect\":\"Deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/983211ba-f348-4758-983b-21fa29294869\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"983211ba-f348-4758-983b-21fa29294869\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'Administrative Templates - Network'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Administrative Templates - Network'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"EnableInsecureGuestLogons\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable insecure guest logons\",\"description\":\"Specifies whether the SMB client will allow insecure guest logons to an SMB server.\"}},\"AllowSimultaneousConnectionsToTheInternetOrAWindowsDomain\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Allow simultaneous connections to the Internet or a Windows Domain\",\"description\":\"Specify whether to prevent computers from connecting to both a domain based network and a non-domain based network at the same time. A value of 0 allows simultaneous connections, and a value of 1 blocks them.\"}},\"TurnOffMulticastNameResolution\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Turn off multicast name resolution\",\"description\":\"Specifies whether LLMNR, a secondary name resolution protocol that transmits using multicast over a local subnet link on a single subnet, is enabled.\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_AdministrativeTemplatesNetwork\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('Enable insecure guest logons;ExpectedValue', '=', parameters('EnableInsecureGuestLogons'), ',', 'Minimize the number of simultaneous connections to the Internet or a Windows Domain;ExpectedValue', '=', parameters('AllowSimultaneousConnectionsToTheInternetOrAWindowsDomain'), ',', 'Turn off multicast name resolution;ExpectedValue', '=', parameters('TurnOffMulticastNameResolution')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_AdministrativeTemplatesNetwork\"},\"EnableInsecureGuestLogons\":{\"value\":\"[parameters('EnableInsecureGuestLogons')]\"},\"AllowSimultaneousConnectionsToTheInternetOrAWindowsDomain\":{\"value\":\"[parameters('AllowSimultaneousConnectionsToTheInternetOrAWindowsDomain')]\"},\"TurnOffMulticastNameResolution\":{\"value\":\"[parameters('TurnOffMulticastNameResolution')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"EnableInsecureGuestLogons\":{\"type\":\"string\"},\"AllowSimultaneousConnectionsToTheInternetOrAWindowsDomain\":{\"type\":\"string\"},\"TurnOffMulticastNameResolution\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"Enable insecure guest logons;ExpectedValue\",\"value\":\"[parameters('EnableInsecureGuestLogons')]\"},{\"name\":\"Minimize the number of simultaneous connections to the Internet or a Windows Domain;ExpectedValue\",\"value\":\"[parameters('AllowSimultaneousConnectionsToTheInternetOrAWindowsDomain')]\"},{\"name\":\"Turn off multicast name resolution;ExpectedValue\",\"value\":\"[parameters('TurnOffMulticastNameResolution')]\"}]}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/985285b7-b97a-419c-8d48-c88cc934c8d8\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"985285b7-b97a-419c-8d48-c88cc934c8d8\"},{\"properties\":{\"displayName\":\"Ensure that 'HTTP Version' is the latest, if used to run the Api app\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Periodically, newer versions are released for HTTP either due to security flaws or to include additional functionality. Using the latest HTTP version for web apps to take advantage of security fixes, if any, and/or new functionalities of the newer version.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"*api\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/web.http20Enabled\",\"equals\":\"true\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/991310cd-e9f3-47bc-b7b6-f57b557d07db\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"991310cd-e9f3-47bc-b7b6-f57b557d07db\"},{\"properties\":{\"displayName\":\"FTPS only should be required in your API App\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Enable FTPS enforcement for enhanced security\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"*api\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/ftpsState\",\"equals\":\"FtpsOnly\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/9a1b8c48-453a-4044-86c3-d8bfd823e4f5\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"9a1b8c48-453a-4044-86c3-d8bfd823e4f5\"},{\"properties\":{\"displayName\":\"Deploy Diagnostic Settings for Azure SQL Database to Event Hub\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploys the diagnostic settings for Azure SQL Database to stream to a regional Event Hub on any Azure SQL Database which is missing this diagnostic settings is created or updated.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"profileName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Profile name\",\"description\":\"The diagnostic settings profile name\"}},\"eventHubRuleId\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Event Hub Authorization Rule Id\",\"description\":\"The Event Hub authorization rule Id for Azure Diagnostics. The authorization rule needs to be at Event Hub namespace level. e.g. /subscriptions/{subscription Id}/resourceGroups/{resource group}/providers/Microsoft.EventHub/namespaces/{Event Hub namespace}/authorizationrules/{authorization rule}\",\"strongType\":\"Microsoft.EventHub/Namespaces/AuthorizationRules\",\"assignPermissions\":true}},\"metricsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable metrics\",\"description\":\"Whether to enable metrics stream to the Event Hub - True or False\"},\"allowedValues\":[\"True\",\"False\"]},\"logsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable logs\",\"description\":\"Whether to enable logs stream to the Event Hub  - True or False\"},\"allowedValues\":[\"True\",\"False\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Sql/servers/databases\"},\"then\":{\"effect\":\"DeployIfNotExists\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"name\":\"[parameters('profileName')]\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"[parameters('logsEnabled')]\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\"equals\":\"[parameters('metricsEnabled')]\"}]},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"fullName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"eventHubRuleId\":{\"type\":\"string\"},\"metricsEnabled\":{\"type\":\"string\"},\"logsEnabled\":{\"type\":\"string\"},\"profileName\":{\"type\":\"string\"}},\"resources\":[{\"type\":\"Microsoft.Sql/servers/databases/providers/diagnosticSettings\",\"apiVersion\":\"2017-05-01-preview\",\"name\":\"[concat(parameters('fullName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\"location\":\"[parameters('location')]\",\"dependsOn\":[],\"properties\":{\"eventHubAuthorizationRuleId\":\"[parameters('eventHubRuleId')]\",\"metrics\":[{\"category\":\"AllMetrics\",\"enabled\":\"[parameters('metricsEnabled')]\",\"retentionPolicy\":{\"enabled\":false,\"days\":0}}],\"logs\":[{\"category\":\"QueryStoreRuntimeStatistics\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"QueryStoreWaitStatistics\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"Errors\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"DatabaseWaitStatistics\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"Blocks\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"SQLInsights\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"Audit\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"SQLSecurityAuditEvents\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"Timeouts\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"AutomaticTuning\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"Deadlocks\",\"enabled\":\"[parameters('logsEnabled')]\"}]}}],\"outputs\":{\"policy\":{\"type\":\"string\",\"value\":\"[concat('Enabled diagnostic settings for ', parameters('fullName'))]\"}}},\"parameters\":{\"location\":{\"value\":\"[field('location')]\"},\"fullName\":{\"value\":\"[field('fullName')]\"},\"eventHubRuleId\":{\"value\":\"[parameters('eventHubRuleId')]\"},\"metricsEnabled\":{\"value\":\"[parameters('metricsEnabled')]\"},\"logsEnabled\":{\"value\":\"[parameters('logsEnabled')]\"},\"profileName\":{\"value\":\"[parameters('profileName')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/9a7c7a7d-49e5-4213-bea8-6a502b6272e0\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"9a7c7a7d-49e5-4213-bea8-6a502b6272e0\"},{\"properties\":{\"displayName\":\"Microsoft IaaSAntimalware extension should be deployed on Windows servers\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy audits any Windows server VM without Microsoft IaaSAntimalware extension deployed.\",\"metadata\":{\"category\":\"Compute\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"2008-R2-SP1\",\"2008-R2-SP1-smalldisk\",\"2012-Datacenter\",\"2012-Datacenter-smalldisk\",\"2012-R2-Datacenter\",\"2012-R2-Datacenter-smalldisk\",\"2016-Datacenter\",\"2016-Datacenter-Server-Core\",\"2016-Datacenter-Server-Core-smalldisk\",\"2016-Datacenter-smalldisk\",\"2016-Datacenter-with-Containers\",\"2016-Datacenter-with-RDSH\",\"2019-Datacenter\",\"2019-Datacenter-Core\",\"2019-Datacenter-Core-smalldisk\",\"2019-Datacenter-Core-with-Containers\",\"2019-Datacenter-Core-with-Containers-smalldisk\",\"2019-Datacenter-smalldisk\",\"2019-Datacenter-with-Containers\",\"2019-Datacenter-with-Containers-smalldisk\"]}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Compute/virtualMachines/extensions/type\",\"equals\":\"IaaSAntimalware\"},{\"field\":\"Microsoft.Compute/virtualMachines/extensions/publisher\",\"equals\":\"Microsoft.Azure.Security\"}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/9b597639-28e4-48eb-b506-56b05d366257\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"9b597639-28e4-48eb-b506-56b05d366257\"},{\"properties\":{\"displayName\":\"[Deprecated]: Audit API Applications that are not using latest supported Java Framework\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Use the latest supported Java version for the latest security classes. Using older classes and types can make your application vulnerable.\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true,\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"microsoft.Web/sites\"},{\"anyOf\":[{\"field\":\"kind\",\"equals\":\"api\"},{\"field\":\"kind\",\"equals\":\"apiApp\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"UseLatestJava\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/9bfe3727-0a17-471f-a2fe-eddd6b668745\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"9bfe3727-0a17-471f-a2fe-eddd6b668745\"},{\"properties\":{\"displayName\":\"Ensure that 'Java version' is the latest, if used as a part of the Funtion app\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Periodically, newer versions are released for Java software either due to security flaws or to include additional functionality. Using the latest Java version for Function apps is recommended in order to to take advantage of security fixes, if any, and/or new functionalities of the latest version.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]},\"JavaLatestVersion\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Latest Java version\",\"description\":\"Latest supported Java version for App Services\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"functionapp*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"notContains\":\"JAVA\"},{\"field\":\"Microsoft.Web/sites/config/web.javaVersion\",\"equals\":\"\"}]},{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"like\":\"[concat('*', parameters('JavaLatestVersion'))]\"},{\"field\":\"Microsoft.Web/sites/config/web.javaVersion\",\"equals\":\"\"}]},{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"equals\":\"\"},{\"field\":\"Microsoft.Web/sites/config/web.javaVersion\",\"like\":\"[concat(parameters('JavaLatestVersion'), '*')]\"}]}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/9d0b6ea4-93e2-4578-bf2f-6bb17d22b4bc\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"9d0b6ea4-93e2-4578-bf2f-6bb17d22b4bc\"},{\"properties\":{\"displayName\":\"Access through Internet facing endpoint should be restricted\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Azure Security center has identified some of your Network Security Groups' inbound rules to be too permissive. Inbound rules should not allow access from 'Any' or 'Internet' ranges. This can potentially enable attackers to easily target your resources.\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"in\":[\"Microsoft.Compute/virtualMachines\",\"Microsoft.ClassicCompute/virtualMachines\"]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"unprotectedNetworkEndpoint\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/9daedab3-fb2d-461e-b861-71790eead4f6\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"9daedab3-fb2d-461e-b861-71790eead4f6\"},{\"properties\":{\"displayName\":\"Append tag and its value from the resource group\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Appends the specified tag with its value from the resource group when any resource which is missing this tag is created or updated. Does not modify the tags of resources created before this policy was applied until those resources are changed. New 'modify' effect policies are available that support remediation of tags on existing resources (see https://aka.ms/modifydoc).\",\"metadata\":{\"category\":\"Tags\"},\"parameters\":{\"tagName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Tag Name\",\"description\":\"Name of the tag, such as 'environment'\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"[concat('tags[', parameters('tagName'), ']')]\",\"exists\":\"false\"},{\"value\":\"[resourceGroup().tags[parameters('tagName')]]\",\"notEquals\":\"\"}]},\"then\":{\"effect\":\"append\",\"details\":[{\"field\":\"[concat('tags[', parameters('tagName'), ']')]\",\"value\":\"[resourceGroup().tags[parameters('tagName')]]\"}]}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/9ea02ca2-71db-412d-8b00-7c7ca9fcd32d\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"9ea02ca2-71db-412d-8b00-7c7ca9fcd32d\"},{\"properties\":{\"displayName\":\"Show audit results from Windows VMs that are not set to the specified time zone\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines that are not set to the specified time zone. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WindowsTimeZone\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/9f658460-46b7-43af-8565-94fc0662be38\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"9f658460-46b7-43af-8565-94fc0662be38\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs on which the Log Analytics agent is not connected as expected\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines on which the Log Analytics agent is not connected to the specified workspaces. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WindowsLogAnalyticsAgentConnection\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/a030a57e-4639-4e8f-ade9-a92f33afe7ee\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"a030a57e-4639-4e8f-ade9-a92f33afe7ee\"},{\"properties\":{\"displayName\":\"Allowed resource types\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy enables you to specify the resource types that your organization can deploy. Only resource types that support 'tags' and 'location' will be affected by this policy. To restrict all resources please duplicate this policy and change the 'mode' to 'All'.\",\"metadata\":{\"category\":\"General\"},\"parameters\":{\"listOfResourceTypesAllowed\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of resource types that can be deployed.\",\"displayName\":\"Allowed resource types\",\"strongType\":\"resourceTypes\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"type\",\"in\":\"[parameters('listOfResourceTypesAllowed')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/a08ec900-254a-4555-9bf5-e42af04b5c5c\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"a08ec900-254a-4555-9bf5-e42af04b5c5c\"},{\"properties\":{\"displayName\":\"Security Center standard pricing tier should be selected\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"The standard pricing tier enables threat detection for networks and virtual machines, providing threat intelligence, anomaly detection, and behavior analytics in Azure Security Center\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Security/pricings\"},{\"field\":\"Microsoft.Security/pricings/pricingTier\",\"exists\":\"true\"},{\"field\":\"Microsoft.Security/pricings/pricingTier\",\"notEquals\":\"Standard\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/a1181c5f-672a-477a-979a-7d58aa086233\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"a1181c5f-672a-477a-979a-7d58aa086233\"},{\"properties\":{\"displayName\":\"All authorization rules except RootManageSharedAccessKey should be removed from Service Bus namespace\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Service Bus clients should not use a namespace level access policy that provides access to all queues and topics in a namespace. To align with the least privilege security model, you shoud create access policies at the entity level for queues and topics to provide access to only the specific entity\",\"metadata\":{\"category\":\"Service Bus\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"The effect determines what happens when the policy rule is evaluated to match\"},\"allowedValues\":[\"Audit\",\"Deny\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.ServiceBus/namespaces/authorizationRules\"},{\"field\":\"name\",\"notEquals\":\"RootManageSharedAccessKey\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/a1817ec0-a368-432a-8057-8371e17ac6ee\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"a1817ec0-a368-432a-8057-8371e17ac6ee\"},{\"properties\":{\"displayName\":\"Deploy Diagnostic Settings for Logic Apps to Event Hub\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploys the diagnostic settings for Logic Apps to stream to a regional Event Hub when any Logic Apps which is missing this diagnostic settings is created or updated.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"DeployIfNotExists\",\"Disabled\"]},\"profileName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Profile name\",\"description\":\"The diagnostic settings profile name\"}},\"eventHubRuleId\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Event Hub Authorization Rule Id\",\"description\":\"The Event Hub authorization rule Id for Azure Diagnostics. The authorization rule needs to be at Event Hub namespace level. e.g. /subscriptions/{subscription Id}/resourceGroups/{resource group}/providers/Microsoft.EventHub/namespaces/{Event Hub namespace}/authorizationrules/{authorization rule}\",\"strongType\":\"Microsoft.EventHub/Namespaces/AuthorizationRules\",\"assignPermissions\":true}},\"metricsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable metrics\",\"description\":\"Whether to enable metrics stream to the Event Hub - True or False\"},\"allowedValues\":[\"True\",\"False\"]},\"logsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable logs\",\"description\":\"Whether to enable logs stream to the Event Hub  - True or False\"},\"allowedValues\":[\"True\",\"False\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Logic/workflows\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"name\":\"[parameters('profileName')]\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"[parameters('logsEnabled')]\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\"equals\":\"[parameters('metricsEnabled')]\"}]},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"resourceName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"eventHubRuleId\":{\"type\":\"string\"},\"metricsEnabled\":{\"type\":\"string\"},\"logsEnabled\":{\"type\":\"string\"},\"profileName\":{\"type\":\"string\"}},\"variables\":{},\"resources\":[{\"type\":\"Microsoft.Logic/workflows/providers/diagnosticSettings\",\"apiVersion\":\"2017-05-01-preview\",\"name\":\"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\"location\":\"[parameters('location')]\",\"dependsOn\":[],\"properties\":{\"eventHubAuthorizationRuleId\":\"[parameters('eventHubRuleId')]\",\"metrics\":[{\"category\":\"AllMetrics\",\"enabled\":\"[parameters('metricsEnabled')]\",\"retentionPolicy\":{\"enabled\":false,\"days\":0}}],\"logs\":[{\"category\":\"WorkflowRuntime\",\"enabled\":\"[parameters('logsEnabled')]\"}]}}],\"outputs\":{}},\"parameters\":{\"location\":{\"value\":\"[field('location')]\"},\"resourceName\":{\"value\":\"[field('name')]\"},\"eventHubRuleId\":{\"value\":\"[parameters('eventHubRuleId')]\"},\"metricsEnabled\":{\"value\":\"[parameters('metricsEnabled')]\"},\"logsEnabled\":{\"value\":\"[parameters('logsEnabled')]\"},\"profileName\":{\"value\":\"[parameters('profileName')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/a1dae6c7-13f3-48ea-a149-ff8442661f60\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"a1dae6c7-13f3-48ea-a149-ff8442661f60\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'Administrative Templates - System'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Administrative Templates - System'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_AdministrativeTemplatesSystem\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/a1e8dda3-9fd2-4835-aec3-0e55531fde33\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"a1e8dda3-9fd2-4835-aec3-0e55531fde33\"},{\"properties\":{\"displayName\":\"Show audit results from Windows VMs that are not joined to the specified domain\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines that are not joined to the specified domain. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WindowsDomainMembership\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/a29ee95c-0395-4515-9851-cc04ffe82a91\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"a29ee95c-0395-4515-9851-cc04ffe82a91\"},{\"properties\":{\"displayName\":\"Audit usage of custom RBAC rules\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Audit built-in roles such as 'Owner, Contributer, Reader' instead of custom RBAC roles, which are error prone. Using custom roles is treated as an exception and requires a rigorous review and threat modeling\",\"metadata\":{\"category\":\"General\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Authorization/roleDefinitions\"},{\"field\":\"Microsoft.Authorization/roleDefinitions/type\",\"equals\":\"CustomRole\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/a451c1ef-c6ca-483d-87ed-f49761e3ffb5\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"a451c1ef-c6ca-483d-87ed-f49761e3ffb5\"},{\"properties\":{\"displayName\":\"Web Application should only be accessible over HTTPS\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Use of HTTPS ensures server/service authentication and protects data in transit from network layer eavesdropping attacks.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"app*\"},{\"field\":\"Microsoft.Web/sites/httpsOnly\",\"equals\":\"false\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/a4af4a39-4135-47fb-b175-47fbdf85311d\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"a4af4a39-4135-47fb-b175-47fbdf85311d\"},{\"properties\":{\"displayName\":\"Auditing should be enabled on advanced data security settings on SQL Server\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Auditing tracks database events and writes them to an audit log in the Azure storage account. It also helps to maintain regulatory compliance, understand database activity, and gain insight into discrepancies and anomalies that could indicate business concerns or suspected security violations.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]},\"setting\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Desired Auditing setting\"},\"allowedValues\":[\"enabled\",\"disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Sql/servers\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Sql/servers/auditingSettings\",\"name\":\"default\",\"existenceCondition\":{\"field\":\"Microsoft.Sql/auditingSettings.state\",\"equals\":\"[parameters('setting')]\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/a6fb4358-5bf4-4ad7-ba82-2cd2f41ce5e9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"a6fb4358-5bf4-4ad7-ba82-2cd2f41ce5e9\"},{\"properties\":{\"displayName\":\"The Log Analytics agent should be installed on virtual machines\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy audits any Windows/Linux virtual machines if the Log Analytics agent is not installed.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Compute/virtualMachines/extensions/publisher\",\"equals\":\"Microsoft.EnterpriseCloud.Monitoring\"},{\"field\":\"Microsoft.Compute/virtualMachines/extensions/type\",\"in\":[\"MicrosoftMonitoringAgent\",\"OmsAgentForLinux\"]},{\"field\":\"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\"equals\":\"Succeeded\"},{\"field\":\"Microsoft.Compute/virtualMachines/extensions/settings.workspaceId\",\"exists\":\"true\"}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/a70ca396-0a34-413a-88e1-b956c1e683be\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"a70ca396-0a34-413a-88e1-b956c1e683be\"},{\"properties\":{\"displayName\":\"DDoS Protection Standard should be enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"DDoS protection standard should be enabled for all virtual networks with a subnet that is part of an application gateway with a public IP.\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"microsoft.network/virtualNetworks\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"EnableDDoSProtection\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/a7aca53f-2ed4-4466-a25e-0b45ade68efd\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"a7aca53f-2ed4-4466-a25e-0b45ade68efd\"},{\"properties\":{\"displayName\":\"Require encryption on Data Lake Store accounts\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy ensures encryption is enabled on all Data Lake Store accounts\",\"metadata\":{\"category\":\"Data Lake\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.DataLakeStore/accounts\"},{\"field\":\"Microsoft.DataLakeStore/accounts/encryptionState\",\"equals\":\"Disabled\"}]},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/a7ff3161-0087-490a-9ad9-ad6217f4f43a\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"a7ff3161-0087-490a-9ad9-ad6217f4f43a\"},{\"properties\":{\"displayName\":\"[Deprecated] Monitor unencrypted SQL databases in Azure Security Center\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Unencrypted SQL databases will be monitored by Azure Security Center as recommendations. This policy is deprecated and replaced by the following policy: Transparent Data Encryption on SQL databases should be enabled'\",\"metadata\":{\"category\":\"Security Center\",\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"in\":[\"Microsoft.SQL/servers/databases\"]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"encryption\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/a8bef009-a5c9-4d0f-90d7-6018734e8a16\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"a8bef009-a5c9-4d0f-90d7-6018734e8a16\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'System Audit Policies - Detailed Tracking'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'System Audit Policies - Detailed Tracking'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SystemAuditPoliciesDetailedTracking\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/a9a33475-481d-4b81-9116-0bf02ffe67e8\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"a9a33475-481d-4b81-9116-0bf02ffe67e8\"},{\"properties\":{\"displayName\":\"Deploy network watcher when virtual networks are created\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a network watcher resource in regions with virtual networks. You need to ensure existence of a resource group named networkWatcherRG, which will be used to deploy network watcher instances.\",\"metadata\":{\"category\":\"Network\"},\"parameters\":{},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Network/virtualNetworks\"},\"then\":{\"effect\":\"DeployIfNotExists\",\"details\":{\"type\":\"Microsoft.Network/networkWatchers\",\"resourceGroupName\":\"networkWatcherRG\",\"existenceCondition\":{\"field\":\"location\",\"equals\":\"[field('location')]\"},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/4d97b98b-1d4f-4787-a291-c67834d212e7\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"location\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2016-09-01\",\"type\":\"Microsoft.Network/networkWatchers\",\"name\":\"[concat('networkWatcher_', parameters('location'))]\",\"location\":\"[parameters('location')]\"}]},\"parameters\":{\"location\":{\"value\":\"[field('location')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/a9b99dd8-06c5-4317-8629-9d86a3c6e7d9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"a9b99dd8-06c5-4317-8629-9d86a3c6e7d9\"},{\"properties\":{\"displayName\":\"MFA should be enabled on accounts with owner permissions on your subscription\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Multi-Factor Authentication (MFA) should be enabled for all subscription accounts with owner permissions to prevent a breach of accounts or resources.\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"EnableMFAForOwnerPermissions\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/aa633080-8b72-40c4-a2d7-d00c03e80bed\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"aa633080-8b72-40c4-a2d7-d00c03e80bed\"},{\"properties\":{\"displayName\":\"Ensure that Register with Azure Active Directory is enabled on WEB App\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Managed service identity in App Service makes the app more secure by eliminating secrets from the app, such as credentials in the connection strings. When registering with Azure Active Directory in the app service, the app will connect to other Azure services securely without the need of username and passwords\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"app*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/web.managedServiceIdentityId\",\"exists\":\"true\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/aa81768c-cb87-4ce2-bfaa-00baa10d760c\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"aa81768c-cb87-4ce2-bfaa-00baa10d760c\"},{\"properties\":{\"displayName\":\"Ensure that 'PHP version' is the latest, if used as a part of the Function app\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Periodically, newer versions are released for PHP software either due to security flaws or to include additional functionality. Using the latest PHP version for Function apps is recommended in order to to take advantage of security fixes, if any, and/or new functionalities of the latest version.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]},\"PHPLatestVersion\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Latest PHP version\",\"description\":\"Latest supported PHP version for App Services\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"functionapp*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"notContains\":\"PHP\"},{\"field\":\"Microsoft.Web/sites/config/web.phpVersion\",\"equals\":\"\"}]},{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"equals\":\"[concat('PHP|', parameters('PHPLatestVersion'))]\"},{\"field\":\"Microsoft.Web/sites/config/web.phpVersion\",\"equals\":\"\"}]},{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/web.linuxFxVersion\",\"equals\":\"\"},{\"field\":\"Microsoft.Web/sites/config/web.phpVersion\",\"equals\":\"[parameters('PHPLatestVersion')]\"}]}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/ab965db2-d2bf-4b64-8b39-c38ec8179461\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"ab965db2-d2bf-4b64-8b39-c38ec8179461\"},{\"properties\":{\"displayName\":\"[Deprecated]: Automatic provisioning of security monitoring agent\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Installs security agent on VMs for advanced security alerts and preventions in Azure Security Center. Applies only for subscriptions that use Azure Security Center.\",\"metadata\":{\"category\":\"Security Center\",\"deprecated\":true},\"parameters\":{},\"policyRule\":{\"if\":{\"field\":\"type\",\"in\":[\"Microsoft.Compute/virtualMachines\",\"Microsoft.ClassicCompute/virtualMachines\"]},\"then\":{\"effect\":\"AuditIfNotExists\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"securityAgent\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/abcc6037-1fc4-47f6-aac5-89706589be24\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"abcc6037-1fc4-47f6-aac5-89706589be24\"},{\"properties\":{\"displayName\":\"Advanced data security should be enabled on your SQL servers\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit SQL servers without Advanced Data Security\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Sql/servers\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Sql/servers/securityAlertPolicies\",\"name\":\"Default\",\"existenceCondition\":{\"field\":\"Microsoft.Sql/servers/securityAlertPolicies/state\",\"equals\":\"Enabled\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/abfb4388-5bf4-4ad7-ba82-2cd2f41ceae9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"abfb4388-5bf4-4ad7-ba82-2cd2f41ceae9\"},{\"properties\":{\"displayName\":\"Advanced data security should be enabled on your SQL managed instances\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit SQL managed instances without Advanced Data Security\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Sql/managedInstances\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Sql/managedInstances/securityAlertPolicies\",\"name\":\"Default\",\"existenceCondition\":{\"field\":\"Microsoft.Sql/managedInstances/securityAlertPolicies/state\",\"equals\":\"Enabled\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/abfb7388-5bf4-4ad7-ba99-2cd2f41cebb9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"abfb7388-5bf4-4ad7-ba99-2cd2f41cebb9\"},{\"properties\":{\"displayName\":\"[Preview]: Role-Based Access Control (RBAC) should be used on Kubernetes Services\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"To provide granular filtering on the actions that users can perform, use Role-Based Access Control (RBAC) to manage permissions in Kubernetes Service Clusters and configure relevant authorization policies.\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.ContainerService/managedClusters\"},{\"anyOf\":[{\"field\":\"Microsoft.ContainerService/managedClusters/enableRBAC\",\"exists\":\"false\"},{\"field\":\"Microsoft.ContainerService/managedClusters/enableRBAC\",\"equals\":\"false\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/ac4a19c2-fa67-49b4-8ae5-0b2e78c49457\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"ac4a19c2-fa67-49b4-8ae5-0b2e78c49457\"},{\"properties\":{\"displayName\":\"[Deprecated]: Allow resource creation if 'environment' tag value in allowed values\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Allows resource creation if the 'environment' tag is set to one of the following values: production, dev, test, staging\",\"metadata\":{\"category\":\"Tags\",\"deprecated\":true},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"tags['environment']\",\"in\":[\"production\",\"dev\",\"test\",\"staging\"]}},\"then\":{\"effect\":\"Deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/ac7e5fc0-c029-4b12-91d4-a8500ce697f9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"ac7e5fc0-c029-4b12-91d4-a8500ce697f9\"},{\"properties\":{\"displayName\":\"SQL Server should use a virtual network service endpoint\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy audits any SQL Server not configured to use a virtual network service endpoint.\",\"metadata\":{\"category\":\"Network\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Sql/servers\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Sql/servers/virtualNetworkRules\",\"existenceCondition\":{\"field\":\"Microsoft.Sql/servers/virtualNetworkRules/virtualNetworkSubnetId\",\"exists\":\"true\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/ae5d2f14-d830-42b6-9899-df6cfe9c71a3\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"ae5d2f14-d830-42b6-9899-df6cfe9c71a3\"},{\"properties\":{\"displayName\":\"Email notifications to admins and subscription owners should be enabled in SQL managed instance advanced data security settings\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit that 'email notification to admins and subscription owners' is enabled in the SQL managed instance advanced threat protection settings. This ensures that any detections of anomalous activities on SQL managed instance are reported as soon as possible to the admins.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Sql/managedInstances\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Sql/managedInstances/securityAlertPolicies\",\"name\":\"default\",\"existenceCondition\":{\"field\":\"Microsoft.Sql/managedInstances/securityAlertPolicies/emailAccountAdmins\",\"equals\":\"true\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/aeb23562-188d-47cb-80b8-551f16ef9fff\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"aeb23562-188d-47cb-80b8-551f16ef9fff\"},{\"properties\":{\"displayName\":\"Monitor missing Endpoint Protection in Azure Security Center\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Servers without an installed Endpoint Protection agent will be monitored by Azure Security Center as recommendations\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"in\":[\"Microsoft.Compute/virtualMachines\",\"Microsoft.ClassicCompute/virtualMachines\"]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"endpointProtection\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/af6cd1bd-1635-48cb-bde7-5b15693900b9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"af6cd1bd-1635-48cb-bde7-5b15693900b9\"},{\"properties\":{\"displayName\":\"[Deprecated] Monitor unaudited SQL servers in Azure Security Center\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"SQL servers which don't have SQL auditing turned on will be monitored by Azure Security Center as recommendations. This policy is deprecated and replaced by the following policy: 'Auditing should be enabled on advanced data security settings on SQL Server'\",\"metadata\":{\"category\":\"Security Center\",\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"in\":[\"Microsoft.SQL/servers\"]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"auditing\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/af8051bf-258b-44e2-a2bf-165330459f9d\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"af8051bf-258b-44e2-a2bf-165330459f9d\"},{\"properties\":{\"displayName\":\"Activity log should be retained for at least one year\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy audits the activity log if the retention is not set for 365 days or forever (retention days set to 0).\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/logProfiles\",\"existenceCondition\":{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Insights/logProfiles/retentionPolicy.enabled\",\"equals\":\"true\"},{\"field\":\"Microsoft.Insights/logProfiles/retentionPolicy.days\",\"equals\":\"365\"}]},{\"allOf\":[{\"field\":\"Microsoft.Insights/logProfiles/retentionPolicy.enabled\",\"equals\":\"false\"},{\"field\":\"Microsoft.Insights/logProfiles/retentionPolicy.days\",\"equals\":\"0\"}]}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/b02aacc0-b073-424e-8298-42b22829ee0a\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"b02aacc0-b073-424e-8298-42b22829ee0a\"},{\"properties\":{\"displayName\":\"Just-In-Time network access control should be applied on virtual machines\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Possible network Just In Time (JIT) access will be monitored by Azure Security Center as recommendations\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"jitNetworkAccess\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/b0f33259-77d7-4c9e-aac6-3aabcfae693c\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"b0f33259-77d7-4c9e-aac6-3aabcfae693c\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Linux VMs that do not have the passwd file permissions set to 0644\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Linux virtual machines that do not have the passwd file permissions set to 0644. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"microsoft-aks\",\"AzureDatabricks\",\"qubole-inc\",\"datastax\",\"couchbase\",\"scalegrid\",\"checkpoint\",\"paloaltonetworks\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"OpenLogic\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"CentOS*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"RHEL\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"osa\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"credativ\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Debian\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"7*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Suse\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"SLES*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"11*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Canonical\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"UbuntuServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"12*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"linux-data-science-vm-ubuntu\",\"azureml\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-centos-os\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-altus-centos-os\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"linux*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"linux*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"PasswordPolicy_msid121\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/b18175dd-c599-4c64-83ba-bb018a06d35b\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"b18175dd-c599-4c64-83ba-bb018a06d35b\"},{\"properties\":{\"displayName\":\"All authorization rules except RootManageSharedAccessKey should be removed from Event Hub namespace\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Event Hub clients should not use a namespace level access policy that provides access to all queues and topics in a namespace. To align with the least privilege security model, you shoud create access policies at the entity level for queues and topics to provide access to only the specific entity\",\"metadata\":{\"category\":\"Event Hub\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"The effect determines what happens when the policy rule is evaluated to match\"},\"allowedValues\":[\"Audit\",\"Deny\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.EventHub/namespaces/authorizationRules\"},{\"field\":\"name\",\"notEquals\":\"RootManageSharedAccessKey\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/b278e460-7cfc-4451-8294-cccc40a940d7\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"b278e460-7cfc-4451-8294-cccc40a940d7\"},{\"properties\":{\"displayName\":\"Deploy prerequisites to audit Windows web servers that are not using secure communication protocols\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows web servers that are not using secure communication protocols (TLS 1.1 or TLS 1.2). It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"MinimumTLSVersion\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Minimum TLS version\",\"description\":\"The minimum TLS protocol version that should be enabled. Windows web servers with lower TLS versions will be marked as non-compliant.\"},\"allowedValues\":[\"1.1\",\"1.2\"]}},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AuditSecureProtocol\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"anyOf\":[{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('[SecureWebServer]s1;MinimumTLSVersion', '=', parameters('MinimumTLSVersion')))]\"},{\"allOf\":[{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"\"},{\"value\":\"[parameters('MinimumTLSVersion')]\",\"equals\":\"1.1\"}]}]},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"AuditSecureProtocol\"},\"MinimumTLSVersion\":{\"value\":\"[parameters('MinimumTLSVersion')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"MinimumTLSVersion\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[SecureWebServer]s1;MinimumTLSVersion\",\"value\":\"[parameters('MinimumTLSVersion')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[SecureWebServer]s1;MinimumTLSVersion\",\"value\":\"[parameters('MinimumTLSVersion')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/b2fc8f91-866d-4434-9089-5ebfe38d6fd8\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"b2fc8f91-866d-4434-9089-5ebfe38d6fd8\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'System Audit Policies - Logon-Logoff'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'System Audit Policies - Logon-Logoff'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SystemAuditPoliciesLogonLogoff\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/b3802d79-dd88-4bce-b81d-780218e48280\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"b3802d79-dd88-4bce-b81d-780218e48280\"},{\"properties\":{\"displayName\":\"Diagnostic logs in Search services should be enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit enabling of diagnostic logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised\",\"metadata\":{\"category\":\"Search\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]},\"requiredRetentionDays\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Required retention (days)\",\"description\":\"The required diagnostic logs retention in days\"}}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Search/searchServices\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"existenceCondition\":{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\"equals\":\"true\"},{\"anyOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\"equals\":\"0\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\"equals\":\"[parameters('requiredRetentionDays')]\"}]},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"true\"}]},{\"allOf\":[{\"not\":{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\"equals\":\"true\"}},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"true\"}]}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/b4330a05-a843-4bc8-bf9a-cacce50c67f4\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"b4330a05-a843-4bc8-bf9a-cacce50c67f4\"},{\"properties\":{\"displayName\":\"[Deprecated]: Audit Web Sockets state for an API App\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"The Web Sockets protocol is vulnerable to different types of security threats. Use of Web Sockets within an API app must be carefully reviewed.\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true,\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"microsoft.Web/sites\"},{\"anyOf\":[{\"field\":\"kind\",\"equals\":\"api\"},{\"field\":\"kind\",\"equals\":\"apiApp\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"DisableWebSockets\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/b48334a4-911b-4084-b1ab-3e6a4e50b951\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"b48334a4-911b-4084-b1ab-3e6a4e50b951\"},{\"properties\":{\"displayName\":\"A security contact phone number should be provided for your subscription\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Enter a phone number to receive notifications when Azure Security Center detects compromised resources\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/securityContacts\",\"existenceCondition\":{\"field\":\"Microsoft.Security/securityContacts/phone\",\"notEquals\":\"\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/b4d66858-c922-44e3-9566-5cdb7a7be744\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"b4d66858-c922-44e3-9566-5cdb7a7be744\"},{\"properties\":{\"displayName\":\"Service Fabric clusters should only use Azure Active Directory for client authentication\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit usage of client authentication only via Azure Active Directory in Service Fabric\",\"metadata\":{\"category\":\"Service Fabric\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.ServiceFabric/clusters\"},{\"anyOf\":[{\"field\":\"Microsoft.ServiceFabric/clusters/azureActiveDirectory.tenantId\",\"exists\":\"false\"},{\"field\":\"Microsoft.ServiceFabric/clusters/azureActiveDirectory.tenantId\",\"equals\":\"\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/b54ed75b-3e1a-44ac-a333-05ba39b99ff0\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"b54ed75b-3e1a-44ac-a333-05ba39b99ff0\"},{\"properties\":{\"displayName\":\"Deploy Advanced Threat Protection for Cosmos DB Accounts\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy enables Advanced Threat Protection across Cosmos DB accounts.\",\"metadata\":{\"category\":\"Cosmos DB\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"DeployIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.DocumentDB/databaseAccounts\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/advancedThreatProtectionSettings\",\"name\":\"current\",\"existenceCondition\":{\"field\":\"Microsoft.Security/advancedThreatProtectionSettings/isEnabled\",\"equals\":\"true\"},\"roleDefinitionIds\":[\"/providers/Microsoft.Authorization/roleDefinitions/fb1c8493-542b-48eb-b624-b4c8fea62acd\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"cosmosDbAccountName\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2017-08-01-preview\",\"type\":\"Microsoft.DocumentDB/databaseAccounts/providers/advancedThreatProtectionSettings\",\"name\":\"[concat(parameters('cosmosDbAccountName'), '/Microsoft.Security/current')]\",\"properties\":{\"isEnabled\":true}}]},\"parameters\":{\"cosmosDbAccountName\":{\"value\":\"[field('name')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/b5f04e03-92a3-4b09-9410-2cc5e5047656\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"b5f04e03-92a3-4b09-9410-2cc5e5047656\"},{\"properties\":{\"displayName\":\"Diagnostic logs in App Services should be enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Audit enabling of diagnostic logs on the app. This enables you to recreate activity trails for investigation purposes if a security incident occurs or your network is compromised\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"notContains\":\"functionapp\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Web/sites/config/detailedErrorLoggingEnabled\",\"equals\":\"true\"},{\"field\":\"Microsoft.Web/sites/config/httpLoggingEnabled\",\"equals\":\"true\"},{\"field\":\"Microsoft.Web/sites/config/requestTracingEnabled\",\"equals\":\"true\"}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/b607c5de-e7d9-4eee-9e5c-83f1bcee4fa0\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"b607c5de-e7d9-4eee-9e5c-83f1bcee4fa0\"},{\"properties\":{\"displayName\":\"Network Watcher should be enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Network Watcher is a regional service that enables you to monitor and diagnose conditions at a network scenario level in, to, and from Azure. Scenario level monitoring enables you to diagnose problems at an end to end network level view. Network diagnostic and visualization tools available with Network Watcher help you understand, diagnose, and gain insights to your network in Azure.\",\"metadata\":{\"category\":\"Network\"},\"parameters\":{\"listOfLocations\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"Locations\",\"description\":\"Audit if Network Watcher is not enabled for region(s).\",\"strongType\":\"location\"}}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions\"},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.Network/networkWatchers\",\"resourceGroupName\":\"NetworkWatcherRG\",\"existenceCondition\":{\"field\":\"location\",\"in\":\"[parameters('listOfLocations')]\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/b6e2945c-0b7b-40f5-9233-7a5323b5cdc6\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"b6e2945c-0b7b-40f5-9233-7a5323b5cdc6\"},{\"properties\":{\"displayName\":\"API App should only be accessible over HTTPS\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Use of HTTPS ensures server/service authentication and protects data in transit from network layer eavesdropping attacks.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"*api\"},{\"field\":\"Microsoft.Web/sites/httpsOnly\",\"equals\":\"false\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/b7ddfbdc-1260-477d-91fd-98bd9be789a6\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"b7ddfbdc-1260-477d-91fd-98bd9be789a6\"},{\"properties\":{\"displayName\":\"Deploy prerequisites to audit Windows VMs in which the Administrators group does not contain only the specified members\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines in which the Administrators group does not contain only the specified members. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"Members\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Members\",\"description\":\"A semicolon-separated list of all the expected members of the Administrators local group. Ex: Administrator; myUser1; myUser2\"}}},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AdministratorsGroupMembers\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('[LocalGroup]AdministratorsGroup;Members', '=', parameters('Members')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"AdministratorsGroupMembers\"},\"Members\":{\"value\":\"[parameters('Members')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"Members\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[LocalGroup]AdministratorsGroup;Members\",\"value\":\"[parameters('Members')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[LocalGroup]AdministratorsGroup;Members\",\"value\":\"[parameters('Members')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/b821191b-3a12-44bc-9c38-212138a29ff3\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"b821191b-3a12-44bc-9c38-212138a29ff3\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'Security Options - Accounts'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Accounts'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsAccounts\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/b872a447-cc6f-43b9-bccf-45703cd81607\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"b872a447-cc6f-43b9-bccf-45703cd81607\"},{\"properties\":{\"displayName\":\"Deploy Diagnostic Settings for Logic Apps to Log Analytics workspace\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploys the diagnostic settings for Logic Apps to stream to a regional Log Analytics workspace when any Logic Apps which is missing this diagnostic settings is created or updated.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"DeployIfNotExists\",\"Disabled\"]},\"profileName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Profile name\",\"description\":\"The diagnostic settings profile name\"}},\"logAnalytics\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Log Analytics workspace\",\"description\":\"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\"strongType\":\"omsWorkspace\",\"assignPermissions\":true}},\"metricsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable metrics\",\"description\":\"Whether to enable metrics stream to the Event Hub - True or False\"},\"allowedValues\":[\"True\",\"False\"]},\"logsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable logs\",\"description\":\"Whether to enable logs stream to the Event Hub  - True or False\"},\"allowedValues\":[\"True\",\"False\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Logic/workflows\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"name\":\"[parameters('profileName')]\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"[parameters('logsEnabled')]\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\"equals\":\"[parameters('metricsEnabled')]\"}]},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa\",\"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"resourceName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"logAnalytics\":{\"type\":\"string\"},\"metricsEnabled\":{\"type\":\"string\"},\"logsEnabled\":{\"type\":\"string\"},\"profileName\":{\"type\":\"string\"}},\"variables\":{},\"resources\":[{\"type\":\"Microsoft.Logic/workflows/providers/diagnosticSettings\",\"apiVersion\":\"2017-05-01-preview\",\"name\":\"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\"location\":\"[parameters('location')]\",\"dependsOn\":[],\"properties\":{\"workspaceId\":\"[parameters('logAnalytics')]\",\"metrics\":[{\"category\":\"AllMetrics\",\"enabled\":\"[parameters('metricsEnabled')]\",\"retentionPolicy\":{\"enabled\":false,\"days\":0}}],\"logs\":[{\"category\":\"WorkflowRuntime\",\"enabled\":\"[parameters('logsEnabled')]\"}]}}],\"outputs\":{}},\"parameters\":{\"location\":{\"value\":\"[field('location')]\"},\"resourceName\":{\"value\":\"[field('name')]\"},\"logAnalytics\":{\"value\":\"[parameters('logAnalytics')]\"},\"metricsEnabled\":{\"value\":\"[parameters('metricsEnabled')]\"},\"logsEnabled\":{\"value\":\"[parameters('logsEnabled')]\"},\"profileName\":{\"value\":\"[parameters('profileName')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/b889a06c-ec72-4b03-910a-cb169ee18721\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"b889a06c-ec72-4b03-910a-cb169ee18721\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'Security Options - Recovery console'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Recovery console'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsRecoveryconsole\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/ba12366f-f9a6-42b8-9d98-157d0b1a837b\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"ba12366f-f9a6-42b8-9d98-157d0b1a837b\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'Security Options - Microsoft Network Client'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Microsoft Network Client'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"MicrosoftNetworkClientDigitallySignCommunicationsAlways\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Microsoft network client: Digitally sign communications (always)\",\"description\":\"Specifies whether packet signing is required by the SMB client component.\"}},\"MicrosoftNetworkClientSendUnencryptedPasswordToThirdpartySMBServers\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Microsoft network client: Send unencrypted password to third-party SMB servers\",\"description\":\"Specifies whether the SMB redirector will send plaintext passwords during authentication to third-party SMB servers that do not support password encryption. It is recommended that you disable this policy setting unless there is a strong business case to enable it.\"}},\"MicrosoftNetworkServerAmountOfIdleTimeRequiredBeforeSuspendingSession\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Microsoft network server: Amount of idle time required before suspending session\",\"description\":\"Specifies the amount of continuous idle time that must pass in an SMB session before the session is suspended because of inactivity. The format of the value is two integers separated by a comma, denoting an inclusive range.\"}},\"MicrosoftNetworkServerDigitallySignCommunicationsAlways\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Microsoft network server: Digitally sign communications (always)\",\"description\":\"Specifies whether packet signing is required by the SMB server component.\"}},\"MicrosoftNetworkServerDisconnectClientsWhenLogonHoursExpire\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Microsoft network server: Disconnect clients when logon hours expire\",\"description\":\"Specifies whether to disconnect users who are connected to the local computer outside their user account's valid logon hours. This setting affects the Server Message Block (SMB) component. If you enable this policy setting you should also enable 'Network security: Force logoff when logon hours expire'\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsMicrosoftNetworkClient\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('Microsoft network client: Digitally sign communications (always);ExpectedValue', '=', parameters('MicrosoftNetworkClientDigitallySignCommunicationsAlways'), ',', 'Microsoft network client: Send unencrypted password to third-party SMB servers;ExpectedValue', '=', parameters('MicrosoftNetworkClientSendUnencryptedPasswordToThirdpartySMBServers'), ',', 'Microsoft network server: Amount of idle time required before suspending session;ExpectedValue', '=', parameters('MicrosoftNetworkServerAmountOfIdleTimeRequiredBeforeSuspendingSession'), ',', 'Microsoft network server: Digitally sign communications (always);ExpectedValue', '=', parameters('MicrosoftNetworkServerDigitallySignCommunicationsAlways'), ',', 'Microsoft network server: Disconnect clients when logon hours expire;ExpectedValue', '=', parameters('MicrosoftNetworkServerDisconnectClientsWhenLogonHoursExpire')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_SecurityOptionsMicrosoftNetworkClient\"},\"MicrosoftNetworkClientDigitallySignCommunicationsAlways\":{\"value\":\"[parameters('MicrosoftNetworkClientDigitallySignCommunicationsAlways')]\"},\"MicrosoftNetworkClientSendUnencryptedPasswordToThirdpartySMBServers\":{\"value\":\"[parameters('MicrosoftNetworkClientSendUnencryptedPasswordToThirdpartySMBServers')]\"},\"MicrosoftNetworkServerAmountOfIdleTimeRequiredBeforeSuspendingSession\":{\"value\":\"[parameters('MicrosoftNetworkServerAmountOfIdleTimeRequiredBeforeSuspendingSession')]\"},\"MicrosoftNetworkServerDigitallySignCommunicationsAlways\":{\"value\":\"[parameters('MicrosoftNetworkServerDigitallySignCommunicationsAlways')]\"},\"MicrosoftNetworkServerDisconnectClientsWhenLogonHoursExpire\":{\"value\":\"[parameters('MicrosoftNetworkServerDisconnectClientsWhenLogonHoursExpire')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"MicrosoftNetworkClientDigitallySignCommunicationsAlways\":{\"type\":\"string\"},\"MicrosoftNetworkClientSendUnencryptedPasswordToThirdpartySMBServers\":{\"type\":\"string\"},\"MicrosoftNetworkServerAmountOfIdleTimeRequiredBeforeSuspendingSession\":{\"type\":\"string\"},\"MicrosoftNetworkServerDigitallySignCommunicationsAlways\":{\"type\":\"string\"},\"MicrosoftNetworkServerDisconnectClientsWhenLogonHoursExpire\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"Microsoft network client: Digitally sign communications (always);ExpectedValue\",\"value\":\"[parameters('MicrosoftNetworkClientDigitallySignCommunicationsAlways')]\"},{\"name\":\"Microsoft network client: Send unencrypted password to third-party SMB servers;ExpectedValue\",\"value\":\"[parameters('MicrosoftNetworkClientSendUnencryptedPasswordToThirdpartySMBServers')]\"},{\"name\":\"Microsoft network server: Amount of idle time required before suspending session;ExpectedValue\",\"value\":\"[parameters('MicrosoftNetworkServerAmountOfIdleTimeRequiredBeforeSuspendingSession')]\"},{\"name\":\"Microsoft network server: Digitally sign communications (always);ExpectedValue\",\"value\":\"[parameters('MicrosoftNetworkServerDigitallySignCommunicationsAlways')]\"},{\"name\":\"Microsoft network server: Disconnect clients when logon hours expire;ExpectedValue\",\"value\":\"[parameters('MicrosoftNetworkServerDisconnectClientsWhenLogonHoursExpire')]\"}]}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/bbcdd8fa-b600-4ee3-85b8-d184e3339652\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"bbcdd8fa-b600-4ee3-85b8-d184e3339652\"},{\"properties\":{\"displayName\":\"[Deprecated]: Audit API Applications that are not using latest supported Python Framework\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Use the latest supported Python version for the latest security classes. Using older classes and types can make your application vulnerable.\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true,\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"microsoft.Web/sites\"},{\"anyOf\":[{\"field\":\"kind\",\"equals\":\"api\"},{\"field\":\"kind\",\"equals\":\"apiApp\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"UseLatestPython\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/bc0378bb-d7ab-4614-a0f6-5a6e3f02d644\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"bc0378bb-d7ab-4614-a0f6-5a6e3f02d644\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'System Audit Policies - Account Logon'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'System Audit Policies - Account Logon'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SystemAuditPoliciesAccountLogon\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/bc87d811-4a9b-47cc-ae54-0a41abda7768\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"bc87d811-4a9b-47cc-ae54-0a41abda7768\"},{\"properties\":{\"displayName\":\"[Preview]: IP Forwarding on your virtual machine should be disabled\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Enabling IP forwarding on a virtual machine's NIC allows the machine to receive traffic addressed to other destinations. IP forwarding is rarely required (e.g., when using the VM as a network virtual appliance), and therefore, this should be reviewed by the network security team.\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"in\":[\"Microsoft.Compute/virtualMachines\",\"Microsoft.ClassicCompute/virtualMachines\"]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"disableIPForwarding\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"Monitored\",\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/bd352bd5-2853-4985-bf0d-73806b4a5744\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"bd352bd5-2853-4985-bf0d-73806b4a5744\"},{\"properties\":{\"displayName\":\"Advanced Threat Protection types should be set to 'All' in SQL managed instance Advanced Data Security settings\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"It is recommended to enable all Advanced Threat Protection types on your SQL servers. Enabling all types protects against SQL injection, database vulnerabilities, and any other anomalous activities.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Sql/managedInstances\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Sql/managedInstances/securityAlertPolicies\",\"name\":\"default\",\"existenceCondition\":{\"field\":\"Microsoft.Sql/managedInstances/securityAlertPolicies/disabledAlerts[*]\",\"equals\":\"\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/bda18df3-5e41-4709-add9-2554ce68c966\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"bda18df3-5e41-4709-add9-2554ce68c966\"},{\"properties\":{\"displayName\":\"Show audit results from Windows VMs in which the Administrators group contains any of the specified members\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines in which the Administrators group contains any of the specified members. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AdministratorsGroupMembersToExclude\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/bde62c94-ccca-4821-a815-92c1d31a76de\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"bde62c94-ccca-4821-a815-92c1d31a76de\"},{\"properties\":{\"displayName\":\"[Deprecated]: Audit Web Applications that are not using latest supported Java Framework\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Use the latest supported Java version for the latest security classes. Using older classes and types can make your application vulnerable.\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true,\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"microsoft.Web/sites\"},{\"anyOf\":[{\"field\":\"kind\",\"equals\":\"app\"},{\"field\":\"kind\",\"equals\":\"WebApp\"},{\"field\":\"kind\",\"equals\":\"app,linux\"},{\"field\":\"kind\",\"equals\":\"app,linux,container\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"UseLatestJava\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/be0a7681-bed4-48dc-9ff3-f0171ee170b6\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"be0a7681-bed4-48dc-9ff3-f0171ee170b6\"},{\"properties\":{\"displayName\":\"Deploy Diagnostic Settings for Key Vault to Log Analytics workspace\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploys the diagnostic settings for Key Vault to stream to a regional Log Analytics workspace when any Key Vault which is missing this diagnostic settings is created or updated.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"DeployIfNotExists\",\"Disabled\"]},\"profileName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Profile name\",\"description\":\"The diagnostic settings profile name\"}},\"logAnalytics\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Log Analytics workspace\",\"description\":\"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\"strongType\":\"omsWorkspace\",\"assignPermissions\":true}},\"metricsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable metrics\",\"description\":\"Whether to enable metrics stream to the Event Hub - True or False\"},\"allowedValues\":[\"True\",\"False\"]},\"logsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable logs\",\"description\":\"Whether to enable logs stream to the Event Hub  - True or False\"},\"allowedValues\":[\"True\",\"False\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.KeyVault/vaults\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"name\":\"[parameters('profileName')]\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"[parameters('logsEnabled')]\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\"equals\":\"[parameters('metricsEnabled')]\"}]},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa\",\"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"resourceName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"logAnalytics\":{\"type\":\"string\"},\"metricsEnabled\":{\"type\":\"string\"},\"logsEnabled\":{\"type\":\"string\"},\"profileName\":{\"type\":\"string\"}},\"variables\":{},\"resources\":[{\"type\":\"Microsoft.KeyVault/vaults/providers/diagnosticSettings\",\"apiVersion\":\"2017-05-01-preview\",\"name\":\"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\"location\":\"[parameters('location')]\",\"dependsOn\":[],\"properties\":{\"workspaceId\":\"[parameters('logAnalytics')]\",\"metrics\":[{\"category\":\"AllMetrics\",\"enabled\":\"[parameters('metricsEnabled')]\",\"retentionPolicy\":{\"enabled\":false,\"days\":0}}],\"logs\":[{\"category\":\"AuditEvent\",\"enabled\":\"[parameters('logsEnabled')]\"}]}}],\"outputs\":{}},\"parameters\":{\"location\":{\"value\":\"[field('location')]\"},\"resourceName\":{\"value\":\"[field('name')]\"},\"logAnalytics\":{\"value\":\"[parameters('logAnalytics')]\"},\"metricsEnabled\":{\"value\":\"[parameters('metricsEnabled')]\"},\"logsEnabled\":{\"value\":\"[parameters('logsEnabled')]\"},\"profileName\":{\"value\":\"[parameters('profileName')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/bef3f64c-5290-43b7-85b0-9b254eef4c47\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"bef3f64c-5290-43b7-85b0-9b254eef4c47\"},{\"properties\":{\"displayName\":\"Geo-redundant storage should be enabled for Storage Accounts\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy audits any Storage Account with geo-redundant storage not enabled.\",\"metadata\":{\"category\":\"Storage\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Storage/storageAccounts\"},{\"not\":{\"field\":\"Microsoft.Storage/storageAccounts/sku.name\",\"in\":[\"Standard_GRS\",\"Standard_RAGRS\",\"Standard_GZRS\",\"Standard_RAGZRS\"]}}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/bf045164-79ba-4215-8f95-f8048dc1780b\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"bf045164-79ba-4215-8f95-f8048dc1780b\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'System Audit Policies - Logon-Logoff'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'System Audit Policies - Logon-Logoff'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"AuditGroupMembership\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Audit Group Membership\",\"description\":\"Specifies whether audit events are generated when group memberships are enumerated on the client computer.\"},\"allowedValues\":[\"No Auditing\",\"Success\",\"Failure\",\"Success and Failure\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SystemAuditPoliciesLogonLogoff\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('Audit Group Membership;ExpectedValue', '=', parameters('AuditGroupMembership')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_SystemAuditPoliciesLogonLogoff\"},\"AuditGroupMembership\":{\"value\":\"[parameters('AuditGroupMembership')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"AuditGroupMembership\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"Audit Group Membership;ExpectedValue\",\"value\":\"[parameters('AuditGroupMembership')]\"}]}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/c04255ee-1b9f-42c1-abaa-bf1553f79930\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"c04255ee-1b9f-42c1-abaa-bf1553f79930\"},{\"properties\":{\"displayName\":\"Only approved VM extensions should be installed\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy governs the virtual machine extensions that are not approved.\",\"metadata\":{\"category\":\"Compute\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"The effect determines what happens when the policy rule is evaluated to match\"},\"allowedValues\":[\"Audit\",\"Deny\",\"Disabled\"]},\"approvedExtensions\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of approved extension types that can be installed. Example: AzureDiskEncryption\",\"displayName\":\"Approved extensions\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines/extensions\"},{\"field\":\"Microsoft.Compute/virtualMachines/extensions/type\",\"notIn\":\"[parameters('approvedExtensions')]\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/c0e996f8-39cf-4af9-9f45-83fbde810432\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"c0e996f8-39cf-4af9-9f45-83fbde810432\"},{\"properties\":{\"displayName\":\"Deploy associations for a custom provider\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploys an association resource that associates selected resource types to the specified custom provider. This policy deployment does not support nested resource types.\",\"metadata\":{\"category\":\"Custom Provider\"},\"parameters\":{\"targetCustomProviderId\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Custom provider Id\",\"description\":\"Resource ID of the Custom provider to which resources need to be associated.\"}},\"resourceTypesToAssociate\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"Resource types to associate\",\"description\":\"The list of resource types to be associated to the custom provider.\",\"strongType\":\"resourceTypes\"}},\"associationNamePrefix\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Association name prefix\",\"description\":\"Prefix to be added to the name of the association resource being created.\"}}},\"policyRule\":{\"if\":{\"field\":\"type\",\"in\":\"[parameters('resourceTypesToAssociate')]\"},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.CustomProviders/Associations\",\"name\":\"[concat(parameters('associationNamePrefix'), '-', uniqueString(parameters('targetCustomProviderId')))]\",\"roleDefinitionIds\":[\"/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"associatedResourceName\":{\"type\":\"string\"},\"resourceTypesToAssociate\":{\"type\":\"string\"},\"targetCustomProviderId\":{\"type\":\"string\"},\"associationNamePrefix\":{\"type\":\"string\"}},\"variables\":{\"resourceType\":\"[concat(parameters('resourceTypesToAssociate'), '/providers/associations')]\",\"resourceName\":\"[concat(parameters('associatedResourceName'), '/microsoft.customproviders/', parameters('associationNamePrefix'), '-', uniqueString(parameters('targetCustomProviderId')))]\"},\"resources\":[{\"type\":\"Microsoft.Resources/deployments\",\"apiVersion\":\"2017-05-10\",\"name\":\"[concat(deployment().Name, '-2')]\",\"properties\":{\"mode\":\"Incremental\",\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"resources\":[{\"type\":\"[variables('resourceType')]\",\"name\":\"[variables('resourceName')]\",\"apiVersion\":\"2018-09-01-preview\",\"properties\":{\"targetResourceId\":\"[parameters('targetCustomProviderId')]\"}}]}}}]},\"parameters\":{\"resourceTypesToAssociate\":{\"value\":\"[field('type')]\"},\"associatedResourceName\":{\"value\":\"[field('name')]\"},\"targetCustomProviderId\":{\"value\":\"[parameters('targetCustomProviderId')]\"},\"associationNamePrefix\":{\"value\":\"[parameters('associationNamePrefix')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/c15c281f-ea5c-44cd-90b8-fc3c14d13f0c\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"c15c281f-ea5c-44cd-90b8-fc3c14d13f0c\"},{\"properties\":{\"displayName\":\"[Deprecated]: Allow resource creation only in Asia data centers\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Allows resource creation in the following locations only: East Asia, Southeast Asia, West India, South India, Central India, Japan East, Japan West\",\"metadata\":{\"category\":\"General\",\"deprecated\":true},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"eastasia\",\"southeastasia\",\"westindia\",\"southindia\",\"centralindia\",\"japaneast\",\"japanwest\"]}},\"then\":{\"effect\":\"Deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/c1b9cbed-08e3-427d-b9ce-7c535b1e9b94\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"c1b9cbed-08e3-427d-b9ce-7c535b1e9b94\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'System Audit Policies - Account Logon'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'System Audit Policies - Account Logon'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"AuditCredentialValidation\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Audit Credential Validation\",\"description\":\"Specifies whether audit events are generated when credentials are submitted for a user account logon request.  This setting is especially useful for monitoring unsuccessful attempts, to find brute-force attacks, account enumeration, and potential account compromise events on domain controllers.\"},\"allowedValues\":[\"No Auditing\",\"Success\",\"Failure\",\"Success and Failure\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SystemAuditPoliciesAccountLogon\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('Audit Credential Validation;ExpectedValue', '=', parameters('AuditCredentialValidation')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_SystemAuditPoliciesAccountLogon\"},\"AuditCredentialValidation\":{\"value\":\"[parameters('AuditCredentialValidation')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"AuditCredentialValidation\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"Audit Credential Validation;ExpectedValue\",\"value\":\"[parameters('AuditCredentialValidation')]\"}]}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/c1e289c0-ffad-475d-a924-adc058765d65\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"c1e289c0-ffad-475d-a924-adc058765d65\"},{\"properties\":{\"displayName\":\"Deploy prerequisites to audit Windows VMs that are not set to the specified time zone\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines that are not set to the specified time zone. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"TimeZone\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Time zone\",\"description\":\"The expected time zone\"},\"allowedValues\":[\"(UTC-12:00) International Date Line West\",\"(UTC-11:00) Coordinated Universal Time-11\",\"(UTC-10:00) Aleutian Islands\",\"(UTC-10:00) Hawaii\",\"(UTC-09:30) Marquesas Islands\",\"(UTC-09:00) Alaska\",\"(UTC-09:00) Coordinated Universal Time-09\",\"(UTC-08:00) Baja California\",\"(UTC-08:00) Coordinated Universal Time-08\",\"(UTC-08:00) Pacific Time (US & Canada)\",\"(UTC-07:00) Arizona\",\"(UTC-07:00) Chihuahua, La Paz, Mazatlan\",\"(UTC-07:00) Mountain Time (US & Canada)\",\"(UTC-06:00) Central America\",\"(UTC-06:00) Central Time (US & Canada)\",\"(UTC-06:00) Easter Island\",\"(UTC-06:00) Guadalajara, Mexico City, Monterrey\",\"(UTC-06:00) Saskatchewan\",\"(UTC-05:00) Bogota, Lima, Quito, Rio Branco\",\"(UTC-05:00) Chetumal\",\"(UTC-05:00) Eastern Time (US & Canada)\",\"(UTC-05:00) Haiti\",\"(UTC-05:00) Havana\",\"(UTC-05:00) Indiana (East)\",\"(UTC-05:00) Turks and Caicos\",\"(UTC-04:00) Asuncion\",\"(UTC-04:00) Atlantic Time (Canada)\",\"(UTC-04:00) Caracas\",\"(UTC-04:00) Cuiaba\",\"(UTC-04:00) Georgetown, La Paz, Manaus, San Juan\",\"(UTC-04:00) Santiago\",\"(UTC-03:30) Newfoundland\",\"(UTC-03:00) Araguaina\",\"(UTC-03:00) Brasilia\",\"(UTC-03:00) Cayenne, Fortaleza\",\"(UTC-03:00) City of Buenos Aires\",\"(UTC-03:00) Greenland\",\"(UTC-03:00) Montevideo\",\"(UTC-03:00) Punta Arenas\",\"(UTC-03:00) Saint Pierre and Miquelon\",\"(UTC-03:00) Salvador\",\"(UTC-02:00) Coordinated Universal Time-02\",\"(UTC-02:00) Mid-Atlantic - Old\",\"(UTC-01:00) Azores\",\"(UTC-01:00) Cabo Verde Is.\",\"(UTC) Coordinated Universal Time\",\"(UTC+00:00) Dublin, Edinburgh, Lisbon, London\",\"(UTC+00:00) Monrovia, Reykjavik\",\"(UTC+00:00) Sao Tome\",\"(UTC+01:00) Casablanca\",\"(UTC+01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna\",\"(UTC+01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague\",\"(UTC+01:00) Brussels, Copenhagen, Madrid, Paris\",\"(UTC+01:00) Sarajevo, Skopje, Warsaw, Zagreb\",\"(UTC+01:00) West Central Africa\",\"(UTC+02:00) Amman\",\"(UTC+02:00) Athens, Bucharest\",\"(UTC+02:00) Beirut\",\"(UTC+02:00) Cairo\",\"(UTC+02:00) Chisinau\",\"(UTC+02:00) Damascus\",\"(UTC+02:00) Gaza, Hebron\",\"(UTC+02:00) Harare, Pretoria\",\"(UTC+02:00) Helsinki, Kyiv, Riga, Sofia, Tallinn, Vilnius\",\"(UTC+02:00) Jerusalem\",\"(UTC+02:00) Kaliningrad\",\"(UTC+02:00) Khartoum\",\"(UTC+02:00) Tripoli\",\"(UTC+02:00) Windhoek\",\"(UTC+03:00) Baghdad\",\"(UTC+03:00) Istanbul\",\"(UTC+03:00) Kuwait, Riyadh\",\"(UTC+03:00) Minsk\",\"(UTC+03:00) Moscow, St. Petersburg\",\"(UTC+03:00) Nairobi\",\"(UTC+03:30) Tehran\",\"(UTC+04:00) Abu Dhabi, Muscat\",\"(UTC+04:00) Astrakhan, Ulyanovsk\",\"(UTC+04:00) Baku\",\"(UTC+04:00) Izhevsk, Samara\",\"(UTC+04:00) Port Louis\",\"(UTC+04:00) Saratov\",\"(UTC+04:00) Tbilisi\",\"(UTC+04:00) Volgograd\",\"(UTC+04:00) Yerevan\",\"(UTC+04:30) Kabul\",\"(UTC+05:00) Ashgabat, Tashkent\",\"(UTC+05:00) Ekaterinburg\",\"(UTC+05:00) Islamabad, Karachi\",\"(UTC+05:00) Qyzylorda\",\"(UTC+05:30) Chennai, Kolkata, Mumbai, New Delhi\",\"(UTC+05:30) Sri Jayawardenepura\",\"(UTC+05:45) Kathmandu\",\"(UTC+06:00) Astana\",\"(UTC+06:00) Dhaka\",\"(UTC+06:00) Omsk\",\"(UTC+06:30) Yangon (Rangoon)\",\"(UTC+07:00) Bangkok, Hanoi, Jakarta\",\"(UTC+07:00) Barnaul, Gorno-Altaysk\",\"(UTC+07:00) Hovd\",\"(UTC+07:00) Krasnoyarsk\",\"(UTC+07:00) Novosibirsk\",\"(UTC+07:00) Tomsk\",\"(UTC+08:00) Beijing, Chongqing, Hong Kong, Urumqi\",\"(UTC+08:00) Irkutsk\",\"(UTC+08:00) Kuala Lumpur, Singapore\",\"(UTC+08:00) Perth\",\"(UTC+08:00) Taipei\",\"(UTC+08:00) Ulaanbaatar\",\"(UTC+08:45) Eucla\",\"(UTC+09:00) Chita\",\"(UTC+09:00) Osaka, Sapporo, Tokyo\",\"(UTC+09:00) Pyongyang\",\"(UTC+09:00) Seoul\",\"(UTC+09:00) Yakutsk\",\"(UTC+09:30) Adelaide\",\"(UTC+09:30) Darwin\",\"(UTC+10:00) Brisbane\",\"(UTC+10:00) Canberra, Melbourne, Sydney\",\"(UTC+10:00) Guam, Port Moresby\",\"(UTC+10:00) Hobart\",\"(UTC+10:00) Vladivostok\",\"(UTC+10:30) Lord Howe Island\",\"(UTC+11:00) Bougainville Island\",\"(UTC+11:00) Chokurdakh\",\"(UTC+11:00) Magadan\",\"(UTC+11:00) Norfolk Island\",\"(UTC+11:00) Sakhalin\",\"(UTC+11:00) Solomon Is., New Caledonia\",\"(UTC+12:00) Anadyr, Petropavlovsk-Kamchatsky\",\"(UTC+12:00) Auckland, Wellington\",\"(UTC+12:00) Coordinated Universal Time+12\",\"(UTC+12:00) Fiji\",\"(UTC+12:00) Petropavlovsk-Kamchatsky - Old\",\"(UTC+12:45) Chatham Islands\",\"(UTC+13:00) Coordinated Universal Time+13\",\"(UTC+13:00) Nuku'alofa\",\"(UTC+13:00) Samoa\",\"(UTC+14:00) Kiritimati Island\"]}},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WindowsTimeZone\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('[WindowsTimeZone]WindowsTimeZone1;TimeZone', '=', parameters('TimeZone')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"WindowsTimeZone\"},\"TimeZone\":{\"value\":\"[parameters('TimeZone')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"TimeZone\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[WindowsTimeZone]WindowsTimeZone1;TimeZone\",\"value\":\"[parameters('TimeZone')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[WindowsTimeZone]WindowsTimeZone1;TimeZone\",\"value\":\"[parameters('TimeZone')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/c21f7060-c148-41cf-a68b-0ab3e14c764c\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"c21f7060-c148-41cf-a68b-0ab3e14c764c\"},{\"properties\":{\"displayName\":\"Show audit results from Windows VMs on which the specified services are not installed and 'Running'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines on which the specified services are not installed and 'Running'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WindowsServiceStatus\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/c2dd2a9a-8a20-4a9c-b8d6-f17ccc26939a\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"c2dd2a9a-8a20-4a9c-b8d6-f17ccc26939a\"},{\"properties\":{\"displayName\":\"Ensure that '.Net Framework' version is the latest, if used as a part of the API app\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Periodically, newer versions are released for .Net Framework software either due to security flaws or to include additional functionality. Using the latest .Net framework version for web apps is recommended in order to to take advantage of security fixes, if any, and/or new functionalities of the latest version.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"*api\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/web.netFrameworkVersion\",\"in\":[\"v3.0\",\"v4.0\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/c2e7ca55-f62c-49b2-89a4-d41eb661d2f0\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"c2e7ca55-f62c-49b2-89a4-d41eb661d2f0\"},{\"properties\":{\"displayName\":\"System updates on virtual machine scale sets should be installed\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit whether there are any missing system security updates and critical updates that should be installed to ensure that your Windows and Linux virtual machine scale sets are secure.\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachineScaleSets\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"SystemUpdates\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/c3f317a7-a95c-4547-b7e7-11017ebdf2fe\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"c3f317a7-a95c-4547-b7e7-11017ebdf2fe\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Linux VMs that have accounts without passwords\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Linux virtual machines that have accounts without passwords. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"microsoft-aks\",\"AzureDatabricks\",\"qubole-inc\",\"datastax\",\"couchbase\",\"scalegrid\",\"checkpoint\",\"paloaltonetworks\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"OpenLogic\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"CentOS*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"RHEL\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"osa\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"credativ\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Debian\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"7*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Suse\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"SLES*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"11*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Canonical\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"UbuntuServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"12*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"linux-data-science-vm-ubuntu\",\"azureml\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-centos-os\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-altus-centos-os\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"linux*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"linux*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"PasswordPolicy_msid232\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/c40c9087-1981-4e73-9f53-39743eda9d05\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"c40c9087-1981-4e73-9f53-39743eda9d05\"},{\"properties\":{\"displayName\":\"Microsoft Antimalware for Azure should be configured to automatically update protection signatures\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy audits any Windows virtual machine not configured with automatic update of Microsoft Antimalware protection signatures.\",\"metadata\":{\"category\":\"Compute\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"field\":\"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\"equals\":\"Windows\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Compute/virtualMachines/extensions/type\",\"equals\":\"IaaSAntimalware\"},{\"field\":\"Microsoft.Compute/virtualMachines/extensions/publisher\",\"equals\":\"Microsoft.Azure.Security\"},{\"field\":\"Microsoft.Compute/virtualMachines/extensions/autoUpgradeMinorVersion\",\"equals\":\"true\"}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/c43e4a30-77cb-48ab-a4dd-93f175c63b57\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"c43e4a30-77cb-48ab-a4dd-93f175c63b57\"},{\"properties\":{\"displayName\":\"[Preview]: Container Registry should use a virtual network service endpoint\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy audits any Container Registry not configured to use a virtual network service endpoint.\",\"metadata\":{\"category\":\"Network\",\"preview\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.ContainerRegistry/registries\"},{\"anyOf\":[{\"field\":\"Microsoft.ContainerRegistry/registries/networkRuleSet.defaultAction\",\"notEquals\":\"Deny\"},{\"field\":\"Microsoft.ContainerRegistry/registries/networkRuleSet.virtualNetworkRules[*].action\",\"exists\":\"false\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/c4857be7-912a-4c75-87e6-e30292bcdf78\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"c4857be7-912a-4c75-87e6-e30292bcdf78\"},{\"properties\":{\"displayName\":\"Managed identity should be used in your API App\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Use a managed identity for enhanced authentication security\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"*api\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/managedServiceIdentityId\",\"exists\":\"true\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/c4d441f8-f9d9-4a9e-9cef-e82117cb3eef\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"c4d441f8-f9d9-4a9e-9cef-e82117cb3eef\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy prerequisites to audit Windows VMs that contain certificates expiring within the specified number of days\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines that contain certificates expiring within the specified number of days. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"CertificateStorePath\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Certificate store path\",\"description\":\"The path to the certificate store containing the certificates to check the expiration dates of. Default value is 'Cert:' which is the root certificate store path, so all certificates on the machine will be checked. Other example paths: 'Cert:\\\\LocalMachine', 'Cert:\\\\LocalMachine\\\\TrustedPublisher', 'Cert:\\\\CurrentUser'\"}},\"ExpirationLimitInDays\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Expiration limit in days\",\"description\":\"An integer indicating the number of days within which to check for certificates that are expiring. For example, if this value is 30, any certificate expiring within the next 30 days will cause this policy to be non-compliant.\"}},\"CertificateThumbprintsToInclude\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Certificate thumbprints to include\",\"description\":\"A semicolon-separated list of certificate thumbprints to check under the specified path. If a value is not specified, all certificates under the certificate store path will be checked. If a value is specified, no certificates other than those with the thumbprints specified will be checked. e.g. THUMBPRINT1;THUMBPRINT2;THUMBPRINT3\"}},\"CertificateThumbprintsToExclude\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Certificate thumbprints to exclude\",\"description\":\"A semicolon-separated list of certificate thumbprints to ignore. e.g. THUMBPRINT1;THUMBPRINT2;THUMBPRINT3\"}},\"IncludeExpiredCertificates\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Include expired certificates\",\"description\":\"Must be 'true' or 'false'. True indicates that any found certificates that have already expired will also make this policy non-compliant. False indicates that certificates that have expired will be be ignored.\"},\"allowedValues\":[\"true\",\"false\"]}},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"CertificateExpiration\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('[CertificateStore]CertificateStore1;CertificateStorePath', '=', parameters('CertificateStorePath'), ',', '[CertificateStore]CertificateStore1;ExpirationLimitInDays', '=', parameters('ExpirationLimitInDays'), ',', '[CertificateStore]CertificateStore1;CertificateThumbprintsToInclude', '=', parameters('CertificateThumbprintsToInclude'), ',', '[CertificateStore]CertificateStore1;CertificateThumbprintsToExclude', '=', parameters('CertificateThumbprintsToExclude'), ',', '[CertificateStore]CertificateStore1;IncludeExpiredCertificates', '=', parameters('IncludeExpiredCertificates')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"CertificateExpiration\"},\"CertificateStorePath\":{\"value\":\"[parameters('CertificateStorePath')]\"},\"ExpirationLimitInDays\":{\"value\":\"[parameters('ExpirationLimitInDays')]\"},\"CertificateThumbprintsToInclude\":{\"value\":\"[parameters('CertificateThumbprintsToInclude')]\"},\"CertificateThumbprintsToExclude\":{\"value\":\"[parameters('CertificateThumbprintsToExclude')]\"},\"IncludeExpiredCertificates\":{\"value\":\"[parameters('IncludeExpiredCertificates')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"CertificateStorePath\":{\"type\":\"string\"},\"ExpirationLimitInDays\":{\"type\":\"string\"},\"CertificateThumbprintsToInclude\":{\"type\":\"string\"},\"CertificateThumbprintsToExclude\":{\"type\":\"string\"},\"IncludeExpiredCertificates\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[CertificateStore]CertificateStore1;CertificateStorePath\",\"value\":\"[parameters('CertificateStorePath')]\"},{\"name\":\"[CertificateStore]CertificateStore1;ExpirationLimitInDays\",\"value\":\"[parameters('ExpirationLimitInDays')]\"},{\"name\":\"[CertificateStore]CertificateStore1;CertificateThumbprintsToInclude\",\"value\":\"[parameters('CertificateThumbprintsToInclude')]\"},{\"name\":\"[CertificateStore]CertificateStore1;CertificateThumbprintsToExclude\",\"value\":\"[parameters('CertificateThumbprintsToExclude')]\"},{\"name\":\"[CertificateStore]CertificateStore1;IncludeExpiredCertificates\",\"value\":\"[parameters('IncludeExpiredCertificates')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[CertificateStore]CertificateStore1;CertificateStorePath\",\"value\":\"[parameters('CertificateStorePath')]\"},{\"name\":\"[CertificateStore]CertificateStore1;ExpirationLimitInDays\",\"value\":\"[parameters('ExpirationLimitInDays')]\"},{\"name\":\"[CertificateStore]CertificateStore1;CertificateThumbprintsToInclude\",\"value\":\"[parameters('CertificateThumbprintsToInclude')]\"},{\"name\":\"[CertificateStore]CertificateStore1;CertificateThumbprintsToExclude\",\"value\":\"[parameters('CertificateThumbprintsToExclude')]\"},{\"name\":\"[CertificateStore]CertificateStore1;IncludeExpiredCertificates\",\"value\":\"[parameters('IncludeExpiredCertificates')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/c5fbc59e-fb6f-494f-81e2-d99a671bdaa8\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"c5fbc59e-fb6f-494f-81e2-d99a671bdaa8\"},{\"properties\":{\"displayName\":\"Email notifications to admins and subscription owners should be enabled in SQL server advanced data security settings\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit that 'email notification to admins and subscription owners' is enabled in the SQL server advanced threat protection settings. This ensures that any detections of anomalous activities on SQL server are reported as soon as possible to the admins.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Sql/servers\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Sql/servers/securityAlertPolicies\",\"name\":\"default\",\"existenceCondition\":{\"field\":\"Microsoft.Sql/servers/securityAlertPolicies/emailAccountAdmins\",\"equals\":\"true\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/c8343d2f-fdc9-4a97-b76f-fc71d1163bfc\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"c8343d2f-fdc9-4a97-b76f-fc71d1163bfc\"},{\"properties\":{\"displayName\":\"Deploy Diagnostic Settings for Batch Account to Log Analytics workspace\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploys the diagnostic settings for Batch Account to stream to a regional Log Analytics workspace when any Batch Account which is missing this diagnostic settings is created or updated.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"DeployIfNotExists\",\"Disabled\"]},\"profileName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Profile name\",\"description\":\"The diagnostic settings profile name\"}},\"logAnalytics\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Log Analytics workspace\",\"description\":\"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\"strongType\":\"omsWorkspace\",\"assignPermissions\":true}},\"metricsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable metrics\",\"description\":\"Whether to enable metrics stream to the Event Hub - True or False\"},\"allowedValues\":[\"True\",\"False\"]},\"logsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable logs\",\"description\":\"Whether to enable logs stream to the Event Hub  - True or False\"},\"allowedValues\":[\"True\",\"False\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Batch/batchAccounts\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"name\":\"[parameters('profileName')]\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"[parameters('logsEnabled')]\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\"equals\":\"[parameters('metricsEnabled')]\"}]},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa\",\"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"resourceName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"logAnalytics\":{\"type\":\"string\"},\"metricsEnabled\":{\"type\":\"string\"},\"logsEnabled\":{\"type\":\"string\"},\"profileName\":{\"type\":\"string\"}},\"variables\":{},\"resources\":[{\"type\":\"Microsoft.Batch/batchAccounts/providers/diagnosticSettings\",\"apiVersion\":\"2017-05-01-preview\",\"name\":\"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\"location\":\"[parameters('location')]\",\"dependsOn\":[],\"properties\":{\"workspaceId\":\"[parameters('logAnalytics')]\",\"metrics\":[{\"category\":\"AllMetrics\",\"enabled\":\"[parameters('metricsEnabled')]\",\"retentionPolicy\":{\"enabled\":false,\"days\":0}}],\"logs\":[{\"category\":\"ServiceLog\",\"enabled\":\"[parameters('logsEnabled')]\"}]}}],\"outputs\":{}},\"parameters\":{\"location\":{\"value\":\"[field('location')]\"},\"resourceName\":{\"value\":\"[field('name')]\"},\"logAnalytics\":{\"value\":\"[parameters('logAnalytics')]\"},\"metricsEnabled\":{\"value\":\"[parameters('metricsEnabled')]\"},\"logsEnabled\":{\"value\":\"[parameters('logsEnabled')]\"},\"profileName\":{\"value\":\"[parameters('profileName')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/c84e5349-db6d-4769-805e-e14037dab9b5\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"c84e5349-db6d-4769-805e-e14037dab9b5\"},{\"properties\":{\"displayName\":\"[Deprecated]: API App should only be accessible over HTTPS\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Use of HTTPS ensures server/service authentication and protects data in transit from network layer eavesdropping attacks.\",\"metadata\":{\"category\":\"Security Center\",\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"microsoft.Web/sites\"},{\"anyOf\":[{\"field\":\"kind\",\"equals\":\"api\"},{\"field\":\"kind\",\"equals\":\"apiApp\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"OnlyHttpsForApiApp\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/c85538c1-b527-4ce4-bdb4-1dabcb3fd90d\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"c85538c1-b527-4ce4-bdb4-1dabcb3fd90d\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'Security Options - Interactive Logon'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Interactive Logon'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsInteractiveLogon\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/c8abcef9-fc26-482f-b8db-5fa60ee4586d\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"c8abcef9-fc26-482f-b8db-5fa60ee4586d\"},{\"properties\":{\"displayName\":\"Diagnostic logs in Data Lake Analytics should be enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit enabling of diagnostic logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised\",\"metadata\":{\"category\":\"Data Lake\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]},\"requiredRetentionDays\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Required retention (days)\",\"description\":\"The required diagnostic logs retention in days\"}}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.DataLakeAnalytics/accounts\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"existenceCondition\":{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\"equals\":\"true\"},{\"anyOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\"equals\":\"0\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\"equals\":\"[parameters('requiredRetentionDays')]\"}]},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"true\"}]},{\"allOf\":[{\"not\":{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\"equals\":\"true\"}},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"true\"}]}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/c95c74d9-38fe-4f0d-af86-0c7d626a315c\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"c95c74d9-38fe-4f0d-af86-0c7d626a315c\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'User Rights Assignment'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'User Rights Assignment'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_UserRightsAssignment\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/c961dac9-5916-42e8-8fb1-703148323994\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"c961dac9-5916-42e8-8fb1-703148323994\"},{\"properties\":{\"displayName\":\"Deploy prerequisites to audit Windows VMs with a pending reboot\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with a pending reboot. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WindowsPendingReboot\",\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"WindowsPendingReboot\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/c96f3246-4382-4264-bf6b-af0b35e23c3c\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"c96f3246-4382-4264-bf6b-af0b35e23c3c\"},{\"properties\":{\"displayName\":\"Deploy Diagnostic Settings for Network Security Groups\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy automatically deploys diagnostic settings to network security groups. A storage account with name '{storagePrefixParameter}{NSGLocation}' will be automatically created.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"storagePrefix\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Storage Account Prefix for Regional Storage Account\",\"description\":\"This prefix will be combined with the network security group location to form the created storage account name.\"}},\"rgName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Resource Group Name for Storage Account (must exist)\",\"description\":\"The resource group that the storage account will be created in. This resource group must already exist.\",\"strongType\":\"ExistingResourceGroups\"}}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Network/networkSecurityGroups\"},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"name\":\"setbypolicy\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa\",\"/providers/microsoft.authorization/roleDefinitions/17d1049b-9a84-46fb-8f53-869881c3d3ab\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"location\":{\"type\":\"string\"},\"storagePrefix\":{\"type\":\"string\"},\"nsgName\":{\"type\":\"string\"},\"rgName\":{\"type\":\"string\"}},\"variables\":{\"storageDeployName\":\"[concat('policyStorage_', uniqueString(parameters('location'), parameters('nsgName')))]\"},\"resources\":[{\"type\":\"Microsoft.Network/networkSecurityGroups/providers/diagnosticSettings\",\"name\":\"[concat(parameters('nsgName'),'/Microsoft.Insights/setbypolicy')]\",\"apiVersion\":\"2017-05-01-preview\",\"location\":\"[parameters('location')]\",\"dependsOn\":[\"[variables('storageDeployName')]\"],\"properties\":{\"storageAccountId\":\"[reference(variables('storageDeployName')).outputs.storageAccountId.value]\",\"logs\":[{\"category\":\"NetworkSecurityGroupEvent\",\"enabled\":true,\"retentionPolicy\":{\"enabled\":false,\"days\":0}},{\"category\":\"NetworkSecurityGroupRuleCounter\",\"enabled\":true,\"retentionPolicy\":{\"enabled\":false,\"days\":0}}]}},{\"apiVersion\":\"2017-05-10\",\"name\":\"[variables('storageDeployName')]\",\"type\":\"Microsoft.Resources/deployments\",\"resourceGroup\":\"[parameters('rgName')]\",\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"location\":{\"value\":\"[parameters('location')]\"},\"storagePrefix\":{\"value\":\"[parameters('storagePrefix')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"location\":{\"type\":\"string\"},\"storagePrefix\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2017-06-01\",\"type\":\"Microsoft.Storage/storageAccounts\",\"name\":\"[concat(parameters('storageprefix'), parameters('location'))]\",\"sku\":{\"name\":\"Standard_LRS\",\"tier\":\"Standard\"},\"kind\":\"Storage\",\"location\":\"[parameters('location')]\",\"tags\":{\"created-by\":\"policy\"},\"scale\":null,\"properties\":{\"networkAcls\":{\"bypass\":\"AzureServices\",\"defaultAction\":\"Allow\",\"ipRules\":[],\"virtualNetworkRules\":[]},\"supportsHttpsTrafficOnly\":true}}],\"outputs\":{\"storageAccountId\":{\"type\":\"string\",\"value\":\"[resourceId(parameters('rgName'), 'Microsoft.Storage/storageAccounts',concat(parameters('storagePrefix'), parameters('location')))]\"}}}}}]},\"parameters\":{\"location\":{\"value\":\"[field('location')]\"},\"storagePrefix\":{\"value\":\"[parameters('storagePrefix')]\"},\"rgName\":{\"value\":\"[parameters('rgName')]\"},\"nsgName\":{\"value\":\"[field('name')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/c9c29499-c1d1-4195-99bd-2ec9e3a9dc89\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"c9c29499-c1d1-4195-99bd-2ec9e3a9dc89\"},{\"properties\":{\"displayName\":\"Storage accounts should allow access from trusted Microsoft services\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Some Microsoft services that interact with storage accounts operate from networks that can't be granted access through network rules. To help this type of service work as intended, allow the set of trusted Microsoft services to bypass the network rules. These services will then use strong authentication to access the storage account.\",\"metadata\":{\"category\":\"Storage\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"The effect determines what happens when the policy rule is evaluated to match\"},\"allowedValues\":[\"Audit\",\"Deny\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Storage/storageAccounts\"},{\"field\":\"Microsoft.Storage/storageAccounts/networkAcls.bypass\",\"exists\":\"true\"},{\"field\":\"Microsoft.Storage/storageAccounts/networkAcls.bypass\",\"notContains\":\"AzureServices\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/c9d007d0-c057-4772-b18c-01e546713bcd\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"c9d007d0-c057-4772-b18c-01e546713bcd\"},{\"properties\":{\"displayName\":\"Remote debugging should be turned off for Web Applications\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Remote debugging requires inbound ports to be opened on a web application. Remote debugging should be turned off.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"app*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/web.remoteDebuggingEnabled\",\"equals\":\"false\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/cb510bfd-1cba-4d9f-a230-cb0976f4bb71\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"cb510bfd-1cba-4d9f-a230-cb0976f4bb71\"},{\"properties\":{\"displayName\":\"Show audit results from Windows VMs in which the Administrators group does not contain only the specified members\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines in which the Administrators group does not contain only the specified members. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AdministratorsGroupMembers\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/cc7cda28-f867-4311-8497-a526129a8d19\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"cc7cda28-f867-4311-8497-a526129a8d19\"},{\"properties\":{\"displayName\":\"[Preview]: Sensitive data in your SQL databases should be classified\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Azure Security Center monitors the data discovery and classification scan results for your SQL databases and provides recommendations to classify the sensitive data in your databases for better monitoring and security\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"in\":[\"Microsoft.Sql/servers/databases\",\"Microsoft.Sql/managedInstances/databases\"]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"sqlDataClassification\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/cc9835f2-9f6b-4cc8-ab4a-f8ef615eb349\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"cc9835f2-9f6b-4cc8-ab4a-f8ef615eb349\"},{\"properties\":{\"displayName\":\"Allowed virtual machine SKUs\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy enables you to specify a set of virtual machine SKUs that your organization can deploy.\",\"metadata\":{\"category\":\"Compute\"},\"parameters\":{\"listOfAllowedSKUs\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of SKUs that can be specified for virtual machines.\",\"displayName\":\"Allowed SKUs\",\"strongType\":\"VMSKUs\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"not\":{\"field\":\"Microsoft.Compute/virtualMachines/sku.name\",\"in\":\"[parameters('listOfAllowedSKUs')]\"}}]},\"then\":{\"effect\":\"Deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/cccc23c7-8427-4f53-ad12-b6a63eb452b3\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"cccc23c7-8427-4f53-ad12-b6a63eb452b3\"},{\"properties\":{\"displayName\":\"Inherit a tag from the resource group\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Adds or replaces the specified tag and value from the parent resource group when any resource is created or updated. Existing resources can be remediated by triggering a remediation task.\",\"metadata\":{\"category\":\"Tags\"},\"parameters\":{\"tagName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Tag Name\",\"description\":\"Name of the tag, such as 'environment'\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"[concat('tags[', parameters('tagName'), ']')]\",\"notEquals\":\"[resourceGroup().tags[parameters('tagName')]]\"},{\"value\":\"[resourceGroup().tags[parameters('tagName')]]\",\"notEquals\":\"\"}]},\"then\":{\"effect\":\"modify\",\"details\":{\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"operations\":[{\"operation\":\"addOrReplace\",\"field\":\"[concat('tags[', parameters('tagName'), ']')]\",\"value\":\"[resourceGroup().tags[parameters('tagName')]]\"}]}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/cd3aa116-8754-49c9-a813-ad46512ece54\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"cd3aa116-8754-49c9-a813-ad46512ece54\"},{\"properties\":{\"displayName\":\"[Deprecated]: Allow resource creation if 'department' tag set\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Allows resource creation only if the 'department' tag is set\",\"metadata\":{\"category\":\"Tags\",\"deprecated\":true},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"tags\",\"containsKey\":\"department\"}},\"then\":{\"effect\":\"Deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/cd8dc879-a2ae-43c3-8211-1877c5755064\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"cd8dc879-a2ae-43c3-8211-1877c5755064\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs that allow re-use of the previous 24 passwords\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines that allow re-use of the previous 24 passwords. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"EnforcePasswordHistory\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/cdbf72d9-ac9c-4026-8a3a-491a5ac59293\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"cdbf72d9-ac9c-4026-8a3a-491a5ac59293\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'System Audit Policies - Privilege Use'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'System Audit Policies - Privilege Use'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SystemAuditPoliciesPrivilegeUse\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_SystemAuditPoliciesPrivilegeUse\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/ce2370f6-0ac5-4d85-8ab4-10721cc640b0\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"ce2370f6-0ac5-4d85-8ab4-10721cc640b0\"},{\"properties\":{\"displayName\":\"Diagnostic logs in Key Vault should be enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit enabling of diagnostic logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised\",\"metadata\":{\"category\":\"Key Vault\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]},\"requiredRetentionDays\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Required retention (days)\",\"description\":\"The required diagnostic logs retention in days\"}}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.KeyVault/vaults\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"existenceCondition\":{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\"equals\":\"true\"},{\"anyOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\"equals\":\"0\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\"equals\":\"[parameters('requiredRetentionDays')]\"}]},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"true\"}]},{\"allOf\":[{\"not\":{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\"equals\":\"true\"}},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"true\"}]}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/cf820ca0-f99e-4f3e-84fb-66e913812d21\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"cf820ca0-f99e-4f3e-84fb-66e913812d21\"},{\"properties\":{\"displayName\":\"Add or replace a tag on resource groups\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Adds or replaces the specified tag and value when any resource group is created or updated. Existing resource groups can be remediated by triggering a remediation task.\",\"metadata\":{\"category\":\"Tags\"},\"parameters\":{\"tagName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Tag Name\",\"description\":\"Name of the tag, such as 'environment'\"}},\"tagValue\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Tag Value\",\"description\":\"Value of the tag, such as 'production'\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions/resourceGroups\"},{\"field\":\"[concat('tags[', parameters('tagName'), ']')]\",\"notEquals\":\"[parameters('tagValue')]\"}]},\"then\":{\"effect\":\"modify\",\"details\":{\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"operations\":[{\"operation\":\"addOrReplace\",\"field\":\"[concat('tags[', parameters('tagName'), ']')]\",\"value\":\"[parameters('tagValue')]\"}]}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/d157c373-a6c4-483d-aaad-570756956268\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"d157c373-a6c4-483d-aaad-570756956268\"},{\"properties\":{\"displayName\":\"Enforce SSL connection should be enabled for PostgreSQL database servers\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy audits any PostgreSQL server that is not enforcing SSL connection. Azure Database for PostgreSQL prefers connecting your client applications to the PostgreSQL service using Secure Sockets Layer (SSL). Enforcing SSL connections between your database server and your client applications helps protect against 'man-in-the-middle' attacks by encrypting the data stream between the server and your application\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.DBforPostgreSQL/servers\"},{\"field\":\"Microsoft.DBforPostgreSQL/servers/sslEnforcement\",\"exists\":\"true\"},{\"field\":\"Microsoft.DBforPostgreSQL/servers/sslEnforcement\",\"notEquals\":\"Enabled\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/d158790f-bfb0-486c-8631-2dc6b4e8e6af\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"d158790f-bfb0-486c-8631-2dc6b4e8e6af\"},{\"properties\":{\"displayName\":\"[Deprecated]: Audit Function Apps that are not using custom domains\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Use of custom domains protects a Function app from common attacks such as phishing and other DNS-related attacks.\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true,\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"microsoft.Web/sites\"},{\"anyOf\":[{\"field\":\"kind\",\"equals\":\"functionapp\"},{\"field\":\"kind\",\"equals\":\"functionapp,linux\"},{\"field\":\"kind\",\"equals\":\"functionapp,linux,container\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"UsedCustomDomains\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/d1cb47db-b7a1-4c46-814e-aad1c0e84f3c\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"d1cb47db-b7a1-4c46-814e-aad1c0e84f3c\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy prerequisites to audit Windows VMs on which the DSC configuration is not compliant\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows VMs on which the Desired State Configuration (DSC) configuration is not compliant. This policy is only applicable to machines with WMF 4 and above. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WindowsDscConfiguration\",\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"WindowsDscConfiguration\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/d38b4c26-9d2e-47d7-aefe-18d859a8706a\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"d38b4c26-9d2e-47d7-aefe-18d859a8706a\"},{\"properties\":{\"displayName\":\"Long-term geo-redundant backup should be enabled for Azure SQL Databases\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy audits any Azure SQL Database with long-term geo-redundant backup not enabled.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Sql/servers/databases\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Sql/servers/databases/backupLongTermRetentionPolicies\",\"name\":\"default\",\"existenceCondition\":{\"anyOf\":[{\"field\":\"Microsoft.Sql/servers/databases/backupLongTermRetentionPolicies/weeklyRetention\",\"notEquals\":\"PT0S\"},{\"field\":\"Microsoft.Sql/servers/databases/backupLongTermRetentionPolicies/monthlyRetention\",\"notEquals\":\"PT0S\"},{\"field\":\"Microsoft.Sql/servers/databases/backupLongTermRetentionPolicies/yearlyRetention\",\"notEquals\":\"PT0S\"}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/d38fc420-0735-4ef3-ac11-c806f651a570\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"d38fc420-0735-4ef3-ac11-c806f651a570\"},{\"properties\":{\"displayName\":\"Virtual machines should be connected to an approved virtual network\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy audits any virtual machine connected to a virtual network that is not approved.\",\"metadata\":{\"category\":\"Network\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"The effect determines what happens when the policy rule is evaluated to match\"},\"allowedValues\":[\"Audit\",\"Deny\",\"Disabled\"]},\"virtualNetworkId\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Virtual network Id\",\"description\":\"Resource Id of the virtual network. Example: /subscriptions/YourSubscriptionId/resourceGroups/YourResourceGroupName/providers/Microsoft.Network/virtualNetworks/Name\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Network/networkInterfaces\"},{\"not\":{\"field\":\"Microsoft.Network/networkInterfaces/ipconfigurations[*].subnet.id\",\"like\":\"[concat(parameters('virtualNetworkId'),'/*')]\"}}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/d416745a-506c-48b6-8ab1-83cb814bcaa3\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"d416745a-506c-48b6-8ab1-83cb814bcaa3\"},{\"properties\":{\"displayName\":\"Deploy Diagnostic Settings for Data Lake Analytics to Log Analytics workspace\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploys the diagnostic settings for Data Lake Analytics to stream to a regional Log Analytics workspace when any Data Lake Analytics which is missing this diagnostic settings is created or updated.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"DeployIfNotExists\",\"Disabled\"]},\"profileName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Profile name\",\"description\":\"The diagnostic settings profile name\"}},\"logAnalytics\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Log Analytics workspace\",\"description\":\"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\"strongType\":\"omsWorkspace\",\"assignPermissions\":true}},\"metricsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable metrics\",\"description\":\"Whether to enable metrics stream to the Event Hub - True or False\"},\"allowedValues\":[\"True\",\"False\"]},\"logsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable logs\",\"description\":\"Whether to enable logs stream to the Event Hub  - True or False\"},\"allowedValues\":[\"True\",\"False\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.DataLakeAnalytics/accounts\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"name\":\"[parameters('profileName')]\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"[parameters('logsEnabled')]\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\"equals\":\"[parameters('metricsEnabled')]\"}]},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa\",\"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"resourceName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"logAnalytics\":{\"type\":\"string\"},\"metricsEnabled\":{\"type\":\"string\"},\"logsEnabled\":{\"type\":\"string\"},\"profileName\":{\"type\":\"string\"}},\"variables\":{},\"resources\":[{\"type\":\"Microsoft.DataLakeAnalytics/accounts/providers/diagnosticSettings\",\"apiVersion\":\"2017-05-01-preview\",\"name\":\"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\"location\":\"[parameters('location')]\",\"dependsOn\":[],\"properties\":{\"workspaceId\":\"[parameters('logAnalytics')]\",\"metrics\":[{\"category\":\"AllMetrics\",\"enabled\":\"[parameters('metricsEnabled')]\",\"retentionPolicy\":{\"enabled\":false,\"days\":0}}],\"logs\":[{\"category\":\"Audit\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"Requests\",\"enabled\":\"[parameters('logsEnabled')]\"}]}}],\"outputs\":{}},\"parameters\":{\"location\":{\"value\":\"[field('location')]\"},\"resourceName\":{\"value\":\"[field('name')]\"},\"logAnalytics\":{\"value\":\"[parameters('logAnalytics')]\"},\"metricsEnabled\":{\"value\":\"[parameters('metricsEnabled')]\"},\"logsEnabled\":{\"value\":\"[parameters('logsEnabled')]\"},\"profileName\":{\"value\":\"[parameters('profileName')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/d56a5a7c-72d7-42bc-8ceb-3baf4c0eae03\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"d56a5a7c-72d7-42bc-8ceb-3baf4c0eae03\"},{\"properties\":{\"displayName\":\"Event Hub should use a virtual network service endpoint\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy audits any Event Hub not configured to use a virtual network service endpoint.\",\"metadata\":{\"category\":\"Network\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.EventHub/namespaces\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.EventHub/namespaces/virtualNetworkRules\",\"existenceCondition\":{\"field\":\"Microsoft.EventHub/namespaces/virtualNetworkRules/virtualNetworkSubnetId\",\"exists\":\"true\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/d63edb4a-c612-454d-b47d-191a724fcbf0\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"d63edb4a-c612-454d-b47d-191a724fcbf0\"},{\"properties\":{\"displayName\":\"Show audit results from Windows Server VMs on which Windows Serial Console is not enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows Server virtual machines on which Windows Serial Console is not enabled. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WindowsSerialConsole\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/d7ccd0ca-8d78-42af-a43d-6b7f928accbc\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"d7ccd0ca-8d78-42af-a43d-6b7f928accbc\"},{\"properties\":{\"displayName\":\"Deploy Diagnostic Settings for Batch Account to Event Hub\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploys the diagnostic settings for Batch Account to stream to a regional Event Hub when any Batch Account which is missing this diagnostic settings is created or updated.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"DeployIfNotExists\",\"Disabled\"]},\"profileName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Profile name\",\"description\":\"The diagnostic settings profile name\"}},\"eventHubRuleId\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Event Hub Authorization Rule Id\",\"description\":\"The Event Hub authorization rule Id for Azure Diagnostics. The authorization rule needs to be at Event Hub namespace level. e.g. /subscriptions/{subscription Id}/resourceGroups/{resource group}/providers/Microsoft.EventHub/namespaces/{Event Hub namespace}/authorizationrules/{authorization rule}\",\"strongType\":\"Microsoft.EventHub/Namespaces/AuthorizationRules\",\"assignPermissions\":true}},\"metricsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable metrics\",\"description\":\"Whether to enable metrics stream to the Event Hub - True or False\"},\"allowedValues\":[\"True\",\"False\"]},\"logsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable logs\",\"description\":\"Whether to enable logs stream to the Event Hub  - True or False\"},\"allowedValues\":[\"True\",\"False\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Batch/batchAccounts\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"name\":\"[parameters('profileName')]\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"[parameters('logsEnabled')]\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\"equals\":\"[parameters('metricsEnabled')]\"}]},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"resourceName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"eventHubRuleId\":{\"type\":\"string\"},\"metricsEnabled\":{\"type\":\"string\"},\"logsEnabled\":{\"type\":\"string\"},\"profileName\":{\"type\":\"string\"}},\"variables\":{},\"resources\":[{\"type\":\"Microsoft.Batch/batchAccounts/providers/diagnosticSettings\",\"apiVersion\":\"2017-05-01-preview\",\"name\":\"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\"location\":\"[parameters('location')]\",\"dependsOn\":[],\"properties\":{\"eventHubAuthorizationRuleId\":\"[parameters('eventHubRuleId')]\",\"metrics\":[{\"category\":\"AllMetrics\",\"enabled\":\"[parameters('metricsEnabled')]\",\"retentionPolicy\":{\"enabled\":false,\"days\":0}}],\"logs\":[{\"category\":\"ServiceLog\",\"enabled\":\"[parameters('logsEnabled')]\"}]}}],\"outputs\":{}},\"parameters\":{\"location\":{\"value\":\"[field('location')]\"},\"resourceName\":{\"value\":\"[field('name')]\"},\"eventHubRuleId\":{\"value\":\"[parameters('eventHubRuleId')]\"},\"metricsEnabled\":{\"value\":\"[parameters('metricsEnabled')]\"},\"logsEnabled\":{\"value\":\"[parameters('logsEnabled')]\"},\"profileName\":{\"value\":\"[parameters('profileName')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/db51110f-0865-4a6e-b274-e2e07a5b2cd7\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"db51110f-0865-4a6e-b274-e2e07a5b2cd7\"},{\"properties\":{\"displayName\":\"[Deprecated]: Audit Web Applications that are not using custom domains\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Use of custom domains protects a web application from common attacks such as phishing and other DNS-related attacks.\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true,\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"microsoft.Web/sites\"},{\"anyOf\":[{\"field\":\"kind\",\"equals\":\"app\"},{\"field\":\"kind\",\"equals\":\"WebApp\"},{\"field\":\"kind\",\"equals\":\"app,linux\"},{\"field\":\"kind\",\"equals\":\"app,linux,container\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"UsedCustomDomains\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/dd2ea520-6b06-45c3-806e-ea297c23e06a\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"dd2ea520-6b06-45c3-806e-ea297c23e06a\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'System Audit Policies - Policy Change'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'System Audit Policies - Policy Change'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SystemAuditPoliciesPolicyChange\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/dd4680ed-0559-4a6a-ad10-081d14cbb484\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"dd4680ed-0559-4a6a-ad10-081d14cbb484\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'Security Settings - Account Policies'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Security Settings - Account Policies'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecuritySettingsAccountPolicies\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/ddb53c61-9db4-41d4-a953-2abff5b66c12\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"ddb53c61-9db4-41d4-a953-2abff5b66c12\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'Security Options - Recovery console'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Recovery console'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"RecoveryConsoleAllowFloppyCopyAndAccessToAllDrivesAndAllFolders\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Recovery console: Allow floppy copy and access to all drives and all folders\",\"description\":\"Specifies whether to make the Recovery Console SET command available, which allows setting of recovery console environment variables.\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsRecoveryconsole\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('Recovery console: Allow floppy copy and access to all drives and all folders;ExpectedValue', '=', parameters('RecoveryConsoleAllowFloppyCopyAndAccessToAllDrivesAndAllFolders')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_SecurityOptionsRecoveryconsole\"},\"RecoveryConsoleAllowFloppyCopyAndAccessToAllDrivesAndAllFolders\":{\"value\":\"[parameters('RecoveryConsoleAllowFloppyCopyAndAccessToAllDrivesAndAllFolders')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"RecoveryConsoleAllowFloppyCopyAndAccessToAllDrivesAndAllFolders\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"Recovery console: Allow floppy copy and access to all drives and all folders;ExpectedValue\",\"value\":\"[parameters('RecoveryConsoleAllowFloppyCopyAndAccessToAllDrivesAndAllFolders')]\"}]}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/ddc0a4d5-5e08-43d5-9fd9-b586d8d7116b\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"ddc0a4d5-5e08-43d5-9fd9-b586d8d7116b\"},{\"properties\":{\"displayName\":\"[Deprecated]: Allow resource creation only in Japan data centers\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Allows resource creation in the following locations only: Japan East, Japan West\",\"metadata\":{\"category\":\"General\",\"deprecated\":true},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"japaneast\",\"japanwest\"]}},\"then\":{\"effect\":\"Deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/e01598e8-6538-41ed-95e8-8b29746cd697\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"e01598e8-6538-41ed-95e8-8b29746cd697\"},{\"properties\":{\"displayName\":\"Cosmos DB should use a virtual network service endpoint\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy audits any Cosmos DB not configured to use a virtual network service endpoint.\",\"metadata\":{\"category\":\"Network\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.DocumentDB/databaseAccounts\"},{\"field\":\"Microsoft.DocumentDB/databaseAccounts/virtualNetworkRules[*].id\",\"exists\":\"false\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/e0a2b1a3-f7f9-4569-807f-2a9edebdf4d9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"e0a2b1a3-f7f9-4569-807f-2a9edebdf4d9\"},{\"properties\":{\"displayName\":\"Deploy prerequisites to audit Windows VMs that do not have the specified Windows PowerShell execution policy\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines where Windows PowerShell is not configured to use the specified PowerShell execution policy. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"ExecutionPolicy\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"PowerShell Execution Policy\",\"description\":\"The expected PowerShell execution policy.\"},\"allowedValues\":[\"AllSigned\",\"Bypass\",\"Default\",\"RemoteSigned\",\"Restricted\",\"Undefined\",\"Unrestricted\"]}},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WindowsPowerShellExecutionPolicy\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('[PowerShellExecutionPolicy]PowerShellExecutionPolicy1;ExecutionPolicy', '=', parameters('ExecutionPolicy')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"WindowsPowerShellExecutionPolicy\"},\"ExecutionPolicy\":{\"value\":\"[parameters('ExecutionPolicy')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"ExecutionPolicy\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[PowerShellExecutionPolicy]PowerShellExecutionPolicy1;ExecutionPolicy\",\"value\":\"[parameters('ExecutionPolicy')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[PowerShellExecutionPolicy]PowerShellExecutionPolicy1;ExecutionPolicy\",\"value\":\"[parameters('ExecutionPolicy')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/e0efc13a-122a-47c5-b817-2ccfe5d12615\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"e0efc13a-122a-47c5-b817-2ccfe5d12615\"},{\"properties\":{\"displayName\":\"Vulnerabilities in security configuration on your machines should be remediated\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Servers which do not satisfy the configured baseline will be monitored by Azure Security Center as recommendations\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"in\":[\"Microsoft.Compute/virtualMachines\",\"Microsoft.ClassicCompute/virtualMachines\"]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"osVulnerabilities\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/e1e5fd5d-3e4c-4ce1-8661-7d1873ae6b15\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"e1e5fd5d-3e4c-4ce1-8661-7d1873ae6b15\"},{\"properties\":{\"displayName\":\"Ensure that 'HTTP Version' is the latest, if used to run the Function app\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Periodically, newer versions are released for HTTP either due to security flaws or to include additional functionality. Using the latest HTTP version for web apps to take advantage of security fixes, if any, and/or new functionalities of the newer version.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"functionapp*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/web.http20Enabled\",\"equals\":\"true\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/e2c1c086-2d84-4019-bff3-c44ccd95113c\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"e2c1c086-2d84-4019-bff3-c44ccd95113c\"},{\"properties\":{\"displayName\":\"[Preview]: Audit Dependency Agent Deployment in VMSS - VM Image (OS) unlisted\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Reports VMSS as non-compliant if the VM Image (OS) is not in the list defined and the agent is not installed. The list of OS images will be updated over time as support is updated.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"listOfImageIdToInclude_windows\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"Optional: List of VM images that have supported Windows OS to add to scope\",\"description\":\"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"}},\"listOfImageIdToInclude_linux\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"Optional: List of VM images that have supported Linux OS to add to scope\",\"description\":\"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachineScaleSets\"},{\"not\":{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageId\",\"in\":\"[parameters('listOfImageIdToInclude_windows')]\"},{\"field\":\"Microsoft.Compute/imageId\",\"in\":\"[parameters('listOfImageIdToInclude_linux')]\"},{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"2008-R2-SP1\",\"2008-R2-SP1-smalldisk\",\"2012-Datacenter\",\"2012-Datacenter-smalldisk\",\"2012-R2-Datacenter\",\"2012-R2-Datacenter-smalldisk\",\"2016-Datacenter\",\"2016-Datacenter-Server-Core\",\"2016-Datacenter-Server-Core-smalldisk\",\"2016-Datacenter-smalldisk\",\"2016-Datacenter-with-Containers\",\"2016-Datacenter-with-RDSH\",\"2019-Datacenter\",\"2019-Datacenter-Core\",\"2019-Datacenter-Core-smalldisk\",\"2019-Datacenter-Core-with-Containers\",\"2019-Datacenter-Core-with-Containers-smalldisk\",\"2019-Datacenter-smalldisk\",\"2019-Datacenter-with-Containers\",\"2019-Datacenter-with-Containers-smalldisk\",\"2019-Datacenter-zhcn\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServerSemiAnnual\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"Datacenter-Core-1709-smalldisk\",\"Datacenter-Core-1709-with-Containers-smalldisk\",\"Datacenter-Core-1803-with-Containers-smalldisk\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServerHPCPack\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"WindowsServerHPCPack\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2016\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2016-BYOL\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2012R2\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"*-WS2012R2-BYOL\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftRServer\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"MLServer-WS2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftVisualStudio\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"VisualStudio\",\"Windows\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftDynamicsAX\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Dynamics\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"equals\":\"Pre-Req-AX7-Onebox-U8\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"windows-data-science-vm\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsDesktop\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Windows-10\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"RHEL\",\"RHEL-SAP-HANA\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"6.*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"SUSE\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"SLES\",\"SLES-HPC\",\"SLES-HPC-Priority\",\"SLES-SAP\",\"SLES-SAP-BYOS\",\"SLES-Priority\",\"SLES-BYOS\",\"SLES-SAPCAL\",\"SLES-Standard\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"12-SP2\",\"12-SP3\",\"12-SP4\"]}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Canonical\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"UbuntuServer\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"14.04.0-LTS\",\"14.04.1-LTS\",\"14.04.5-LTS\"]},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"16.04-LTS\",\"16.04.0-LTS\"]},{\"field\":\"Microsoft.Compute/imageSKU\",\"in\":[\"18.04-LTS\"]}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"OpenLogic\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"Centos\",\"Centos-LVM\",\"CentOS-SRIOV\"]},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"6.*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-centos-os\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"like\":\"7*\"}]}]}}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.Compute/virtualMachineScaleSets/extensions\",\"existenceCondition\":{\"field\":\"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\"equals\":\"Microsoft.Azure.Monitoring.DependencyAgent\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/e2dd799a-a932-4e9d-ac17-d473bc3c6c10\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"e2dd799a-a932-4e9d-ac17-d473bc3c6c10\"},{\"properties\":{\"displayName\":\"Azure VPN gateways should not use 'basic' SKU\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy ensures that VPN gateways do not use 'basic' SKU.\",\"metadata\":{\"category\":\"Network\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Network/virtualNetworkGateways\"},{\"field\":\"Microsoft.Network/virtualNetworkGateways/gatewayType\",\"equals\":\"Vpn\"},{\"field\":\"Microsoft.Network/virtualNetworkGateways/sku.tier\",\"equals\":\"Basic\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/e345b6c3-24bd-4c93-9bbb-7e5e49a17b78\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"e345b6c3-24bd-4c93-9bbb-7e5e49a17b78\"},{\"properties\":{\"displayName\":\"MFA should be enabled on accounts with read permissions on your subscription\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Multi-Factor Authentication (MFA) should be enabled for all subscription accounts with read privileges to prevent a breach of accounts or resources.\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"EnableMFAForReadPermissions\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/e3576e28-8b17-4677-84c3-db2990658d64\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"e3576e28-8b17-4677-84c3-db2990658d64\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'Security Options - Shutdown'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Shutdown'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsShutdown\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/e3a77a94-cf41-4ee8-b45c-98be28841c03\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"e3a77a94-cf41-4ee8-b45c-98be28841c03\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'Security Settings - Account Policies'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Security Settings - Account Policies'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"EnforcePasswordHistory\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enforce password history\",\"description\":\"Specifies limits on password reuse - how many times a new password must be created for a user account before the password can be repeated.\"}},\"MaximumPasswordAge\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Maximum password age\",\"description\":\"Specifies the maximum number of days that may elapse before a user account password must be changed. The format of the value is two integers separated by a comma, denoting an inclusive range.\"}},\"MinimumPasswordAge\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Minimum password age\",\"description\":\"Specifies the minimum number of days that must elapse before a user account password can be changed.\"}},\"MinimumPasswordLength\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Minimum password length\",\"description\":\"Specifies the minimum number of characters that a user account password may contain.\"}},\"PasswordMustMeetComplexityRequirements\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Password must meet complexity requirements\",\"description\":\"Specifies whether a user account password must be complex. If required, a complex password must not contain part of  user's account name or full name; be at least 6 characters long; contain a mix of uppercase, lowercase, number, and non-alphabetic characters.\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecuritySettingsAccountPolicies\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('Enforce password history;ExpectedValue', '=', parameters('EnforcePasswordHistory'), ',', 'Maximum password age;ExpectedValue', '=', parameters('MaximumPasswordAge'), ',', 'Minimum password age;ExpectedValue', '=', parameters('MinimumPasswordAge'), ',', 'Minimum password length;ExpectedValue', '=', parameters('MinimumPasswordLength'), ',', 'Password must meet complexity requirements;ExpectedValue', '=', parameters('PasswordMustMeetComplexityRequirements')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_SecuritySettingsAccountPolicies\"},\"EnforcePasswordHistory\":{\"value\":\"[parameters('EnforcePasswordHistory')]\"},\"MaximumPasswordAge\":{\"value\":\"[parameters('MaximumPasswordAge')]\"},\"MinimumPasswordAge\":{\"value\":\"[parameters('MinimumPasswordAge')]\"},\"MinimumPasswordLength\":{\"value\":\"[parameters('MinimumPasswordLength')]\"},\"PasswordMustMeetComplexityRequirements\":{\"value\":\"[parameters('PasswordMustMeetComplexityRequirements')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"EnforcePasswordHistory\":{\"type\":\"string\"},\"MaximumPasswordAge\":{\"type\":\"string\"},\"MinimumPasswordAge\":{\"type\":\"string\"},\"MinimumPasswordLength\":{\"type\":\"string\"},\"PasswordMustMeetComplexityRequirements\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"Enforce password history;ExpectedValue\",\"value\":\"[parameters('EnforcePasswordHistory')]\"},{\"name\":\"Maximum password age;ExpectedValue\",\"value\":\"[parameters('MaximumPasswordAge')]\"},{\"name\":\"Minimum password age;ExpectedValue\",\"value\":\"[parameters('MinimumPasswordAge')]\"},{\"name\":\"Minimum password length;ExpectedValue\",\"value\":\"[parameters('MinimumPasswordLength')]\"},{\"name\":\"Password must meet complexity requirements;ExpectedValue\",\"value\":\"[parameters('PasswordMustMeetComplexityRequirements')]\"}]}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/e3d95ab7-f47a-49d8-a347-784177b6c94c\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"e3d95ab7-f47a-49d8-a347-784177b6c94c\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'Security Options - User Account Control'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - User Account Control'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"UACAdminApprovalModeForTheBuiltinAdministratorAccount\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"UAC: Admin Approval Mode for the Built-in Administrator account\",\"description\":\"Specifies the behavior of Admin Approval Mode for the built-in Administrator account.\"}},\"UACBehaviorOfTheElevationPromptForAdministratorsInAdminApprovalMode\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"UAC: Behavior of the elevation prompt for administrators in Admin Approval Mode\",\"description\":\"Specifies the behavior of the elevation prompt for administrators.\"}},\"UACDetectApplicationInstallationsAndPromptForElevation\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"UAC: Detect application installations and prompt for elevation\",\"description\":\"Specifies the behavior of application installation detection for the computer.\"}},\"UACRunAllAdministratorsInAdminApprovalMode\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"UAC: Run all administrators in Admin Approval Mode\",\"description\":\"Specifies the behavior of all User Account Control (UAC) policy settings for the computer.\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsUserAccountControl\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('User Account Control: Admin Approval Mode for the Built-in Administrator account;ExpectedValue', '=', parameters('UACAdminApprovalModeForTheBuiltinAdministratorAccount'), ',', 'User Account Control: Behavior of the elevation prompt for administrators in Admin Approval Mode;ExpectedValue', '=', parameters('UACBehaviorOfTheElevationPromptForAdministratorsInAdminApprovalMode'), ',', 'User Account Control: Detect application installations and prompt for elevation;ExpectedValue', '=', parameters('UACDetectApplicationInstallationsAndPromptForElevation'), ',', 'User Account Control: Run all administrators in Admin Approval Mode;ExpectedValue', '=', parameters('UACRunAllAdministratorsInAdminApprovalMode')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_SecurityOptionsUserAccountControl\"},\"UACAdminApprovalModeForTheBuiltinAdministratorAccount\":{\"value\":\"[parameters('UACAdminApprovalModeForTheBuiltinAdministratorAccount')]\"},\"UACBehaviorOfTheElevationPromptForAdministratorsInAdminApprovalMode\":{\"value\":\"[parameters('UACBehaviorOfTheElevationPromptForAdministratorsInAdminApprovalMode')]\"},\"UACDetectApplicationInstallationsAndPromptForElevation\":{\"value\":\"[parameters('UACDetectApplicationInstallationsAndPromptForElevation')]\"},\"UACRunAllAdministratorsInAdminApprovalMode\":{\"value\":\"[parameters('UACRunAllAdministratorsInAdminApprovalMode')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"UACAdminApprovalModeForTheBuiltinAdministratorAccount\":{\"type\":\"string\"},\"UACBehaviorOfTheElevationPromptForAdministratorsInAdminApprovalMode\":{\"type\":\"string\"},\"UACDetectApplicationInstallationsAndPromptForElevation\":{\"type\":\"string\"},\"UACRunAllAdministratorsInAdminApprovalMode\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"User Account Control: Admin Approval Mode for the Built-in Administrator account;ExpectedValue\",\"value\":\"[parameters('UACAdminApprovalModeForTheBuiltinAdministratorAccount')]\"},{\"name\":\"User Account Control: Behavior of the elevation prompt for administrators in Admin Approval Mode;ExpectedValue\",\"value\":\"[parameters('UACBehaviorOfTheElevationPromptForAdministratorsInAdminApprovalMode')]\"},{\"name\":\"User Account Control: Detect application installations and prompt for elevation;ExpectedValue\",\"value\":\"[parameters('UACDetectApplicationInstallationsAndPromptForElevation')]\"},{\"name\":\"User Account Control: Run all administrators in Admin Approval Mode;ExpectedValue\",\"value\":\"[parameters('UACRunAllAdministratorsInAdminApprovalMode')]\"}]}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/e425e402-a050-45e5-b010-bd3f934589fc\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"e425e402-a050-45e5-b010-bd3f934589fc\"},{\"properties\":{\"displayName\":\"Allowed locations\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy enables you to restrict the locations your organization can specify when deploying resources. Use to enforce your geo-compliance requirements. Excludes resource groups, Microsoft.AzureActiveDirectory/b2cDirectories, and resources that use the 'global' region.\",\"metadata\":{\"category\":\"General\"},\"parameters\":{\"listOfAllowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources.\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"location\",\"notIn\":\"[parameters('listOfAllowedLocations')]\"},{\"field\":\"location\",\"notEquals\":\"global\"},{\"field\":\"type\",\"notEquals\":\"Microsoft.AzureActiveDirectory/b2cDirectories\"}]},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/e56962a6-4747-49cd-b67b-bf8b01975c4c\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"e56962a6-4747-49cd-b67b-bf8b01975c4c\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'Security Options - Accounts'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Accounts'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"AccountsGuestAccountStatus\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Accounts: Guest account status\",\"description\":\"Specifies whether the local Guest account is disabled.\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsAccounts\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('Accounts: Guest account status;ExpectedValue', '=', parameters('AccountsGuestAccountStatus')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_SecurityOptionsAccounts\"},\"AccountsGuestAccountStatus\":{\"value\":\"[parameters('AccountsGuestAccountStatus')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"AccountsGuestAccountStatus\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"Accounts: Guest account status;ExpectedValue\",\"value\":\"[parameters('AccountsGuestAccountStatus')]\"}]}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/e5b81f87-9185-4224-bf00-9f505e9f89f3\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"e5b81f87-9185-4224-bf00-9f505e9f89f3\"},{\"properties\":{\"displayName\":\"[Deprecated]: Audit Web Applications that are not using latest supported Node.js Framework\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Use the latest supported Node.js version for the latest security classes. Using older classes and types can make your application vulnerable.\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true,\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"microsoft.Web/sites\"},{\"anyOf\":[{\"field\":\"kind\",\"equals\":\"app,linux\"},{\"field\":\"kind\",\"equals\":\"app,linux,container\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"UseLatestNodeJS\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/e67687e8-08d5-4e7f-8226-5b4753bba008\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"e67687e8-08d5-4e7f-8226-5b4753bba008\"},{\"properties\":{\"displayName\":\"Subnets should be associated with a Network Security Group\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Protect your subnet from potential threats by restricting access to it with a Network Security Group (NSG). NSGs contain a list of Access Control List (ACL) rules that allow or deny network traffic to your subnet.\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Network/virtualNetworks/subnets\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"networkSecurityGroupsOnSubnets\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/e71308d3-144b-4262-b144-efdc3cc90517\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"e71308d3-144b-4262-b144-efdc3cc90517\"},{\"properties\":{\"displayName\":\"Advanced Threat Protection types should be set to 'All' in SQL server Advanced Data Security settings\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"It is recommended to enable all Advanced Threat Protection types on your SQL servers. Enabling all types protects against SQL injection, database vulnerabilities, and any other anomalous activities.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Sql/servers\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Sql/servers/securityAlertPolicies\",\"name\":\"default\",\"existenceCondition\":{\"field\":\"Microsoft.Sql/servers/securityAlertPolicies/disabledAlerts[*]\",\"equals\":\"\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/e756b945-1b1b-480b-8de8-9a0859d5f7ad\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"e756b945-1b1b-480b-8de8-9a0859d5f7ad\"},{\"properties\":{\"displayName\":\"Allowed locations for resource groups\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy enables you to restrict the locations your organization can create resource groups in. Use to enforce your geo-compliance requirements.\",\"metadata\":{\"category\":\"General\"},\"parameters\":{\"listOfAllowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that resource groups can be created in.\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions/resourceGroups\"},{\"field\":\"location\",\"notIn\":\"[parameters('listOfAllowedLocations')]\"}]},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/e765b5de-1225-4ba3-bd56-1ac6695af988\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"e765b5de-1225-4ba3-bd56-1ac6695af988\"},{\"properties\":{\"displayName\":\"[Deprecated]: Audit Web Sockets state for a Web Application\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"The Web Sockets protocol is vulnerable to different types of security threats. Use of Web Sockets within a web application must be carefully reviewed.\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true,\"deprecated\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"microsoft.Web/sites\"},{\"anyOf\":[{\"field\":\"kind\",\"equals\":\"app\"},{\"field\":\"kind\",\"equals\":\"WebApp\"},{\"field\":\"kind\",\"equals\":\"app,linux\"},{\"field\":\"kind\",\"equals\":\"app,linux,container\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"DisableWebSockets\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/e797f851-8be7-4c40-bb56-2e3395215b0e\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"e797f851-8be7-4c40-bb56-2e3395215b0e\"},{\"properties\":{\"displayName\":\"Enforce SSL connection should be enabled for MySQL database servers\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy audits any MySQL server that is not enforcing SSL connection. Azure Database for MySQL supports connecting your Azure Database for MySQL server to client applications using Secure Sockets Layer (SSL). Enforcing SSL connections between your database server and your client applications helps protect against 'man in the middle' attacks by encrypting the data stream between the server and your application.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.DBforMySQL/servers\"},{\"field\":\"Microsoft.DBforMySQL/servers/sslEnforcement\",\"exists\":\"true\"},{\"field\":\"Microsoft.DBforMySQL/servers/sslEnforcement\",\"notEquals\":\"Enabled\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/e802a67a-daf5-4436-9ea6-f6d821dd0c5d\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"e802a67a-daf5-4436-9ea6-f6d821dd0c5d\"},{\"properties\":{\"displayName\":\"Vulnerabilities in container security configurations should be remediated\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Audit vulnerabilities in security configuration on machines with Docker installed and display as recommendations in Azure Security Center.\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"in\":[\"Microsoft.Compute/virtualMachines\",\"Microsoft.ClassicCompute/virtualMachines\",\"Microsoft.Compute/virtualMachineScaleSets\"]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"ContainerBenchmark\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/e8cbc669-f12d-49eb-93e7-9273119e9933\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"e8cbc669-f12d-49eb-93e7-9273119e9933\"},{\"properties\":{\"displayName\":\"Deploy Diagnostic Settings for Data Lake Storage Gen1 to Event Hub\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploys the diagnostic settings for Data Lake Storage Gen1 to stream to a regional Event Hub when any Data Lake Storage Gen1 which is missing this diagnostic settings is created or updated.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"DeployIfNotExists\",\"Disabled\"]},\"profileName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Profile name\",\"description\":\"The diagnostic settings profile name\"}},\"eventHubRuleId\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Event Hub Authorization Rule Id\",\"description\":\"The Event Hub authorization rule Id for Azure Diagnostics. The authorization rule needs to be at Event Hub namespace level. e.g. /subscriptions/{subscription Id}/resourceGroups/{resource group}/providers/Microsoft.EventHub/namespaces/{Event Hub namespace}/authorizationrules/{authorization rule}\",\"strongType\":\"Microsoft.EventHub/Namespaces/AuthorizationRules\",\"assignPermissions\":true}},\"metricsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable metrics\",\"description\":\"Whether to enable metrics stream to the Event Hub - True or False\"},\"allowedValues\":[\"True\",\"False\"]},\"logsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable logs\",\"description\":\"Whether to enable logs stream to the Event Hub  - True or False\"},\"allowedValues\":[\"True\",\"False\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.DataLakeStore/accounts\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"name\":\"[parameters('profileName')]\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"[parameters('logsEnabled')]\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\"equals\":\"[parameters('metricsEnabled')]\"}]},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"resourceName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"eventHubRuleId\":{\"type\":\"string\"},\"metricsEnabled\":{\"type\":\"string\"},\"logsEnabled\":{\"type\":\"string\"},\"profileName\":{\"type\":\"string\"}},\"variables\":{},\"resources\":[{\"type\":\"Microsoft.DataLakeStore/accounts/providers/diagnosticSettings\",\"apiVersion\":\"2017-05-01-preview\",\"name\":\"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\"location\":\"[parameters('location')]\",\"dependsOn\":[],\"properties\":{\"eventHubAuthorizationRuleId\":\"[parameters('eventHubRuleId')]\",\"metrics\":[{\"category\":\"AllMetrics\",\"enabled\":\"[parameters('metricsEnabled')]\",\"retentionPolicy\":{\"enabled\":false,\"days\":0}}],\"logs\":[{\"category\":\"Audit\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"Requests\",\"enabled\":\"[parameters('logsEnabled')]\"}]}}],\"outputs\":{}},\"parameters\":{\"location\":{\"value\":\"[field('location')]\"},\"resourceName\":{\"value\":\"[field('name')]\"},\"eventHubRuleId\":{\"value\":\"[parameters('eventHubRuleId')]\"},\"metricsEnabled\":{\"value\":\"[parameters('metricsEnabled')]\"},\"logsEnabled\":{\"value\":\"[parameters('logsEnabled')]\"},\"profileName\":{\"value\":\"[parameters('profileName')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/e8d096bc-85de-4c5f-8cfb-857bd1b9d62d\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"e8d096bc-85de-4c5f-8cfb-857bd1b9d62d\"},{\"properties\":{\"displayName\":\"Remote debugging should be turned off for API Apps\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Remote debugging requires inbound ports to be opened on an API apps. Remote debugging should be turned off.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"*api\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/web.remoteDebuggingEnabled\",\"equals\":\"false\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/e9c8d085-d9cc-4b17-9cdc-059f1f01f19e\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"e9c8d085-d9cc-4b17-9cdc-059f1f01f19e\"},{\"properties\":{\"displayName\":\"Inherit a tag from the resource group if missing\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Adds the specified tag with its value from the parent resource group when any resource missing this tag is created or updated. Existing resources can be remediated by triggering a remediation task. If the tag exists with a different value it will not be changed.\",\"metadata\":{\"category\":\"Tags\"},\"parameters\":{\"tagName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Tag Name\",\"description\":\"Name of the tag, such as 'environment'\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"[concat('tags[', parameters('tagName'), ']')]\",\"exists\":\"false\"},{\"value\":\"[resourceGroup().tags[parameters('tagName')]]\",\"notEquals\":\"\"}]},\"then\":{\"effect\":\"modify\",\"details\":{\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"operations\":[{\"operation\":\"add\",\"field\":\"[concat('tags[', parameters('tagName'), ']')]\",\"value\":\"[resourceGroup().tags[parameters('tagName')]]\"}]}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/ea3f2387-9b95-492a-a190-fcdc54f7b070\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"ea3f2387-9b95-492a-a190-fcdc54f7b070\"},{\"properties\":{\"displayName\":\"Key Vault should use a virtual network service endpoint\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy audits any Key Vault not configured to use a virtual network service endpoint.\",\"metadata\":{\"category\":\"Network\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.KeyVault/vaults\"},{\"anyOf\":[{\"field\":\"Microsoft.KeyVault/vaults/networkAcls.defaultAction\",\"notEquals\":\"Deny\"},{\"field\":\"Microsoft.KeyVault/vaults/networkAcls.virtualNetworkRules[*].id\",\"exists\":\"false\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/ea4d6841-2173-4317-9747-ff522a45120f\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"ea4d6841-2173-4317-9747-ff522a45120f\"},{\"properties\":{\"displayName\":\"Ensure Function app has 'Client Certificates (Incoming client certificates)' set to 'On'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Client certificates allow for the app to request a certificate for incoming requests. Only clients that have a valid certificate will be able to reach the app.\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"functionapp*\"},{\"field\":\"Microsoft.Web/sites/clientCertEnabled\",\"equals\":\"false\"}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/eaebaea7-8013-4ceb-9d14-7eb32271373c\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"eaebaea7-8013-4ceb-9d14-7eb32271373c\"},{\"properties\":{\"displayName\":\"Log checkpoints should be enabled for PostgreSQL database servers\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy helps audit any PostgreSQL databases in your environment without log_checkpoints setting enabled.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.DBforPostgreSQL/servers\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.DBforPostgreSQL/servers/configurations\",\"name\":\"log_checkpoints\",\"existenceCondition\":{\"field\":\"Microsoft.DBforPostgreSQL/servers/configurations/value\",\"equals\":\"ON\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/eb6f77b9-bd53-4e35-a23d-7f65d5f0e43d\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"eb6f77b9-bd53-4e35-a23d-7f65d5f0e43d\"},{\"properties\":{\"displayName\":\"Log connections should be enabled for PostgreSQL database servers\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy helps audit any PostgreSQL databases in your environment without log_connections setting enabled.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.DBforPostgreSQL/servers\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.DBforPostgreSQL/servers/configurations\",\"name\":\"log_connections\",\"existenceCondition\":{\"field\":\"Microsoft.DBforPostgreSQL/servers/configurations/value\",\"equals\":\"ON\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/eb6f77b9-bd53-4e35-a23d-7f65d5f0e442\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"eb6f77b9-bd53-4e35-a23d-7f65d5f0e442\"},{\"properties\":{\"displayName\":\"Disconnections should be logged for PostgreSQL database servers.\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy helps audit any PostgreSQL databases in your environment without log_disconnections enabled.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.DBforPostgreSQL/servers\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.DBforPostgreSQL/servers/configurations\",\"name\":\"log_disconnections\",\"existenceCondition\":{\"field\":\"Microsoft.DBforPostgreSQL/servers/configurations/value\",\"equals\":\"ON\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/eb6f77b9-bd53-4e35-a23d-7f65d5f0e446\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"eb6f77b9-bd53-4e35-a23d-7f65d5f0e446\"},{\"properties\":{\"displayName\":\"Log duration should be enabled for PostgreSQL database servers\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy helps audit any PostgreSQL databases in your environment without log_duration setting enabled.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.DBforPostgreSQL/servers\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.DBforPostgreSQL/servers/configurations\",\"name\":\"log_duration\",\"existenceCondition\":{\"field\":\"Microsoft.DBforPostgreSQL/servers/configurations/value\",\"equals\":\"ON\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/eb6f77b9-bd53-4e35-a23d-7f65d5f0e8f3\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"eb6f77b9-bd53-4e35-a23d-7f65d5f0e8f3\"},{\"properties\":{\"displayName\":\"Deprecated accounts with owner permissions should be removed from your subscription\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Deprecated accounts with owner permissions should be removed from your subscription.  Deprecated accounts are accounts that have been blocked from signing in.\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"RemoveDeprecatedAccountsWithOwnerPermissions\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/ebb62a0c-3560-49e1-89ed-27e074e9f8ad\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"ebb62a0c-3560-49e1-89ed-27e074e9f8ad\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy prerequisites to audit Linux VMs that allow remote connections from accounts without passwords\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Linux virtual machines that allow remote connections from accounts without passwords. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"microsoft-aks\",\"AzureDatabricks\",\"qubole-inc\",\"datastax\",\"couchbase\",\"scalegrid\",\"checkpoint\",\"paloaltonetworks\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"OpenLogic\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"CentOS*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"RHEL\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"osa\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"credativ\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Debian\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"7*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Suse\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"SLES*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"11*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Canonical\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"UbuntuServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"12*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"linux-data-science-vm-ubuntu\",\"azureml\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-centos-os\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-altus-centos-os\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"linux*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"linux*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"PasswordPolicy_msid110\",\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"PasswordPolicy_msid110\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforLinux')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforLinux\",\"typeHandlerVersion\":\"1.0\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/ec49586f-4939-402d-a29e-6ff502b20592\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"ec49586f-4939-402d-a29e-6ff502b20592\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'Administrative Templates - Control Panel'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Administrative Templates - Control Panel'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_AdministrativeTemplatesControlPanel\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_AdministrativeTemplatesControlPanel\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/ec7ac234-2af5-4729-94d2-c557c071799d\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"ec7ac234-2af5-4729-94d2-c557c071799d\"},{\"properties\":{\"displayName\":\"Deploy Diagnostic Settings for Key Vault to Event Hub\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploys the diagnostic settings for Key Vault to stream to a regional Event Hub when any Key Vault which is missing this diagnostic settings is created or updated.\",\"metadata\":{\"category\":\"Key Vault\"},\"parameters\":{\"profileName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Profile name\",\"description\":\"The diagnostic settings profile name\"}},\"eventHubRuleId\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Event Hub Authorization Rule Id\",\"description\":\"The Event Hub authorization rule Id for Azure Diagnostics. The authorization rule needs to be at Event Hub namespace level. e.g. /subscriptions/{subscription Id}/resourceGroups/{resource group}/providers/Microsoft.EventHub/namespaces/{Event Hub namespace}/authorizationrules/{authorization rule}\",\"strongType\":\"Microsoft.EventHub/Namespaces/AuthorizationRules\",\"assignPermissions\":true}},\"metricsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable metrics\",\"description\":\"Whether to enable metrics stream to the Event Hub - True or False\"},\"allowedValues\":[\"True\",\"False\"]},\"logsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable logs\",\"description\":\"Whether to enable logs stream to the Event Hub  - True or False\"},\"allowedValues\":[\"True\",\"False\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.KeyVault/vaults\"},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"name\":\"[parameters('profileName')]\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"[parameters('logsEnabled')]\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\"equals\":\"[parameters('metricsEnabled')]\"}]},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vaultName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"eventHubRuleId\":{\"type\":\"string\"},\"metricsEnabled\":{\"type\":\"string\"},\"logsEnabled\":{\"type\":\"string\"},\"profileName\":{\"type\":\"string\"}},\"resources\":[{\"type\":\"Microsoft.KeyVault/vaults/providers/diagnosticSettings\",\"apiVersion\":\"2017-05-01-preview\",\"name\":\"[concat(parameters('vaultName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\"location\":\"[parameters('location')]\",\"dependsOn\":[],\"properties\":{\"eventHubAuthorizationRuleId\":\"[parameters('eventHubRuleId')]\",\"metrics\":[{\"category\":\"AllMetrics\",\"enabled\":\"[parameters('metricsEnabled')]\",\"retentionPolicy\":{\"enabled\":false,\"days\":0}}],\"logs\":[{\"category\":\"AuditEvent\",\"enabled\":\"[parameters('logsEnabled')]\"}]}}],\"outputs\":{\"policy\":{\"type\":\"string\",\"value\":\"[concat('Enabled diagnostic settings for ', parameters('vaultName'))]\"}}},\"parameters\":{\"location\":{\"value\":\"[field('location')]\"},\"vaultName\":{\"value\":\"[field('name')]\"},\"eventHubRuleId\":{\"value\":\"[parameters('eventHubRuleId')]\"},\"metricsEnabled\":{\"value\":\"[parameters('metricsEnabled')]\"},\"logsEnabled\":{\"value\":\"[parameters('logsEnabled')]\"},\"profileName\":{\"value\":\"[parameters('profileName')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/ed7c8c13-51e7-49d1-8a43-8490431a0da2\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"ed7c8c13-51e7-49d1-8a43-8490431a0da2\"},{\"properties\":{\"displayName\":\"Deploy Diagnostic Settings for Stream Analytics to Event Hub\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploys the diagnostic settings for Stream Analytics to stream to a regional Event Hub when any Stream Analytics which is missing this diagnostic settings is created or updated.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"DeployIfNotExists\",\"Disabled\"]},\"profileName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Profile name\",\"description\":\"The diagnostic settings profile name\"}},\"eventHubRuleId\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Event Hub Authorization Rule Id\",\"description\":\"The Event Hub authorization rule Id for Azure Diagnostics. The authorization rule needs to be at Event Hub namespace level. e.g. /subscriptions/{subscription Id}/resourceGroups/{resource group}/providers/Microsoft.EventHub/namespaces/{Event Hub namespace}/authorizationrules/{authorization rule}\",\"strongType\":\"Microsoft.EventHub/Namespaces/AuthorizationRules\",\"assignPermissions\":true}},\"metricsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable metrics\",\"description\":\"Whether to enable metrics stream to the Event Hub - True or False\"},\"allowedValues\":[\"True\",\"False\"]},\"logsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable logs\",\"description\":\"Whether to enable logs stream to the Event Hub  - True or False\"},\"allowedValues\":[\"True\",\"False\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.StreamAnalytics/streamingjobs\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"name\":\"[parameters('profileName')]\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"[parameters('logsEnabled')]\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\"equals\":\"[parameters('metricsEnabled')]\"}]},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"resourceName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"eventHubRuleId\":{\"type\":\"string\"},\"metricsEnabled\":{\"type\":\"string\"},\"logsEnabled\":{\"type\":\"string\"},\"profileName\":{\"type\":\"string\"}},\"variables\":{},\"resources\":[{\"type\":\"Microsoft.StreamAnalytics/streamingjobs/providers/diagnosticSettings\",\"apiVersion\":\"2017-05-01-preview\",\"name\":\"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\"location\":\"[parameters('location')]\",\"dependsOn\":[],\"properties\":{\"eventHubAuthorizationRuleId\":\"[parameters('eventHubRuleId')]\",\"metrics\":[{\"category\":\"AllMetrics\",\"enabled\":\"[parameters('metricsEnabled')]\",\"retentionPolicy\":{\"enabled\":false,\"days\":0}}],\"logs\":[{\"category\":\"Execution\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"Authoring\",\"enabled\":\"[parameters('logsEnabled')]\"}]}}],\"outputs\":{}},\"parameters\":{\"location\":{\"value\":\"[field('location')]\"},\"resourceName\":{\"value\":\"[field('name')]\"},\"eventHubRuleId\":{\"value\":\"[parameters('eventHubRuleId')]\"},\"metricsEnabled\":{\"value\":\"[parameters('metricsEnabled')]\"},\"logsEnabled\":{\"value\":\"[parameters('logsEnabled')]\"},\"profileName\":{\"value\":\"[parameters('profileName')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/edf3780c-3d70-40fe-b17e-ab72013dafca\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"edf3780c-3d70-40fe-b17e-ab72013dafca\"},{\"properties\":{\"displayName\":\"Vulnerability assessment should be enabled on your SQL servers\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit Azure SQL servers which do not have recurring vulnerability assessment scans enabled. Vulnerability assessment can discover, track, and help you remediate potential database vulnerabilities.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Sql/servers\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Sql/servers/vulnerabilityAssessments\",\"name\":\"default\",\"existenceCondition\":{\"field\":\"Microsoft.Sql/servers/vulnerabilityAssessments/recurringScans.isEnabled\",\"equals\":\"True\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/ef2a8f2a-b3d9-49cd-a8a8-9a3aaaf647d9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"ef2a8f2a-b3d9-49cd-a8a8-9a3aaaf647d9\"},{\"properties\":{\"displayName\":\"Deploy Diagnostic Settings for Event Hub to Event Hub\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Deploys the diagnostic settings for Event Hub to stream to a regional Event Hub when any Event Hub which is missing this diagnostic settings is created or updated.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"DeployIfNotExists\",\"Disabled\"]},\"profileName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Profile name\",\"description\":\"The diagnostic settings profile name\"}},\"eventHubRuleId\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Event Hub Authorization Rule Id\",\"description\":\"The Event Hub authorization rule Id for Azure Diagnostics. The authorization rule needs to be at Event Hub namespace level. e.g. /subscriptions/{subscription Id}/resourceGroups/{resource group}/providers/Microsoft.EventHub/namespaces/{Event Hub namespace}/authorizationrules/{authorization rule}\",\"strongType\":\"Microsoft.EventHub/Namespaces/AuthorizationRules\",\"assignPermissions\":true}},\"metricsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable metrics\",\"description\":\"Whether to enable metrics stream to the Event Hub - True or False\"},\"allowedValues\":[\"True\",\"False\"]},\"logsEnabled\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Enable logs\",\"description\":\"Whether to enable logs stream to the Event Hub  - True or False\"},\"allowedValues\":[\"True\",\"False\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.EventHub/namespaces\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"name\":\"[parameters('profileName')]\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"[parameters('logsEnabled')]\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\"equals\":\"[parameters('metricsEnabled')]\"}]},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"resourceName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"eventHubRuleId\":{\"type\":\"string\"},\"metricsEnabled\":{\"type\":\"string\"},\"logsEnabled\":{\"type\":\"string\"},\"profileName\":{\"type\":\"string\"}},\"variables\":{},\"resources\":[{\"type\":\"Microsoft.EventHub/namespaces/providers/diagnosticSettings\",\"apiVersion\":\"2017-05-01-preview\",\"name\":\"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\"location\":\"[parameters('location')]\",\"dependsOn\":[],\"properties\":{\"eventHubAuthorizationRuleId\":\"[parameters('eventHubRuleId')]\",\"metrics\":[{\"category\":\"AllMetrics\",\"enabled\":\"[parameters('metricsEnabled')]\",\"retentionPolicy\":{\"enabled\":false,\"days\":0}}],\"logs\":[{\"category\":\"ArchiveLogs\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"OperationalLogs\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"AutoScaleLogs\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"KafkaCoordinatorLogs\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"EventHubVNetConnectionEvent\",\"enabled\":\"[parameters('logsEnabled')]\"},{\"category\":\"CustomerManagedKeyUserLogs\",\"enabled\":\"[parameters('logsEnabled')]\"}]}}],\"outputs\":{}},\"parameters\":{\"location\":{\"value\":\"[field('location')]\"},\"resourceName\":{\"value\":\"[field('name')]\"},\"eventHubRuleId\":{\"value\":\"[parameters('eventHubRuleId')]\"},\"metricsEnabled\":{\"value\":\"[parameters('metricsEnabled')]\"},\"logsEnabled\":{\"value\":\"[parameters('logsEnabled')]\"},\"profileName\":{\"value\":\"[parameters('profileName')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/ef7b61ef-b8e4-4c91-8e78-6946c6b0023f\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"ef7b61ef-b8e4-4c91-8e78-6946c6b0023f\"},{\"properties\":{\"displayName\":\"The Log Analytics agent should be installed on Virtual Machine Scale Sets\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy audits any Windows/Linux Virtual Machine Scale Sets if the Log Analytics agent is not installed.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachineScaleSets\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Compute/virtualMachineScaleSets/extensions\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\"equals\":\"Microsoft.EnterpriseCloud.Monitoring\"},{\"field\":\"Microsoft.Compute/virtualMachineScaleSets/extensions/type\",\"in\":[\"MicrosoftMonitoringAgent\",\"OmsAgentForLinux\"]},{\"field\":\"Microsoft.Compute/virtualMachineScaleSets/extensions/provisioningState\",\"equals\":\"Succeeded\"},{\"field\":\"Microsoft.Compute/virtualMachineScaleSets/extensions/settings.workspaceId\",\"exists\":\"true\"}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/efbde977-ba53-4479-b8e9-10b957924fbf\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"efbde977-ba53-4479-b8e9-10b957924fbf\"},{\"properties\":{\"displayName\":\"Ensure that Register with Azure Active Directory is enabled on Function App\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Managed service identity in App Service makes the app more secure by eliminating secrets from the app, such as credentials in the connection strings. When registering with Azure Active Directory in the app service, the app will connect to other Azure services securely without the need of username and passwords\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"functionapp*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/web.managedServiceIdentityId\",\"exists\":\"true\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/f0473e7a-a1ba-4e86-afb2-e829e11b01d8\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"f0473e7a-a1ba-4e86-afb2-e829e11b01d8\"},{\"properties\":{\"displayName\":\"Deploy prerequisites to audit Windows VMs that have the specified applications installed\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines that have the specified applications installed. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"ApplicationName\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Application names (supports wildcards)\",\"description\":\"A semicolon-separated list of the names of the applications that should not be installed. e.g. 'Microsoft SQL Server 2014 (64-bit); Microsoft Visual Studio Code' or 'Microsoft SQL Server 2014*' (to match any application starting with 'Microsoft SQL Server 2014')\"}}},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"NotInstalledApplication\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('[InstalledApplication]NotInstalledApplicationResource1;Name', '=', parameters('ApplicationName')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"NotInstalledApplication\"},\"ApplicationName\":{\"value\":\"[parameters('ApplicationName')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"ApplicationName\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[InstalledApplication]NotInstalledApplicationResource1;Name\",\"value\":\"[parameters('ApplicationName')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[InstalledApplication]NotInstalledApplicationResource1;Name\",\"value\":\"[parameters('ApplicationName')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/f0633351-c7b2-41ff-9981-508fc08553c2\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"f0633351-c7b2-41ff-9981-508fc08553c2\"},{\"properties\":{\"displayName\":\"Latest TLS version should be used in your Web App\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Upgrade to the latest TLS version\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"app*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/minTlsVersion\",\"equals\":\"1.2\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/f0e6e85b-9b9f-4a4b-b67b-f730d42f1b0b\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"f0e6e85b-9b9f-4a4b-b67b-f730d42f1b0b\"},{\"properties\":{\"displayName\":\"Virtual networks should use specified virtual network gateway\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy audits any virtual network if the default route does not point to the specified virtual network gateway.\",\"metadata\":{\"category\":\"Network\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]},\"virtualNetworkGatewayId\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Virtual network gateway Id\",\"description\":\"Resource Id of the virtual network gateway. Example: /subscriptions/YourSubscriptionId/resourceGroups/YourResourceGroup/providers/Microsoft.Network/virtualNetworkGateways/Name\"}}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Network/virtualNetworks\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Network/virtualNetworks/subnets\",\"name\":\"GatewaySubnet\",\"existenceCondition\":{\"not\":{\"field\":\"Microsoft.Network/virtualNetworks/subnets/ipConfigurations[*].id\",\"notContains\":\"[concat(parameters('virtualNetworkGatewayId'), '/')]\"}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/f1776c76-f58c-4245-a8d0-2b207198dc8b\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"f1776c76-f58c-4245-a8d0-2b207198dc8b\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy prerequisites to audit Linux VMs that do not have the passwd file permissions set to 0644\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Linux virtual machines that do not have the passwd file permissions set to 0644. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"microsoft-aks\",\"AzureDatabricks\",\"qubole-inc\",\"datastax\",\"couchbase\",\"scalegrid\",\"checkpoint\",\"paloaltonetworks\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"OpenLogic\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"CentOS*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"RHEL\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"osa\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"credativ\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Debian\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"7*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Suse\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"SLES*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"11*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Canonical\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"UbuntuServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"12*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"linux-data-science-vm-ubuntu\",\"azureml\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-centos-os\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-altus-centos-os\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"linux*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"linux*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"PasswordPolicy_msid121\",\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"PasswordPolicy_msid121\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforLinux')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforLinux\",\"typeHandlerVersion\":\"1.0\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/f19aa1c1-6b91-4c27-ae6a-970279f03db9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"f19aa1c1-6b91-4c27-ae6a-970279f03db9\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'Adminstrative Templates - MSS (Legacy)'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Adminstrative Templates - MSS (Legacy)'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_AdminstrativeTemplatesMSSLegacy\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_AdminstrativeTemplatesMSSLegacy\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\"}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/f1f4825d-58fb-4257-8016-8c00e3c9ed9d\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"f1f4825d-58fb-4257-8016-8c00e3c9ed9d\"},{\"properties\":{\"displayName\":\"Show audit results from Windows VMs in which the Administrators group does not contain all of the specified members\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines in which the Administrators group does not contain all of the specified members. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AdministratorsGroupMembersToInclude\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/f3b44e5d-1456-475f-9c67-c66c4618e85a\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"f3b44e5d-1456-475f-9c67-c66c4618e85a\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs that do not contain the specified certificates in Trusted Root\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows VMs that do not contain the specified certificates in the Trusted Root Certification Authorities certificate store (Cert:\\\\LocalMachine\\\\Root). For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WindowsCertificateInTrustedRoot\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/f3b9ad83-000d-4dc1-bff0-6d54533dd03f\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"f3b9ad83-000d-4dc1-bff0-6d54533dd03f\"},{\"properties\":{\"displayName\":\"[Preview]: Audit Log Analytics Workspace for VM - Report Mismatch\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Reports VMs as non-compliant if they not logging to the LA workspace specified in the policy/initiative assignment.\",\"metadata\":{\"category\":\"Monitoring\"},\"parameters\":{\"logAnalyticsWorkspaceId\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Log Analytics Workspace Id that VMs should be configured for\",\"description\":\"This is the Id (GUID) of the Log Analytics Workspace that the VMs should be configured for.\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines/extensions\"},{\"field\":\"Microsoft.Compute/virtualMachines/extensions/publisher\",\"equals\":\"Microsoft.EnterpriseCloud.Monitoring\"},{\"field\":\"Microsoft.Compute/virtualMachines/extensions/settings.workspaceId\",\"notEquals\":\"[parameters('logAnalyticsWorkspaceId')]\"}]},\"then\":{\"effect\":\"audit\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/f47b5582-33ec-4c5c-87c0-b010a6b2e917\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"f47b5582-33ec-4c5c-87c0-b010a6b2e917\"},{\"properties\":{\"displayName\":\"Authorization rules on the Event Hub instance should be defined\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Audit existence of authorization rules on Event Hub entities to grant least-privileged access\",\"metadata\":{\"category\":\"Event Hub\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.EventHub/namespaces/eventhubs\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.EventHub/namespaces/eventHubs/authorizationRules\"}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/f4826e5f-6a27-407c-ae3e-9582eb39891d\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"f4826e5f-6a27-407c-ae3e-9582eb39891d\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs that do not have the password complexity setting enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines that do not have the password complexity setting enabled. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"PasswordMustMeetComplexityRequirements\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/f48b2913-1dc5-4834-8c72-ccc1dfd819bb\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"f48b2913-1dc5-4834-8c72-ccc1dfd819bb\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy prerequisites to audit Windows VMs that have not restarted within the specified number of days\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines that have not restarted within the specified number of days. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"NumberOfDays\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Number of days\",\"description\":\"The number of days without restart until the machine is considered non-compliant\"}}},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"MachineLastBootUpTime\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('[MachineUpTime]MachineLastBootUpTime;NumberOfDays', '=', parameters('NumberOfDays')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"type\":{\"value\":\"[field('type')]\"},\"configurationName\":{\"value\":\"MachineLastBootUpTime\"},\"NumberOfDays\":{\"value\":\"[parameters('NumberOfDays')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"NumberOfDays\":{\"type\":\"string\"}},\"resources\":[{\"condition\":\"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[MachineUpTime]MachineLastBootUpTime;NumberOfDays\",\"value\":\"[parameters('NumberOfDays')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"[MachineUpTime]MachineLastBootUpTime;NumberOfDays\",\"value\":\"[parameters('NumberOfDays')]\"}]}}},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"condition\":\"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/f4b245d4-46c9-42be-9b1a-49e2b5b94194\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"f4b245d4-46c9-42be-9b1a-49e2b5b94194\"},{\"properties\":{\"displayName\":\"Deploy Auditing on SQL servers\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy ensures that Auditing is enabled on SQL Servers for enhanced security and compliance. It will automatically create a storage account in the same region as the SQL server to store audit records.\",\"metadata\":{\"category\":\"SQL\"},\"parameters\":{\"retentionDays\":{\"type\":\"String\",\"metadata\":{\"description\":\"The value in days of the retention period (0 indicates unlimited retention)\",\"displayName\":\"Retention days (optional, 180 days if unspecified)\"}},\"storageAccountsResourceGroup\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Resource group name for storage accounts\",\"description\":\"Auditing writes database events to an audit log in your Azure Storage account (a storage account will be created in each region where a SQL Server is created that will be shared by all servers in that region). Important - for proper operation of Auditing do not delete or rename the resource group or the storage accounts.\",\"strongType\":\"existingResourceGroups\"}}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Sql/servers\"},\"then\":{\"effect\":\"DeployIfNotExists\",\"details\":{\"type\":\"Microsoft.Sql/servers/auditingSettings\",\"name\":\"Default\",\"existenceCondition\":{\"field\":\"Microsoft.Sql/auditingSettings.state\",\"equals\":\"Enabled\"},\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/056cd41c-7e88-42e1-933e-88ba6a50c9c3\",\"/providers/microsoft.authorization/roleDefinitions/17d1049b-9a84-46fb-8f53-869881c3d3ab\"],\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"template\":{\"$schema\":\"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"serverName\":{\"type\":\"string\"},\"auditRetentionDays\":{\"type\":\"string\"},\"storageAccountsResourceGroup\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"}},\"variables\":{\"retentionDays\":\"[int(parameters('auditRetentionDays'))]\",\"subscriptionId\":\"[subscription().subscriptionId]\",\"uniqueStorage\":\"[uniqueString(variables('subscriptionId'), parameters('location'), parameters('storageAccountsResourceGroup'))]\",\"locationCode\":\"[substring(parameters('location'), 0, 3)]\",\"storageName\":\"[tolower(concat('sqlaudit', variables('locationCode'), variables('uniqueStorage')))]\",\"createStorageAccountDeploymentName\":\"[concat('sqlServerAuditingStorageAccount-', uniqueString(variables('locationCode'), parameters('serverName')))]\"},\"resources\":[{\"apiVersion\":\"2017-05-10\",\"name\":\"[variables('createStorageAccountDeploymentName')]\",\"type\":\"Microsoft.Resources/deployments\",\"resourceGroup\":\"[parameters('storageAccountsResourceGroup')]\",\"properties\":{\"mode\":\"Incremental\",\"parameters\":{\"location\":{\"value\":\"[parameters('location')]\"},\"storageName\":{\"value\":\"[variables('storageName')]\"}},\"templateLink\":{\"uri\":\"https://raw.githubusercontent.com/Azure/azure-policy/master/samples/SQL/deploy-sql-server-auditing/createStorage.template.json\",\"contentVersion\":\"1.0.0.0\"}}},{\"name\":\"[concat(parameters('serverName'), '/Default')]\",\"type\":\"Microsoft.Sql/servers/auditingSettings\",\"apiVersion\":\"2017-03-01-preview\",\"properties\":{\"state\":\"Enabled\",\"storageEndpoint\":\"[reference(variables('createStorageAccountDeploymentName')).outputs.storageAccountEndPoint.value]\",\"storageAccountAccessKey\":\"[reference(variables('createStorageAccountDeploymentName')).outputs.storageAccountKey.value]\",\"retentionDays\":\"[variables('retentionDays')]\",\"auditActionsAndGroups\":null,\"storageAccountSubscriptionId\":\"[subscription().subscriptionId]\",\"isStorageSecondaryKeyInUse\":false}}]},\"parameters\":{\"serverName\":{\"value\":\"[field('name')]\"},\"auditRetentionDays\":{\"value\":\"[parameters('retentionDays')]\"},\"storageAccountsResourceGroup\":{\"value\":\"[parameters('storageAccountsResourceGroup')]\"},\"location\":{\"value\":\"[field('location')]\"}}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/f4c68484-132f-41f9-9b6d-3e4b1cb55036\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"f4c68484-132f-41f9-9b6d-3e4b1cb55036\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'Security Options - Network Access'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Network Access'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"NetworkAccessRemotelyAccessibleRegistryPaths\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Network access: Remotely accessible registry paths\",\"description\":\"Specifies which registry paths will be accessible over the network, regardless of the users or groups listed in the access control list (ACL) of the `winreg` registry key.\"}},\"NetworkAccessRemotelyAccessibleRegistryPathsAndSubpaths\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Network access: Remotely accessible registry paths and sub-paths\",\"description\":\"Specifies which registry paths and sub-paths will be accessible over the network, regardless of the users or groups listed in the access control list (ACL) of the `winreg` registry key.\"}},\"NetworkAccessSharesThatCanBeAccessedAnonymously\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Network access: Shares that can be accessed anonymously\",\"description\":\"Specifies which network shares can be accessed by anonymous users. The default configuration for this policy setting has little effect because all users have to be authenticated before they can access shared resources on the server.\"}}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsNetworkAccess\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('Network access: Remotely accessible registry paths;ExpectedValue', '=', parameters('NetworkAccessRemotelyAccessibleRegistryPaths'), ',', 'Network access: Remotely accessible registry paths and sub-paths;ExpectedValue', '=', parameters('NetworkAccessRemotelyAccessibleRegistryPathsAndSubpaths'), ',', 'Network access: Shares that can be accessed anonymously;ExpectedValue', '=', parameters('NetworkAccessSharesThatCanBeAccessedAnonymously')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_SecurityOptionsNetworkAccess\"},\"NetworkAccessRemotelyAccessibleRegistryPaths\":{\"value\":\"[parameters('NetworkAccessRemotelyAccessibleRegistryPaths')]\"},\"NetworkAccessRemotelyAccessibleRegistryPathsAndSubpaths\":{\"value\":\"[parameters('NetworkAccessRemotelyAccessibleRegistryPathsAndSubpaths')]\"},\"NetworkAccessSharesThatCanBeAccessedAnonymously\":{\"value\":\"[parameters('NetworkAccessSharesThatCanBeAccessedAnonymously')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"NetworkAccessRemotelyAccessibleRegistryPaths\":{\"type\":\"string\"},\"NetworkAccessRemotelyAccessibleRegistryPathsAndSubpaths\":{\"type\":\"string\"},\"NetworkAccessSharesThatCanBeAccessedAnonymously\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"Network access: Remotely accessible registry paths;ExpectedValue\",\"value\":\"[parameters('NetworkAccessRemotelyAccessibleRegistryPaths')]\"},{\"name\":\"Network access: Remotely accessible registry paths and sub-paths;ExpectedValue\",\"value\":\"[parameters('NetworkAccessRemotelyAccessibleRegistryPathsAndSubpaths')]\"},{\"name\":\"Network access: Shares that can be accessed anonymously;ExpectedValue\",\"value\":\"[parameters('NetworkAccessSharesThatCanBeAccessedAnonymously')]\"}]}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/f56a3ab2-89d1-44de-ac0d-2ada5962e22a\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"f56a3ab2-89d1-44de-ac0d-2ada5962e22a\"},{\"properties\":{\"displayName\":\"Virtual machines should be associated with a Network Security Group\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"Protect your VM from potential threats by restricting access to it with a Network Security Group (NSG). NSGs contain a list of Access Control List (ACL) rules that allow or deny network traffic to your VM from other instances, in or outside the same subnet.\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"in\":[\"Microsoft.Compute/virtualMachines\",\"Microsoft.ClassicCompute/virtualMachines\"]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"networkSecurityGroupsOnVirtualMachines\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/f6de0be7-9a8a-4b8a-b349-43cf02d22f7c\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"f6de0be7-9a8a-4b8a-b349-43cf02d22f7c\"},{\"properties\":{\"displayName\":\"Show audit results from Windows VMs that do not have the specified Windows PowerShell execution policy\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines where Windows PowerShell is not configured to use the specified PowerShell execution policy. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"windows*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"WindowsPowerShellExecutionPolicy\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/f8036bd0-c10b-4931-86bb-94a878add855\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"f8036bd0-c10b-4931-86bb-94a878add855\"},{\"properties\":{\"displayName\":\"External accounts with owner permissions should be removed from your subscription\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"External accounts with owner permissions should be removed from your subscription in order to prevent unmonitored access.\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.Resources/subscriptions\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"RemoveExternalAccountsWithOwnerPermissions\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/f8456c1c-aa66-4dfb-861a-25d127b775c9\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"f8456c1c-aa66-4dfb-861a-25d127b775c9\"},{\"properties\":{\"displayName\":\"[Preview]: Deploy requirements to audit Windows VMs configurations in 'System Audit Policies - System'\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'System Audit Policies - System'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{\"AuditOtherSystemEvents\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Audit Other System Events\",\"description\":\"Specifies whether audit events are generated for Windows Firewall Service and Windows Firewall driver start and stop events, failure events for these services and Windows Firewall Service policy processing failures.\"},\"allowedValues\":[\"No Auditing\",\"Success\",\"Failure\",\"Success and Failure\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SystemAuditPoliciesSystem\",\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\"equals\":\"[base64(concat('Audit Other System Events;ExpectedValue', '=', parameters('AuditOtherSystemEvents')))]\"},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"},\"configurationName\":{\"value\":\"AzureBaseline_SystemAuditPoliciesSystem\"},\"AuditOtherSystemEvents\":{\"value\":\"[parameters('AuditOtherSystemEvents')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"},\"configurationName\":{\"type\":\"string\"},\"AuditOtherSystemEvents\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2018-11-20\",\"type\":\"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\"name\":\"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\"location\":\"[parameters('location')]\",\"properties\":{\"guestConfiguration\":{\"name\":\"[parameters('configurationName')]\",\"version\":\"1.*\",\"configurationParameter\":[{\"name\":\"Audit Other System Events;ExpectedValue\",\"value\":\"[parameters('AuditOtherSystemEvents')]\"}]}}},{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforWindows\",\"typeHandlerVersion\":\"1.1\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}},\"dependsOn\":[\"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"]}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/f8b0158d-4766-490f-bea0-259e52dba473\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"f8b0158d-4766-490f-bea0-259e52dba473\"},{\"properties\":{\"displayName\":\"Diagnostic logs in Service Bus should be enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit enabling of diagnostic logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised\",\"metadata\":{\"category\":\"Service Bus\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]},\"requiredRetentionDays\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Required retention (days)\",\"description\":\"The required diagnostic logs retention in days\"}}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.ServiceBus/namespaces\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"existenceCondition\":{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\"equals\":\"true\"},{\"anyOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\"equals\":\"0\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\"equals\":\"[parameters('requiredRetentionDays')]\"}]},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"true\"}]},{\"allOf\":[{\"not\":{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\"equals\":\"true\"}},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"true\"}]}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/f8d36e2f-389b-4ee4-898d-21aeb69a0f45\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"f8d36e2f-389b-4ee4-898d-21aeb69a0f45\"},{\"properties\":{\"displayName\":\"Diagnostic logs in Azure Stream Analytics should be enabled\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Audit enabling of diagnostic logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised\",\"metadata\":{\"category\":\"Stream Analytics\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]},\"requiredRetentionDays\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Required retention (days)\",\"description\":\"The required diagnostic logs retention in days\"}}},\"policyRule\":{\"if\":{\"field\":\"type\",\"equals\":\"Microsoft.StreamAnalytics/streamingJobs\"},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Insights/diagnosticSettings\",\"existenceCondition\":{\"anyOf\":[{\"allOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\"equals\":\"true\"},{\"anyOf\":[{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\"equals\":\"0\"},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\"equals\":\"[parameters('requiredRetentionDays')]\"}]},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"true\"}]},{\"allOf\":[{\"not\":{\"field\":\"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\"equals\":\"true\"}},{\"field\":\"Microsoft.Insights/diagnosticSettings/logs.enabled\",\"equals\":\"true\"}]}]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/f9be5368-9bf5-4b84-9e0a-7850da98bb46\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"f9be5368-9bf5-4b84-9e0a-7850da98bb46\"},{\"properties\":{\"displayName\":\"Latest TLS version should be used in your Function App\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Upgrade to the latest TLS version\",\"metadata\":{\"category\":\"App Service\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Web/sites\"},{\"field\":\"kind\",\"like\":\"functionapp*\"}]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Web/sites/config\",\"name\":\"web\",\"existenceCondition\":{\"field\":\"Microsoft.Web/sites/config/minTlsVersion\",\"equals\":\"1.2\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/f9d614c5-c173-4d56-95a7-b4437057d193\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"f9d614c5-c173-4d56-95a7-b4437057d193\"},{\"properties\":{\"displayName\":\"Deploy prerequisites to enable Guest Configuration Policy on Linux VMs.\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"This policy creates a system-assigned managed identity and deploys the VM extension for Guest Configuration on Linux VMs. This is a prerequisites for Guest Configuration Policy and must be assigned to the scope before using any Guest Configuration policy. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol.\",\"metadata\":{\"category\":\"Guest Configuration\",\"requiredProviders\":[\"Microsoft.GuestConfiguration\"]},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"microsoft-aks\",\"AzureDatabricks\",\"qubole-inc\",\"datastax\",\"couchbase\",\"scalegrid\",\"checkpoint\",\"paloaltonetworks\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"OpenLogic\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"CentOS*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"RHEL\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"osa\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"credativ\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Debian\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"7*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Suse\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"SLES*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"11*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Canonical\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"UbuntuServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"12*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"linux-data-science-vm-ubuntu\",\"azureml\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-centos-os\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-altus-centos-os\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"linux*\"}]}]}]},\"then\":{\"effect\":\"deployIfNotExists\",\"details\":{\"roleDefinitionIds\":[\"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"],\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"name\":\"AzurePolicyforLinux\",\"existenceCondition\":{\"allOf\":[{\"field\":\"Microsoft.Compute/virtualMachines/extensions/publisher\",\"equals\":\"Microsoft.GuestConfiguration\"},{\"field\":\"Microsoft.Compute/virtualMachines/extensions/type\",\"equals\":\"ConfigurationforLinux\"}]},\"deployment\":{\"properties\":{\"mode\":\"incremental\",\"parameters\":{\"vmName\":{\"value\":\"[field('name')]\"},\"location\":{\"value\":\"[field('location')]\"}},\"template\":{\"$schema\":\"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\"contentVersion\":\"1.0.0.0\",\"parameters\":{\"vmName\":{\"type\":\"string\"},\"location\":{\"type\":\"string\"}},\"resources\":[{\"apiVersion\":\"2017-03-30\",\"type\":\"Microsoft.Compute/virtualMachines\",\"identity\":{\"type\":\"SystemAssigned\"},\"name\":\"[parameters('vmName')]\",\"location\":\"[parameters('location')]\"},{\"apiVersion\":\"2015-05-01-preview\",\"name\":\"[concat(parameters('vmName'), '/AzurePolicyforLinux')]\",\"type\":\"Microsoft.Compute/virtualMachines/extensions\",\"location\":\"[parameters('location')]\",\"properties\":{\"publisher\":\"Microsoft.GuestConfiguration\",\"type\":\"ConfigurationforLinux\",\"typeHandlerVersion\":\"1.0\",\"autoUpgradeMinorVersion\":true,\"settings\":{},\"protectedSettings\":{}}}]}}}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/fb27e9e0-526e-4ae1-89f2-a2a0bf0f8a50\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"fb27e9e0-526e-4ae1-89f2-a2a0bf0f8a50\"},{\"properties\":{\"displayName\":\"[Preview]: Kubernetes Services should be upgraded to a non-vulnerable Kubernetes version\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Upgrade your Kubernetes service cluster to a later Kubernetes version to protect against known vulnerabilities in your current Kubernetes version. Vulnerability CVE-2019-9946 has been patched in Kubernetes versions 1.11.9+, 1.12.7+, 1.13.5+, and 1.14.0+\",\"metadata\":{\"category\":\"Security Center\",\"preview\":true},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"Audit\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.ContainerService/managedClusters\"},{\"anyOf\":[{\"field\":\"Microsoft.ContainerService/managedClusters/kubernetesVersion\",\"in\":[\"1.13.4\",\"1.13.3\",\"1.13.2\",\"1.13.1\",\"1.13.0\"]},{\"field\":\"Microsoft.ContainerService/managedClusters/kubernetesVersion\",\"in\":[\"1.12.6\",\"1.12.5\",\"1.12.4\",\"1.12.3\",\"1.12.2\",\"1.12.1\",\"1.12.0\"]},{\"field\":\"Microsoft.ContainerService/managedClusters/kubernetesVersion\",\"in\":[\"1.11.8\",\"1.11.7\",\"1.11.6\",\"1.11.5\",\"1.11.4\",\"1.11.3\",\"1.11.2\",\"1.11.1\",\"1.11.0\"]},{\"field\":\"Microsoft.ContainerService/managedClusters/kubernetesVersion\",\"like\":\"1.10.*\"},{\"field\":\"Microsoft.ContainerService/managedClusters/kubernetesVersion\",\"like\":\"1.9.*\"},{\"field\":\"Microsoft.ContainerService/managedClusters/kubernetesVersion\",\"like\":\"1.8.*\"},{\"field\":\"Microsoft.ContainerService/managedClusters/kubernetesVersion\",\"like\":\"1.7.*\"},{\"field\":\"Microsoft.ContainerService/managedClusters/kubernetesVersion\",\"like\":\"1.6.*\"},{\"field\":\"Microsoft.ContainerService/managedClusters/kubernetesVersion\",\"like\":\"1.5.*\"},{\"field\":\"Microsoft.ContainerService/managedClusters/kubernetesVersion\",\"like\":\"1.4.*\"},{\"field\":\"Microsoft.ContainerService/managedClusters/kubernetesVersion\",\"like\":\"1.3.*\"},{\"field\":\"Microsoft.ContainerService/managedClusters/kubernetesVersion\",\"like\":\"1.2.*\"},{\"field\":\"Microsoft.ContainerService/managedClusters/kubernetesVersion\",\"like\":\"1.1.*\"},{\"field\":\"Microsoft.ContainerService/managedClusters/kubernetesVersion\",\"like\":\"1.0.*\"}]}]},\"then\":{\"effect\":\"[parameters('effect')]\"}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/fb893a29-21bb-418c-a157-e99480ec364c\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"fb893a29-21bb-418c-a157-e99480ec364c\"},{\"properties\":{\"displayName\":\"[Preview]: Show audit results from Windows VMs configurations in 'Security Options - Microsoft Network Client'\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Microsoft Network Client'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"esri\",\"incredibuild\",\"MicrosoftDynamicsAX\",\"MicrosoftSharepoint\",\"MicrosoftVisualStudio\",\"MicrosoftWindowsDesktop\",\"MicrosoftWindowsServerHPCPack\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftWindowsServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"2008*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"MicrosoftSQLServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notEquals\":\"SQL2008R2SP3-WS2008R2SP1\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"dsvm-windows\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"standard-data-science-vm\",\"windows-data-science-vm\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"batch\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"rendering-windows2016\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"center-for-internet-security-inc\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"cis-windows-server-201*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"pivotal\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"bosh-windows-server*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloud-infrastructure-services\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"ad*\"}]}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"AzureBaseline_SecurityOptionsMicrosoftNetworkClient\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/fcbc55c9-f25a-4e55-a6cb-33acb3be778b\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"fcbc55c9-f25a-4e55-a6cb-33acb3be778b\"},{\"properties\":{\"displayName\":\"Show audit results from Linux VMs that do not have the specified applications installed\",\"policyType\":\"BuiltIn\",\"mode\":\"All\",\"description\":\"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Linux virtual machines that do not have the specified applications installed. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\"metadata\":{\"category\":\"Guest Configuration\"},\"parameters\":{},\"policyRule\":{\"if\":{\"anyOf\":[{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Compute/virtualMachines\"},{\"anyOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"in\":[\"microsoft-aks\",\"AzureDatabricks\",\"qubole-inc\",\"datastax\",\"couchbase\",\"scalegrid\",\"checkpoint\",\"paloaltonetworks\"]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"OpenLogic\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"CentOS*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"RHEL\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"RedHat\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"osa\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"credativ\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"Debian\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"7*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Suse\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"SLES*\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"11*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"Canonical\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"UbuntuServer\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"12*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-dsvm\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"in\":[\"linux-data-science-vm-ubuntu\",\"azureml\"]}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-centos-os\"},{\"field\":\"Microsoft.Compute/imageSKU\",\"notLike\":\"6*\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"cloudera\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"equals\":\"cloudera-altus-centos-os\"}]},{\"allOf\":[{\"field\":\"Microsoft.Compute/imagePublisher\",\"equals\":\"microsoft-ads\"},{\"field\":\"Microsoft.Compute/imageOffer\",\"like\":\"linux*\"}]}]}]},{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.HybridCompute/machines\"},{\"field\":\"Microsoft.HybridCompute/imageOffer\",\"like\":\"linux*\"}]}]},\"then\":{\"effect\":\"auditIfNotExists\",\"details\":{\"type\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\"name\":\"installed_application_linux\",\"existenceCondition\":{\"field\":\"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\"equals\":\"Compliant\"}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/fee5cb2b-9d9b-410e-afe3-2902d90d0004\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"fee5cb2b-9d9b-410e-afe3-2902d90d0004\"},{\"properties\":{\"displayName\":\"Vulnerabilities on your SQL databases should be remediated\",\"policyType\":\"BuiltIn\",\"mode\":\"Indexed\",\"description\":\"Monitor Vulnerability Assessment scan results and recommendations for how to remediate database vulnerabilities.\",\"metadata\":{\"category\":\"Security Center\"},\"parameters\":{\"effect\":{\"type\":\"String\",\"metadata\":{\"displayName\":\"Effect\",\"description\":\"Enable or disable the execution of the policy\"},\"allowedValues\":[\"AuditIfNotExists\",\"Disabled\"]}},\"policyRule\":{\"if\":{\"field\":\"type\",\"in\":[\"Microsoft.Sql/servers/databases\",\"Microsoft.Sql/managedinstances/databases\"]},\"then\":{\"effect\":\"[parameters('effect')]\",\"details\":{\"type\":\"Microsoft.Security/complianceResults\",\"name\":\"sqlVulnerabilityAssessment\",\"existenceCondition\":{\"field\":\"Microsoft.Security/complianceResults/resourceStatus\",\"in\":[\"OffByPolicy\",\"Healthy\"]}}}}},\"id\":\"/providers/Microsoft.Authorization/policyDefinitions/feedbf84-6b99-488c-acc2-71c829aa5ffc\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"feedbf84-6b99-488c-acc2-71c829aa5ffc\"},{\"properties\":{\"displayName\":\"test_policy3ulbefgq5\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policy5rxcsbgyu\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policy5rxcsbgyu\"},{\"properties\":{\"displayName\":\"test_policyvrud2j572\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policy6rmvrx2ug\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policy6rmvrx2ug\"},{\"properties\":{\"displayName\":\"test_policyeezgnn3tf\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policy72fpbk6om\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policy72fpbk6om\"},{\"properties\":{\"displayName\":\"test_policylzld56g3c\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policy75lhjp2qz\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policy75lhjp2qz\"},{\"properties\":{\"displayName\":\"test_policy4leaozaze\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policyafjaspbln\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policyafjaspbln\"},{\"properties\":{\"displayName\":\"test_policytz5xijuco\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123\",\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"displayName\":\"Allowed locations\",\"strongType\":\"location\"}}},\"policyRule\":{\"if\":{\"not\":{\"in\":\"[parameters('allowedLocations')]\",\"field\":\"location\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policyaip6dvuui\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policyaip6dvuui\"},{\"properties\":{\"displayName\":\"test_policyk2ipvteje\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policycc24wg2ai\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policycc24wg2ai\"},{\"properties\":{\"displayName\":\"test_policynek2j6dvx\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policyebyt2or2s\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policyebyt2or2s\"},{\"properties\":{\"displayName\":\"test_policyo57mbgttt\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policyf4gvztvgz\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policyf4gvztvgz\"},{\"properties\":{\"displayName\":\"test_policyry7ktdqpn\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policyfneqctrjx\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policyfneqctrjx\"},{\"properties\":{\"displayName\":\"test_policypq5w4fcp5\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policyhavmopeay\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policyhavmopeay\"},{\"properties\":{\"displayName\":\"test_policyzhxn622hb\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policyhb6kmyq63\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policyhb6kmyq63\"},{\"properties\":{\"displayName\":\"test_policyzbi2xb6y7\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policyismcbfzwf\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policyismcbfzwf\"},{\"properties\":{\"displayName\":\"test_policyyulsilxiw\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policyjp2hqpyxg\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policyjp2hqpyxg\"},{\"properties\":{\"displayName\":\"test_policykr5rg52qb\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123\",\"metadata\":{\"category\":\"test\",\"createdBy\":\"93a01e49-673a-4e15-8230-51214a737962\",\"createdOn\":\"2019-02-20T07:02:32.8430887Z\",\"updatedBy\":null,\"updatedOn\":null},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policyko7fuaryl\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policyko7fuaryl\"},{\"properties\":{\"displayName\":\"test_policym7v6bzkep\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policyl5e3igsku\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policyl5e3igsku\"},{\"properties\":{\"displayName\":\"test_policyr5ivz4uoy\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policylw4dif6k4\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policylw4dif6k4\"},{\"properties\":{\"displayName\":\"test_policyp2yhkolhg\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policymxx4vzibo\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policymxx4vzibo\"},{\"properties\":{\"displayName\":\"test_policyt252aa3in\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policyose3kehj3\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policyose3kehj3\"},{\"properties\":{\"displayName\":\"test_policyg5g7wrd63\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policyqcexugiyb\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policyqcexugiyb\"},{\"properties\":{\"displayName\":\"test_policyfn5bvohrv\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123\",\"metadata\":{\"category\":\"test\",\"createdBy\":\"93a01e49-673a-4e15-8230-51214a737962\",\"createdOn\":\"2019-02-15T07:02:13.594025Z\",\"updatedBy\":null,\"updatedOn\":null},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policyr45j67nyp\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policyr45j67nyp\"},{\"properties\":{\"displayName\":\"test_policy5u5ook2zf\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123\",\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policyrs5zxfokx\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policyrs5zxfokx\"},{\"properties\":{\"displayName\":\"test_policyepxuvmnrs\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policyrtseayuym\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policyrtseayuym\"},{\"properties\":{\"displayName\":\"test_policyeglfwi2os\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policyrzih7n7ws\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policyrzih7n7ws\"},{\"properties\":{\"displayName\":\"test_policyrjb7ausww\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123\",\"metadata\":{\"category\":\"test\",\"createdBy\":\"93a01e49-673a-4e15-8230-51214a737962\",\"createdOn\":\"2019-02-26T07:06:57.89264Z\",\"updatedBy\":null,\"updatedOn\":null},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policysh2ld2fbf\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policysh2ld2fbf\"},{\"properties\":{\"displayName\":\"test_policyeop2lxcb7\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policytaxuus2zo\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policytaxuus2zo\"},{\"properties\":{\"displayName\":\"test_policymichd2ukj\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policytrkoh7vio\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policytrkoh7vio\"},{\"properties\":{\"displayName\":\"test_policymhqqjyizg\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policyunv6j3gfp\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policyunv6j3gfp\"},{\"properties\":{\"displayName\":\"test_policyf2qzg3ba4\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"displayName\":\"Allowed locations\",\"strongType\":\"location\"}}},\"policyRule\":{\"if\":{\"not\":{\"in\":\"[parameters('allowedLocations')]\",\"field\":\"location\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policyv3qavzpbx\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policyv3qavzpbx\"},{\"properties\":{\"displayName\":\"test_policy5koxubsg5\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policyv53qgvql6\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policyv53qgvql6\"},{\"properties\":{\"displayName\":\"test_policy7t2i6ysv7\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policyvpb2ircbl\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policyvpb2ircbl\"},{\"properties\":{\"displayName\":\"test_policyn67yt2fld_new\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\",\"createdBy\":\"93a01e49-673a-4e15-8230-51214a737962\",\"createdOn\":\"2019-06-11T06:51:10.2516Z\",\"updatedBy\":\"93a01e49-673a-4e15-8230-51214a737962\",\"updatedOn\":\"2019-06-11T06:51:13.9885473Z\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"displayName\":\"Allowed locations 2\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"audit\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policyx5j3fsjzb\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policyx5j3fsjzb\"},{\"properties\":{\"displayName\":\"test_policyif4bjggk7\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123_new\",\"metadata\":{\"category\":\"test2\"},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policyyuuoin4oc\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policyyuuoin4oc\"},{\"properties\":{\"displayName\":\"test_policyvy7eweevk\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"desc_for_test_policy_123\",\"metadata\":{\"category\":\"test\",\"createdBy\":\"93a01e49-673a-4e15-8230-51214a737962\",\"createdOn\":\"2019-02-19T07:01:55.8648869Z\",\"updatedBy\":null,\"updatedOn\":null},\"parameters\":{\"allowedLocations\":{\"type\":\"Array\",\"metadata\":{\"description\":\"The list of locations that can be specified when deploying resources\",\"strongType\":\"location\",\"displayName\":\"Allowed locations\"}}},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":\"[parameters('allowedLocations')]\"}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/azure-cli-test-policyzyhzyddss\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"azure-cli-test-policyzyhzyddss\"},{\"properties\":{\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"Deny cool access tiering for storage\",\"metadata\":{\"createdBy\":\"89ed5be8-ff97-41b5-ab11-055e1e3cc34b\",\"createdOn\":\"2019-03-09T04:29:39.8836867Z\",\"updatedBy\":null,\"updatedOn\":null},\"parameters\":{},\"policyRule\":{\"if\":{\"allOf\":[{\"field\":\"type\",\"equals\":\"Microsoft.Storage/storageAccounts\"},{\"field\":\"kind\",\"equals\":\"BlobStorage\"},{\"not\":{\"field\":\"Microsoft.Storage/storageAccounts/accessTier\",\"equals\":\"cool\"}}]},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/denyCoolTiering\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"denyCoolTiering\"},{\"properties\":{\"policyType\":\"Custom\",\"mode\":\"All\",\"metadata\":{\"createdBy\":\"5b5e6b07-55b8-419b-a446-20fe0aa5b459\",\"createdOn\":\"2019-11-08T05:58:35.9462109Z\",\"updatedBy\":\"5b5e6b07-55b8-419b-a446-20fe0aa5b459\",\"updatedOn\":\"2019-11-08T05:58:36.2899714Z\"},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"northeurope\",\"westeurope\"]}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/pd1d6a287496763bd\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"pd1d6a287496763bd\"},{\"properties\":{\"policyType\":\"Custom\",\"mode\":\"All\",\"metadata\":{\"createdBy\":\"5b5e6b07-55b8-419b-a446-20fe0aa5b459\",\"createdOn\":\"2019-11-08T04:25:20.3616782Z\",\"updatedBy\":\"5b5e6b07-55b8-419b-a446-20fe0aa5b459\",\"updatedOn\":\"2019-11-08T04:25:20.5689022Z\"},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"northeurope\",\"westeurope\"]}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/pd1ff115351d7d620\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"pd1ff115351d7d620\"},{\"properties\":{\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"metadata\":{\"createdBy\":\"5b5e6b07-55b8-419b-a446-20fe0aa5b459\",\"createdOn\":\"2019-11-08T05:58:36.5087248Z\",\"updatedBy\":null,\"updatedOn\":null},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"northeurope\",\"westeurope\"]}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/pd226f944793a0edd\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"pd226f944793a0edd\"},{\"properties\":{\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"metadata\":{\"createdBy\":\"5b5e6b07-55b8-419b-a446-20fe0aa5b459\",\"createdOn\":\"2019-11-08T04:25:20.9593945Z\",\"updatedBy\":null,\"updatedOn\":null},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"northeurope\",\"westeurope\"]}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/pd248103959e1b89a\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"pd248103959e1b89a\"},{\"properties\":{\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"metadata\":{\"createdBy\":\"5b5e6b07-55b8-419b-a446-20fe0aa5b459\",\"createdOn\":\"2019-11-08T05:53:56.4821495Z\",\"updatedBy\":null,\"updatedOn\":null},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"northeurope\",\"westeurope\"]}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/pdn4b00229168b529\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"pdn4b00229168b529\"},{\"properties\":{\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"metadata\":{\"createdBy\":\"5b5e6b07-55b8-419b-a446-20fe0aa5b459\",\"createdOn\":\"2019-11-08T05:12:02.5562119Z\",\"updatedBy\":null,\"updatedOn\":null},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"northeurope\",\"westeurope\"]}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/pdn7d459478c62e5f\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"pdn7d459478c62e5f\"},{\"properties\":{\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"metadata\":{\"createdBy\":\"5b5e6b07-55b8-419b-a446-20fe0aa5b459\",\"createdOn\":\"2019-11-08T05:16:25.1651266Z\",\"updatedBy\":null,\"updatedOn\":null},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"northeurope\",\"westeurope\"]}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/pdndd5095457eae7f\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"pdndd5095457eae7f\"},{\"properties\":{\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"metadata\":{\"createdBy\":\"5b5e6b07-55b8-419b-a446-20fe0aa5b459\",\"createdOn\":\"2019-11-08T05:21:56.3757672Z\",\"updatedBy\":null,\"updatedOn\":null},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"northeurope\",\"westeurope\"]}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/pdnfc173081e3e1c6\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"pdnfc173081e3e1c6\"},{\"properties\":{\"displayName\":\"pol-defdis-2169\",\"policyType\":\"Custom\",\"mode\":\"All\",\"description\":\"policy definition description\",\"metadata\":{\"createdBy\":\"5b5e6b07-55b8-419b-a446-20fe0aa5b459\",\"createdOn\":\"2019-11-07T10:43:22.5629692Z\",\"updatedBy\":null,\"updatedOn\":null},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"northeurope\",\"westeurope\"]}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/pol-def-2601\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"pol-def-2601\"},{\"properties\":{\"displayName\":\"pol-dis-5258\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"policy definition description\",\"metadata\":{\"createdBy\":\"5b5e6b07-55b8-419b-a446-20fe0aa5b459\",\"createdOn\":\"2019-11-07T09:57:59.3671014Z\",\"updatedBy\":null,\"updatedOn\":null},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"northeurope\",\"westeurope\"]}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/pol-def-3066\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"pol-def-3066\"},{\"properties\":{\"displayName\":\"pol-defdis-1797\",\"policyType\":\"Custom\",\"mode\":\"All\",\"description\":\"policy definition description\",\"metadata\":{\"createdBy\":\"5b5e6b07-55b8-419b-a446-20fe0aa5b459\",\"createdOn\":\"2019-11-08T05:59:42.1212637Z\",\"updatedBy\":null,\"updatedOn\":null},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"northeurope\",\"westeurope\"]}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/pol-def-3604\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"pol-def-3604\"},{\"properties\":{\"displayName\":\"pol-defdis-8885\",\"policyType\":\"Custom\",\"mode\":\"All\",\"description\":\"policy definition description\",\"metadata\":{\"createdBy\":\"5b5e6b07-55b8-419b-a446-20fe0aa5b459\",\"createdOn\":\"2019-11-07T10:51:26.6479837Z\",\"updatedBy\":null,\"updatedOn\":null},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"northeurope\",\"westeurope\"]}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/pol-def-4703\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"pol-def-4703\"},{\"properties\":{\"displayName\":\"pol-defdis-5984\",\"policyType\":\"Custom\",\"mode\":\"All\",\"description\":\"policy definition description\",\"metadata\":{\"createdBy\":\"5b5e6b07-55b8-419b-a446-20fe0aa5b459\",\"createdOn\":\"2019-11-07T10:44:44.5908405Z\",\"updatedBy\":null,\"updatedOn\":null},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"northeurope\",\"westeurope\"]}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/pol-def-4803\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"pol-def-4803\"},{\"properties\":{\"displayName\":\"pol-dis-2866\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"policy definition description\",\"metadata\":{\"createdBy\":\"5b5e6b07-55b8-419b-a446-20fe0aa5b459\",\"createdOn\":\"2019-11-07T09:59:29.3473453Z\",\"updatedBy\":null,\"updatedOn\":null},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"northeurope\",\"westeurope\"]}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/pol-def-7444\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"pol-def-7444\"},{\"properties\":{\"displayName\":\"pol-defdis-3052\",\"policyType\":\"Custom\",\"mode\":\"All\",\"description\":\"policy definition description\",\"metadata\":{\"createdBy\":\"5b5e6b07-55b8-419b-a446-20fe0aa5b459\",\"createdOn\":\"2019-11-07T10:50:49.8743418Z\",\"updatedBy\":null,\"updatedOn\":null},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"northeurope\",\"westeurope\"]}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/pol-def-834\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"pol-def-834\"},{\"properties\":{\"displayName\":\"pol-dis-6545\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"policy definition description\",\"metadata\":{\"createdBy\":\"5b5e6b07-55b8-419b-a446-20fe0aa5b459\",\"createdOn\":\"2019-11-07T10:01:11.8439197Z\",\"updatedBy\":\"5b5e6b07-55b8-419b-a446-20fe0aa5b459\",\"updatedOn\":\"2019-11-07T10:01:13.5984375Z\"},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"northeurope\",\"westeurope\"]}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/pol-def-900\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"pol-def-900\"},{\"properties\":{\"displayName\":\"pol-defdis-412\",\"policyType\":\"Custom\",\"mode\":\"All\",\"description\":\"policy definition description\",\"metadata\":{\"createdBy\":\"5b5e6b07-55b8-419b-a446-20fe0aa5b459\",\"createdOn\":\"2019-11-07T10:39:00.9481726Z\",\"updatedBy\":null,\"updatedOn\":null},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"northeurope\",\"westeurope\"]}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/pol-def-9447\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"pol-def-9447\"},{\"properties\":{\"displayName\":\"My Policy\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"This is my policy\",\"metadata\":{\"createdBy\":\"5b5e6b07-55b8-419b-a446-20fe0aa5b459\",\"createdOn\":\"2019-11-13T06:04:34.9335495Z\",\"updatedBy\":null,\"updatedOn\":null},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"northeurope\",\"westeurope\"]}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/policy1\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"policy1\"}]}"
    }
  }, {
    "Method" : "GET",
    "Uri" : "http://localhost:1234/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/policy1?api-version=2016-12-01",
    "Headers" : {
      "User-Agent" : "Azure-SDK-For-Java/null OS:Windows 10/10.0 MacAddressHash:6329c03b535ec33cd37fb229b82c5babb3cb7866e991f6299f1b3716d621b34d Java:1.8.0_221 (PolicyClient)",
      "Content-Type" : "application/json; charset=utf-8"
    },
    "Response" : {
      "date" : "Wed, 13 Nov 2019 06:04:35 GMT",
      "content-length" : "567",
      "expires" : "-1",
      "transfer-encoding" : "chunked",
      "vary" : "Accept-Encoding,Accept-Encoding",
      "retry-after" : "0",
      "x-ms-ratelimit-remaining-subscription-reads" : "11998",
      "StatusCode" : "200",
      "pragma" : "no-cache",
      "strict-transport-security" : "max-age=31536000; includeSubDomains",
      "x-ms-correlation-request-id" : "e957dfa3-4d89-4876-9b62-ac186531057f",
      "x-content-type-options" : "nosniff",
      "x-ms-routing-request-id" : "SOUTHEASTASIA:20191113T060436Z:e957dfa3-4d89-4876-9b62-ac186531057f",
      "content-type" : "application/json; charset=utf-8",
      "cache-control" : "no-cache",
      "x-ms-request-id" : "southeastasia:9cd85c54-5acf-4e3e-970e-05cc1a0f6227",
      "Body" : "{\"properties\":{\"displayName\":\"My Policy\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"This is my policy\",\"metadata\":{\"createdBy\":\"5b5e6b07-55b8-419b-a446-20fe0aa5b459\",\"createdOn\":\"2019-11-13T06:04:34.9335495Z\",\"updatedBy\":null,\"updatedOn\":null},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"northeurope\",\"westeurope\"]}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/policy1\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"policy1\"}"
    }
  }, {
    "Method" : "DELETE",
    "Uri" : "http://localhost:1234/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/policy1?api-version=2016-12-01",
    "Headers" : {
      "User-Agent" : "Azure-SDK-For-Java/null OS:Windows 10/10.0 MacAddressHash:6329c03b535ec33cd37fb229b82c5babb3cb7866e991f6299f1b3716d621b34d Java:1.8.0_221 (PolicyClient)",
      "Content-Type" : "application/json; charset=utf-8"
    },
    "Response" : {
      "date" : "Wed, 13 Nov 2019 06:04:35 GMT",
      "content-length" : "567",
      "expires" : "-1",
      "transfer-encoding" : "chunked",
      "x-ms-ratelimit-remaining-subscription-deletes" : "14999",
      "vary" : "Accept-Encoding,Accept-Encoding",
      "retry-after" : "0",
      "StatusCode" : "200",
      "pragma" : "no-cache",
      "strict-transport-security" : "max-age=31536000; includeSubDomains",
      "x-ms-correlation-request-id" : "f9406654-66bc-4c05-b1dd-f0ba7fd620c2",
      "x-content-type-options" : "nosniff",
      "x-ms-routing-request-id" : "SOUTHEASTASIA:20191113T060436Z:f9406654-66bc-4c05-b1dd-f0ba7fd620c2",
      "content-type" : "application/json; charset=utf-8",
      "cache-control" : "no-cache",
      "x-ms-request-id" : "southeastasia:d8bca5f1-c5ec-4d63-8d7f-269ddc18ad2d",
      "Body" : "{\"properties\":{\"displayName\":\"My Policy\",\"policyType\":\"Custom\",\"mode\":\"Indexed\",\"description\":\"This is my policy\",\"metadata\":{\"createdBy\":\"5b5e6b07-55b8-419b-a446-20fe0aa5b459\",\"createdOn\":\"2019-11-13T06:04:34.9335495Z\",\"updatedBy\":null,\"updatedOn\":null},\"parameters\":{},\"policyRule\":{\"if\":{\"not\":{\"field\":\"location\",\"in\":[\"northeurope\",\"westeurope\"]}},\"then\":{\"effect\":\"deny\"}}},\"id\":\"/subscriptions/00000000-0000-0000-0000-000000000000/providers/Microsoft.Authorization/policyDefinitions/policy1\",\"type\":\"Microsoft.Authorization/policyDefinitions\",\"name\":\"policy1\"}"
    }
  } ],
  "variables" : [ "1fc4d8bf-9bbb-46c4-8b6a-c25b19dd4a3f", "59b288b6-5802-4478-b4c3-393ff2d102a4", "6192976e-c3eb-485d-b9b0-7c49b51b56f5", "dacff63a-a71c-42c1-998d-bdbf5bb23a1d", "2214f0d1-cd39-4f73-966e-214f6e011249", "1c253704-500e-4b43-886b-530d084fe47a", "9c3a19ce-5ae6-43aa-8d89-9a25ec5c639e", "2c099bea-5cfd-4f3d-83bf-717d6a94f6b5", "142d5b9e-2bb2-4a8f-bb5d-e2d38b6b7946", "7fa39616-0d93-4fab-86fa-576e758328a4", "149bcf1c-da93-4ae3-b204-1f3e98547197", "357f14d7-0899-4721-a6ca-10f587176593", "cedd65c2-e3a5-490c-904f-d2816cbdf71c", "142359b9-80ab-405b-a0a4-cea08808022f", "2c7afc5b-8997-4e0c-ba4a-78297fcd5004", "613b01b1-4bc2-4bb6-a429-4de0e8f0031e", "d04fee21-563b-4008-abd5-5ec2fcd21927", "3217a3e6-3413-49d6-87cd-18ba5470ace6", "54db6568-d800-4ec5-9d6a-0c1ce2d63081", "a0e22503-8141-4ac4-8f05-207de01c9fbb", "a7856286-4e52-47d1-b8c3-c7a970d2fc4a", "a7a09afb-52c7-4cb2-8b0f-50d29795e43b", "c1e6080f-914e-4b2b-a25c-61ab54797765", "b03f1de5-ceac-40d7-adb3-e936203c42d0", "f0cd47e1-a8b6-4202-8541-3bba9049f0e7", "128cce67-d5b5-4f89-b6d6-084012c973e2", "9275db1d-4f20-4ce3-a67c-d3dbac184540", "e59541ed-2e9f-4baa-b352-94746e358d4f", "1d474c1e-125d-4939-b765-9017fc9dcf4a", "22dbbfc3-0412-4b5c-849a-d5b5d9749b78", "20452dd9-7f80-4b96-8d89-d5527d1f630d", "1d5a5a23-57d1-4352-a767-e7b2d10b5a45", "403d61d5-0378-41de-890d-7f10248a6da7", "208db10c-8c43-472f-8869-33534fb96005", "b4674644-cd68-4f51-a3a7-7970311d1073", "9c733300-964a-46d7-8b4e-7e92aa40c834", "cfa305b3-445a-4b93-8179-e006e42847ce", "b5287948-819a-4d61-bd13-ab034252e541", "79ed6176-42c4-4330-ada8-58545d085abd", "6a088071-274a-40d9-9341-5be978808826", "fa2c4405-aac2-447e-b9a5-d9b4f6390ff5", "11c8a1c2-9f9a-46c9-8e51-b59a44c3a290", "57917867-f8ad-4ea7-8429-e82084530504", "5b656ae9-cdbf-4ea8-91cc-be86214dc160", "66ad9345-0b31-43a1-92fc-c8811ab3a887", "13cf2107-def4-4a5e-b83e-cbc3b736fc01", "3ccc5cfe-332b-4304-8f29-e795c1d08f12", "4a415e86-6f25-42a9-9071-e70938f77040", "d7f383e6-94bc-44cc-902d-383aa0d5e059", "a218aad5-56d2-40c1-a126-002ea8aa0198", "5ed89301-702d-4a6c-8b4d-d77109cf2a2e", "31f4c87a-5a99-47c6-a384-b0f2e388c940", "aeebdde4-1de8-461a-b151-e74d25550f72", "a41bfae6-8c09-4359-9057-16edb6421158", "f9b860d3-5577-4b68-bb10-28b1d66e3f33", "a4580e74-ecda-40c2-ba9a-b09f0ef87f77", "884e1604-7fe5-4ef8-94f2-fdb410cd2a99", "ff0ac628-ae70-4244-aceb-559e9b1250d5", "c3534ce5-4780-4073-af70-97f11a9c99d9", "b2b2d569-5f7b-46be-a014-e2709b76acdb", "86742c81-eb26-49bf-aad3-882831146987", "bfc47b9e-06aa-4faf-a681-eeff12e981c2", "4078b9ec-78fb-483a-9e9f-e654a2da6951", "8a4e9c01-0af1-454f-97f9-d4f97b005bde", "4c05ecb9-41f7-447b-a450-7da4e276de97", "19693828-b6c6-4eba-bed1-5ade64ac1833", "7bfe1ff5-6eba-4f26-8072-8776fc69c2d7", "59555bb5-d6ce-4d35-aeee-97ad58013b8f", "cfc6f2f6-d7b5-4445-b355-786644808c3b", "3114f41d-dd9b-4d33-b8eb-e9d7863f7aa3", "39b484ee-6793-4d5b-9f2f-a83e6c772bfd", "0b871d82-feaa-4a6a-a495-cfcf5a31d71e", "623727ba-7921-4495-97ad-7e7db746de43", "fed60b13-b709-4aac-acec-a9be903db0b3", "ce701f85-9d37-48f9-a7e8-55de7520777e", "471e3b71-7915-4699-95e2-1875ec6fcd1d", "d6942537-aa8a-4616-99ae-c4a1fcbd448b", "132cf213-26f2-4d4d-9a3e-e16830b1689f", "097f03e2-1534-4b91-a233-c9060acd2ebb", "1ae300c9-2850-4782-8fc2-3fd723876524", "521a58e7-8224-478a-8375-901c3ab05a3e", "993c298c-680d-4dbf-9584-5ee0242e063b", "a2011ae1-946d-4423-89cc-96ab3325bc9f", "8edca55d-54cf-4f45-9646-12912f87ce15", "e3ec5063-044c-4118-b79c-f3268ea6eccc", "c42b6f96-1cba-4970-a1b3-7d265243ef77", "bf817ebf-d855-4130-9975-97314ad20c16", "8d2d8a19-f657-4858-8325-9ffd621e52c5", "553ee710-5f99-40f9-ac35-002cccee758f", "ef5f6e08-8681-496e-a362-18c354175a72", "4ce9ee9c-5eee-4909-bab4-8fbd8b9cbd33", "c1184e1d-3496-4688-b949-1f6be0b5d75a", "c9810a2d-b20f-4d3e-9daf-9adc3c23ec03", "b4ca67e9-bcf1-4e17-b30a-afa2df40da59", "eed1403f-42f6-4bb0-ad76-fc7bfcc55082", "a3ab4f5d-2ba7-4099-a5ca-509fd7018317", "b0aa8d9f-0819-4bc8-a348-469dce22ccb7", "ba89ba1f-ac29-432c-a504-d19aea48940a", "0840b248-56cc-47e2-9306-be4f73d68959", "89e88ff6-3f16-4650-afc9-eff6b1a1281d", "e4d9d7b2-f714-4c13-8e9c-b778d1b4ddec", "abf23209-97c7-45e1-9612-49c2240548af", "559aa08e-e886-404a-84af-93200247f744", "136d7bc6-e285-4b55-a891-dcf0351a9761", "a6bdf3f2-7506-4dbc-b660-5234de66f0b1", "e1273b0b-5713-45c0-9be9-629e8073a849", "47bb1c78-de87-43f4-8c30-9b03fa2f8c06", "ae62bf9b-6f6f-41a0-8482-a877147e81dc", "394e888f-386c-4689-821c-f3cb6acfc614", "e013106c-362a-44e9-9df7-009cf86e1dcc", "a076e594-c0d4-4692-ab11-908e87ef1b94", "5e2071cf-7936-4500-9879-36aa1bb9f9ff", "9a7b85c8-82a5-402c-8522-0829538f0a7f", "b05b48db-31f5-425e-b592-38825cf4943c", "8b6bc216-96a8-495a-a531-dfdeb9dc0a1c", "5b7f0495-89f2-4cb3-a989-63432e011520", "acb77905-9c93-4ead-bcd4-187a94bd5da0", "5652a010-a89f-4928-b279-b5c9e19291f4", "4fe35569-eae4-4dc0-8dd4-43c388abfdfa", "c52dbd29-eacb-4ed5-b7ff-f4179f56bf27", "d657ac7f-ab92-425c-b273-9cfa493d16d6", "d9445896-f157-4703-a90d-274902ce942b", "f66af1e2-4852-457e-b8d3-d04d6021139d", "8725620b-3c4a-4cd8-9488-ffcd2182787a", "ade31247-7da1-4270-90f5-950ba2a61578", "a5c2d85f-f923-4fc8-b32f-ebb3abba8782", "b45284b4-3986-4cfe-87b3-c75d3b5e6dc8", "f741805a-d2a1-48ca-b436-8ea9157584ba", "fd1e472c-9443-4a75-930d-0b2b4b474e5f", "945ea07c-602c-4a1d-9a46-3ba77e810d14", "7d49af47-5d7e-4b65-a3d7-e2cc5263b9ad", "7035b74b-190c-46b8-8632-e3b124b8648a", "1ca2ea47-18cf-47e1-a933-f75eea97892a", "8d5ae145-a748-423d-9822-d45fc8cca153", "b0294e88-49c1-42fd-9972-16035b747609", "3b7e131b-83f6-4b1a-9719-8251591b64a9", "f4a895e2-7c41-42ca-ab3c-5d9845850329", "d6fa4a07-c0fb-4f99-a30c-71edf864c1a8", "90babc4f-7259-4c6d-bebf-0633919751af", "ada4bec8-c423-490e-ad42-931cc5f38799", "bd6832e2-7047-4c20-b52d-13c5b79210b8", "147990df-9a4c-41d6-898b-c2ece9fd5491", "2142260b-6abd-461c-bcbf-7b30662524d3", "d280b8c0-4d6e-40f3-af6f-1bb92d1c2c54", "5b40c218-5700-41ac-82e7-85d5ccefcc92", "a8a5601e-79e9-4286-8d01-3b57baff20a1", "21068018-c269-4558-9837-e4d024526a11", "f06d91cc-a106-4fdf-985e-1af6d267e915", "155778eb-16f8-4e3c-8865-b90c9332dbe6", "708ce5aa-cda9-4eb3-b87c-c79b72bf98d2", "9023ee95-80c0-427e-a31b-5f84c3355ad9", "1e913229-3813-4e02-8336-4b33f0e61558", "e31ce449-52e4-4c41-9474-91571cc32e95", "acfddca2-35c0-4a78-a5a2-6131a5301bcd", "d660c4fd-4339-4bfc-b52c-0abaff1926b1", "92d44711-6f89-4ed3-a8bf-6d5fd8ef3a1c", "0520fbe3-1c56-4ab5-aa04-a318ed781fd8", "7ca705a1-776e-4cab-8383-3143c548af70", "f9e75a6a-6deb-46e0-83b5-3ff4501cd323", "65709ad8-63c0-4dd9-a8e8-c8016144c2c1", "74526c5b-6468-42e8-b78f-c6b455f5bae8", "9adad318-7a24-4cb1-b82a-43fdb58576ac", "7817bf37-bd0b-43ec-a47c-d0089e7422cc", "310f3d9f-1f20-4eea-bcad-ccbe065bafe3", "e9817526-5695-447f-a6a1-6b1f0b27424e", "3479efec-a508-403a-97e7-1ef7c3fadfb8", "56c90d89-3298-4d50-8ef2-9ac9944d0897", "a72f0bbf-22b0-454f-b590-7e92c3bdffd9", "56f958d9-5d0f-4339-888c-cd35d89dfe81", "84057069-f8c6-4dfb-9fa4-b95b8370a3bf", "dee064b0-66d8-4d61-ac61-6fdeb7958cb4", "b857c0ec-d424-4959-8ca4-65cadd020aa6", "3d420670-5552-44d3-aeb5-3ee7df34b817", "26f06426-5e43-403a-931a-cf22a892bc7b", "9dedbee4-4c71-4557-bdca-9480d35aca95", "12773927-d324-4c3a-8735-ea05a583de1b", "0d3f03a3-d1d8-4a29-a4f0-e400a5915434", "d6e5fab5-6c4f-4d69-a403-0c371e081e6d", "d081d155-3059-463e-8848-06abccd5786e", "c3b05359-f461-4980-a572-93b1102784bc", "991b938b-805a-4e21-8868-9e3c2aeeec4d", "6e19e14e-92b4-48d8-a2c8-335b93e01283", "e1e0a307-08cb-4311-ae6b-1d0f4e5ae798", "0e753f2f-96ba-475c-be39-521978f0a907", "d9ab4d89-66a8-44cf-9203-fb1618481f00", "d4466e32-0ebc-4343-9880-a2789c2fcac8", "6da03db4-2acf-494f-8a49-28ef2630ca27", "bf5ee0c1-7122-4d2d-8000-4051e0aac7cd", "715939a1-f763-4ab6-81cf-e03d4d10303f", "6b153f6d-a6ef-4146-b50d-aea5aa678818", "c330ee96-9e0d-4329-8a6a-dc4f27bc943f", "3f1936fa-15df-4b08-bbd4-5f4e52eeb83b", "4b745e12-d651-4299-955e-a7ba956f687a", "e82d7453-2946-4727-a51d-35964dad6f65", "e9efd92a-5f29-4d8d-9901-71cedaa33466", "4966d839-bf0d-409c-86db-e435659ee882", "18d9319f-5204-409b-a664-579664fa37eb", "4bb6a887-5e88-4e49-9731-93ca0b727b2b", "13151d8b-e05e-4cf9-9863-bb9ebbf5503d", "1f0cc2f7-7598-4b25-9821-d119011f8df7", "6bf9b1e2-0fb8-4580-adc1-9186ab0d7fd6", "2d1a07e4-762b-4504-8b48-a5beb325d26b", "bda67f8a-f76b-4766-9c17-724be0155a73", "e3d4bcef-e20d-4e0b-8136-71f4730b8a73", "e34e34af-df11-405d-8ecd-7abe84aaa5d3", "591af59f-6e75-43b8-bb30-6a7b6f61dd6d", "0ff501a1-7c78-4bd5-813f-d613e82be52f", "5a9ec39c-53e3-42b1-8e4a-dba9998fef5e", "439f2eac-8c1b-4e6a-8069-3ffcbaf2aa87", "11f1c04c-6f09-4302-a6fe-dd1a3e8fa0e1", "b4bce9bc-41e3-4b57-ae0a-aeb34eeeed4a", "3f14d241-b241-4522-a48d-481faf5e115f", "e6e8a136-7a5a-4e06-92c1-a5db56eb3663", "96738289-e463-4a46-bca0-e64d8f5619c1", "75ec0926-3943-48d1-bbb3-c600436b83fd", "be72dfde-69d2-4687-a262-a35150c450b8", "ca24242e-401b-46ef-bd11-891b6136806d", "569b9e1f-9bee-42a5-a401-9b75f0f29e3a", "8b02f427-e26f-4c40-b757-49c20827b4ff", "9d745ebb-ff42-44fc-890d-96465e9174c4", "6500aee9-7d98-4b89-8939-e3a25b811b0c", "8d797e64-0704-4bd8-aace-3bf2d2343712", "6023ab22-ffc9-4d30-be1c-0d70ea57bbc5", "9228836c-8ef2-4aec-b07b-ec600cbf9343", "b87edb6d-be67-49f8-bb63-b69bc45211eb", "8ca4e07e-ccaf-4ff9-b096-f98d71af05b4", "84dd4ea7-4194-4154-a622-43471445c9c2", "d6704e60-b6e7-47d7-b7a9-0214d3680020", "9b08d015-4d6d-4e84-b75c-9c8faf2fb232", "f9bd74a0-7b53-4bba-8250-e8cccd0f3038", "ce357a74-6881-4712-9a05-765c63f17398", "b2ac34d5-9155-4fab-a870-93d15b633e1d", "d383cf2a-a78d-4021-8ca9-9293daa25a04", "ab9d42d5-bdcb-45ee-a725-e4d75365ef48", "dade14c2-75da-4095-963b-9e66cd1d1220", "8ac78026-3168-45eb-b0e0-fd5d269b61fa", "9ff6cd06-36ec-4ee6-a9bc-3f376e444193", "2a33fbe2-6889-460d-8895-3c5170342983", "bca1784d-3afa-4d41-a3cc-6d781171c0ed", "45ab3d4e-85d4-4732-a865-d45eba5d0267", "0bd96312-8467-4682-a8be-6cc3d5e0f55c", "3ddd695f-b978-4d19-9df5-7b723a10f267", "e0e84c15-eab7-494d-ba4d-c7dc8581764f", "1db7fdd3-471c-4b3f-b3e6-5f4c845de601", "11eadc8b-9ac6-4e43-b72a-521adf48ee1f", "9e660272-714e-45a9-b0b0-c75c88aa712b", "8c5d40e1-73ad-41c7-89dc-b37cf57d7a0b", "f1908bac-ba96-4a84-8eb5-4cc7ea03a852", "56a292ab-47be-4dfb-8302-f2ce44f79daa", "04d3a599-b9a5-4702-8795-add20bfa68e6", "4b685358-ebca-4aa5-8cc8-1a0c463e3a51", "3f49df9a-345d-4540-881c-e3b757cb00b3", "44877568-429d-4560-b423-8c81faca3fa6", "96233423-2267-44b9-959e-7c37fcd76551", "8b2dca79-b67a-487c-a1e8-faf54bae7c56", "f1d5ecf4-93db-489d-926e-695dda597e41", "81b3f689-03b1-497f-bbb9-c294c06e9cf6", "e0c2d984-e67d-4532-a27c-d07f308e4d70", "f7ee766d-3f9b-4e0c-98d8-593addbdfe2f", "8daff9ec-2e86-4b73-b66c-cd574dfd7819", "4f5b41aa-f7a8-405f-927a-b576b4ed864c", "29c351ac-7c4e-4532-8b7f-755f8bb22ef6", "f32de797-ebd4-4f4c-aded-0fcb612d45e8", "dc17fab7-e002-472e-be5f-620fe12ef9bc", "758cce3f-f54b-46f6-a247-d92981136882", "2b630d7d-2d40-40b4-b8d4-ac9fbaa06bc1", "0400ab71-0128-4e84-8268-c2b663e13754", "b42a19ff-af29-4f5e-898e-e8327cb60900", "76adeb06-4746-4509-a8d3-ed109be0dcdb", "eaf2a4eb-e829-4a57-81f2-8eccb549cec9", "68440aed-fc44-4def-a906-e147b19ea9e4", "39ab8af0-8760-45ad-9283-274f7a4c13f0", "43d3f835-8f7a-4d8a-b0b6-7cd6d3d64142", "d28be414-e195-4088-b3ba-7d16411d8081", "44b74d8f-98e4-4359-a642-ad8f87330e0f", "dadc93da-c29f-4b3f-b451-75497e2cc610", "ea6b2070-0dd4-4ff6-866a-dafcb1e34264", "5633e866-7630-46f3-b456-e795bcc1af1d", "583c2a3d-000b-46af-9e7a-b48e420f4bd8", "11a0bb33-6d1a-4402-a596-c8fcdc0e65a7", "5f06a595-aedb-4b24-9b34-7a6444751b02", "f58705fa-a5b6-4090-a8ff-a31a1f0d5f8f", "95bbb2fa-91df-4fc1-8e01-58e3e959368a", "e0b2635e-0a1c-4197-bc72-66d29d3a0bd3", "2576bcef-8e1d-4923-91c2-878b9a408bd3", "e6e85f8a-be49-4696-9105-69c9fb9e31fb", "09eab759-eae6-4928-a2ab-90fb957cba65", "5cf72795-2ba4-4600-839c-e2c628330517", "f9831618-28c4-4b3d-8254-032df6c635c3", "686e0abf-27f3-4ebe-8bd0-f7094da6a0ca", "ca0bc7fd-1091-4927-98f1-96ef7ddd8746", "6830d370-7b4c-4f12-9936-a7ec6eac7b70", "259a002f-dbdf-42cc-8fa5-00ecd55949dd", "ec25adfa-6cae-4f56-a945-50c516f43cc6", "f92d6567-bdec-4b10-95d3-6496e5491bd0", "75849b92-cfce-41bd-ab99-3d830d65a59d", "73f37fa9-7895-4968-9b78-49d501357bb1", "12613a96-3738-478b-abad-bbfeca351217", "2c5f8c97-2f6d-488f-ba3d-5cfc84bcf9ec", "ae485772-09f6-4d76-b4ab-ba3aa08e1208", "d5c11396-dfde-4297-9e65-c5f9782927e0", "ee28b8ff-45b7-4e15-8b1f-1d58361892aa", "6ecbd7d7-d8e4-436b-919e-45020cefd9f6", "8d6f6be9-9c82-4796-b463-0b65b8e2931a", "b0aa9faf-c5b4-4b59-af41-5b917a59f7b4", "940f6f79-c220-4d5b-9cfe-c14d23f24aa8", "b507b427-e7c4-4a82-84c1-2ee6827f2a56", "fd0794d6-ef8c-48a4-99d8-e24dda04c079", "7e5e8737-70fd-4676-b56b-6101d5830089", "3ff5841f-7315-4b23-809e-bb32bd7390f1", "347e64ae-1f6d-4dd6-974c-78c7feed66a9", "3af4fd87-4ccd-4868-8422-2594cc648b4a", "8f2d6381-a919-4e80-bc03-bb38c54132b6", "08f0613a-c6a6-4421-a3f7-ecbadf5420b0", "94e12d7e-5a84-440e-b6d5-545d75bfc8f8", "9f8e0a0b-2715-4df3-8cc3-56b8034b7670", "2f537db0-28bd-4932-9f7a-93ad2dfb599a", "a5d07c12-4777-4253-ad2b-7421b3377d4c", "d926aef7-c5f4-45b9-ae45-214629b8232c", "5ee77ccc-cab3-4e12-9d6c-05a8f206eb80", "d79f8acf-fc06-4eab-a857-7e55807bea12", "eea57e60-e679-42b0-9f9e-c2481616546a", "9a11755e-2d07-4e35-b195-6e5486b2fb18", "a5dc5dc6-ba7a-4de9-bd67-27335393acae", "dc9460fc-811c-4be7-a3e8-c0515bfb3bc3", "31d3da7d-6187-453f-983a-e2abc9dc8d19", "ec0b700a-c64b-48d3-a01e-a70fd863300f", "d4b9b289-5882-428c-8c34-fe992e8dc55e", "b9f3671e-1498-426a-a9dc-0dd451bd04e9", "779f08de-58cf-4adb-b594-34ee2135802d", "137c0d73-6b53-41c0-8ee7-4ca58679fcdc", "b822c542-5f70-467b-92cc-e48711be4320", "e5218057-bbc8-4cee-aaf0-10d680d89e5b", "d25dab9e-deab-414a-8ba5-04abd013d8b8", "e3431e71-a39b-43e6-b756-11a306267688", "f794ebed-d3dc-4a7f-b093-0c9a0601667f", "47f2f600-359f-4c69-ae77-02f3b2d7e78d", "a9bf63bf-09d0-468d-ad97-43fa76ceb071", "5763cc37-0805-4cc2-b9b5-dba189bc7202", "bfec27bf-f401-4d55-8096-0ed9fe513f97", "3da7d9a2-f8a3-4fef-ab13-fe9d5eacff9c", "c9dfdc13-a21f-457f-8224-f746406edb0f", "e4912600-6fbd-4615-805d-11498357fabc", "38136938-9971-46bf-841a-6d3f0fa67b00", "4958c8aa-ecdd-4d0b-ad9f-8eca5349352a", "2c4244ac-eb94-4732-b688-0300ea4fe10f", "39c1ae65-40c0-4972-aab9-976703ec7a10", "6805dde3-945c-4194-9b98-6c6c209cfa56", "13bd02bf-4f25-4287-92ed-bc9f6fa4f61b", "f024691e-d0ad-4f78-acbe-7e068e7cf436", "52dbb394-c32a-41f8-839b-c3985e6107e8", "df631762-6606-4f60-86b3-49510a10259a", "5ba2c95e-46b4-424d-b2bc-33d8c13eec07", "b3a887a5-29d0-43d3-ba62-5192652ab3b0", "1c6ee457-182b-45b9-a290-d61e1b2b52f4", "7def4019-41a4-4e56-9309-9bd3bd84a39d", "65dca02f-256f-4534-b09c-70ddb72285d5", "80a3e8db-29ed-4fb6-a1da-485b69b5ab72", "87e7fc0b-cad4-4ce4-8d71-0e1acabf87f3", "57ea6de5-9dc8-49e4-850f-c9764f8bd204", "f474b644-e4f4-44c5-9cdf-cd63235361f6", "942bcdc5-8f8d-4520-8bf2-90f8c58878cb", "dd495959-ad79-4331-b6ca-99274812f928", "c4821747-a0dc-419d-86f1-da7bac991dde", "aaa20e7f-e568-4a86-bcc5-1cc24f495796", "8f53fc9d-89c7-421c-9ea6-815dcca4986e", "e08746a6-c675-41a5-a832-449504c52119", "01f5a988-66c0-42bc-9d31-67c705c7edcd", "aef5aae7-2d37-437a-902b-fa9e3177fd83", "737fb908-373d-45f4-8279-bd5c2453072c", "224e4daf-610d-4ac0-bf2d-8969a609f590", "65c56a29-c1e4-4b4e-9078-9bb85c14a1e6", "aa37e070-315e-4a87-8221-12011e6a6143", "e4b4bc81-cab1-4e09-abfa-8dc4ff53f63a", "aeab02bc-34e6-4c44-8adb-70e366e30ed8", "8bcec49d-ef75-487b-8aa5-253d9bd21575", "32d2ce6e-0eab-41e2-844d-e93258bf152e", "0b7c5dc5-234c-4bc4-aefe-6d5450e86df3", "d78019b6-0b64-47d3-84cb-bacbfa46f726", "0570b7c2-ca7e-4e9f-9ca9-ce94510e2b9b", "e9512159-7a81-4d7c-8c8c-81ab1b358c96", "834f95bc-9d00-4c49-a573-aa3eafa255c3", "d3d12375-6be9-4bdd-b6c5-10bcfd54b50e", "14a8b080-2bf9-44bc-9618-3394b9567b2d", "2175e12f-385b-4b2a-9237-f0130c2fb8eb", "911859cd-7f6c-4fe0-8ee3-9e684bccb73a", "1e90ad9e-238c-4fb8-acd2-d73a4cf694ff", "dbbcfea6-920f-4239-8afc-482946b34581", "7b5b7b4f-d487-4b3b-a79c-fd1ea5246420", "99ceb323-8e6d-40b4-903b-cd1558f11f44", "4313a57f-3b21-453c-950b-aec458675414", "539160b9-4e6e-4989-aa5c-5e7a85984e0b", "dc082076-04b1-46fc-be0f-28826eadf2c9", "b6117922-9ee1-48c7-9ce1-df9a2464dda9", "5be98382-edcf-41a4-a0d1-aca5055937be", "b383b916-533b-4e10-8cd8-c9d469895052", "4b267deb-bc41-4d7f-a4c6-6bd482dd7226", "f842c4d1-45ee-4961-ba33-63c6bffef832", "ad7df69b-f763-4c22-978a-7396ee507bba", "db2c09ed-694c-4fc3-b686-6c067f7d28b3", "8895b576-97f0-447f-91bf-58e4b13f802b", "a34784ac-ce09-4a46-9245-cfe2c9911c2b", "cf27756b-ce41-4b28-b2d9-098c10374377", "103e6bf2-de76-4f84-a512-cab7b5276b4d", "3187cfb0-3e97-4df0-9d0f-8db505a876dd", "cb24b2dc-519a-47bf-be8c-de9f51d0e03e", "3736174c-fd8b-46f5-859d-af4d07492a93", "8642c307-e8bd-4b7e-b8e2-c4b05c98de77", "15efe6a6-fa90-42cd-b710-04b5a2389f65", "207a3244-0654-42ac-be16-be98ecb1ea6c", "9d31e981-8556-4663-8984-576639c37441", "cf9de71c-0a5f-4f53-9c4f-b8c4f3964262", "aafde7aa-835f-475b-8cab-668c6b05704c", "a2ad3157-f176-4f4f-94ae-b305ee51f48a", "4c344ea9-8d43-4551-9ce3-bd66e4fea7cd", "78e5cd29-518a-42ec-9d15-152b34449476", "c0b7522b-d6eb-41d7-9bc3-daf5274491cf", "1f3a4cdc-32da-48a6-8d2b-3ab3523417ab", "a2a29eee-6f8d-4908-aa4b-1e490482ae61", "a059bd9d-d79c-46e5-801e-8f7c1912f478", "a2188297-1752-49e4-b910-3316f172d3f2", "6eb72a2d-3ee1-4603-86d0-b343b4ca7dd1", "abede5df-8edd-4082-88c2-4b772443e1d6", "11faf07d-8617-449a-92b8-05e40ee6ea03", "e6611636-7fde-4f37-87fd-776fc7c6cea6", "ea869fe0-e207-421a-9475-b045e1030833", "e7040f3a-c59b-451c-b51b-70bd1ad205bc", "b467f9d2-188a-4081-aa06-a831cdab792e", "4809bbe2-1f35-4260-9282-db93bec683c9", "5726cf6b-a7bf-4fe4-8d95-6646067a7078", "e9a4310c-2a67-44d9-9251-4a6929764554", "197e95bd-32e5-434b-8482-a6ebfc882682", "61be3623-a422-406c-b6e9-34bfabd10786", "3da8fbc1-763c-4ab4-99fb-0e993fc47852", "8073a470-4e8f-4292-827a-b2b6b84278ec", "a47de0ce-96a5-48f6-9d41-4cc9743dccb3", "c34f05be-8d75-4c52-b9fb-f1213e49e8f6", "17486fcd-2f00-404a-91e3-9073972d0a9d", "aa927d32-9c56-4f16-aa11-6f995adb0c0d", "28027bf3-0a44-4ce6-a426-fd1590ff253b", "a30050e7-8a58-4726-87f9-89d15933a01b", "2a719a45-202a-4151-a564-89c6aef663ba", "6b975ea4-a6aa-47d6-8904-e201ee8aff79", "bc0b2650-5bcc-496c-93d4-654383988543", "bb2f92e4-8be3-4793-91b8-8a182de9292e", "811640ef-3878-4be9-b29c-ae91a7ab6355", "91583c47-ba2e-4df8-87fa-711bad10f892", "756a48fe-ac3c-4167-8813-ce11eac948a1", "3137224b-bc5b-45e9-bb9a-ad3db7421a16", "010b04ce-b72d-4c0b-a25e-c60ed7201e02", "5cb054a9-167d-4be7-bfdc-67003c896d74", "72abf51c-5ba4-46a7-8f96-95ed425fccac", "cdc8f454-80bc-454d-a032-016755985608", "1a562c84-1ce0-4d9c-a13d-c76c844d1b40", "48bb7e6a-0b08-41dd-8030-89445276d78a", "c35b45ee-bf16-4aaf-b4e0-b29e3b9b7b08" ]
}